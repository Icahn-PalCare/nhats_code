= V4 Outline MultiLine NoSorting TabWidth=30

H="NHATS Data Cleaning Part 1 (1_combine_waves)"
/*Combines rounds 1 and 2 sample person SP interview files,
sensitive demo files and the round 2 cumulative tracker file case 
status variables into a single file

Data format is multiple observations per subject, one for each round
*/

capture log close
clear all
set more off

local logs E:\nhats\nhats_code\NHATS data setup\logs\
log using "`logs'1_nhats_setup1.txt", text replace
local r1raw E:\nhats\data\NHATS Public\round_1\
local r2raw E:\nhats\data\NHATS Public\round_2\
local r3raw E:\nhats\data\NHATS Public\round_3\
local r4raw E:\nhats\data\NHATS Public\round_4\
local r5raw E:\nhats\data\NHATS Public\round_5\
local r6raw E:\nhats\data\NHATS Public\round_6\
local work E:\nhats\data\NHATS working data
local r1s E:\nhats\data\NHATS Sensitive\r1_sensitive\
local r2s E:\nhats\data\NHATS Sensitive\r2_sensitive\
local r3s E:\nhats\data\NHATS Sensitive\r3_sensitive\
local r4s E:\nhats\data\NHATS Sensitive\r4_sensitive\
local r5s E:\nhats\data\NHATS Sensitive\r5_sensitive\
local r6s E:\nhats\data\NHATS Sensitive\r6_sensitive\
local logs E:\nhats\nhats_code\NHATS data setup\logs\

cd "`work'"
*********************************************

//round 1
use "`r1raw'NHATS_Round_1_SP_File.dta"
//check to make sure sample ids are unique
sort spid 
quietly by spid: gen dup = cond(_N==1,0,_n)
tab dup
capture gen wave=1
la var wave "Survey wave"
save round_1_1.dta, replace
clear

//round 2
use "`r2raw'NHATS_Round_2_SP_File_v2.dta"
//check to make sure sample ids are unique
sort spid 
quietly by spid: gen dup = cond(_N==1,0,_n)
tab dup
capture gen wave=2
la var wave "Survey wave"
save round_2_1.dta, replace
clear 

//round 3
use "`r3raw'NHATS_Round_3_SP_File.dta"
//check to make sure sample ids are unique
sort spid 
quietly by spid: gen dup = cond(_N==1,0,_n)
tab dup
capture gen wave=3
la var wave "Survey wave"
save round_3_1.dta, replace
clear 

//round 4
use "`r4raw'NHATS_Round_4_SP_File.dta"
//check to make sure sample ids are unique
sort spid 
quietly by spid: gen dup = cond(_N==1,0,_n)
tab dup
capture gen wave=4
la var wave "Survey wave"
save round_4_1.dta, replace
clear 

//round 5
use "`r5raw'NHATS_Round_5_SP_File.dta"
//check to make sure sample ids are unique
sort spid 
quietly by spid: gen dup = cond(_N==1,0,_n)
tab dup
capture gen wave=5
la var wave "Survey wave"
save round_5_1.dta, replace
clear 

//round 6 
use "`r6raw'NHATS_Round_6_SP_File.dta"
//check to make sure sample ids are unique
sort spid
quietly by spid: gen dup = cond(_N==1,0,_n)
tab dup
capture gen wave=6
la var wave "Survey Wave"
save round_6_1.dta, replace
clear



//round 1
foreach w in 1 2 3 4 5 6{
use round_`w'_1.dta

if `w'!=1 local pd pd* 

//keep selected variables only
local keepallwaves spid wave r`w'dresid w`w'varunit w`w'anfinwgt0 w`w'varstrat  ///
	mo* r`w'd2intvrage hh`w'martlstat ///
	ip`w'cmedicaid ip`w'mgapmedsp ip`w'nginsnurs ip`w'covmedcad ip`w'covtricar ///
	hh* hc* ss* pc* cp* cg* ha* sc* mc* sd* pa* hw* ///
	is`w'* ht`w'placedesc fl`w'* ir* cm* ew* hp* sn* dt* `pd' gr* wa* r`w'dorigwksc ///
	r`w'dnhatswksc r`w'dnhatsgrav r`w'dnhatsgrb wb*

if `w'==1 {	
keep `keepallwaves' r`w'dgender rl`w'dracehisp rl`w'spkothlan rl`w'condspanh el`w'higstschl ///
ia`w'*  re`w'resistrct re1dcensdiv
}

if `w'==2 {	
keep `keepallwaves' re2intplace re2newstrct re2spadrsnew re2dresistrct ///
	re2dadrscorr re2dcensdiv ip2nginslast
}

if `w'==3 {	
keep `keepallwaves' re3intplace re3newstrct re3spadrsnew re3dresistrct ///
	re3dcensdiv ip3nginslast ia*
}
if `w'==4 {	
keep `keepallwaves' re4intplace re4newstrct re4spadrsnew re4dresistrct ///
	re4dcensdiv ip4nginslast
}
if `w'==5 {	
keep `keepallwaves' r`w'dgender rl`w'dracehisp rl`w'spkothlan rl`w'condspanh el`w'higstschl re5intplace re5newstrct re5spadrsnew re5dresistrct ///
	re5dcensdiv ip5nginslast ia`w'*
}	
if `w'==6 {	
keep `keepallwaves' re6intplace re6newstrct re6spadrsnew re6dresistrct ///
	re6dcensdiv ip6nginslast
	
}
save round_`w'_ltd.dta, replace
}

//check sensitive data files, keep only some variables, merge with ltd datasets
foreach w in 1 2 3 4 5 6{
	use "`r`w's'NHATS_Round_`w'_SP_Sen_Dem_File.dta"
	sort spid 
	quietly by spid: gen dup = cond(_N==1,0,_n)
	tab dup	
	clear
}

//combine 3 waves into single dataset
use round_1_ltd.dta
append using round_2_ltd.dta
append using round_3_ltd.dta
append using round_4_ltd.dta
append using round_5_ltd.dta
append using round_6_ltd.dta

//merge in sensitive data, use r1 as basis, added in cancer vars
merge m:1 spid using "`r1s'NHATS_Round_1_SP_Sen_Dem_File.dta", ///
	keepusing(r1dbirthmth r1dbirthyr r1dintvwrage hh1modob hh1yrdob hh1dspousage ///
	rl1primarace rl1hisplatno hc1cancerty*)	

drop _merge

//merge in additional r2 sensitive data
merge m:1 spid using "`r2s'NHATS_Round_2_SP_Sen_Dem_File.dta", ///
	keepusing(r2dintvwrage hh2dspousage r2ddeathage pd2mthdied pd2yrdied)
drop _merge

//merge in additional r3 sensitive data
merge m:1 spid using "`r3s'NHATS_Round_3_SP_Sen_Dem_File.dta", ///
	keepusing(r3dintvwrage hh3dspousage r3ddeathage pd3mthdied pd3yrdied)
drop _merge

//merge in additional r4 sensitive data
merge m:1 spid using "`r4s'NHATS_Round_4_SP_Sen_Dem_File.dta", ///
	keepusing(r4dintvwrage hh4dspousage r4ddeathage pd4mthdied pd4yrdied)
drop _merge

//merge in additional r5 sensitive data
merge m:1 spid using "`r5s'NHATS_Round_5_SP_Sen_Dem_File.dta", ///
	keepusing(r5dintvwrage hh5spageall r5ddeathage pd5mthdied pd5yrdied)
drop _merge

//merge in additional r6 sensitive data
merge m:1 spid using "`r6s'NHATS_Round_6_SP_Sen_Dem_File.dta", ///
	keepusing(r6dintvwrage hh6spageall r6ddeathage pd6mthdied pd6yrdied)
drop _merge

//3B?
//merge in tracker status information
merge m:1 spid using "`r6raw'NHATS_Round_6_Tracker_File", ///
	keepusing(yearsample r6status r6spstat r6spstatdtmt r6spstatdtyr r6fqstatdtmt r5status r5spstat r5spstatdtmt r5spstatdtyr r5fqstatdtmt r4status r4spstat r4spstatdtmt r4spstatdtyr r4fqstatdtmt r3status r3spstat r3spstatdtmt r3spstatdtyr r3fqstatdtmt ///
		r2status r2spstat r2spstatdtmt r2spstatdtyr r2fqstatdtmt r1status r1spstat r1spstatdtmt r1spstatdtyr ///
		r1fqstatdt*)

//merge in nsoc tracker information
merge m:1 spid using "`r1s'NSOC_Round_1_SP_tracker_file", nogen
//drop obs that are in tracker file but not sp file
drop if _merge==2
drop _merge	
save round_1_to_6.dta, replace

*********************************************
log close


H="NHATS Data Cleaning Part 2 (1a_help_hours_imputation)"
/*this section uses the SP and OP R1,2&3 data files and imputes
hours of help provided to SP per methods in NHATS Technical Paper #7

Variables from this dataset are then brought in to the SP R 1,2,3 dataset
and also the NSOC caregiver dataset*/

capture log close
clear all
set more off

local logs E:\nhats\nhats_code\NHATS data setup\logs
//local logs /Users/rebeccagorges/Documents/data/nhats/logs/
log using "`logs'1a-help_hours_imputation-LOG.txt", text replace

//PC file paths
local r1raw "E:\nhats\data\NHATS Public\round_1\"
local r2raw "E:\nhats\data\NHATS Public\round_2\"
local r3raw "E:\nhats\data\NHATS Public\round_3\"
local r4raw "E:\nhats\data\NHATS PUBLIC\round_4\"
local r5raw "E:\nhats\data\NHATS PUBLIC\round_5\"
local r6raw "E:\nhats\data\NHATS Public\round_6\"
local work "E:\nhats\data\NHATS working data\"
local r1s "E:\nhats\data\NHATS Sensitive\r1_sensitive\"
local r2s "E:\nhats\data\NHATS Sensitive\r2_sensitive\"
local r3s "E:\nhats\data\NHATS Sensitive\r3_sensitive\"
local r4s "E:\nhats\data\NHATS Sensitive\r4_sensitive\"
local r5s "E:\nhats\data\NHATS Sensitive\r5_sensitive\"
local r6s "E:\nhats\data\NHATS Sensitive\r6_sensitive\"

/* //Rebecca mac file paths
local r1raw /Users/rebeccagorges/Documents/data/nhats/round_1/
local r2raw /Users/rebeccagorges/Documents/data/nhats/round_2/
local r3raw /Users/rebeccagorges/Documents/data/nhats/round_3/
local work /Users/rebeccagorges/Documents/data/nhats/working
local r1s /Users/rebeccagorges/Documents/data/nhats/r1_sensitive/
local r2s /Users/rebeccagorges/Documents/data/nhats/r2_sensitive/ 
 */
 
cd "`work'"

**User note: This section can be commented out after run one time to set up datasets
********************************************************************
//combine op and sp data files

//round 1
use "`r1raw'NHATS_Round_1_OP_File_v2.dta", clear
sort spid opid 

merge m:1 spid using round_1_1.dta //bring in sorted sp ivw dataset
keep if _merge==3 //drop obs with no OP entries
save R1_OPSPlinked.dta, replace

//round 2
use "`r2raw'NHATS_Round_2_OP_File_v2.dta", clear
sort spid opid

merge m:1 spid using round_2_1.dta //bring in sorted sp ivw dataset
keep if _merge==3 //drop obs with no OP entries
save R2_OPSPlinked.dta, replace

//round 3
use "`r3raw'NHATS_Round_3_OP_File.dta", clear
sort spid opid

merge m:1 spid using round_3_1.dta //bring in sorted sp ivw dataset
keep if _merge==3 //drop obs with no OP entries
save R3_OPSPlinked.dta, replace

//round 4
use "`r4raw'NHATS_Round_4_OP_File.dta", clear
sort spid opid

merge m:1 spid using round_4_1.dta //bring in sorted sp ivw dataset
keep if _merge==3 //drop obs with no OP entries
save R4_OPSPlinked.dta, replace

//round 5
use "`r5raw'NHATS_Round_5_OP_File.dta", clear
sort spid opid

merge m:1 spid using round_5_1.dta //bring in sorted sp ivw dataset
keep if _merge==3 //drop obs with no OP entries
save R5_OPSPlinked.dta, replace

//round 6
use "`r6raw'NHATS_Round_6_OP_File.dta", clear
sort spid opid

merge m:1 spid using round_6_1.dta //bring in sorted sp ivw dataset
keep if _merge==3 //drop obs with no OP entries
save R6_OPSPlinked.dta, replace


foreach w in 1 2 3 4 5 6{
	use R`w'_OPSPlinked.dta
	
//now create limited datasets for each wave with only needed variables
local keeplist spid op* wave  w`w'anfinwgt0 w`w'varstrat w`w'varunit r`w'dresid ///
 mo`w'douthelp mo`w'dinsdhelp mo`w'dbedhelp sc`w'deathelp sc`w'dbathhelp ///
 sc`w'dtoilhelp sc`w'ddreshelp ha`w'dlaunreas ha`w'dshopreas ha`w'dmealreas ///
 ha`w'dbankreas mc`w'dmedsreas
 
	keep `keeplist'
	save R`w'_OPSPltd.dta, replace
}

********************************************************************
//merge into single file for initial setup
use R1_OPSPltd.dta, clear
append using R2_OPSPltd.dta
append using R3_OPSPltd.dta
append using R4_OPSPltd.dta
append using R5_OPSPltd.dta
append using R6_OPSPltd.dta

save R1234_OPSPltd.dta, replace
********************************************************************
use R1234_OPSPltd.dta, clear

tab wave, missing

********************************************************************
//recode helper time variables to -1 (na) if not helper per flag variable
**Note, these OP variables are backfilled from wave to wave
gen opishelper_allw=.
foreach w in 1 2 3 4 5 6{
tab op`w'ishelper wave, missing //helper flag variable
replace opishelper_allw=op`w'ishelper if wave==`w'
}
tab opishelper_allw wave, missing

foreach w in 1 2 3 4 5 6{
	foreach v in op`w'helpsched op`w'numdayswk op`w'numdaysmn op`w'numhrsday {
		tab `v' if op`w'ishelper==-1 & wave==`w', missing
		replace `v'=-1 if op`w'ishelper==-1 & wave==`w'
	}
}
//generate indicator of help with any task that has monthly reference period
gen month=.
foreach w in 1 2 3 4 5 6{
replace month=0 if wave==`w'
replace month=1 if (op`w'outhlp==1 | op`w'insdhlp==1 | op`w'bedhlp==1 | ///
 op`w'tkplhlp1==1 | op`w'tkplhlp2==1 | op`w'launhlp==1 | op`w'shophlp==1 | ///
 op`w'mealhlp==1 | op`w'bankhlp==1 | op`w'eathlp==1 | op`w'bathhlp==1 | ///
 op`w'toilhlp==1 | op`w'dreshlp==1 | op`w'medshlp==1) & wave==`w'
} 
tab month wave, missing

 //generate indicator of help with any task that has yearly reference period
gen year=.
foreach w in 1 2 3 4 5 6{
replace year=0 if wave==`w'
replace year=1 if (op`w'moneyhlp==1 | op`w'dochlp==1 | op`w'insurhlp==1) & wave==`w'
tab year month if wave==`w', missing
}

//generate indicator of help in last year but not last month
gen yearnotmonth=0
replace yearnotmonth=1 if year==1 & month==0
tab yearnotmonth wave, missing
********************************************************************
//pull variable for sits in with doctor
gen op_doc_help=.
forvalues i=1/6 {
	replace op_doc_help=op`i'dochlp if wave==`i'
}
********************************************************************
//generate SP received help with self care or mobility activity or 
//household activity for health and functioning reasons
gen disab=.
foreach w in 1 2 3 4 5 6{
replace disab=0 if wave==`w'
//self care or mobility, assumed to be for health reasons
replace disab=1 if (mo`w'douthelp==2 | mo`w'dinsdhelp==2 | mo`w'dbedhelp==2 | ///
 sc`w'deathelp==2 | sc`w'dbathhelp==2 | sc`w'dtoilhelp==2 | sc`w'ddreshelp==2) & wave==`w'
//household activity for health or functioning reasons or in residential care
**note this is different from tech paper #7 because codes disab=1 if 1,3 or 4
**not just if 3 or 4
foreach v in ha`w'dlaunreas ha`w'dshopreas ha`w'dmealreas ha`w'dbankreas mc`w'dmedsreas{
replace disab=1 if inlist(`v',1,3,4) & wave==`w'
}
}
tab disab wave, missing

********************************************************************
//flag variable for hours/month reported, valid
tab op1dhrsmth wave, missing //derived hours/month from HL section
gen op_ind_hrsmth=.
foreach w in 1 2 3 4 5 6{
replace op_ind_hrsmth=op`w'dhrsmth if wave==`w'
}
recode op_ind_hrsmth (1/750=1)

la def hrsmth -13"-13:Deceased" -12"Zero days/wk" -11"-11:hours missing" ///
 -10"-10:days missing" -9 "-9:days+hours mssing" -1"-1:NA" 1"1:Valid" 9999"9999:<1hr/day",replace
la val op_ind_hrsmth hrsmth 
tab op_ind_hrsmth wave, missing

//generate variable indicating one day per month or one day per week
gen justone=.
foreach w in 1 2 3 4 5 6{
replace justone=0 if wave==`w'
replace justone=1 if (op`w'numdayswk==1 | op`w'numdaysmn==1) & wave==`w'
}
tab justone op_ind_hrsmth, missing

//recode help flags to 0=(no or inapplicable) or 1=yes
foreach w in 1 2 3 4 5 6{
foreach v in op`w'outhlp op`w'insdhlp op`w'bedhlp op`w'tkplhlp1 op`w'tkplhlp2 op`w'launhlp ///
 op`w'shophlp op`w'mealhlp op`w'bankhlp op`w'eathlp op`w'bathhlp op`w'toilhlp op`w'dreshlp ///
 op`w'medshlp op`w'moneyhlp op`w'dochlp op`w'insurhlp{
tab `v' if wave==`w', missing
replace `v'=0 if `v'==-1 & wave==`w'
}
}

//generate variable indicating help with only one activity
gen numact=.
foreach w in 1 2 3 4 5 6{
replace numact=op`w'outhlp + op`w'insdhlp + op`w'bedhlp + op`w'tkplhlp1 + op`w'tkplhlp2 + ///
 op`w'launhlp + op`w'shophlp + op`w'mealhlp + op`w'bankhlp + op`w'eathlp + op`w'bathhlp + ///
 op`w'toilhlp + op`w'dreshlp + op`w'medshlp + op`w'moneyhlp + op`w'dochlp + op`w'insurhlp if wave==`w'
}

tab numact wave, missing
gen oneact=0 //note this =0 if help with no activities
replace oneact=1 if numact==1
tab oneact opishelper_allw, missing

********************************************************************
//generate variables indicating relationship is spouse, other rel, other nonrel
gen spouse=.
gen otherrel=.
gen nonrel=.
gen daughter=0
gen son=0
gen oth_fam=0

label var otherrel "Non-spouse relative"
label var oth_fam "Family member of SP, not spouse, son, or daughter"
label var nonrel "Non-relative"

foreach w in 1 2 3 4 5 6{
replace spouse=0 if wave==`w'
replace spouse=1 if op`w'relat==2 & wave==`w'
replace otherrel=0 if wave==`w'
replace otherrel=1 if ((op`w'relat>2 & op`w'relat<=29) | op`w'relat==91) & wave==`w'
replace nonrel=0 if wave==`w'
replace nonrel=1 if (op`w'relat>=30 & op`w'relat~=91) & wave==`w'
replace daughter=1 if inlist(op`w'relat,3,5,7) & wave==`w'
replace son=1 if inlist(op`w'relat,4,6,8) & wave==`w'
replace oth_fam=1 if ((op`w'relat>8 & op`w'relat<=29) | op`w'relat==91) & wave==`w'

tab op`w'relat spouse
tab op`w'relat otherrel
tab op`w'relat nonrel

}

tab spouse wave, missing
tab otherrel wave, missing
tab nonrel wave, missing

********************************************************************
//generate variables indicating help w/ adls & iadls
local adl insd bed eat bath toil dres
local iadl laun shop meal bank meds 
local nonadl out money tkpl
forvalues i=1/6 {
	gen op`i'tkplhlp=op`i'tkplhlp1==1 | op`i'tkplhlp2==1
}

foreach x of local adl {
	gen op_adl_`x'=0
}
foreach x of local iadl {
	gen op_iadl_`x'=0
}
foreach x of local nonadl {
	gen op_nonadl_`x'=0
}

forvalues i=1/6 {
	foreach x of local adl{
		replace op_adl_`x'=1 if op`i'`x'hlp==1 & wave==`i'
}
	foreach x of local iadl {
		replace op_iadl_`x'=1 if op`i'`x'hlp==1 & wave==`i'
}
	foreach x of local nonadl {
		replace op_nonadl_`x'=1 if op`i'`x'hlp==1 & wave==`i'
}
}

********************************************************************
//generate variables indicating help on a regular schedule
gen regular=.
foreach w in 1 2 3 4 5 6{
replace regular=0 if wave==`w'
replace regular=1 if op`w'helpsched==1 & wave==`w'
}
tab regular wave, missing

la def hrsmth -13"-13:Deceased" -12"-12:Zero days/wk" -11"-11:hours missing" ///
 -10"-10:days missing" -9 "-9:days+hours mssing" -1"-1:NA" 1"1:Valid" 9999"9999:<1hr/day",replace
la val op_ind_hrsmth hrsmth 

tab op_ind_hrsmth wave

tab op_ind_hrsmth yearnotmonth if wave==1 & opishelper_allw==1
tab op_ind_hrsmth yearnotmonth if wave==2 & opishelper_allw==1

tab opishelper_allw

//generate indicator of imputation category
//1=impute, 2=recode to zero, 3=recode to small number hrs/day, 4=no imputation needed
gen impute_cat=-1

//wave=1
	//1=impute
	replace impute_cat=1 if inlist(op_ind_hrsmth,-11,-10) | ///
	(op_ind_hrsmth==-9 & yearnotmonth==0) & op1ishelper==1 & wave==1
	replace impute_cat=1 if op_ind_hrsmth==9999 & (op1numdayswk==1 | op1numdaysmn==1) ///
	 & yearnotmonth==0 & op1ishelper==1 & wave==1
	//2=recode to zero
	replace impute_cat=2 if op_ind_hrsmth==-9 & yearnotmonth==1 & op1ishelper==1 & wave==1
	replace impute_cat=2 if op_ind_hrsmth==9999 & (op1numdayswk==1 | op1numdaysmn==1) ///
	& yearnotmonth==1 & op1ishelper==1 & wave==1
	//3=set to small number
	replace impute_cat=3 if op_ind_hrsmth==9999 & ///
	(op1numdayswk~=1 & op1numdaysmn~=1) & op1ishelper==1 & wave==1
	//4=imputation not necessary, complete info
	replace impute_cat=4 if op_ind_hrsmth==1 & op1ishelper==1 & wave==1

//if wave==2 | wave==3 | wave == 4
	//1=impute, wave 2,3 criteria
	replace impute_cat=1 if inlist(op_ind_hrsmth,-11,-9) & opishelper_allw==1 & inlist(wave,2,3,4,5,6)
	replace impute_cat=1 if op_ind_hrsmth==-12 & yearnotmonth==0 & opishelper_allw==1 & inlist(wave,2,3,4,5,6)
	//2=recode to zero, wave 2, 3
	replace impute_cat=2 if op_ind_hrsmth==-12 & yearnotmonth==1 & opishelper_allw==1 & inlist(wave,2,3,4,5,6)
	//3=recode to small number
	replace impute_cat=3 if op_ind_hrsmth==9999 & opishelper_allw==1 & inlist(wave,2,3,4,5,6)
	//4=imputation not necessary
	replace impute_cat=4 if op_ind_hrsmth==1 & opishelper_allw==1 & inlist(wave,2,3,4,5,6)

la def impute_cat -1"N/A, not helper" 1"Impute" 2"Recode to zero" ///
3"Recode to small number" 4"No imputation needed"
la val impute_cat impute_cat
tab impute_cat wave, missing

tab impute_cat op_ind_hrsmth if wave==1, missing
tab impute_cat op_ind_hrsmth if wave==2, missing
tab impute_cat op_ind_hrsmth if wave==3, missing
tab impute_cat op_ind_hrsmth if wave==4, missing
tab impute_cat op_ind_hrsmth if wave==5, missing
tab impute_cat op_ind_hrsmth if wave==6, missing

********************************************************************
//save separate datasets for r 1 2 & 3 so can run imputation with weighting
foreach w in 1 2 3 4 5 6{
preserve
keep op* wave numact yearnotmonth disab w`w'anfinwgt0 w`w'varstrat w`w'varunit ///
 r`w'dresid spid justone spouse otherrel nonrel regular oneact impute_cat son ///
 daughter oth_fam 
keep if wave==`w'
save R`w'_for_hrs_impute.dta,replace
restore
}
*/
********************************************************************
//implement matching, do separately for each wave
foreach w in 1 2 3 4 5 6{
use R`w'_for_hrs_impute.dta, clear

svyset w`w'varunit [pweight=w`w'anfinwgt0], strata(w`w'varstrat)

//wave 1 imputation... need to check what is different if anything for wave 2
gen op_hrsmth_i=0
replace op_hrsmth_i=op`w'dhrsmth if impute_cat==4  //use actual value
replace op_hrsmth_i=0 if impute_cat==2 //set to zero
replace op_hrsmth_i=(.5*op`w'numdayswk*4.3) if impute_cat==3 & op`w'helpsched==1 //assign small hours
replace op_hrsmth_i=(.5*op`w'numdaysmn) if impute_cat==3 & inlist(op`w'helpsched,2,-7,-8)  //assign small hours

//impute where op_ind_hrsmth=-10, missing days per month
gen op_numdays_i=0
replace op_numdays_i=op`w'numdayswk*4.3 if inlist(impute_cat,3,4) & op`w'helpsched==1
replace op_numdays_i=op`w'numdaysmn if inlist(impute_cat,3,4) & inlist(op`w'helpsched,2,-7,-8)

gen ln_opnumdays_i=ln(op_numdays_i) if inlist(impute_cat,3,4)

local adjvars spouse otherrel regular yearnotmonth oneact disab ///
 op`w'outhlp op`w'insdhlp op`w'bedhlp op`w'tkplhlp1 op`w'tkplhlp2 op`w'launhlp ///
 op`w'shophlp op`w'mealhlp op`w'bankhlp op`w'eathlp op`w'bathhlp op`w'toilhlp ///
 op`w'dreshlp op`w'medshlp op`w'moneyhlp op`w'dochlp op`w'insurhlp

svy: reg ln_opnumdays_i `adjvars' if inlist(impute_cat,3,4)
predict ln_opnumdays_i2 if impute_cat==1 & op_ind_hrsmth==-10
gen op_numdays_i2=exp(ln_opnumdays_i2) if impute_cat==1 & op_ind_hrsmth==-10
replace op_hrsmth_i= op_numdays_i2*op`w'numhrsday if impute_cat==1 & ///
 op_ind_hrsmth==-10 & op`w'numhrsday>=1
replace op_hrsmth_i= op_numdays_i2*.5 if impute_cat==1 & ///
 op_ind_hrsmth==-10 & op`w'numhrsday==0

//impute where op_ind_hrsmth=-11, missing hours per day
gen op_numhrsday_i=0
replace op_numhrsday_i=.5 if impute_cat==3
replace op_numhrsday_i=op`w'numhrsday if impute_cat==4
gen ln_opnumhrsday_i=ln(op_numhrsday_i) if inlist(impute_cat,3,4)
svy: reg ln_opnumhrsday_i `adjvars' if inlist(impute_cat,3,4)
predict ln_opnumhrsday_i2 if impute_cat==1 & op_ind_hrsmth==-11
gen op_numhrsday_i2=exp(ln_opnumhrsday_i2) if impute_cat==1 & op_ind_hrsmth==-11
replace op_hrsmth_i=op`w'numdayswk*4.3*op_numhrsday_i2 if impute_cat==1 & ///
 op_ind_hrsmth==-11 & op`w'helpsched==1
replace op_hrsmth_i=op`w'numdaysmn*op_numhrsday_i2 if impute_cat==1 & ///
 op_ind_hrsmth==-11 & inlist(op`w'helpsched,2,-7,-8) & op`w'numdaysmn>=1
replace op_hrsmth_i=op`w'numdayswk*4.3*op_numhrsday_i2 if impute_cat==1 & ///
 op_ind_hrsmth==-11 & inlist(op`w'helpsched,2,-7,-8) & ///
 op`w'numdaysmn<1 & op`w'numdayswk>=1 

//impute where op_ind_hrsmth=-9, -12 or 9999, missing hours and days or <1hr/day
gen ln_opdhrsmth_i=ln(op_hrsmth_i) if inlist(impute_cat,3,4)
svy: reg ln_opdhrsmth_i `adjvars' if inlist(impute_cat,3,4)
predict ln_opdhrsmth_i2 if impute_cat==1 & inlist(op_ind_hrsmth,-9,-12,9999)
gen op_hrsmth_i2=exp(ln_opdhrsmth_i2) if impute_cat==1 & inlist(op_ind_hrsmth,-9,-12,9999)
replace op_hrsmth_i=op_hrsmth_i2 if impute_cat==1 & inlist(op_ind_hrsmth,-9,-12,9999)
replace op_hrsmth_i=-1 if op`w'ishelper~=1 

//look at imputed hours per month by imputation category
di "where op_ind_hrsmth==-12"
capture noisily: mean op_hrsmth_i if impute_cat==1 & op_ind_hrsmth==-12 [pweight=w`w'anfinwgt0]
di "where op_ind_hrsmth==-11"
mean op_hrsmth_i if impute_cat==1 & op_ind_hrsmth==-11 [pweight=w`w'anfinwgt0]
di "where op_ind_hrsmth==-10"
capture noisily: mean op_hrsmth_i if impute_cat==1 & op_ind_hrsmth==-10 [pweight=w`w'anfinwgt0]
di "where op_ind_hrsmth==-9"
mean op_hrsmth_i if impute_cat==1 & op_ind_hrsmth==-9 [pweight=w`w'anfinwgt0] 
di "where op_ind_hrsmth==9999"
capture noisily: mean op_hrsmth_i if impute_cat==1 & op_ind_hrsmth==9999 [pweight=w`w'anfinwgt0] 

di "impute_cat==2"
mean op_hrsmth_i if op_hrsmth_i~=-1 & impute_cat==2 [pweight=w`w'anfinwgt0]
di "impute_cat==3"
mean op_hrsmth_i if op_hrsmth_i~=-1 & impute_cat==3 [pweight=w`w'anfinwgt0]
di "impute_cat==4"
mean op_hrsmth_i if op_hrsmth_i~=-1 & impute_cat==4 [pweight=w`w'anfinwgt0]

save R`w'_hrs_imputed_added.dta,replace

}

********************************************************************
log close


H="NHATS Data Cleaning Part 3 (2_r12_cleaning_1_1)"
capture log close
clear all
set more off

local logs "E:\nhats\nhats_code\NHATS data setup\logs"
//local logs /Users/rebeccagorges/Documents/data/nhats/logs/

log using "`logs'2_nhats_cleaning.txt", text replace

local work "E:\nhats\data\NHATS working data\"
//local work /Users/rebeccagorges/Documents/data/nhats/working

cd "`work'"
use round_1_to_6.dta
*********************************************
tab wave, missing

*********************************************
//interview type, varies by wave, use tracker status variables

tab r3spstat if wave==3
tab r3status if wave==3

gen ivw_type=3
replace ivw_type=1 if r1spstat==20 & wave==1 

foreach w in 2 3 4 5 6{
	replace ivw_type=1 if (r`w'spstat==20 & r`w'status!=62) & wave==`w'
	replace ivw_type=2 if (r`w'spstat==20 & r`w'status==62) & wave==`w'
}

la def ivw_type 1 "Alive, SP interview completed" 2"Died, proxy SP LML interview completed" ///
	3"SP interview not completed"
la val ivw_type ivw_type
tab ivw_type wave, missing

tab r1status r1spstat if wave==1, missing
tab r1dresid r1spstat if wave==1, missing
//compare to old code, if r1dresid=1 or 2, then include in homebound paper
//so use ivw type=1 is the same thing for r1

gen sp_ivw_yes=1 if r1spstat==20 & wave==1
replace sp_ivw_yes=0 if inlist(r1spstat,11,24) & wave==1

foreach w in 2 3 4 5 6{
	tab r`w'status r`w'spstat if wave==`w', missing
	replace sp_ivw_yes=1 if r`w'spstat==20 & wave==`w'
	replace sp_ivw_yes=0 if inlist(r`w'spstat,11,12,24) & wave==`w'
}
la var sp_ivw_yes "SP interview conducted? yes=1" //note this includes lml interviews
tab sp_ivw_yes wave, missing

gen lml_ivw_yes = 0
foreach w in 2 3 4 5 6{
	replace lml_ivw_yes=1 if r`w'spstat==20 & r`w'status==62 & wave==`w'
}
la var lml_ivw_yes "LWL interview? yes=1"

tab sp_ivw_yes lml_ivw_yes, missing
tab lml_ivw_yes wave, missing

tab mo2outoft r2status if wave==2, missing
tab mo3outoft r3status if wave==3, missing

//identify proxy SP interviews
gen proxy_ivw=.
foreach w in 1 2 3 4 5 6{
replace proxy_ivw=1 if is`w'resptype==2
replace proxy_ivw=0 if is`w'resptype==1
}
la var proxy_ivw "Interview via proxy"
tab proxy_ivw wave, missing
tab proxy_ivw wave if ivw_type==1, missing
tab proxy_ivw wave if ivw_type==2, missing

/*missing data convention per user guide
For our purposes, code all as missing
The following codes were used at the item level for missing data of different types:
-7 = Refusal
-8 = Don’t Know
-1 = Inapplicable
-9 = Not Ascertained*/
local miss -9,-1

*********************************************
*********************************************
//definitions of homebound
*********************************************
*********************************************
//how often go out of the house?
gen freq_go_out=.
foreach w in 1 2 3 4 5 6{
	tab mo`w'outoft, missing
	replace freq_go_out=mo`w'outoft if wave==`w'
}

replace freq_go_out=. if inlist(freq_go_out,`miss')
la def freq_go_out 1 "Every day" 2 "Most days (5-6/week)" ///
	3 "Some days (2-4/week)" 4 "Rarely" 5 "Never"
la val 	freq_go_out freq_go_out
la var freq_go_out "How often go outside"
tab freq_go_out sp_ivw_yes, missing
tab freq_go_out sp_ivw_yes if wave==1, missing
tab freq_go_out sp_ivw_yes if wave==2 & lml_ivw_yes==0, missing
tab freq_go_out sp_ivw_yes if wave==2 & lml_ivw_yes==1, missing
tab freq_go_out sp_ivw_yes if wave==3 & lml_ivw_yes==0, missing


//MO questions not asked in lml interviews where persons were not alert(PD6)
//or not mobile(PD7) in last month so lml has more missingless
tab freq_go_out mo2outoft if wave==2 & lml_ivw_yes==1, missing

*********************************************
//Did anyone ever help you - asked if report going outside
//left missing if report never go outside
gen help_go_out=.
foreach w in 1 2 3 4 5 6{
	tab mo`w'outhlp, missing
	replace help_go_out=1 if mo`w'outhlp==1
	replace help_go_out=0 if mo`w'outhlp==2
	replace help_go_out=-7 if mo`w'outhlp==-7
	replace help_go_out=-8 if mo`w'outhlp==-8
}
la var help_go_out "Anyone ever help you leave home?"
tab help_go_out wave if sp_ivw_yes==1, missing

*********************************************
//go out of the house on own?
//only asked if report having help when go outside (help_go_out==1)
gen out_on_own=.
foreach w in 1 2 3 4 5 6{
	tab mo`w'outslf help_go_out if wave==`w', missing
	replace out_on_own=mo`w'outslf if wave==`w'
}
replace out_on_own=. if inlist(out_on_own,`miss')
replace out_on_own=5 if help_go_out==0
replace out_on_own=6 if freq_go_out==5
la def out_on_own 1"Most times" 2"Sometimes" 3"Rarely" 4"Never"5"NA, reported no help" ///
6"NA, never left home"
la val out_on_own out_on_own
la var out_on_own "When left house, left by yourself?"
tab out_on_own wave if sp_ivw_yes==1, missing

*********************************************
//needs help when go outside? gets help and also goes outside on own != never
gen needshelp=0
replace needshelp=1 if help_go_out==1& out_on_own~=4
la var needshelp "Leaves home but with help"
tab needshelp wave, missing

*********************************************
//has difficulty? when you used your walker,cane,etc? how much difficulty
//did you have leaving the house by yourself? 1=none, 2=a little, 3=some, 4=a lot
//inapplicable if don't report using any device to help, so set to 0 here
gen hasdifficulty=0
foreach w in 1 2 3 4 5 6{
	tab mo`w'outdif if wave==`w', missing
	replace hasdifficulty=1 if inlist(mo`w'outdif,2,3,4,5)
	replace hasdifficulty=0 if mo`w'outdif==1
	replace hasdifficulty=-7 if  mo`w'outdif==-7
	replace hasdifficulty=-8 if  mo`w'outdif==-8

}
la var hasdifficulty "Leaves home on own but has difficulty"
tab hasdifficulty wave if sp_ivw_yes==1, missing
*********************************************
//needs help or has difficulty going outside?
gen helpdiff=.
replace helpdiff=0 if needshelp==0 & hasdifficulty==0
replace helpdiff=1 if needshelp==1 | hasdifficulty==1
la var helpdiff "Either needs help or has difficulty going outside"
tab helpdiff wave if sp_ivw_yes==1, missing
*********************************************
//independent - go out some/most days but are independent
gen independent=0
replace independent=1 if help_go_out==0 & hasdifficulty==0
la var independent "Independently leaves home"
tab independent wave if sp_ivw_yes==1, missing

tab independent helpdiff, missing //no overlap
*********************************************
/*homebound categories
0 = never go out
1 = rarely go out
2 = go out but never by self
3 = go out but need help/have difficulty
4 = go out, independent - don't need help or have difficulty
*/
gen homebound_cat=.
replace homebound_cat=1 if freq_go_out==4 | freq_go_out==5
replace homebound_cat=2 if inlist(freq_go_out,3,2,1) & out_on_own==4
replace homebound_cat=3 if inlist(freq_go_out,3,2,1) & helpdiff==1
replace homebound_cat=4 if inlist(freq_go_out,3,2,1) & independent==1

//from technical paper
replace homebound_cat=3 if spid==10009011 & wave==1

la var homebound_cat "Homebound status, categorical"
la def hb 1 "Never/Rarely leaves home" 2 "Leaves home but never by self" ///
3 "Leaves home but needs help/has difficulty" 4 "Independent, not homebound"
la val homebound_cat hb
tab homebound_cat wave if sp_ivw_yes==1, missing
/*binary for never go out, since never/rarely together*/
gen never_go_out=freq_go_out==5 if freq!=.
label var never_go_out "Never leaves home"
*********************************************
/*subcategories for level 4 homeboud category
independent but go out only rarely
independent and go out frequently*/
gen indeplow=0
replace indeplow=1 if freq_go_out==3 & independent==1
la var indeplow "Independent, go out rarely" 

gen indephigh=0
replace indephigh=1 if inlist(freq_go_out,2,1) & independent==1
la var indephigh "Independent, go out often"

tab indeplow wave if sp_ivw_yes==1, missing
tab indephigh wave if sp_ivw_yes==1, missing

*********************************************
*********************************************
//demographic information
*********************************************
*********************************************
//age at interview, note this is missing for wave 3 b/c no wave 3 sensitive data yet
gen age=.
foreach w in 1 2 3 4 5 6{
	replace age=r`w'dintvwrage if wave==`w'
	sum age if wave==`w', detail
	}	
//for last month of life interviews, use age at death variable
tab ivw_type if age==-1, missing
replace age=r2ddeathage if ivw_type==2 & r2dintvwrage==-1
sum age
//some observations that died still have missing age, so set to missing
tab ivw_type if inlist(age,-7,-8)
replace age=. if inlist(age,-7,-8)

la var age "Age at interview or death"
sum age if ivw_type==1, detail
sum age if ivw_type==2, detail
sum age, detail

//gender, only asked in round 1
gen female=.
replace female=1 if r1dgender==2
replace female=0 if r1dgender==1
replace female=1 if r5dgender==2
replace female=0 if r5dgender==1

la var female "Female"
la def female 0"Male" 1"Female"
la val female female
tab female if wave==1, missing
tab rl1dracehisp, missing

//race, ethnicity
gen race_cat=rl1dracehisp
replace race_cat=-8 if inlist(rl1dracehisp,5,6)
label define race 1 "White Non-His" 2 "Black Non-His" 4 "Hispanic" ///
	3 "Other (Am Indian/Asian/Nat. Hawaii)" -8 "DKRF"
label values race_cat race
la var race_cat "Race, categorical"
tab race_cat if wave==1, missing

replace race_cat = 1 if rl5dracehisp==1
replace race_cat = 2 if rl5dracehisp==2
replace race_cat = 3 if rl5dracehisp==3
replace race_cat = 4 if rl5dracehisp==4
replace race_cat = -8 if inlist(rl5dracehisp,5,6) 

//education
generate education=.
replace education=1 if inlist(el1higstschl,1,2,3)
replace education=2 if el1higstschl==4
replace education=3 if inlist(el1higstschl,5,6,7)
replace education=4 if inlist(el1higstschl,8,9)
replace education=-7 if el1higstschl == -7
replace education=-8 if el1higstschl == -8

replace education=1 if inlist(el5higstschl,1,2,3)
replace education=2 if el5higstschl==4
replace education=3 if inlist(el5higstschl,5,6,7)
replace education=4 if inlist(el5higstschl,8,9)


la var education "Education level, categorical"
label define edulbl 1 "<High School" 2 "High School/GED" 3 "Some College" ///
	4 ">=Bachelors" 5 "DKRF"
label values education edulbl
tab education el1higstschl if wave==1, missing

gen educ_hs_ind=education>=2 if education>0 & education!=.

//income, just wave 1
sum ia1totinc, detail //this is the actual reported income, only present 40% sample

forvalues i = 1/5 {
	gen imputed_inc`i'=.
	foreach w in 1 3 5 {
		replace ia`w'toincim`i'=. if inlist(ia`w'toincim`i',-9,-1)
		sum ia`w'toincim`i' if wave==`w',detail //imputed income variables
		replace imputed_inc`i' = ia`w'toincim`i' if wave==`w'
}
		label var imputed_inc`i' "Imputed Income `i'"
}



egen aveincome=rowmean(imputed_inc1-imputed_inc5)
foreach w in 1 3 5 {
	replace aveincome=ia`w'totinc if wave==`w' & ia`w'totinc>=0 & ///
	!missing(ia`w'totinc)
}

sort spid wave
by spid: carryforward aveincome, replace
//use first income imputation to set income categorical variable
gen income_cat=0 if aveincome<15000 & aveincome!=.
replace income_cat=1 if aveincome>=15000 & aveincome<30000 & aveincome!=.
replace income_cat=2 if aveincome>=30000 & aveincome<60000 & aveincome!=.
replace income_cat=3 if aveincome>=60000 & aveincome!=.
label define income_cat 0 "<15000" 1 "15-29,999" 2 "30-59,999" 3 ">60000"
label values income_cat income_cat
tab income_cat, missing

//speak language other than english?
gen otherlang=rl1spkothlan
replace otherlang=0 if rl1spkothlan==2
replace otherlang = 1 if rl1condspanh == 1
replace otherlang = . if inlist(otherlang,-9,-1)
la var otherlang "Speak language other than English?"
tab otherlang wave, missing

replace otherlang=0 if rl5spkothlan==2
replace otherlang=1 if rl5spkothlan==1
replace otherlang=1 if rl5condspanh==1
replace otherlang=. if inlist(rl5spkothlan,-9,-1)


//fill in gender, race, education, income, etc. for wave 2 interviews
sort spid wave
by spid (wave): carryforward female race_cat education income_cat ///
otherlang imputed_inc1 imputed_inc2 imputed_inc3 imputed_inc4 imputed_inc5, replace

gen white=race_cat==1
gen black=race_cat==2
gen hisp=race_cat==4
gen other_race=race_cat==3
label var white "White Non-Hisp"
label var black "Black Non-Hisp"
label var hisp "Hispanic"
label var other_race "Other race/ethnicity"
//merge white & other for reportability
gen whiteoth=white | other_race if !missing(white) & !missing(other_r)
label var whiteoth "White Non-Hispanic or other"
//marital status
//wave 2,3, use derived variable which is populated if not asked b/c no change 
gen maritalstat=hh1martlstat if wave==1
foreach w in 2 3 4 5 6{
	replace maritalstat=hh`w'dmarstat if wave==`w'
}
replace maritalstat=-9 if inlist(maritalstat,`miss')

la var maritalstat "Marital status"
label define maritallbl 1 "Married" 2 "Live w/Part" 3 "Separated" ///
	4 "Divorced" 5 "Widowed" 6 "Never Married" -7 "Refused" -8 "DK"
la val maritalstat maritallbl
tab maritalstat wave, missing




*********************************************
*********************************************
//Insurance coverage
*********************************************
*********************************************
//medicaid status
gen medicaid=.
foreach w in 1 2 3 4 5 6{
	tab ip`w'cmedicaid if wave==`w' , missing
	replace medicaid=1 if ip`w'cmedicaid==1 & wave==`w'
	replace medicaid=0 if ip`w'cmedicaid==2 & wave==`w'
	replace medicaid=-7 if ip`w'cmedicaid==-7 & wave==`w'
	replace medicaid=-8 if ip`w'cmedicaid==-8 & wave==`w'
}
la var medicaid "Medicaid"
tab medicaid wave,missing
tab medicaid if wave==1 & ivw_type==1,missing
//medigap status
gen medigap=.
foreach w in 1 2 3 4 5 6{
	tab ip`w'mgapmedsp if wave==`w' , missing
	replace medigap=1 if ip`w'mgapmedsp==1 & wave==`w'
	replace medigap=0 if ip`w'mgapmedsp==2 & wave==`w'
	replace medigap=-7 if ip`w'mgapmedsp==-7 & wave==`w'
	replace medigap=-8 if ip`w'mgapmedsp==-8 & wave==`w'
}
la var medigap "Medigap"
tab medigap wave,missing

//medicare part d
gen mc_partd=.
foreach w in 1 2 3 4 5 6{
	tab ip`w'covmedcad if wave==`w' , missing
	replace mc_partd=1 if ip`w'covmedcad==1 & wave==`w'
	replace mc_partd=0 if ip`w'covmedcad==2 & wave==`w'
	replace mc_partd=-7 if ip`w'covmedcad==-7 & wave==`w'
	replace mc_partd=-8 if ip`w'covmedcad==-8 & wave==`w'
}
la var mc_partd "Medicare Part D"
tab mc_partd wave,missing

//tricare - va insurance
gen tricare=.
foreach w in 1 2 3 4 5 6{
	tab ip`w'covtricar if wave==`w' , missing
	replace tricare=1 if ip`w'covtricar==1 & wave==`w'
	replace tricare=0 if ip`w'covtricar==2 & wave==`w'
	replace tricare=-7 if ip`w'covtricar==-7 & wave==`w'
	replace tricare=-8 if ip`w'covtricar==-8 & wave==`w'
}
la var tricare "Tricare - veterans insurance"
tab tricare wave,missing

//long term care nursing home insurance, private
gen private_ltc=.
foreach w in 1 2 3 4 5 6{
	tab ip`w'nginsnurs if wave==`w' , missing
	replace private_ltc=1 if ip`w'nginsnurs==1 & wave==`w'
	replace private_ltc=0 if ip`w'nginsnurs==2 & wave==`w'
	replace private_ltc=-7 if ip`w'nginsnurs==-7 & wave==`w'
	replace private_ltc=-8 if ip`w'nginsnurs==-8 & wave==`w'
}
la var private_ltc "Private nursing home insurance"
tab private_ltc wave,missing

//if report nh insurance in prev wave, asked to verify still have it curr wave
foreach w in 2 3 4 5 6{
tab ip`w'nginslast if wave==`w' & ip`w'nginsnurs==-1, missing
replace private_ltc=1 if ip`w'nginslast==1 & ip`w'nginsnurs==-1 & wave==`w'
replace private_ltc=0 if ip`w'nginslast==2 & ip`w'nginsnurs==-1 & wave==`w'
replace private_ltc=-7 if ip`w'nginslast==-7 & ip`w'nginsnurs==-1 & wave==`w'
replace private_ltc=-8 if ip`w'nginslast==-8 & ip`w'nginsnurs==-1 & wave==`w'
}
tab private_ltc wave,missing

*********************************************
*********************************************
//Residence information
*********************************************
*********************************************
//residence physical structure variable only in wave 1
tab re1resistrct if wave==1, missing
tab re1resistrct ht1placedesc if wave==1, missing
//derived variable in waves 2, 3
tab re2dresistrct if wave==2, missing
//per user guide, need to fix this variable since incorrectly coded for 71 obs
replace re2dresistrct = re2newstrct if inlist(re2spadrsnew,1,3) & inlist(re2newstrct,1,2,3,4,91)

tab re3dresistrct if wave==3, missing

//housing type in each wave, however missing if same residence as prior wave
foreach w in 1 2 3{
tab ht`w'placedesc if wave==`w', missing
}

//if missing housing type in waves 2,3, backfill with wave 1 info
//get indicators for moving in waves 2 or 3
tab re2dadrscorr, missing

gen w2_moved=1 if re2dadrscorr==2
replace w2_moved=0 if re2dadrscorr==1 | re2dadrscorr==3
tab w2_moved

tab re3spadrsnew, missing
gen w3_moved=1 if re3spadrsnew==2
replace w3_moved=0 if re3spadrsnew==1 | re3spadrsnew==3
tab w3_moved

gen w4_moved=1 if re4spadrsnew==2
replace w4_moved=0 if re4spadrsnew==1 | re4spadrsnew==3
tab w4_moved

gen w5_moved=1 if re5spadrsnew==2
replace w5_moved=0 if re5spadrsnew==1 | re5spadrsnew==3
tab w5_moved

gen w6_moved=1 if re6spadrsnew==2
replace w6_moved=0 if re6spadrsnew==1 | re6spadrsnew==3
tab w6_moved

gen ht_new=.
foreach w in 1 2 3 4 5 6{
replace ht_new=ht`w'placedesc if wave==`w'
}

foreach w in 2 3 4 5 6{
replace ht_new=. if ht`w'placedesc==-1 & w`w'_moved==0
}

tab ht_new wave, missing

sort spid wave
by spid (wave): carryforward ht_new, replace

tab ht_new wave, missing

//most residence information from wave 1
//used derived variables wave 2,3
gen residence=.
replace residence=re1resistrct if wave==1
replace residence=re2dresistrct if wave==2
replace residence=re3dresistrct if wave==3
replace residence=re4dresistrct if wave==4
replace residence=re5dresistrct if wave==5
replace residence=re6dresistrct if wave==6
replace residence=3 if inlist(residence,4,91)

tab residence wave

//now overwrite with the new housing type description as done in orig code
replace residence=1 if ht_new==1
replace residence=2 if inlist(ht_new,2,3,4,91)
replace residence=. if inlist(residence,-9,-1)
tab residence wave, missing

label define residlbl 1 "Private Res." 2 "Group Home/Facility" ///
	3 "Mobile Home/Multi-Unit"
label values residence residlbl
tab residence if wave==1, missing
tab residence if wave==2, missing
tab residence if wave==3, missing
tab residence if wave==4, missing
tab residence if wave==5, missing
tab residence if wave==6, missing


***********************************************************
//living arrangement, NHATS derived variable
gen livearrang=.
foreach w in 1 2 3 4 5 6{
tab hh`w'dlvngarrg if wave==`w' & ivw_type==1, missing
replace livearrang=hh`w'dlvngarrg if wave==`w'
replace livearrang=1 if (hh`w'dlvngarrg==-9 & hh`w'dhshldnum==1)  & wave==`w'
replace livearrang=-7 if hh`w'dlvngarrg == -7 & wave == `w'
replace livearrang=-8 if hh`w'dlvngarrg == -8 & wave == `w'
}
replace livearrang=. if livearrang==-1 

la var livearrang "Living arrangmeent, categorical"
la def livearrang 1 "Alone" 2 "With spouse/partner" ///
	3"With spouse/partner + others" 4 "With others"
la val livearrang livearrang
tab livearrang wave if ivw_type==1, missing

//live alone?
gen livealone=1 if livearrang==1
replace livealone=0 if inlist(livearrang,2,3,4)
la var livealone "Lives alone"
tab livealone livearrang, missing

save round_1_6_cleanv1.dta, replace
local ivars age female race_cat education  income_cat otherlang maritalstat medicaid medigap mc_partd tricare private_ltc w2_moved w3_moved ht_new residence livearrang livealone
foreach w in `ivars'{

tab `w'


}




*********************************************
log close


H="NHATS Data Cleaning Part 4 (3_r12_cleaning_2_1)"
capture log close
clear all
set more off

local logs "E:\nhats\nhats_code\NHATS data setup\logs"
//local logs /Users/rebeccagorges/Documents/data/nhats/logs/

log using "`logs'3_nhats_cleaning.txt", text replace

local work "E:\nhats\data\NHATS working data\"
//local work /Users/rebeccagorges/Documents/data/nhats/working

cd "`work'"
use round_1_6_cleanv1.dta

*********************************************
tab wave, missing

*********************************************
*********************************************
//self reported health status/conditions
*********************************************
*********************************************
gen srh=.
foreach w in 1 2 3 4 5 6{
tab hc`w'health if wave==`w', missing
replace srh=hc`w'health if wave==`w'
}
replace srh=. if inlist(srh,-9,-1)

la var srh "Self reported health, categorical"
la def srh 1 "Excellent" 2 "Very good" 3 "Good" 4 "Fair" 5 "Poor"
la val srh srh
tab srh if ivw_type==1, missing

gen srh_fp=1 if srh==4 | srh==5
replace srh_fp=0 if inlist(srh,1,2,3)
replace srh_fp=-7 if srh == -7
replace srh_fp=-8 if srh == -8
la var srh_fp "Self reported health=fair/poor"
tab srh_fp srh, missing

*********************************************
//Self-Report Disease
*********************************************
//Round 1 - ever told you had xx
//Round 2 - since the last interview, new condition? 
/*
1 heart attack
2 heart disease
3 high blood pressure
4 arthritis
5 osteoporosis
6 diabetes
7 lung disease
8 stroke
9 dementia
10 cancer
create two sets of indicator variables for waves 2 and later
sr_disease_ever = 1 if ever report having the disease (only this variable in wave 1)
sr_disease_new = 1 if newly reported the disease this wave
*/

//heart attack / ami, asked both waves, for Wave 1 ask ever had, wave 2 ask in last year
//same questions for stroke, cancer

capture program drop disease
program define disease 
	args dis num
	
	gen sr_`dis'_raw=.
	foreach w in 1 2 3 4 5 6{
		replace sr_`dis'_raw=1 if hc`w'disescn`num'==1 & wave==`w'
		replace sr_`dis'_raw=0 if hc`w'disescn`num'==2 & wave==`w'
		replace sr_`dis'_raw=-7 if hc`w'disescn`num'==-7 & wave==`w'
		replace sr_`dis'_raw=-8 if hc`w'disescn`num'==-8 & wave==`w'
	}
	//create two new variables from this...
	gen sr_`dis'_ever=sr_`dis'_raw
	replace sr_`dis'_ever=. if (wave==2 | wave==3| wave==4 | wave==5 | wave==6) & sr_`dis'_raw==0 //set to missing if report no new wave
	replace sr_`dis'_ever=-7 if sr_`dis'_raw == -7
	replace sr_`dis'_ever=-8 if sr_`dis'_raw == -8

	sort spid wave
	by spid (wave): carryforward sr_`dis'_ever if ivw_type==1 , replace
	
	replace sr_`dis'_ever = sr_`dis'_raw if (wave==2 | wave==3 | wave==4 | wave==5 | wave==6) & sr_`dis'_ever == . & sr_`dis'_raw != .

	gen sr_`dis'_new=sr_`dis'_raw if wave==2 | wave==3 | wave==4 | wave==5 | wave==6

	end

//now run programs for specific disease variables
disease ami 1
disease stroke 8
disease cancer 10

la var sr_ami_raw "Self report Heart Attack, Raw"
la var sr_ami_ever "Ever Self report Heart Attack"
la var sr_ami_new "Self report Heart Attack since prev year"
la var sr_stroke_raw "Self report Stroke, Raw"
la var sr_stroke_ever "Ever Self report Stroke"
la var sr_stroke_new "Self report Stroke since prev year"
la var sr_cancer_raw "Self report Cancer, Raw"
la var sr_cancer_ever "Ever Self report Cancer"
la var sr_cancer_new "Self report Cancer since prev year"

//same question pattern, different variable name though, for hip fracture
gen sr_hip_raw=.
foreach w in 1 2 3 4 5 6{
	replace sr_hip_raw=1 if hc`w'brokebon1==1 & wave==`w'
	replace sr_hip_raw=0 if hc`w'brokebon1==2 & wave==`w'
	replace sr_hip_raw = -7 if hc`w'brokebon1==-7 & wave==`w'
	replace sr_hip_raw = -8 if hc`w'brokebon1==-8 & wave==`w'
}
//create two new variables from this...
gen sr_hip_ever=sr_hip_raw
replace sr_hip_ever=. if (wave==2 | wave==3 | wave==4 | wave==5 | wave==6) & sr_hip_raw==0 //set to missing if report no new wave

sort spid wave
by spid (wave): carryforward sr_hip_ever if ivw_type==1 , replace

replace sr_hip_ever = sr_hip_raw if (wave==2 | wave==3 | wave==4 | wave==5 | wave==6) & sr_hip_ever == . & sr_hip_raw != .

gen sr_hip_new=sr_hip_raw if wave==2 | wave==3 | wave == 4 | wave==5 | wave==6
la var sr_hip_raw "Self report Hip Fracture, Raw"
la var sr_hip_ever "Ever Self report Hip Fracture (since age 50)"
la var sr_hip_new "Self report Hip Fracture since prev year"

foreach dis in ami stroke cancer hip{
tab sr_`dis'_raw wave if ivw_type==1, missing
tab sr_`dis'_ever wave if ivw_type==1, missing
tab sr_`dis'_new wave if ivw_type==1, missing
}

**************************************************************************
//Many diseases asked 1st wave, then only if report no, asked again 2nd wave
//wave 2,3=7 if report yes in wave 1
//use a program over several diseases since pattern is the same

la def sr_prev_rept 0 "No" 1 "Yes" 7 "Previously reported"

capture program drop prev_report
program define prev_report
	args dis num
 
	gen sr_`dis'_raw=.
		foreach w in 1 2 3 4 5 6{
			replace sr_`dis'_raw=1 if hc`w'disescn`num'==1 & wave==`w'
			replace sr_`dis'_raw=0 if hc`w'disescn`num'==2 & wave==`w'
			replace sr_`dis'_raw=7 if hc`w'disescn`num'==7 & wave==`w'
			replace sr_`dis'_raw=-7 if hc`w'disescn`num'==-7 & wave==`w'
			replace sr_`dis'_raw=-8 if hc`w'disescn`num'==-8 & wave==`w'
		}

	la val sr_`dis'_raw sr_prev_rept
	tab sr_`dis'_raw wave if ivw_type==1, missing

	gen sr_`dis'_ever = 1 if inlist(sr_`dis'_raw,1,7) //if prev or curr report yes
	replace sr_`dis'_ever = 0 if sr_`dis'_raw==0
	replace sr_`dis'_ever = -7 if sr_`dis'_raw==-7
	replace sr_`dis'_ever = -8 if sr_`dis'_raw==-8
	tab sr_`dis'_ever sr_`dis'_raw, missing
	tab sr_`dis'_ever wave if ivw_type==1, missing

	gen sr_`dis'_new=sr_`dis'_raw if wave==2 | wave==3 | wave== 4 | wave==5 | wave==6
	replace sr_`dis'_new=0 if sr_`dis'_raw==7
	tab sr_`dis'_new if (wave==2 | wave==3 | wave==4 | wave==5 | wave==6) & ivw_type==1, missing

	end

//now run programs for specific disease variables
prev_report heart_dis 2
prev_report htn 3
prev_report ra 4
prev_report osteoprs 5
prev_report diabetes 6
prev_report lung_dis 7
prev_report dementia 9

la var sr_heart_dis_ever "Self report Heart Disease"
la var sr_heart_dis_new "Self report Heart Disease since prev year"
la var sr_htn_ever "Self report high blood pressure"
la var sr_htn_new "Self report high blood pressure since prev year"
la var sr_ra_ever "Self report arthritis"
la var sr_ra_new "Self report arthritis since prev year"
la var sr_osteoprs_ever "Self report osteoporosis"
la var sr_osteoprs_new "Self report osteoporosis since prev year"
la var sr_diabetes_ever "Self report diabetes"
la var sr_diabetes_new "Self report diabetes since prev year"
la var sr_lung_dis_ever "Self report Lung Disease"
la var sr_lung_dis_new "Self report Lung Disease since prev year"
la var sr_dementia_ever "Self report Dementia"
la var sr_dementia_new "Self report Dementia since prev year"

*************************************************
//Depression & Anxiety
//Over the last month how often have you:
//responses are 1=not at all, 2=several days, 3=more than half days, 4=nearly every day
*************************************************
gen sr_depr_pqq1=.
gen sr_depr_pqq2=.
gen sr_anx_gad1=.
gen sr_anx_gad2=.

foreach w in 1 2 3 4 5 6{
	//set up new variables for individual wave variables
	foreach q in 1 2 3 4 {
	gen temp_hc`w'deprsan`q'=. if inlist(hc`w'depresan`q',-9,-8,-7,-1)
	replace temp_hc`w'deprsan`q'=hc`w'depresan`q'-1 if inlist(hc`w'depresan`q',1,2,3,4)
	replace temp_hc`w'deprsan`q'=0 if inlist(hc`w'depresan`q',-8,-7)
	}
	//now create clean depression, anxiety variables
	replace sr_depr_pqq1=temp_hc`w'deprsan1 if wave==`w' //little interest or pleasure in doing things
	replace sr_depr_pqq2=temp_hc`w'deprsan2 if wave==`w' //felt down/depressed/hopeless
	replace sr_anx_gad1=temp_hc`w'deprsan3 if wave==`w' //felt nervous or anxious
	replace sr_anx_gad2=temp_hc`w'deprsan4 if wave==`w' //unable to stop worrying
	

	foreach q in 1 2 3 4 {
	drop temp_hc`w'deprsan`q'
	}
	
}

la def depr_anx 0"Not at all" 1"Several days" 2"More than half the days" ///
3"Nearly every day"
la val sr_depr_pqq1 sr_depr_pqq2 sr_anx_gad1 sr_anx_gad2 depr_anx
la var sr_depr_pqq1 "How often little interest in doing things?"
la var sr_depr_pqq2 "How often felt down, depressed, hopeless?"
la var sr_anx_gad1 "How often felt nervous or anxious?"
la var sr_anx_gad2 "How often unable to stop worrying?"

foreach v in sr_depr_pqq1 sr_depr_pqq2 sr_anx_gad1 sr_anx_gad2{
	tab `v' wave if ivw_type==1,missing
}

//combined phq-2 score for depression, cutoff 3+=depressed
gen sr_phq2_score=sr_depr_pqq1+sr_depr_pqq2
gen sr_phq2_depressed=1 if sr_phq2_score>=3 & sr_phq2_score~=.
replace sr_phq2_depressed=0 if sr_phq2_score<3 & sr_phq2_score~=.
la var sr_phq2_score "PHQ-2 combined score 0-6 scale"
la var sr_phq2_depressed "Depressed per PHQ-2, score=3+"
tab sr_phq2_score sr_phq2_depressed if ivw_type==1, missing

//combined gad-2 score for anxiety, cutoff 3+=anxiety
gen sr_gad2_score=sr_anx_gad1+sr_anx_gad2
gen sr_gad2_anxiety=1 if sr_gad2_score>=3 & sr_gad2_score~=.
replace sr_gad2_anxiety=0 if sr_gad2_score<3 & sr_gad2_score~=.
la var sr_gad2_score "GAD-2 combined score 0-6 scale"
la var sr_gad2_anxiety "Anxiety per GAD-2, score=3+"
tab sr_gad2_score sr_gad2_anxiety if ivw_type==1, missing
tab sr_gad2_anxiety wave, missing

*************************************************
//Dementia, based on NHATS technical paper no. 5, expanded for 3 waves
//separate variables for proxy vs self interviews
*************************************************
tab proxy_ivw ivw_type, missing

//Initialize 3 category dementia variable
//probable dementia, possible dementia, no dementia
//probable = diagnosis reported or 2+ ad8 questions (proxy) or <1.5 SD below mean
gen dem_3_cat=-1 if ivw_type!=1 //set to na if not SP interview
replace dem_3_cat=1 if sr_dementia_ever==1 //if reported directly

//for proxy interviews, use ad8 score
forvalues i = 1/8{
gen pr_ad8_`i'=-1 //initialize to n/a
replace pr_ad8_`i'=. if proxy_ivw==1 & dem_3_cat==. //set missing if proxy ivw w/o direct report dementia
foreach w in 1 2 3 4 5 6{
	replace pr_ad8_`i'=1 if inlist(cp`w'chgthink`i',1,3) & wave==`w' & dem_3_cat==. & proxy_ivw==1 //yes or dementia reported
	replace pr_ad8_`i'=0 if inlist(cp`w'chgthink`i',2,-8) & wave==`w' & dem_3_cat==. &  proxy_ivw==1 //no or don't know
	}	
tab pr_ad8_`i' wave, missing
tab pr_ad8_`i' wave if proxy_ivw==1, missing
}

tab pr_ad8_3 cp1chgthink3 if wave==1, missing
tab cp2chgthink1 cp2dad8dem if wave==2 & proxy_ivw==1, missing //previous proxy ivw ad8 items indicated dementia

tab pr_ad8_1 wave, missing
tab pr_ad8_1 cp2dad8dem if wave==2 & proxy_ivw==1, missing //previous proxy ivw ad8 items indicated dementia
tab pr_ad8_1 sr_dementia_ever if wave==2 & proxy_ivw==1, missing // reported dementia directly

gen pr_ad8_score=(pr_ad8_1+pr_ad8_2+pr_ad8_3+pr_ad8_4+pr_ad8_5+pr_ad8_6+pr_ad8_7+pr_ad8_8) if proxy_ivw==1 & dem_3_cat==.
tab pr_ad8_score proxy_ivw, missing
tab pr_ad8_score wave, missing

gen dem_via_proxy=1 if pr_ad8_score>=2 & pr_ad8_score~=. //from ad8 score directly
replace dem_via_proxy=0 if inlist(pr_ad8_score,0,1)
replace dem_via_proxy=1 if (cp2dad8dem==1 | cp3dad8dem==1) & proxy_ivw==1 //if previous interview ad8 indicated dementia
replace dem_via_proxy=-1 if sr_dementia_ever==1
tab dem_via_proxy wave if proxy_ivw==1 & ivw_type==1, missing

//set 3 category dementia state variable
//first xwave variable for proxy allowed sp to answer cg section
gen speaktosp=.
foreach w in 1 2 3 4 5 6{
	replace speaktosp=cg`w'speaktosp if wave==`w'
}

replace dem_3_cat=1 if dem_3_cat==. & dem_via_proxy==1 //if proxy ivw indicates dem
replace dem_3_cat=3 if dem_3_cat==. & dem_via_proxy==0 & speaktosp==2  //proxy ind no dem
tab dem_3_cat wave, missing
*************************************************
//for self interviews
*************************************************
//current date questions
tab cg1todaydat1 cg1speaktosp if wave==1 & ivw_type==1, missing

forvalues i = 1/4{
	gen date_item`i'=.
	foreach w in 1 2 3 4 5 6{
		replace date_item`i'=1 if cg`w'todaydat`i'==1 & wave==`w' //yes
		replace date_item`i'=0 if inlist(cg`w'todaydat`i',2,-7) & wave==`w' //no, dont know, refused
	}
}
//count date questions correct
gen date_sum=date_item1+date_item2+date_item3+date_item4
tab date_sum wave, missing

//add categories for proxy says can't speak to sp or proxy says can speak but sp unble to answer
foreach w in 1 2 3 4 5 6{
	replace date_sum=-2 if date_sum==. & cg`w'speaktosp==2 & wave==`w'
	replace date_sum=-3 if (date_item1==. | date_item2==. | date_item3==. | ///
		date_item4==. ) & cg`w'speaktosp==1 & wave==`w'
}
tab date_sum wave, missing

//new version date sum measure, without the extra categories
gen date_sumr=date_sum
replace date_sumr=. if date_sum==-2
replace date_sumr=0 if date_sum==-3

//president/vp items and count
capture program drop president 
program define president
	args newv oldv
	gen `newv'=.	
	foreach w in 1 2 3 4 5 6{
		replace `newv'=1 if cg`w'`oldv'==1  & wave==`w' //yes
		replace `newv'=0 if inlist(cg`w'`oldv',2,-7) & wave==`w' //no, refused
	}
	tab `newv' wave, missing
end

president preslast presidna1	
president presfirst presidna3
president vplast vpname1
president vpfirst vpname3

//count president questions correct
gen presvp=preslast+presfirst+vplast+vpfirst
tab presvp wave, missing

//add categories for proxy says can't speak to sp or proxy says can speak but sp unble to answer
foreach w in 1 2 3 4 5 6{
	replace presvp=-2 if presvp==. & cg`w'speaktosp==2 & wave==`w'
	replace presvp=-3 if presvp==. & (preslast==. | presfirst==. | vplast==. | ///
		vpfirst==. ) & cg`w'speaktosp==1 & wave==`w'
}
tab presvp wave, missing

//new version president sum measure, without the extra categories
gen presvpr=presvp
replace presvpr=. if presvp==-2
replace presvpr=0 if presvp==-3

//total orientation domain, date and president questions
gen date_prvp=date_sumr+presvpr
tab date_prvp, missing

//executive function domain, clock drawing score
gen clock_scorer=.
foreach w in 1 2 3 4 5 6{
	replace clock_scorer=cg`w'dclkdraw if wave==`w'
	replace clock_scorer=. if inlist(cg`w'dclkdraw,-2,-9) & wave==`w' //missing
	replace clock_scorer=0 if inlist(cg`w'dclkdraw,-3,-4,-7) & wave==`w' //refused,unable
//assign mean values where missing response
	replace clock_scorer=2 if cg`w'dclkdraw==-9 & cg`w'speaktosp==1 & wave==`w' //proxy
	replace clock_scorer=3 if cg`w'dclkdraw==-9 & cg`w'speaktosp==-1 & wave==`w' //self
	}
tab clock_scorer wave, missing //left as -1 if inapplicable

//memory domain, word recall, uses derived scores, not raw responses
capture program drop recall
program define recall
	args newv oldv
	gen `newv'=.
	foreach w in 1 2 3 4 5 6{
		replace `newv'=cg`w'`oldv' if wave==`w'
		replace `newv'=. if inlist(cg`w'`oldv',-2,-1) & wave==`w' //n/a or not asked
		replace `newv'=0 if inlist(cg`w'`oldv',-7,-3) & wave==`w' //refused or unable
	}
	tab `newv' wave, missing
end

recall irecall dwrdimmrc
recall drecall dwrddlyrc

gen wordrecall0_20=irecall+drecall

//overall cognitive domain score, assigns cutoffs for each of the domain variables
gen clock65=0 if clock_scorer>1 & clock_scorer<=5
replace clock65=1 if inlist(clock_scorer,0,1)

gen word65=0 if wordrecall0_20>3 & wordrecall0_20<=20
replace word65=1 if inlist(wordrecall0_20,0,1,2,3)

gen datena65=0 if date_prvp>3 & date_prvp<=8
replace datena65=1 if inlist(date_prvp,0,1,2,3)

gen domain65=clock65+word65+datena65
tab domain65 wave, missing

//now apply to dementia 3 category variable
replace dem_3_cat=1 if dem_3_cat==. & inlist(speaktosp,1,-1) & inlist(domain65,2,3)
replace dem_3_cat=2 if dem_3_cat==. & inlist(speaktosp,1,-1) & domain65==1
replace dem_3_cat=3 if dem_3_cat==. & inlist(speaktosp,1,-1) & domain65==0

la def dem3 1"Probable dementia" 2"Possible dementia" 3"No dementia"
la val dem_3_cat dem3
la var dem_3_cat "Dementia likelihood, 3 categories"

tab dem_3_cat wave, missing

gen dem_2_cat=1 if inlist(dem_3_cat,1,2)
replace dem_2_cat=0 if dem_3_cat==3
la var dem_2_cat "Ind prob/possible dementia"
tab dem_2_cat wave, missing
*************************************************
//rate memory
gen memory=.
foreach w in 1 2 3 4 5 6{
replace memory=cg`w'ratememry if wave==`w'&proxy_ivw==0 //self interview
replace memory=cp`w'memrygood if wave==`w'&proxy_ivw==1 //proxy interview

}
replace memory=. if inlist(memory,-1)
la var memory "Rate memory 1=Excell, 5=Poor"
la def mem 1"Excellent" 2"Very good" 3"Good" 4"Fair" 5"Poor"
la val memory mem
tab memory wave, missing

*************************************************
//total number self reported medical conditions, ever
//note that depression and anxeity are from the specific interview questions
//the others are all if the person has reported the condition in any interview wave
egen sr_numconditions1=anycount(sr_ami_ever sr_stroke_ever sr_cancer_ever ///
	sr_hip_ever sr_heart_dis_ever sr_htn_ever sr_ra_ever sr_osteoprs_ever ///
	sr_diabetes_ever sr_lung_dis_ever sr_dementia_ever sr_phq2_depressed ///
	sr_gad2_anxiety), values(1)
replace sr_numconditions1=. if ivw_type!=1
la var 	sr_numconditions1 "Count medical conditions"
tab sr_numconditions1 wave, missing


local ivars srh srh_fp sr_ami_raw sr_ami_ever sr_ami_new sr_stroke_raw sr_stroke_ever sr_stroke_new sr_cancer_raw sr_cancer_ever sr_cancer_new ///
sr_hip_raw sr_hip_ever sr_hip_new sr_heart_dis_raw sr_heart_dis_ever sr_heart_dis_new sr_htn_raw sr_htn_ever sr_htn_new sr_ra_raw ///
sr_ra_ever sr_ra_new sr_osteoprs_raw sr_osteoprs_ever sr_osteoprs_new sr_diabetes_raw sr_diabetes_ever sr_diabetes_new sr_lung_dis_raw ///
sr_lung_dis_ever sr_lung_dis_new sr_dementia_raw sr_dementia_ever sr_dementia_new
foreach w in `ivars'{
tab `w'
}

*************************************************
save round_1_6_cleanv2.dta, replace

*************************************************
log close


H="NHATS Data Cleaning Part 5 (4_r12_cleaning_3_1)"
capture log close
clear all
set more off

local logs "E:\nhats\nhats_code\NHATS data setup\logs"
//local logs /Users/rebeccagorges/Documents/data/nhats/logs/

log using "`logs'4_nhats_cleaning.txt", text replace

local work "E:\nhats\data\NHATS working data\"
//local work /Users/rebeccagorges/Documents/data/nhats/working

cd "`work'"
use round_1_6_cleanv2.dta

*********************************************
//fall in the last month
gen fall_last_month=.
foreach w in 1 2 3 4 5 6{
	replace fall_last_month=1 if hc`w'fllsinmth==1 & wave==`w'
	replace fall_last_month=0 if hc`w'fllsinmth==2 & wave==`w'
	replace fall_last_month = -7 if hc`w'fllsinmth==-7 & wave==`w'
	replace fall_last_month = -8 if hc`w'fllsinmth==-8 & wave==`w'
}
la var fall_last_month "Fall down in last month"
tab fall_last_month wave, missing

*********************************************
//self care help, using the derived variables in the SC section
//uses the "has help" variables (has difficulty, uses devices other options)
//if don't know, refused, or not done, set to missing
tab sc1deathelp, missing
rename sc*eatslfdif sc*eatdif
rename sc*eatslfoft sc*eatoft
capture program drop selfcare
program define selfcare
	args act
	gen adl_`act'_diff=.
	gen adl_`act'_help=.
	gen adl_`act'_not_done=.
	foreach w in 1 2 3 4 5 6{
		replace adl_`act'_help=1 if sc`w'`act'hlp==1 & wave==`w' //yes
		replace adl_`act'_help=0 if sc`w'`act'hlp==2 & wave==`w' //no
		replace adl_`act'_help=0 if sc`w'`act'hlp==-1 & sp_ivw==1 & wave==`w' //bias to null
		replace adl_`act'_help=-7 if sc`w'`act'hlp==-7 & wave==`w' //refused
		replace adl_`act'_help=-8 if sc`w'`act'hlp==-8 & wave==`w' //DK
		replace adl_`act'_diff=sc`w'`act'dif>1 if sc`w'`act'dif>0 & wave==`w'
		replace adl_`act'_not_done=sc`w'`act'oft==5 if sc`w'`act'oft>0 & wave==`w'
}
	tab adl_`act'_help wave, missing
	tab adl_`act'_help wave if ivw_type==1, missing
	*replace adl_`act'_diff=1 if adl_`act'_help==1
	
end	
	
selfcare eat
selfcare bath
selfcare toil
selfcare dres

la var adl_eat_help "Has help while eating"
la var adl_bath_help "Has help while bathing"
la var adl_toil_help "Has help while toileting"
la var adl_dres_help "Has help while dressing"
*********************************************
//household activity help, using derived variables in the HA section
//if did not do by self b/c of health
//reason only or health and other reason, then new help var ==1
tab ha1dlaunsfdf ha1dlaunreas if wave==1, missing
tab ha2dlaunsfdf ha2dlaunreas if wave==2, missing

capture program drop hhact
program define hhact
	args act
	
	gen iadl_`act'_help=.
	gen iadl_`act'_diff=.
	gen iadl_`act'_not_done=.
	foreach w in 1 2 3 4 5 6{
		replace iadl_`act'_help=1 if inlist(ha`w'd`act'sfdf,1,8) & ///
			inlist(ha`w'd`act'reas,1,3) & wave==`w'
		replace iadl_`act'_help=0 if inlist(ha`w'd`act'sfdf,2,3,6) & wave==`w' //did by self
		replace iadl_`act'_help=0 if inlist(ha`w'd`act'sfdf,1,8) & ///
			inlist(ha`w'd`act'reas,2,4) & wave==`w'		
		replace iadl_`act'_help=-8 if inlist(ha`w'd`act'sfdf,4,5,7) & wave==`w' //dkrf
		replace iadl_`act'_help=-8 if inlist(ha`w'd`act'sfdf,1,8) & ///
			inlist(ha`w'd`act'reas,-7,-8) & wave==`w'
		replace iadl_`act'_diff=ha`w'`act'dif>1 if ha`w'`act'dif>0 & wave==`w'
		replace iadl_`act'_not_done=ha`w'`act'oft==5 if ha`w'`act'oft>0
	}	
	tab iadl_`act'_help wave, missing
	tab iadl_`act'_help wave if ivw_type==1, missing
	*replace iadl_`act'_diff=1 if iadl_`act'_help==1
	end
	
hhact laun
hhact shop
hhact meal
hhact bank

la var iadl_laun_help "Rec'd help doing laundry last month"
la var iadl_shop_help "Rec'd help shopping last month"
la var iadl_meal_help "Rec'd help preparing meals last month"
la var iadl_bank_help "Rec'd help with banking last month"
 
//taking medications, questions slightly different and in mc section
//set to =0 if do not take medications
tab mc1dmedssfdf mc1dmedsreas if wave==1, missing
tab mc2dmedssfdf mc2dmedsreas if wave==2, missing

gen iadl_meds_help=.
gen iadl_meds_diff=.
gen iadl_meds_not_done=.
foreach w in 1 2 3 4 5 6{
	replace iadl_meds_help=1 if inlist(mc`w'dmedssfdf,1,8) & ///
		inlist(mc`w'dmedsreas,1,3) & wave==`w'
	//did by self or don't take medications
	replace iadl_meds_help=0 if inlist(mc`w'dmedssfdf,2,3,6,9) & wave==`w' 
	replace iadl_meds_help=0 if inlist(mc`w'dmedssfdf,1,8) & ///
		inlist(mc`w'dmedsreas,2,4) & wave==`w'		
	replace iadl_meds_help=-8 if mc`w'dmedssfdf == 7 & wave==`w' 
	replace iadl_meds_help=-8 if inlist(mc`w'dmedssfdf,1,8) & ///
		inlist(mc`w'dmedsreas,-7,-8) & wave==`w'
	replace iadl_meds_dif=mc`w'medsdif>1 if mc`w'medsdif>0 & wave==`w'
	replace iadl_meds_not_done=inlist(mc`w'dmedssfdf,1,8) if wave==`w'
}	

la var iadl_meds_help "Rec'd help taking medications last month"
tab iadl_meds_help wave, missing
tab iadl_meds_help wave if ivw_type==1, missing
replace iadl_meds_diff=1 if iadl_meds_help==1
//other meds questions, for treatment burden
gen ind_meds_diff=.
gen ind_meds_mistake=.
forvalues w=1/6 {
replace ind_meds_diff=inlist(mc`w'medsdif,2,3,4) if mc`w'medsdif>0 & !missing(mc`w'medsdif)
replace ind_meds_diff=0 if mc`w'meds==2
replace ind_meds_diff=0 if mc`w'dmedsrea==2 & inlist(mc`w'medstrk,2,3)
replace ind_meds_mistake=mc`w'medsmis==1 if mc`w'medsmis>0 & !missing(mc`w'medsmis)
}
label var ind_meds_diff "Any difficulty keeping track of meds"
label var ind_meds_mistake "Any mistake taking meds"
gen ind_meds_problem=ind_meds_diff==1 | ind_meds_mistake==1 if !missing(ind_meds_diff) ///
| !missing(ind_meds_mistake)
label var ind_meds_prob "SR difficulty keeping track of or mistake taking meds"
*********************************************
//has , sees regular doctor
gen reg_doc_have = .
foreach w in 1 2 3 4 5 6{
	replace reg_doc_have=1 if mc`w'havregdoc==1
	replace reg_doc_have=0 if mc`w'havregdoc==2
	replace reg_doc_have=-7 if mc`w'havregdoc==-7
	replace reg_doc_have=-8 if mc`w'havregdoc==-8
}
la var reg_doc_have "Have regular doctor"
tab reg_doc_have wave, missing
tab reg_doc_have wave if ivw_type==1, missing

gen reg_doc_seen = .
foreach w in 1 2 3 4 5 6{
	replace reg_doc_seen=1 if mc`w'regdoclyr==1 & wave==`w'
	replace reg_doc_seen=0 if mc`w'regdoclyr==2 & wave==`w'
	replace reg_doc_seen=-7 if mc`w'regdoclyr==-7 & wave==`w'
	replace reg_doc_seen=-8 if mc`w'regdoclyr==-8 & wave==`w'
}
la var reg_doc_seen "Seen regular doctor within last year"
tab reg_doc_seen wave, missing
tab reg_doc_seen wave if ivw_type==1, missing

//home visit, missing if did not see regular doctor within the last year
tab mc1regdoclyr mc1hwgtregd8 if wave==1, missing

gen reg_doc_homevisit = .
foreach w in 1 2 3 4 5 6{
	replace reg_doc_homevisit=1 if mc`w'hwgtregd8==1
	replace reg_doc_homevisit=0 if mc`w'hwgtregd8==2
	replace reg_doc_homevisit=-7 if mc`w'hwgtregd8==-7
	replace reg_doc_homevisit=-8 if mc`w'hwgtregd8==-8
	//replace reg_doc_homevisit=0 if mc`w'regdoclyr==2
}
la var reg_doc_homevisit "Was regular doctor visit a home visit?"
tab reg_doc_homevisit wave, missing
tab reg_doc_homevisit wave if ivw_type==1, missing

//hospital stay last 12 months?
tab hc1hosptstay, missing

gen sr_hosp_ind=.
foreach w in 1 2 3 4 5 6{
	replace sr_hosp_ind=1 if hc`w'hosptstay==1
	replace sr_hosp_ind=0 if hc`w'hosptstay==2
	replace sr_hosp_ind=-7 if hc`w'hosptstay==-7
	replace sr_hosp_ind=-8 if hc`w'hosptstay==-8
}
la var sr_hosp_ind "Hospital stay in the last year 1=yes"
tab sr_hosp_ind wave, missing
tab sr_hosp_ind wave if ivw_type==1, missing

//number of separate hospital stays?
tab hc1hosovrnht hc1hosptstay, missing //if ind=no above, raw variable is n/a
gen sr_hosp_stays=.
foreach w in 1 2 3 4 5 6{
	replace sr_hosp_stays=hc`w'hosovrnht if hc`w'hosovrnht>0 & wave==`w'
}
replace sr_hosp_stays=0 if sr_hosp_ind==0 //set to 0 if none reported in y/n ? above
la var sr_hosp_stays "Number unique hospital stays last year"
tab sr_hosp_stays wave, missing
tab sr_hosp_stays wave if ivw_type==1, missing

save round_1_6_cleanv3.dta, replace

local ivars fall_last_month adl_eat_help adl_bath_help adl_toil_help adl_dres_help iadl_laun_help iadl_shop_help ///
iadl_meal_help iadl_bank_help iadl_meds_help reg_doc_have reg_doc_seen reg_doc_homevisit sr_hosp_ind sr_hosp_stays
foreach w in `ivars'{
tab `w' wave,missing
}

*********************************************
log close


H="NHATS Data Cleaning Part 6 (5_r12_add_helper)"
/*Collapse helper information to the SP - wave level
and merge into SP dataset

variables created are:
Total # helpers for the SP
Total hours/month help provided for SP
Indicators for relationship of primary helper (identified as helper 
with the most hours)

Uses imputed hours per code 1a_help_hours_imputation.do
(see NHATS Technical Paper #7 for imputation methodology)
*/

capture log close
clear all
set more off
local logs E:\nhats\nhats_code\NHATS data setup\logs\
log using "`logs'6-add_helper_to_SP_ds-LOG.txt", text replace

local r1raw E:\nhats\data\NHATS Public\round_1\
local r2raw E:\nhats\data\NHATS Public\round_2\
local r3raw E:\nhats\data\NHATS Public\round_3\
local r4raw E:\nhats\data\NHATS Public\round_4\
local r5raw E:\nhats\data\NHATS Public\round_5\
local r6raw E:\nhats\data\NHATS Public\round_6\
local work E:\nhats\data\NHATS working data
local r1s E:\nhats\data\NHATS Sensitive\r1_sensitive\
local r2s E:\nhats\data\NHATS Sensitive\r2_sensitive\
local r3s E:\nhats\data\NHATS Sensitive\r3_sensitive\
local r4s E:\nhats\data\NHATS Sensitive\r4_sensitive\
local r5s E:\nhats\data\NHATS Sensitive\r5_sensitive\
local r6s E:\nhats\data\NHATS Sensitive\r6_sensitive\
local logs E:\nhats\nhats_code\NHATS data setup\logs\

cd "`work'"
***************************************************************
//get all 3 waves helper imputed hours into a single dataset
use R1_hrs_imputed_added.dta

local keepvars spid wave opid op_hrsmth_i numact yearnotmonth disab ///
 justone spouse otherrel nonrel regular oneact impute_cat opishelper_allw paid ///
 op_adl* op_iadl* op_nonadl* son daughter oth_fam rc_staff op_doc_help op_sn

qui append using R2_hrs_imputed_added.dta
 
qui append using R3_hrs_imputed_added.dta

qui append using R4_hrs_imputed_added.dta

qui append using R5_hrs_imputed_added.dta

qui append using R6_hrs_imputed_added.dta
 
tab wave opishelper_allw, missing

//identify paid helpers and staff at residence (not helpers)
gen paid=0
gen rc_staff=0
forvalues i=1/6 {
	replace paid=1 if op`i'paidh==1 & ((op`i'relat>=30 & op`i'relat<=40)| ///
	op`i'relat==92) & wave==`i'
	foreach x of varlist op`i'*hlp op`i'*hlp1 op`i'*hlp2 op`i'*hlpmst {
		replace rc_staff=1 if op`i'relat==37 & `x'==1 & wave==`i'
}
}

gen op_sn=0 
forvalues i=1/6 {
	replace op_sn=op`i'socl==1 if wave==`i'
}
label var op_sn "OP in SP's social network"

keep `keepvars'

replace opishelper_allw=0 if opishelper_allw==-1
replace op_hrsmth_i=. if op_hrsmth_i==-1
***************************************************************
//identify primary helper, person with the most hours / month using imputed hours
sort spid wave opid spouse

gen primary_cg=0
egen max_hrs_helped=max(op_hrsmth_i) if opishelper_allw==1, by(spid wave)
replace primary_cg=1 if op_hrsmth_i==max_hrs_helped & opishelper_allw==1
tab primary_cg wave, missing

//check that each sp has 1 primary cg identified, doesn't matter!
egen num_primary_cg=total(primary_cg), by(spid wave)
tab num_primary_cg wave, missing

//assign relationship to primary helper
//if same number of hours for two different helpers, then assign to spouse first
gen prim_helper_cat=1 if primary_cg==1 & spouse==1
replace prim_helper_cat=2 if primary_cg==1 & otherrel==1 & prim_helper_cat==.
replace prim_helper_cat=3 if prim_helper_cat==.
la def helpcat 1"Spouse" 2"Other relative" 3"Other, not relative"
la val prim_helper_cat helpcat
tab prim_helper_cat wave, missing

//get categorical relationship
gen op_relationship_cat=6
local i=1
foreach x in spouse daughter son oth_fam paid {
	replace op_relationship_cat=`i' if `x'==1
	local i=`i'+1
}
label define op_relationship_cat 1 "Spouse/Partner" 2 "Daughter (incl. step-/-in-law)" ///
3 "Son (incl. step-/-in-law)" 4 "Other family" 5 "Paid CG" 6 "Unpaid non-family CG"
label values op_relationship_cat op_relationship_cat

//get total number hours/month help received and number of helpers per spid/wave
egen tot_hrsmonth_help_i=total(op_hrsmth_i), by(spid wave)
egen n_helpers=count(op_hrsmth_i), by(spid wave)
gen tot_hrswk_help_i=tot_hrsmonth_help_i/(52/12)
//family caregivers
gen op_family=op_relationship_cat<=4 if opishelper==1
label var op_family "OP is family helper"
egen n_family_helpers=total(op_family),by(spid wave)
label var n_family_helpers "Number family helpers"
gen ind_family_helper=n_family_helpers>0
label var ind_family_helper "Indicatory any family helpers"
//paid caregivers
egen n_paid_helpers=total(paid), by(spid wave)
gen ind_paid_helper=n_paid_helpers>0 
label var n_paid_helpers "Number paid helpers"
label var ind_paid_helper "Indicator any paid helpers"
egen ind_rc_staff=max(rc_staff), by(spid wave)
label var ind_rc_staff "Indicator Facility Staff in OP file"
gen num_helpers_cat=0
replace num_helpers_cat=1 if n_helpers>0 & n_helpers<.
replace num_helpers_cat=2 if n_helpers>3 & n_helpers<.
replace num_helpers_cat=3 if n_helpers>=7 & n_helpers<.
label define num_helpers_cat 0 "No helpers" 1 "1-3 helpers" 2 "4-6 helpers" ///
3 "7+ helpers"
label values num_helpers_cat num_helpers_cat

gen phrs=op_hrsmth_i if paid==1
egen tot_hrsmonth_paid_i=total(phrs), by(spid wave)
gen tot_hrswk_paid_i=tot_hrsmonth_paid_i/(52/12)
label var tot_hrsmonth_paid_i "Hours/month help recived, paid helpers, imputed"
label var tot_hrswk_paid_i "Hours/week help received, paid helpers, imputed"
gen op_hrswk_i=op_hrsmth_i/(52/12)
label var op_hrswk_i "OP hours/week help SP"

la var tot_hrsmonth_help_i "Hours / month help received, all helpers, imputed"
sum tot_hrsmonth_help_i, detail
la var tot_hrswk_help_i "Hours / week help received, all helpers, imputed"

la var n_helpers "Number helpers reported by SP"
tab n_helpers wave, missing
la var prim_helper_cat "Primary helper relationship, missing if no helper"
tab prim_helper_cat wave, missing

la var tot_hrsmonth_help_i "Hours / month help received, all helpers, imputed"
sum tot_hrsmonth_help_i, detail
la var tot_hrswk_help_i "Hours / week help received, all helpers, imputed"

la var n_helpers "Number helpers reported by SP"
tab n_helpers wave, missing
la var prim_helper_cat "Primary helper relationship, missing if no helper"
tab prim_helper_cat wave, missing


//number in social network
by spid wave, sort: egen n_sn=total(op_sn)
replace n_sn=0 if missing(n_sn)
label var n_sn "Number in social network"

//save as op file before dropping down to one obs per spid
saveold "E:/nhats/data/NHATS cleaned/op_round_1_6.dta", replace

//keep the entry for the primary caregiver only, this will then be the 
//information merged into the SP dataset
keep if primary_cg==1

//sort and keep only first primary cg, again preference given if spouse
gsort spid wave -spouse otherrel opid
duplicates drop spid wave, force

//now one obs per sp - wave

sum tot_hrsmonth_help_i, detail
tab n_helpers wave, missing
tab prim_helper_cat wave, missing
***************************************************************
//merge this helper data with the main SP dataset
save helper_by_sp.dta, replace

use round_1_6_cleanv3, clear

merge 1:1 spid wave using helper_by_sp.dta, keepusing(opid n_helpers n_fam ind_fam ///
 tot_hrsmonth_* prim_helper_cat ind_pa n_pai tot_hrswk* num_helpers_cat ind_rc_*)

drop _merge 

foreach x in n_helpers ind_pa n_paid num_helpers_cat{
replace `x'=0 if `x'==.
}

gen ind_no_helpers=.
replace ind_no_helpers=1 if n_helpers==0
replace ind_no_helpers=0 if n_helpers>0
la var ind_no_helpers "Indicator no Helpers reported"
tab ind_no_helpers wave, missing

la var tot_hrsmonth_help_i "Hours / month help received, all helpers, imputed"
sum tot_hrsmonth_help_i, detail
la var tot_hrswk_help_i "Hours / week help received, all helpers, imputed"

la var n_helpers "Number helpers reported by SP"
tab n_helpers wave, missing
la var prim_helper_cat "Primary helper relationship, missing if no helper"
tab prim_helper_cat wave, missing

rename opid prim_helper_opid
destring prim_helper_opid, replace
la var prim_helper_opid "Primary helper OPID"

***************************************************************
//save the dataset with helper information added

save round_1_6_clean_helper_added.dta, replace

saveold round_1_6_clean_helper_added_old.dta, replace

***************************************************************
log close


H="NHATS Data Cleaning Part 7--Variable Construction"
capture log close
clear all
set more off
local logs E:\nhats\nhats_code\NHATS data setup\logs\

local r1raw E:\nhats\data\NHATS Public\round_1\
local r2raw E:\nhats\data\NHATS Public\round_2\
local r3raw E:\nhats\data\NHATS Public\round_3\
local r4raw E:\nhats\data\NHATS Public\round_4\
local r5raw E:\nhats\data\NHATS Public\round_5\
local r6raw E:\nhats\data\NHATS Public\round_6\
local work E:\nhats\data\NHATS working data
local r1s E:\nhats\data\NHATS Sensitive\r1_sensitive\
local r2s E:\nhats\data\NHATS Sensitive\r2_sensitive\
local r3s E:\nhats\data\NHATS Sensitive\r3_sensitive\
local r4s E:\nhats\data\NHATS Sensitive\r4_sensitive\
local r5s E:\nhats\data\NHATS Sensitive\r5_sensitive\
local r6s E:\nhats\data\NHATS Sensitive\r6_sensitive\
local logs E:\nhats\nhats_code\NHATS data setup\logs\



//7/13/17--add in metro/nonmetro var
use "E:\nhats\data\NHATS Public\NHATS_Round_1_6_MetNonmet_STATA\NHATS_Round_1_6_MetNonmet.dta", clear
forvalues i=1/6 {
gen metro_ind`i'=r`i'd==1 if inrange(r`i'd,1,2)
}
reshape long metro_ind, i(spid) j(wave)
label var metro_ind "Lives in metropolitan area"
tempfile metro
save `metro'

cd "`work'"
use round_1_6_clean_helper_added.dta
merge 1:1 spid wave using `metro', keep(match master) nogen


///// 3/26/18 --Adding in Hospice and place died variables.

egen placedied=rowmax(pd*placedied)
label value pd2placedied placedied
label var placedied "Place of Death"
replace placedied=. if inlist(placedied,-1,-8)
replace placedied=6 if placedied==91

egen hospice1=rowmax(pd*hospice1)
egen hospice2=rowmax(pd*hospice2)
egen hospicelml=rowmax(pd*hospcelml)

replace hospice2=. if inlist(hospice2,-1,-8) 

foreach x in hospice1 hospicelml {
replace `x'=. if inlist(`x',-1,-8)
replace `x'=0 if `x'==2
} 
 
label var hospice1 "Hopsice at Nursing Home"
label var hospice2 "Hospice Other Place"
label var hospicelml "Hospice Care in Last Month"
 
 
///// 3/14/18 --Adding in Frailty underlying series

//activities done twice (grip test, walk test..)

forvalues i=1/2{
capture drop gripsc`i'
egen gripsc`i'= rowmax(gr*grp`i'rdng)
egen walksec`i'= rowmax(wa*wlkc`i'secs)
egen walkhndr`i'=rowmax(wa*wlk`i'hndr)
replace gripsc`i'=. if inlist(gripsc`i', -1, -9, -7, -8)
replace walksec`i'=. if inlist(walksec`i', -1, -9, -7, -8)
replace walkhndr`i'=. if inlist(walkhndr`i', -1, -9, -7, -8)
}

label var gripsc1 "GRP1 Display Reading"
label var gripsc2 "GRP2 Display Reading"
label var walksec1 "Secs Hld Walking Course1"
label var walksec2 "Secs Hld Walking Course2"
label var walkhndr1 "Hnrds Hld Walking Course1"
label var walkhndr2 "Hnrds Hld Walking Course2"
/*
forvalues i=1/2{
capture drop walk`i'
if `i'==1 egen walk`i'=rowmax(wa*wlkc1secs)  
if `i'==2 egen walk`i'=rowmax(wa*wlk1hndr)
replace walk`i'=. if inlist(walk`i', -1, -9, -7, -8)
}
rename walk1 walksec
rename walk2 walkhnrds
label var walk1 "Secs Hld Walking Course)
*/

foreach x in origwksc nhatswksc nhatsgrav nhatsgrb{
capture drop `x'
gen `x'=.
forvalues w=1/6 {
replace `x'=r`w'd`x' if  inlist( r`w'd`x', 0, 1, 2, 3, 4)
}
}

label var origwksc "Original Walk Score"
label var nhatswksc "NHATS Walk Score"
label var nhatsgrav "NHATS Avg. Grip Score"
label var nhatsgrb "NHATS Best Grip Score"


local a lst10pnds trytolose 
local b evrgowalk vigoractv

foreach x in `a' `b'{
capture drop `x'
gen `x'=.
}

forvalues w=1/6{
foreach x in `a'{
replace `x'=0 if inlist(hw`w'`x', 2, -8, -7) 
replace `x'=1 if hw`w'`x'==1
}
foreach y in `b'{
replace `y'=0 if inlist(pa`w'`y', 2, -8, -7) 
replace `y'=1 if pa`w'`y'==1
}
}

label var lst10pnds "Lost 10 Pounds in Last Yr."
label var trytolose "Were You Trying to Lose Weight"
label var evrgowalk "Ever Go Walking for Exercise"
label var vigoractv "Ever Vigorous Activities"


capture drop unwgtloss lowphysact
gen unwgtloss=. 
gen lowphysact=.
replace unwgtloss=0 if lst10pnds==0 | trytolose==1
replace unwgtloss=1 if lst10pnds==1 & trytolose==0
replace lowphysact=0 if evrgowalk==1 | vigoractv==1
replace lowphysact=1 if evrgowalk==0 & vigoractv==0

label var unwgtloss "Unintentional Weight Loss"
label var lowphysact "Low Physical Activity"

capture drop lowenrgy
egen lowenrgy=rowmax(ss*lowenergy)
replace lowenrgy=. if inlist(lowenrgy, -9, -8, -7, -1)
replace lowenrgy=0 if lowenrgy==2
label var lowenrgy "Low Energy in Last Month"


///// 3/7/18 --Adding in Well-Being questions 
/// Inapplicable is people who have no interview, had a proxy, or died. turned to missing. 

foreach j in 1 2 4 {
	forvalues i=1/4 {
		capture drop wbq`j'`i'
		gen wbq`j'`i'=.
	}
}
drop wbq44

forvalues w=1/6 {
forvalues i=1/4 {
	replace wbq1`i'=1 if wb`w'offelche`i'==4 
	replace wbq1`i'=2 if wb`w'offelche`i'==3 
	replace wbq1`i'=3 if wb`w'offelche`i'==2 
	replace wbq1`i'=4 if wb`w'offelche`i'==1 
	replace wbq1`i'=0 if wb`w'offelche`i'==5 
	replace wbq1`i'=5 if wb`w'offelche`i'==-7 | wb`w'offelche`i'==-8
	}
	}

label var wbq11 "Often you Feel Cheerful"
rename wbq11 oftcheer 
label define oftcheer 0 "Never" 1 "Rarely (Once a Week or Less)" 2 "Some Days(2-4 Days a Week)" ///
3 "Most Days(5-6 Days a Week)" 4 "Every Day (7 Days a Week)" 5 "RF/DK"
label values oftcheer oftcheer
label var wbq12 "Often you Feel Bored"
rename wbq12 oftbored
label values oftbored oftcheer
label var wbq13 "Often you Feel Full of Life"
rename wbq13 oftfol
label values oftfol oftcheer
label var wbq14 "Often you Feel Upset"
rename wbq14 oftupset
label values oftupset oftcheer


forvalues w=1/6 {
	forvalues i=1/4 {
	replace wbq2`i'=1 if wb`w'truestme`i'==3 
	replace wbq2`i'=2 if wb`w'truestme`i'==2 
	replace wbq2`i'=3 if wb`w'truestme`i'==1 
	replace wbq2`i'=4 if wb`w'truestme`i'==-7 | wb`w'truestme`i'==-8
	}
}

label var wbq21 "Life has Meaning Purpose"
rename wbq21 lifemean 
label define lifemean 1 "Agree Not at All" 2 "Agree a Little" 3 "Agree A Lot" 4 "RF/DK"
label values lifemean lifemean
label var wbq22 "Feels Confident"
rename wbq22 confident
label values confident lifemean
label var wbq23 "Gave up Improving Life"
rename wbq23 giveup
label values giveup lifemean
label var wbq24 "Likes Living Situation"
rename wbq24 livingsit
label values livingsit lifemean

forvalues w=1/6 {
	forvalues i=1/3 {
	replace wbq4`i'=1 if wb`w'agrwstmt`i'==3 
	replace wbq4`i'=2 if wb`w'agrwstmt`i'==2 
	replace wbq4`i'=3 if wb`w'agrwstmt`i'==1 
	replace wbq4`i'=4 if wb`w'agrwstmt`i'==-7 | wb`w'agrwstmt`i'==-8
	}
}

label var wbq41 "Self Determination"
rename wbq41 selfdeter 
label values selfdeter lifemean
label var wbq42 "Want-Finds Way to Do"
rename wbq42 findway
label values findway lifemean
label var wbq43 "Easily Adjust to Change"
rename wbq43 adjchg
label values adjchg lifemean
	

capture drop agefeel
egen agefeel= rowmax(wb*ageyofeel) 
replace agefeel=. if agefeel==-9 | agefeel==-8 | agefeel==-7 | agefeel==-1
label var agefeel "Age you Feel Most Times"



///// 3/5/18 --Adding in FRI questions from round 1

foreach x in cane walker wheelchr {
capture drop `x'_nhats
gen `x'_nhats=fl1`x'
replace `x'_nhats=. if fl1`x'==-9 | (fl1`x'==-1 & sp_ivw==0) 
replace `x'_nhats=0 if fl1`x'==-1 & sp_ivw==1
label var `x'_nhats "`x' from NHATS"
}

capture drop com_nhats
recode sc1usvartoi1 (2=0) (-9 -1=.), gen(com_nhats)

capture drop bathtoi_nhats
gen bathtoi_nhats=. //if sc1dbathdevi==3 | sc1dbathdevi==4 | sc1dtoildevi==3 | sc1dtoildevi==4
replace bathtoi_nhats=0 if sc1dbathdevi==1 | sc1dtoildevi==1
replace bathtoi_nhats=1 if sc1dbathdevi==2 | sc1dtoildevi==2


///// 3/2/18 --Adding in meal skippped questions; update 3/13 added in EW18
//missing if in NH-FQ, dead, in NH-FQ R1 & R2

capture drop mealskip1 nopayhous nopayutil nopaymed
local ew mealskip1 nopayhous nopayutil nopaymed
foreach x in `ew'{
gen `x'=.
}

foreach x in `ew'{
forvalues w=2/6 {
replace `x'=0 if ew`w'`x'==2 
replace `x'=1 if ew`w'`x'==1
replace `x'=2 if ew`w'`x'==-7 | ew`w'`x'==-8
}
}

label var mealskip1 "No Money, Meals Skipped"
label var nopayhous "No Money for Housing"
label var nopayutil "No Money for Utilities"
label var nopaymed "No Money for Medical"

label define mealskip 0 "No" 1 "Yes" 2 "RF/DK"
foreach x in `ew' {
label values `ew' mealskip
}
rename mealskip1 mealskip

capture drop mealskipnum
gen mealskipnum=.

forvalues w=2/6 {
replace mealskipnum=0 if ew`w'mealskip2==-1 & ew`w'mealskip1==2
replace mealskipnum=1 if ew`w'mealskip2==4
replace mealskipnum=2 if ew`w'mealskip2==3
replace mealskipnum=3 if ew`w'mealskip2==2
replace mealskipnum=4 if ew`w'mealskip2==1
replace mealskipnum=5 if ew`w'mealskip2==-7 | ew`w'mealskip2==-8
}

label var mealskipnum "How Often Meals Skipped"
label define mealskipnum1 0 "No" 1 "A Few Days" 2 "Several Days(less than half)" ///
3 "More than Half the Days" 4 " Nearly Every Day" 5 "RF/DK"
label values mealskipnum mealskipnum1


///// 12/5/17 --Adding in Cancer 

// recode hc1cancerty1 (-1 2=0) (-9 -8 =.), gen (sr_skincancer_had)

// From sensitive data
recode hc1cancerty1 hc1cancerty2 hc1cancerty3 hc1cancerty4 hc1cancerty5 ///
hc1cancerty6 hc1cancerty7 hc1cancerty8 (-1 2=0) (-9 -8 =.), gen (sr_skincancer_had sr_breastcancer_had sr_prostatecancer_had sr_bladdercancer_had ///
sr_crvovrnutrncancer_had sr_coloncancer_had sr_kidneycancer_had sr_othercancer_had)

//keep sr_breastcancer_had sr_prostatecancer_had sr_bladdercancer_had ///
//sr_crvovrnutrncancer_had sr_coloncancer_had sr_kidneycancer_had sr_othercancer_had


//recoding all refuse, dk, na, as missing
qui destring *, replace
foreach x of varlist * {
	replace `x'=. if inlist(`x',-1,-7,-8,-9)
}

//how do you get to the doctor?
gen howgetdoc=.
forvalues i=1/9 {
	forvalues j=1/6 {
		replace howgetdoc=`i' if mc`j'hwgtregd`i'==1 & wave==`j'
}
}
label define howgetdoc 1 "Drove" 2 "Got a Ride" 3 "Van/Shuttle from place lives" 4 "Van/Shuttle for seniors & disabled" 5 "Pulic transit" 6 "Taxi" 7 "Walked" 8 "Home visit" 9 "Other" 0 "Did not See Doctor" 10 "Refused/DK"
label values howgetdoc howgetdoc


//note 11/14/17--add importance of activities
gen ind_imp_visit=.
gen ind_imp_relig=.
gen ind_imp_club=.
gen ind_imp_goout=.

forvalues w=1/6 {
replace ind_imp_visit=inlist(pa`w'impvstfam,1,2) if wave==`w'
replace ind_imp_relig=inlist(pa`w'imprelser,1,2) if wave==`w'
replace ind_imp_club=inlist(pa`w'imparclub,1,2) if wave==`w'
replace ind_imp_goout=inlist(pa`w'impouteny,1,2) if wave==`w'
}
label var ind_imp_visit "Very/somewhat important to visit in person with friends/family"
label var ind_imp_relig "Very/somewhat important to attend religious services"
label var ind_imp_club "Very/somewhat important to participate in clubs, classes, etc."
label var ind_imp_goout "Very/somewhat important to go out for enjoyment"

foreach x in out insd bed {
	gen device_`x'=.
}

foreach x in eat bath toil dres {
	gen device_`x'=.
}
forvalues w=1/6 {
foreach x in out insd bed {
	replace device_`x'=mo`w'd`x'devi==2 if inlist(mo`w'd`x'devi,1,2) & wave==`w'
}

foreach x in eat bath toil dres {
	replace device_`x'=sc`w'd`x'devi==2 if inlist(sc`w'd`x'devi,1,2) & wave==`w'
}
replace device_bath=0 if sc`w'dbathdevi==9 & wave==`w'
}

gen device_any=0
foreach x in out ins bed eat bath toil dres {
	replace device_any=1 if device_`x'==1
}
label var device_any "Uses any assistive device for ADLs"

gen drives=.
forvalues w=1/6 {
replace drives=dt`w'oftedrive>0 & dt`w'oftedrive<5 if wave==`w'
}
label var drives "Drives"

gen avoids=.
forvalues w=1/6 {
replace avoids=0 if dt`w'oftedrive>0 & dt`w'oftedrive!=5
local avoids dt`w'avoidriv1 dt`w'avoidriv2 dt`w'avoidriv4

foreach x of varlist `avoids' {
	replace avoids=1 if `x'==1
	replace `x'=. if `x'<0
}
}
label var avoids "Avoids driving alone/at night/in weather*"

gen miss=0
gen ind_transp_disadv=.

forvalues w=1/6 {
replace ind_transp_disadv=0 if (dt`w'oftedrive==. | inlist(dt`w'oftedrive,5,6)) & wave==`w'
local probs pa`w'trkpfrvis pa`w'trprrelsr pa`w'trprkpfgr pa`w'trprgoout
foreach x in `probs' {
replace ind_transp_disadv=1 if `x'==1 & wave==`w'
gen `x'2=`x'==1 if `x'>=0 & !missing(`x') & wave==`w'
replace `x'=`x'2
drop `x'2
replace miss=miss+1 if missing(`x') & wave==`w'
}
}
replace ind_transp_disadv=0 if !miss & missing(ind_transp_disadv)
replace ind_transp_disadv=. if miss==4
label var ind_transp_disadv "Any transportation disadvantage"
drop miss

local lab1 Walked
local lab2 Got ride
local lab3 Van or shuttle provided by place of residence
local lab4 Van or shuttle for seniors
local lab5 Public transportation
local lab6 Taxi
local lab7 Other
local l=1

forvalues i=1/7 {
gen get_places`i'=.
}
forvalues w=1/6 {
replace dt`w'getoplcs3=0 if !missing(dt`w'getoplcs7) & missing(dt`w'getoplcs3)
forvalues x=1/7  {
	replace get_places`x'=dt`w'getoplcs`x'==1 if wave==`w'
	replace get_places`x'=. if (inlist(dt`w'getoplcs7,-1,.) | dt`w'getoplcs`x'==.) & wave==`w'
	label var get_places`x' "Get places: `lab`l''"
	local l=`l'+1
}
}
//marital status-3 vars: married, married_or_partnered

gen married=maritalstat==1 if maritalstat!=. //married
gen marital_sep=maritalstat==3 if !mi(maritalstat)
gen marital_div=maritalstat==4 if !mi(maritalstat)
gen marital_wid=maritalstat==5 if !mi(maritalstat)
gen marital_nev=maritalstat==6 if !mi(maritalstat)
gen marriedpartnered=married
replace marriedpartnered=1 if maritalstat==2 //living with a partner
gen marital_sd=marital_sep
replace marital_sd=1 if marital_div==1

label var married "Married"
label var marriedpartnered "Married or Live w/ Partner"

//lives with spouse
gen resspouse=.
forvalues i=1/6 {
	replace resspouse=hh`i'livwthspo==1 if wave==`i' & hh`i'livwthspo>0
	replace resspouse=0 if marriedpart==0
}
label var resspouse "Lives with Spouse/Partner"

//household members
gen hhm=.
forvalues i=1/6 {
	replace hhm=hh`i'dhshldnum if hh`i'dhshldnum>0 & wave==`i'
}
label var hhm "Number of household members"

//age categorical

sort spid wave
by spid: replace age=age[_n-1]+1 if missing(age)

gen agecat = .
forvalues i=1/6 {
replace agecat= r`i'd2intvrage if wave==`i'
}
replace agecat=. if agecat==-1
label values agecat r1d2intvrage
label var agecat "Age, 5 yr categories"

//activities past month

gen attrelig=. //attend services
gen imprelig=. //importance of religious services
gen visitfrfam=. //visit fr. fam.
gen impvisit=. //importance of visiting friends & fam
gen attclub=. //participate in club, organized activity, class, etc.
gen impclub=. //importance of such activities
gen vigact=. //vigorous activities

forvalues i=1/6 {
	replace attrelig=pa`i'attrelser==1 if pa`i'attrelser>0 & wave==`i'
	replace imprelig=pa`i'imprelser if pa`i'imprelser>0 & wave==`i' 
	replace visitfrfam=pa`i'vistfrfam==1 if pa`i'vistfrfam>0 & wave==`i'
	replace impvisit=pa`i'impvstfam if pa`i'impvstfam>0 & wave==`i'
	replace attclub=pa`i'clbmtgrac==1 if pa`i'clbmtgrac>0 & wave==`i'
	replace impclub=pa`i'imparclub if pa`i'imparclub>0 & wave==`i'
	replace vigact=pa`i'vigoractv==1 if pa`i'vigoractv>0 & wave==`i'
}

gen religvimp=imprelig==1 if imprelig!=. //very important binary

label var attrelig "Past mo. Attend religious services"
label var imprelig "Importance of religious services"
label var religvimp "Religious services very important, yes/no"
label var visitfrfam "Past mo. visit friends or family"
label var impvisit "Importance of visiting friends/family"
label var attclub "Past mo. participate in clubs/classes/organized activities"
label var impclub "Importance of club/class/etc. participation"
label var vigact "Past mo. engage in vigorous activity"

label values imprelig pa1imprelser
label values impvisit pa1impvstfam
label values impclub pa1imparclub

//smokin'
gen smokedever=. 
gen smoke_start_age=.
gen smoke_stop_age=.
forvalues i=1(4)5 {
	replace smokedever=sd`i'smokedreg==1 if wave==`i' & sd`i'smokedreg>0
	replace smoke_start_age=sd`i'agesrtsmk if wave==`i' & sd`i'agesrtsmk>0
	replace smoke_stop_age=sd`i'agelstsmk if wave==`i' & sd`i'agelstsmk>0
}

sort spid wave
by spid: carryforward smoke*, replace
gen smokesnow=.
by spid, sort: egen numcigsever=max(sd1numcigday)
gen numcigsnow=.


forvalues i=1/6 {
	replace smokesnow=sd`i'smokesnow==1 if wave==`i' & sd`i'smokesnow>0
	replace numcigsnow=sd`i'numcigday if wave==`i' & smokesnow==1
}
replace smokedever=1 if smokesnow==1
replace smokesnow=0 if smokedever==0
replace numcigsnow=0 if smokesnow==0

label var smokedever "Ever smoked"
label var smokesnow "Smokes now"
label var numcigsever "Number of cigarettes/day when smoked"
label var numcigsnow "Number of cigarettes/day currently"
label var smoke_start_age "Age started smoking"
label var smoke_stop_age "Age stopped smoking"

//pain
gen ind_pain=.
forvalues i=1/6 {
	replace ind_pain=ss`i'painb==1 if inrange(ss`i'painb,0,2) & wave==`i'
}
label var ind_pain "Bothered by pain"

//weight

gen wgt_curr=.
gen height_ft=.
gen height_in=.

forvalues i=1/6 {
	replace wgt_curr=hw`i'currweigh if hw`i'currweigh>0 & wave==`i'
	replace height_ft=hw`i'howtallft if hw`i'howtallft>0 & wave==`i'
	replace height_in=hw`i'howtallin if hw`i'howtallin>0 & wave==`i'
}

label var wgt_curr "Current weight, lbs."
label var height_ft "Current height, feet"
label var height_in "Current height, inches"

gen bmi=(wgt_curr/((height_ft*12+height_in)^2))*703

label var bmi "Current BMI"

//get the per round weight, cluster, and strata vars (and why is moved created like that?)
gen moved=.
rename w1varunit varunit
rename w1varstrat varstrat
rename w1anfinwgt0 anfinwgt

forvalues i=2/6 {
	replace moved=w`i'_moved if wave==`i'
	foreach x in anfinwgt varstrat varunit {
		replace `x'=w`i'`x' if wave==`i'
}
drop w`i'_moved w`i'anfinwgt0 w`i'varstrat w`i'varunit 
}

******************************************
/*these are taken from Rebecca's code*/

gen community_dwelling = 0
replace community_dwelling = 1 if r1dresid == 1 | r1dresid == 2 | r2dresid == 1 | r2dresid == 2 | r3dresid == 1 | r3dresid == 2 | r4dresid == 1 | r4dresid == 2 
gen SP_completed = 0
replace SP_completed = 1 if r1dresid == 1 | r1dresid == 2 | r2dresid == 1 | r2dresid == 2 | r2dresid == 4 | r3dresid == 1 | r3dresid == 2 | r3dresid == 4 | r4dresid == 1 | r4dresid == 2 | r4dresid == 4

gen nhres=r1dresid==4 if r1dresid!=.
gen rcfres=inlist(r1dresid,2,3) if r1dresid!=.
gen res_care=r1dresid>1 if r1dresid!=.
gen sp_status=1 
gen deceased=0
gen prob_dem=dem_3_cat==1 if !missing(dem_3_cat)
label var prob_dem "Indicator probable dementia"
forvalues i=2/6 {
	replace nhres=inlist(r`i'dresid,4,5,8) if wave==`i'
	replace res_care=inlist(r`i'dresid,2,3,4,5,7,8) if wave==`i'
	replace rcfres=inlist(r`i'dresid,2,3,7) if wave==`i'
	replace deceased=inlist(r`i'status,62,86) if wave>=`i'
}

replace sp_status=2 if res_care==1
replace sp_status=3 if nhres==1
replace sp_status=4 if deceased==1
label var sp_status "Residential status"
label var nhres "Nursing Home Resident"
label var rcfres "Residential Care, excl. NH"
label var res_care "Residential Care, incl. NH"
label define sp_status 1 "Non-res care community" 2 "Res-care not NH" 3 "NH resident" ///
4 "Deceased"
label values sp_status sp_status

//these ADL variables were missing previously
gen adl_ins_help = .
gen adl_ins_diff=.
gen adl_ins_not_done=.

foreach w in 1 2 3 4 5 6{
	replace adl_ins_help=1 if mo`w'insdhlp==1 & wave==`w'
	replace adl_ins_help=0 if mo`w'insdhlp==2 & wave==`w'
	replace adl_ins_help=0 if mo`w'insdhlp==-1 & sp_ivw==1 & wave==`w'
	replace adl_ins_help=-7 if mo`w'insdhlp==-7 & wave==`w'
	replace adl_ins_help=-8 if mo`w'insdhlp==-8 & wave==`w'
	replace adl_ins_diff=0 if mo`w'insddif==1 & wave==`w'
	replace adl_ins_diff=1 if mo`w'insddif>1 & wave==`w'
	replace adl_ins_diff=0 if mo`w'insddif==-1 & sp_ivw==1 & wave==`w'
	replace adl_ins_diff=-7 if mo`w'insddif==-7 & wave==`w'
	replace adl_ins_diff=-8 if mo`w'insddif==-8 & wave==`w'
	replace adl_ins_not_done=inlist(mo`w'dinsdsfdf,1,8) if wave==`w'
}

*replace adl_ins_dif=1 if adl_ins_help==1
label var adl_ins_help "Received help getting around inside"

gen adl_bed_help = .
gen adl_bed_diff=.
gen adl_bed_not_done=.
foreach w in 1 2 3 4 5 6{
	replace adl_bed_help=1 if mo`w'bedhlp==1 & wave==`w'
	replace adl_bed_help=0 if mo`w'bedhlp==2 & wave==`w'
	replace adl_bed_help=0 if mo`w'bedhlp==-1 & sp_ivw==1 & wave==`w'
	replace adl_bed_help=-7 if mo`w'bedhlp==-7 & wave==`w'
	replace adl_bed_help=-8 if mo`w'bedhlp==-8 & wave==`w'
	replace adl_bed_diff=0 if mo`w'beddif==1 & wave==`w'
	replace adl_bed_diff=1 if mo`w'beddif>1 & wave==`w'
	replace adl_bed_diff=0 if mo`w'beddif==-1 & sp_ivw==1 & wave==`w'
	replace adl_bed_diff=-7 if mo`w'beddif==-7 & wave==`w'
	replace adl_bed_diff=-8 if mo`w'beddif==-8 & wave==`w'
	replace adl_bed_not_done=inlist(mo`w'dbedsfdf,1,8) if wave==`w'
}
label var adl_bed_help "Received help getting out of bed"
*replace adl_bed_diff=1 if adl_bed_help==1
//construct date of ivw--use 1st of month for all, because only have mo & yr

gen ivw_day=1
label define ivw_day 1 "Not provided" 
label values ivw_day ivw_day
gen ivw_month=.
gen ivw_year=.
forvalues i=1/6 {
	replace ivw_month=r`i'spstatdtmt if wave==`i'
	replace ivw_month=r`i'fqstatdtmt if wave==`i' & r`i'spstatdtmt==.
	replace ivw_year=r`i'spstatdtyr if wave==`i'
	replace ivw_year=201`i' if wave==`i' & r`i'spstatdtyr==.
}
replace ivw_month=r1fqstatdtmt if wave==1 & ivw_month==.
replace ivw_year=r1fqstatdty if wave==1 & ivw_year==.


gen adl_index=0
foreach i in eat bath toil dres bed ins {
replace adl_index=adl_index+adl_`i'_help if adl_`i'_help>0
}
*gen adl_index=adl_eat_help+adl_bath_help+adl_toil_help+adl_dres_help+adl_ins_help+adl_bed_help
replace adl_index=. if adl_index<0
gen adl_independent=adl_index==0 if adl_index!=.
gen adl_impair=adl_index>0 if adl_index!=.
gen iadl_index=iadl_laun_help+iadl_shop_help+iadl_bank_help+iadl_meal_help+iadl_meds_help
replace iadl_index=. if iadl_index<0
gen iadl_independent=iadl_index==0 if iadl_index!=.
gen iadl_impair=iadl_index>0 if iadl_index!=.
foreach x in adl iadl {
	egen `x'_diff_index=rowtotal(`x'*diff)
	gen `x'_diff_ind=`x'_diff_index>=1 if !missing(`x'_diff_index)
}
label var adl_independent "Independent in ADLs"
label var adl_impair "Help with 1+ ADL"
label var adl_index "Index of help w/ ADLs"
label var iadl_independent "Independent in IADLs"
label var iadl_impair "Help with 1+ IADL"
label var iadl_index "Index of help w/ IADLs"

gen ivw_date=mdy(ivw_month,ivw_day,ivw_year)
format ivw_date %td

//addition of variables from Eric's homebound code
gen meals_wheels=.
gen noone_talk=.
gen restrnt_takeout=.

forvalues i=1/6 {
replace meals_wheels=ha`i'dmealwhl if wave==`i'
replace noone_talk=fl`i'noonetalk if wave==`i'
replace restrnt_takeout=ha`i'dmealtkot if wave==`i'
foreach x in meals_wheels noone_talk restrnt_takeout {
replace `x'=0 if `x'==.
}
}

//pull in date of death, constructed from claims and nhats
merge m:1 spid using "E:\nhats\data\CMS_DUA_28016\death_date.dta", nogen

gen died_12=mofd(death_date)-mofd(ivw_date)<=12
gen died_24=mofd(death_date)-mofd(ivw_date)<=24
//note-the following has been superseded by the death date using claims
/*

//use status to get death
gen died_12=.
gen died_24=.
forvalues i=1/3 {
replace died_12=inlist(r`=`i'+1'status,62,86) if wave==`i' & r`=`i'+1'status!=79
}
forvalues i=1/2 {
replace died_24=inlist(r`=`i'+2'status,62,86) if wave==`i' & !inlist(r`=`i'+2'status,79,.)
}
replace died_24=1 if died_12==1

foreach i in 12 24 {
label var died_`i' "SP died w/in `i' months, per future wave status"
}*/

//update 8/2/17--pulled in nhats dod to share off server

//look at death month & year. don't have, so set date to last of month
gen dd=.
replace pd2yrdied=pd2yrdied+2010 if pd2yrdied>0
gen nhats_death_day=. 
forvalues i=2/4 {
	foreach j in mth yr {
		replace pd`i'`j'died=. if pd`i'`j'<0
}
	replace nhats_death_day=31 if inlist(pd`i'm,1,3,5,7,8,10,12)
	replace nhats_death_day=30 if inlist(pd`i'm,4,6,9,11)
	replace nhats_death_day=28 if inlist(pd`i'm,2)
	replace dd=mdy(pd`i'mthdied,nhats_death_day,pd`i'yrdied) if pd`i'yrdied>0 & pd`i'yrdied!=.
}

by spid, sort: egen nhats_death_date=max(dd)
label var nhats_death_date "SP death date, from tracker (day imputed)"
format nhats_death_date %td
gen nhats_death_month=month(nhats_death_date)
gen nhats_death_year=year(nhats_death_date)
foreach x in month year {
label var nhats_death_date "SP death `x', from tracker"
}

drop dd

gen eligible_nsoc=fl1dnsoc==1
gen completed_nsoc=fl1dnsoccomp>0 if fl1dnsoccomp!=.
gen total_caregiver_comp=fl1dnsoccomp if fl1dnsoccomp>0 & fl1dnsoccomp!=.
gen total_caregiver_elig=fl1dnsoccnt if fl1dnsoccnt>0 & fl1dnsoccnt!=.
label var eligible  "Eligible for NSOC interview, wave 1 tracker"
label var complete  "Completed Interview"
label var total_caregiver_comp "Total Caregivers that Completed Interview"
label var total_caregiver_elig "Total Caregivers Eligible for NSOC"
rename r*status round*status

//adverse consequences of unmet need

gen adverse=0
forvalues i=1/6 {
	foreach x of varlist ha`i'*out sc`i'*out {
		replace adverse=1 if `x'==1 & wave==`i'
}
}
label var adverse "Any adverse consequence of unmet need (excluding mobility)"

//limited favorite activity
capture drop lim_fav
gen lim_fav=.

forvalues i=1/5 { 
	replace lim_fav=pa`i'helmfvact==1 if pa`i'helmfvact>=0 & wave==`i'
}
label var lim_fav "Last month ever kept from favorite activity by health/function"


capture drop lim_fav_yr
////NEW limited favorite activity
gen lim_fav_yr=.
//forvalues i=6 {
	replace lim_fav_yr=pa6fvactlimyr==1 if pa6fvactlimyr>=0 & wave==6
//}
label var lim_fav_yr "Last year ever kept from favorite activity by health/function"


//social cohesion
gen cohesion_knowwell=.
gen cohesion_willing=.
gen cohesion_peop=.

forvalues i=1/6 {
	foreach x in know will peop {
		replace cohesion_`x'=cm`i'`x' if !missing(cm`i'`x') & wave==`i'
}
}
gen cohesion=(cohesion_p+cohesion_k+cohesion_w==3) ///
if !missing(cohesion_k) | !missing(cohesion_w) | !missing(cohesion_p)

label var cohesion_knowwell "People know each other well in the community"
label var cohesion_w "People are willing to help each other in the commmunity"
label var cohesion_p "People can be trusted in the community"
label define cohesion_ 1 "Agree a lot" 2 "Agree a little" 3 "Do not agree"
label values cohesion_* cohesion_
label var cohesion "High community cohesion (Highest on all 3 statements)"

gen home_disorder_insd=.
gen home_disorder_outsd=.
gen home_disorder_area=.
gen home_disorder_clutter=.

forvalues i=1/6 {
	foreach x of varlist ir`i'condihom* ir`i'condhome* ir`i'areacond* ir`i'clutter* {
		replace `x'=. if `x'==7
		qui sum `x'
		if r(max)==2 replace `x'=`x'==1 if !missing(`x')
		if inlist(r(max),3,4) replace `x'=`x'>1 if !missing(`x')
}

	egen insd=rowtotal(ir`i'condihom*)
	egen outsd=rowtotal(ir`i'condhome*)
	egen area=rowtotal(ir`i'areacond*)
	egen clutter=rowtotal(ir`i'clutter*)
	foreach x in insd outsd area clutter {
		replace home_disorder_`x'=`x'>=1 if wave==`i' & !missing(`x')
		drop `x'
}
}

label var home_disorder_insd "Disorder in home (peelng paint, pests, brkn furniture or floorbrds, trippng hazards)"
label var home_disorder_outsd "Disorder outside (brkn windows, foundation, bricks/siding, roof, steps)"
label var home_disorder_clutter "Disorder in home (clutter in interview or other rooms)"
label var home_disorder_area "Disorder in immed area (litter/glass/graffiti/vacant houses/stores/foreclosures)"	

//economic well-being
foreach x of varlist ew* {
	replace `x'=. if `x'<0
}

foreach x in creditdebt medcreditdebt medbillsovertime medpaynotcash finhlpfam ///
fingftfam govtasst {
	gen `x'=.
}

forvalues i=1/6 {
gen creditdebt`i'=inlist(ew`i'pycredbal,2,3) | !missing(ew`i'crecardeb) if ///
 !missing(ew`i'pycredbal) | !missing(ew`i'crecardeb)
gen medcreditdebt`i'=ew`i'credcdmed==1 if !missing(ew`i'credcdmed)
gen medbillsovertime`i'=ew`i'medpaovtm==1 if !missing(ew`i'medpaovtm)
gen medpaynotcash`i'=medbillsovertime==1 | medcreditdebt==1 if !missing(medbillsovertime) | ///
!missing(medcreditdebt)

gen finhlpfam`i'=ew`i'finhlpfam==1 if !missing(ew`i'finhlpfam)
gen fingftfam`i'= ew`i'fingftfam==1 if !missing(ew`i'finhlpfam)
gen govtasst`i'=ew`i'progneed1==1 | ew`i'progneed2==1 | ew`i'progneed3==1 if !missing(ew`i'progneed1) ///
| !missing(ew`i'progneed2) | !missing(ew`i'progneed3)
foreach x in creditdebt medcreditdebt medbillsovertime medpaynotcash finhlpfam ///
fingftfam govtasst {
	replace `x'=`x'`i' if wave==`i'
	drop `x'`i'
}
}
replace medpaynotcash=medbillsovertime==1 | medcreditdebt==1 if !missing(medbillsovertime) | !missing(medcreditdebt)

label var creditdebt "Has credit card debt or does not pay off in full monthly"
label var medpaynotcash "Has medical credit card debt or pays bills over time"
label var govtasst "Receives foodstamps or other food or gas/energy assistance"

//home ownership

local homevars ownhome rent mortgagepaidoff paysmortgage mortpaymt ///
timeinmort owedonmort homevalue rentpaid section8

foreach x of local homevars {
	gen `x'=.
}

label var ownhome "SP owns home"
label var rent "SP rents"
label var mortgagepaidoff "Mortgage is paid off"
label var mortpaymt "Mortgage payment"
label define mortpaymt 1 "<$250" 2 "$250-499" 3 "$500-999" 4 "$1000+"
label values mortpaymt mortpaymt
label var timeinmort "Time left in mortgage"
label define timeinmort 1 "5 years" 2 "10 years" 3 "Longer than 10 years"
label values timeinmort timeinmort
label var owedonmort "Amount left on mortgage"
label define owedonmort 1 "<$50,000" 2 "$50,000-99,999.99" 3 "$100,000+"
label values owedonmort owedonmort
label var homevalue "Home value"
label define homevalue 1 "<$50K" 2 "50-75K" 3 "75-100K" 4 "100-200K" 5 "200-300K" ///
6 "300-500K" 7 "500-750K" 8 "$750K+"
label values homevalue homevalue

forvalues i=1/6 {
tab hp`i'ownrentot 
replace ownhome=hp`i'ownrentot==1 if wave==`i' & (!missing(hp`i'ownrento) | res_care==1)
replace rent=hp`i'ownrentot==2 if wave==`i' & (!missing(hp`i'ownrento) | res_care==1)
tab hp`i'mrtpadoff 
replace mortgagepaidoff=hp`i'mrtpadoff==1 if !missing(hp`i'mrtpadoff)
replace paysmortgage=hp`i'mrtpadoff==2 if !missing(hp`i'mrtpadoff)
tab hp`i'mortpaymt 
replace mortpaymt= hp`i'mortpaymt if wave==`i'
qui replace mortpaymt=1 if wave==`i' & hp`i'mthlymort<250
qui replace mortpaymt=2 if wave==`i' & hp`i'mthlymort>=250 & hp`i'mthlymort<=499
qui replace mortpaymt=3 if wave==`i' & hp`i'mthlymort>=500 & hp`i'mthlymort<1000
qui replace mortpaymt=4 if wave==`i' & hp`i'mthlymort>=1000 & !missing(hp`i'mthlymort)
tab hp`i'whnpayoff 
replace timeinmort=hp`i'whnpayoff if wave==`i'
tab hp`i'amoutowed 
replace owedonmort=hp`i'amoutowed if wave==`i'
qui replace owedonmort=1 if wave==`i' & hp`i'amtstlowe<50000 
qui replace owedonmort=2 if wave==`i' & hp`i'amtstlowe>=50000 & hp`i'amtstlowe<=100000
qui replace owedonmort=3 if wave==`i' & hp`i'amtstlowe>=100000 & !missing(hp`i'amtstlowe)
tab hp`i'homvalamt 
replace homevalue= hp`i'homvalamt if wave==`i'
qui replace homevalue=1 if wave==`i' & hp`i'homevalue<50000 & hp`i'homevalue>=0
qui replace homevalue=2 if wave==`i' & hp`i'homevalue>=50000 & hp`i'homevalue<75000
qui replace homevalue=3 if wave==`i' & hp`i'homevalue>=75000 & hp`i'homevalue<100000
qui replace homevalue=4 if wave==`i' & hp`i'homevalue>=100000 & hp`i'homevalue<200000
qui replace homevalue=5 if wave==`i' & hp`i'homevalue>=200000 & hp`i'homevalue<300000
qui replace homevalue=6 if wave==`i' & hp`i'homevalue>=300000 & hp`i'homevalue<500000
qui replace homevalue=7 if wave==`i' & hp`i'homevalue>=500000 & hp`i'homevalue<750000
qui replace homevalue=8 if wave==`i' & hp`i'homevalue>=750000 & !missing(hp`i'homevalue)

tab hp`i'rentamou 
replace rentpaid =hp`i'rentamou if wave==`i'
qui replace rentpaid=1 if wave==`i' & hp`i'rentamt<250 & hp`i'rentamt>=0
qui replace rentpaid=2 if wave==`i' & hp`i'rentamt>=250 & hp`i'rentamt<=499
qui replace rentpaid=3 if wave==`i' & hp`i'rentamt>=500 & hp`i'rentamt<1000
qui replace rentpaid=4 if wave==`i' & hp`i'rentamt>=1000 & !missing(hp`i'rentamt)
qui replace rentpaid=4 if inlist(rentpaid,5,6)
replace mortpaymt=4 if inlist(mortpaymt,5,6)
tab hp1sec8pubsn
replace section8=hp`i'sec8pubsn==1 if wave==`i' & (!missing(hp`i'sec8pubsn) |ownhome==1 | rent==1)
}

label var rentpaid "Amount rent paid"
label define rentpaid 1 "<$250" 2 "250-499" 3 "500-999" 4 "$1000+"
label values rentpaid rentpaid
label var section8 "Indicator lives in Section 8 housing"
label var medcreditdebt "Has Medical credit card debt"
label var medbillsovertime "Pays Medical bills over time"
label var finhlpfam "Received financial help/gifts from family"
label var fingftfam "Provided financial help/gifts to family"
label var paysmortgage "Pays a mortgage"
gen n_social_network=.
forvalues i=1/6 {
	replace n_social_network=sn`i'dnumsn if sn`i'dnumsn>=0 & wave==`i'
}
label var n_social_network "Number in social network"

gen division=.
forvalues w=1/6 {
	replace division=re`w'dcensdiv if re`w'dcensdiv>0 & wave==`w'
}
gen region=division 
recode region (1 2=1) (3 4=2) (5/7=3) (8 9=4)

la define region 1 "Northeast" 2 "Midwest" 3 "South" 4 "West"
label values region region
 
//and now drop all raw variables
forvalues i=1/6 {
	drop r`i'* ip`i'* is`i'* re`i'* hc`i'* ht`i'* hh`i'* ss`i'* fl`i'* ///
	 pc`i'* cp`i'* cg`i'* mo`i'* ha`i'* sc`i'* mc`i'* pa`i'* sd`i'* hw`i'* ///
	 cm`i'* sn`i'* hp`i'* ew`i'* ir`i'* dt`i'* wb`i'*
}

drop el1* rl1* ia1* pd2* pd3* pd4* ia3* ia5*

rename round*status r*status

svyset varunit [pw=anfinwgt], strat(varstrat)

sort spid wave
by spid: carryforward educ*, replace
label var educ_hs_ind "Education: HS+"

saveold "E:\nhats\data\NHATS cleaned\sp_round_1_6", replace version(12)

drop death_* died_12 died_24

gen time2d=mofd(nhats_death_date)-mofd(ivw_date)

foreach x in 12 24 {
	gen nhats_died_`x'=time2d<=`x' if !lml
}

drop time2d 

saveold "E:\nhats\data\NHATS cleaned\sp_round_1_6_public_sens_only.dta", replace version(12)


H="xxx(done step above) Drop the Raw Variables to a Limited Data Set (6a_Drop_Variables)"
use "E:\nhats\data\NHATS working data\round_1_6_clean_helper_added_old.dta", clear
//gen n = 1
//Add a couple of essential variables
gen community_dwelling = 0
replace community_dwelling = 1 if r1dresid == 1 | r1dresid == 2 | r2dresid == 1 | r2dresid == 2 | r3dresid == 1 | r3dresid == 2 | r4dresid == 1 | r4dresid == 2 
gen SP_completed = 0
replace SP_completed = 1 if r1dresid == 1 | r1dresid == 2 | r2dresid == 1 | r2dresid == 2 | r2dresid == 4 | r3dresid == 1 | r3dresid == 2 | r3dresid == 4 | r4dresid == 1 | r4dresid == 2 | r4dresid == 4

//these ADL variables were missing previously
gen adl_ins_help = .
foreach w in 1 2 3 4{
	replace adl_ins_help=1 if mo`w'insdhlp==1 & wave==`w'
	replace adl_ins_help=0 if mo`w'insdhlp==2 & wave==`w'
	replace adl_ins_help=-7 if mo`w'insdhlp==-7 & wave==`w'
	replace adl_ins_help=-8 if mo`w'insdhlp==-8 & wave==`w'
}

gen adl_bed_help = .
foreach w in 1 2 3 4{
	replace adl_bed_help=1 if mo`w'bedhlp==1 & wave==`w'
	replace adl_bed_help=0 if mo`w'bedhlp==2 & wave==`w'
	replace adl_bed_help=-7 if mo`w'bedhlp==-7 & wave==`w'
	replace adl_bed_help=-8 if mo`w'bedhlp==-8 & wave==`w'
}

/*
drop sr_depr_pqq1 sr_depr_pqq2 sr_anx_gad1 sr_anx_gad2 sr_phq2_score sr_phq2_depressed sr_gad2_score sr_gad2_anxiety
gen sr_depr_pqq1=.
gen sr_depr_pqq2=.
gen sr_anx_gad1=.
gen sr_anx_gad2=.
foreach w in 1 2 3{
	//set up new variables for individual wave variables
	foreach q in 1 2 3 4{
	gen temp_hc`w'deprsan`q'=. if inlist(hc`w'depresan`q',-9,-8,-7,-1)
	replace temp_hc`w'deprsan`q'=hc`w'depresan`q'-1 if inlist(hc`w'depresan`q',1,2,3,4)
	}
	//now create clean depression, anxiety variables
	replace sr_depr_pqq1=temp_hc`w'deprsan1 if wave==`w' //little interest or pleasure in doing things
	replace sr_depr_pqq2=temp_hc`w'deprsan2 if wave==`w' //felt down/depressed/hopeless
	replace sr_anx_gad1=temp_hc`w'deprsan3 if wave==`w' //felt nervous or anxious
	replace sr_anx_gad2=temp_hc`w'deprsan4 if wave==`w' //unable to stop worrying

	foreach q in 1 2 3 4{
	drop temp_hc`w'deprsan`q'
	}
	
}
*/
/*
la def depr_anx 0"Not at all" 1"Several days" 2"More than half the days" ///
3"Nearly every day"
la val sr_depr_pqq1 sr_depr_pqq2 sr_anx_gad1 sr_anx_gad2 depr_anx
la var sr_depr_pqq1 "How often little interest in doing things?"
la var sr_depr_pqq2 "How often felt down, depressed, hopeless?"
la var sr_anx_gad1 "How often felt nervous or anxious?"
la var sr_anx_gad2 "How often unable to stop worrying?"

foreach v in sr_depr_pqq1 sr_depr_pqq2 sr_anx_gad1 sr_anx_gad2{
	tab `v' wave if ivw_type==1,missing
}

//combined phq-2 score for depression, cutoff 3+=depressed
gen sr_phq2_score=sr_depr_pqq1+sr_depr_pqq2
gen sr_phq2_depressed=1 if sr_phq2_score>=3 & sr_phq2_score~=.
replace sr_phq2_depressed=0 if sr_phq2_score<3 & sr_phq2_score~=.
la var sr_phq2_score "PHQ-2 combined score 0-6 scale"
la var sr_phq2_depressed "Depressed per PHQ-2, score=3+"
tab sr_phq2_score sr_phq2_depressed if ivw_type==1, missing
replace sr_depr_pqq1 = -7 if hc1depresan1 == -7 | hc2depresan1  == -7 | hc3depresan1  == -7
replace sr_depr_pqq1 = -8 if hc1depresan1 == -8 | hc2depresan1  == -8 | hc3depresan1  == -8
replace sr_depr_pqq2 = -7 if hc1depresan2 == -7 | hc2depresan2  == -7 | hc3depresan2  == -7
replace sr_depr_pqq2 = -8 if hc1depresan2 == -8 | hc2depresan2  == -8 | hc3depresan2  == -8
replace sr_phq2_score = -7 if sr_depr_pqq1 == -7 & sr_depr_pqq2 == -7
replace sr_phq2_score = -8 if sr_depr_pqq1 == -8 & sr_depr_pqq2 == -8

//combined gad-2 score for anxiety, cutoff 3+=anxiety
gen sr_gad2_score=sr_anx_gad1+sr_anx_gad2
gen sr_gad2_anxiety=1 if sr_gad2_score>=3 & sr_gad2_score~=.
replace sr_gad2_anxiety=0 if sr_gad2_score<3 & sr_gad2_score~=.
la var sr_gad2_score "GAD-2 combined score 0-6 scale"
la var sr_gad2_anxiety "Anxiety per GAD-2, score=3+"
tab sr_gad2_score sr_gad2_anxiety if ivw_type==1, missing
tab sr_gad2_anxiety wave, missing
replace sr_anx_gad1 = -7 if hc1depresan3 == -7 | hc2depresan3  == -7 | hc3depresan3  == -7
replace sr_anx_gad1 = -8 if hc1depresan3 == -8 | hc2depresan3  == -8 | hc3depresan3  == -8
replace sr_anx_gad2 = -7 if hc1depresan4 == -7 | hc2depresan4  == -7 | hc3depresan4  == -7
replace sr_anx_gad2 = -8 if hc1depresan4 == -8 | hc2depresan4  == -8 | hc3depresan4  == -8
replace sr_gad2_score = -7 if sr_anx_gad1 == -7 & sr_anx_gad2 == -7
replace sr_gad2_score = -8 if sr_anx_gad1 == -8 & sr_anx_gad2 == -8
tab sr_gad2_score 
tab sr_anx_gad1 
tab sr_anx_gad2
*/
//gen education_rf_1 = 0
//gen education_dk_1 = 0
//sum n if el1higstschl == -8 & wave==1 & community_dwelling == 1
//replace education_rf_1 = 
//sum n if el1higstschl


capture drop r1dresid rl1condspanh is1resptype r1dgender r1d2intvrage re1resistrct hc1health hc1disescn1 hc1disescn2 hc1disescn3 hc1disescn4 hc1disescn5 hc1disescn6 hc1disescn7 hc1disescn8 hc1disescn9 hc1disescn10 hc1cancerty1 hc1dementage hc1brokebon1 hc1brokebon2 hc1serdisill hc1hosptstay hc1hosovrnht hc1kneesurg hc1knesrgyr hc1ageknesur hc1hipsurg hc1hipsrgyr hc1agehipsur hc1catarsurg hc1catrsrgyr hc1agecatsur hc1bckspnsur hc1backsrgyr hc1agebcksrg hc1heartsurg hc1hartsrgyr hc1agehrtsrg hc1fllsinmth hc1worryfall hc1worrylimt hc1faleninyr hc1multifall hc1depresan1 hc1depresan2 hc1depresan3 hc1depresan4 hc1aslep30mn hc1trbfalbck hc1sleepmed ht1placedesc hh1martlstat hh1yrendmarr hh1yrsmarliv hh1spgender hh1d2spouage hh1spouseduc hh1spoupchlp hh1livwthspo hh1placekind hh1proxlivsp hh1othlvhere hh1dspouseid hh1dlvngarrg hh1dhshldnum hh1dhshldchd ss1heringaid ss1hearphone ss1convwradi ss1convquiet ss1glasseswr ss1seewellst ss1seestvgls ss1glasscls ss1othvisaid ss1glrednewp ss1probchswl ss1probspeak ss1painbothr ss1painlimts ss1painmedof ss1painwhe1 ss1painwhe2 ss1painwhe3 ss1painwhe4 ss1painwhe5 ss1painwhe6 ss1painwhe7 ss1painwhe8 ss1painwhe9 ss1painwhe10 ss1painwhe11 ss1painwhe12 ss1painwhe13 ss1probbreat ss1prbbrlimt ss1strnglmup ss1uplimtact ss1lwrbodstr ss1lwrbodimp ss1lowenergy ss1loenlmtat ss1prbbalcrd ss1prbbalcnt pc1walk6blks pc1walk3blks pc1up20stair pc1up10stair pc1car20pnds pc1car10pnds pc1geonknees pc1bendover pc1hvobovrhd pc1rechovrhd pc1opnjarwhd pc1grspsmobj cp1memrygood cp1knownspyr cp1chgthink1 cp1chgthink2 cp1chgthink3 cp1chgthink4 cp1chgthink5 cp1chgthink6 cp1chgthink7 cp1chgthink8 cp1memcogpr1 cp1memcogpr2 cp1memcogpr3 cp1memcogpr4 cg1speaktosp cg1quesremem cg1reascano1 cg1reascano2 cg1reascano3 cg1reascano4 cg1reascano5 cg1reascano6 cg1reascano7 cg1reascano8 cg1reascano9 cg1ratememry cg1ofmemprob cg1memcom1yr cg1todaydat1 cg1todaydat2 cg1todaydat3 cg1todaydat4 cg1todaydat5 cg1prewrdrcl cg1dwrdlstnm cg1wrdsrcal1 cg1wrdsrcal2 cg1wrdsrcal3 cg1wrdsrcal4 cg1wrdsrcal5 cg1wrdsrcal6 cg1wrdsrcal7 cg1wrdsrcal8 cg1wrdsrcal9 cg1wrdsrca10 cg1dwrdimmrc cg1dwrdinone cg1dwrdirref cg1wrdsntlst cg1numnotlst cg1probreca1 cg1probreca2 cg1probreca3 cg1probreca4 cg1dclkdraw cg1dclkimgcl cg1atdrwclck cg1presidna1 cg1presidna2 cg1presidna3 cg1presidna4 cg1vpname1 cg1vpname2 cg1vpname3 cg1vpname4 cg1wrdsdcal1 cg1wrdsdcal2 cg1wrdsdcal3 cg1wrdsdcal4 cg1wrdsdcal5 cg1wrdsdcal6 cg1wrdsdcal7 cg1wrdsdcal8 cg1wrdsdcal9 cg1wrdsdca10 cg1dwrddlyrc cg1dwrddnone cg1dwrddrref cg1wrdnotlst cg1numwrdnot cg1dwrd1rcl cg1dwrd2rcl cg1dwrd3rcl cg1dwrd4rcl cg1dwrd5rcl cg1dwrd6rcl cg1dwrd7rcl cg1dwrd8rcl cg1dwrd9rcl cg1dwrd10rcl cg1dwrd1dly cg1dwrd2dly cg1dwrd3dly cg1dwrd4dly cg1dwrd5dly cg1dwrd6dly cg1dwrd7dly cg1dwrd8dly cg1dwrd9dly cg1dwrd10dly mo1outoft mo1outcane mo1outwalkr mo1outwlchr mo1outsctr mo1outhlp mo1outslf mo1outdif mo1outyrgo mo1outwout ha1laun ha1launslf ha1whrmachi1 ha1whrmachi2 ha1whrmachi3 ha1whrmachi4 ha1whrmachi5 ha1whrmachi6 ha1dlaunreas ha1laundif ha1launoft ha1launwout ha1shop ha1shopslf ha1howpaygr1 ha1howpaygr2 ha1howpaygr3 ha1howpaygr4 ha1howpaygr5 ha1howpaygr6 ha1howpaygr7 ha1howgtstr1 ha1howgtstr2 ha1howgtstr3 ha1howgtstr4 ha1howgtstr5 ha1howgtstr6 ha1howgtstr7 ha1howgtstr8 ha1shopcart ha1shoplean ha1dshopreas ha1shopdif ha1shopoft ha1shopwout ha1meal ha1mealslf ha1restamels ha1oftmicrow ha1dmealreas ha1mealdif ha1mealoft ha1mealwout ha1bank ha1bankslf ha1dbankreas ha1bankdif ha1bankoft ha1bankwout ha1money ha1moneyhlp ha1dlaunsfdf ha1dshopsfdf ha1dmealsfdf ha1dbanksfdf ha1dmealwhl ha1dmealtkot sc1eatdev sc1eatdevoft sc1eathlp sc1eatslfoft sc1eatslfdif sc1eatwout sc1showrbat1 sc1showrbat2 sc1showrbat3 sc1prfrshbth sc1scusgrbrs sc1shtubseat sc1bathhlp sc1bathoft sc1bathdif sc1bathyrgo sc1bathwout sc1usvartoi1 sc1usvartoi2 sc1usvartoi3 sc1usvartoi4 sc1toilhlp sc1toiloft sc1toildif sc1toilwout sc1dresoft sc1dresdev sc1dreshlp sc1dresslf sc1dresdif sc1dresyrgo sc1dreswout sc1deatdevi sc1deathelp sc1deatsfdf sc1dbathdevi sc1dbathhelp sc1dbathsfdf sc1dtoildevi sc1dtoilhelp sc1dtoilsfdf sc1ddresdevi sc1ddreshelp sc1ddressfdf mc1meds mc1medstrk mc1medsslf mc1whrgtmed1 mc1whrgtmed2 mc1whrgtmed3 mc1whrgtmed4 mc1howpkupm1 mc1howpkupm2 mc1howpkupm3 mc1medsrem mc1dmedsreas mc1medsdif mc1medsyrgo mc1medsmis mc1havregdoc mc1regdoclyr mc1hwgtregd1 mc1hwgtregd2 mc1hwgtregd3 mc1hwgtregd4 mc1hwgtregd5 mc1hwgtregd6 mc1hwgtregd7 mc1hwgtregd8 mc1hwgtregd9 mc1ansitindr mc1tpersevr1 mc1tpersevr2 mc1tpersevr3 mc1tpersevr4 mc1chginspln mc1anhlpwdec mc1dmedssfdf sd1smokedreg sd1smokesnow sd1numcigday sd1agesrtsmk sd1agelstsmk el1higstschl rl1spkothlan rl1dracehisp ip1covmedcad ip1mgapmedsp ip1cmedicaid ip1covtricar ip1nginsnurs ia1totinc ia1toincim1 ia1toincim2 ia1toincim3 ia1toincim4 ia1toincim5 w1anfinwgt0 w1varstrat w1varunit
capture drop r2dresid is2resptype r2d2intvrage re2spadrsnew re2intplace re2newstrct re2dadrscorr re2dresistrct re2dcensdiv hc2health hc2disescn1 hc2disescn2 hc2disescn3 hc2disescn4 hc2disescn5 hc2disescn6 hc2disescn7 hc2disescn8 hc2disescn9 hc2disescn10 hc2brokebon1 hc2brokebon2 hc2hosptstay hc2hosovrnht hc2knesrgyr hc2hipsrgyr hc2catrsrgyr hc2backsrgyr hc2hartsrgyr hc2fllsinmth hc2worryfall hc2worrylimt hc2faleninyr hc2multifall hc2depresan1 hc2depresan2 hc2depresan3 hc2depresan4 hc2aslep30mn hc2trbfalbck hc2sleepmed ht2placedesc hh2marchange hh2martlstat hh2yrendmarr hh2newspoprt hh2spgender hh2dspouage hh2dspageall hh2spouseduc hh2spoupchlp hh2livwthspo hh2placekind hh2dmarstat hh2dlvngarrg hh2dhshldnum hh2dhshldchd hh2dspouseid ss2heringaid ss2hearphone ss2convwradi ss2convquiet ss2glasseswr ss2seewellst ss2seestvgls ss2glasscls ss2othvisaid ss2glrednewp ss2probchswl ss2probspeak ss2painbothr ss2painlimts ss2painmedof ss2painwhe1 ss2painwhe2 ss2painwhe3 ss2painwhe4 ss2painwhe5 ss2painwhe6 ss2painwhe7 ss2painwhe8 ss2painwhe9 ss2painwhe10 ss2painwhe11 ss2painwhe12 ss2painwhe13 ss2probbreat ss2prbbrlimt ss2strnglmup ss2uplimtact ss2lwrbodstr ss2lwrbodimp ss2lowenergy ss2loenlmtat ss2prbbalcrd ss2prbbalcnt pc2walk6blks pc2walk3blks pc2up20stair pc2up10stair pc2car20pnds pc2car10pnds pc2geonknees pc2bendover pc2hvobovrhd pc2rechovrhd pc2opnjarwhd pc2grspsmobj cp2memrygood cp2knownspyr cp2chgthink1 cp2chgthink2 cp2chgthink3 cp2chgthink4 cp2chgthink5 cp2chgthink6 cp2chgthink7 cp2chgthink8 cp2memcogpr1 cp2memcogpr2 cp2memcogpr3 cp2memcogpr4 cp2dad8dem cg2speaktosp cg2quesremem cg2reascano1 cg2reascano2 cg2reascano3 cg2reascano4 cg2reascano5 cg2reascano6 cg2reascano7 cg2reascano8 cg2reascano9 cg2ratememry cg2ofmemprob cg2memcom1yr cg2todaydat1 cg2todaydat2 cg2todaydat3 cg2todaydat5 cg2todaydat4 cg2todaydat6 cg2prewrdrcl cg2dwrdlstnm cg2wrdsrcal1 cg2wrdsrcal2 cg2wrdsrcal3 cg2wrdsrcal4 cg2wrdsrcal5 cg2wrdsrcal6 cg2wrdsrcal7 cg2wrdsrcal8 cg2wrdsrcal9 cg2wrdsrca10 cg2dwrdimmrc cg2dwrdinone cg2dwrdirref cg2wrdsntlst cg2numnotlst cg2probreca1 cg2probreca2 cg2probreca3 cg2probreca4 cg2probreca5 cg2dclkdraw cg2dclkimgcl cg2atdrwclck cg2presidna1 cg2presidna2 cg2presidna3 cg2presidna4 cg2vpname1 cg2vpname2 cg2vpname3 cg2vpname4 cg2wrdsdcal1 cg2wrdsdcal2 cg2wrdsdcal3 cg2wrdsdcal4 cg2wrdsdcal5 cg2wrdsdcal6 cg2wrdsdcal7 cg2wrdsdcal8 cg2wrdsdcal9 cg2wrdsdca10 cg2dwrddlyrc cg2dwrddnone cg2dwrddrref cg2wrdnotlst cg2numwrdnot cg2dwrd1rcl cg2dwrd2rcl cg2dwrd3rcl cg2dwrd4rcl cg2dwrd5rcl cg2dwrd6rcl cg2dwrd7rcl cg2dwrd8rcl cg2dwrd9rcl cg2dwrd10rcl cg2dwrd1dly cg2dwrd2dly cg2dwrd3dly cg2dwrd4dly cg2dwrd5dly cg2dwrd6dly cg2dwrd7dly cg2dwrd8dly cg2dwrd9dly cg2dwrd10dly mo2outoft mo2outcane mo2outwalkr mo2outwlchr mo2outsctr mo2outhlp mo2outslf mo2outdif mo2outyrgo mo2outwout ha2laun ha2launslf ha2whrmachi1 ha2whrmachi2 ha2whrmachi3 ha2whrmachi4 ha2whrmachi5 ha2whrmachi6 ha2dlaunreas ha2laundif ha2launoft ha2launwout ha2shop ha2shopslf ha2howpaygr1 ha2howpaygr2 ha2howpaygr3 ha2howpaygr4 ha2howpaygr5 ha2howpaygr6 ha2howpaygr7 ha2howgtstr1 ha2howgtstr2 ha2howgtstr3 ha2howgtstr4 ha2howgtstr5 ha2howgtstr6 ha2howgtstr7 ha2howgtstr8 ha2shopcart ha2shoplean ha2dshopreas ha2shopdif ha2shopoft ha2shopwout ha2meal ha2mealslf ha2restamels ha2oftmicrow ha2dmealreas ha2mealdif ha2mealoft ha2mealwout ha2bank ha2bankslf ha2dbankreas ha2bankdif ha2bankoft ha2bankwout ha2money ha2moneyhlp ha2dlaunsfdf ha2dshopsfdf ha2dmealsfdf ha2dbanksfdf ha2dmealwhl ha2dmealtkot sc2eatdev sc2eatdevoft sc2eathlp sc2eatslfoft sc2eatslfdif sc2eatwout sc2showrbat1 sc2showrbat2 sc2showrbat3 sc2bdevdec sc2prfrshbth sc2scusgrbrs sc2shtubseat sc2bathhlp sc2bathoft sc2bathdif sc2bathyrgo sc2bathwout sc2usvartoi1 sc2usvartoi2 sc2usvartoi3 sc2usvartoi4 sc2toilhlp sc2toiloft sc2toildif sc2toilwout sc2dresoft sc2dresdev sc2dreshlp sc2dresslf sc2dresdif sc2dresyrgo sc2dreswout sc2deatdevi sc2deathelp sc2deatsfdf sc2dbathdevi sc2dbathhelp sc2dbathsfdf sc2dtoildevi sc2dtoilhelp sc2dtoilsfdf sc2ddresdevi sc2ddreshelp sc2ddressfdf mc2meds mc2medstrk mc2medsslf mc2whrgtmed1 mc2whrgtmed2 mc2whrgtmed3 mc2whrgtmed4 mc2howpkupm1 mc2howpkupm2 mc2howpkupm3 mc2medsrem mc2dmedsreas mc2medsdif mc2medsyrgo mc2medsmis mc2havregdoc mc2regdoclyr mc2hwgtregd1 mc2hwgtregd2 mc2hwgtregd3 mc2hwgtregd4 mc2hwgtregd5 mc2hwgtregd6 mc2hwgtregd7 mc2hwgtregd8 mc2hwgtregd9 mc2ansitindr mc2tpersevr1 mc2tpersevr2 mc2tpersevr3 mc2tpersevr4 mc2chginspln mc2anhlpwdec mc2dmedssfdf sd2smokesnow sd2numcigday ip2covmedcad ip2mgapmedsp ip2cmedicaid ip2covtricar ip2nginslast ip2nginsnurs w2anfinwgt0 w2varstrat w2varunit r3dresid is3resptype r3d2intvrage re3spadrsnew re3intplace re3newstrct re3dresistrct re3dcensdiv hc3health hc3disescn1 hc3disescn2 hc3disescn3 hc3disescn4 hc3disescn5 hc3disescn6 hc3disescn7 hc3disescn8 hc3disescn9 hc3disescn10 hc3brokebon1 hc3brokebon2 hc3hosptstay hc3hosovrnht hc3knesrgyr hc3hipsrgyr hc3catrsrgyr hc3backsrgyr hc3hartsrgyr hc3fllsinmth hc3worryfall hc3worrylimt hc3faleninyr hc3multifall hc3depresan1 hc3depresan2 hc3depresan3 hc3depresan4 hc3aslep30mn hc3trbfalbck hc3sleepmed ht3placedesc hh3marchange hh3martlstat hh3yrendmarr hh3newspoprt hh3spgender hh3dspouage hh3dspageall hh3spouseduc hh3spoupchlp hh3livwthspo hh3placekind hh3dmarstat hh3dlvngarrg hh3dhshldnum hh3dhshldchd hh3dspouseid ss3heringaid ss3hearphone ss3convwradi ss3convquiet ss3glasseswr ss3seewellst ss3seestvgls ss3glasscls ss3othvisaid ss3glrednewp ss3probchswl ss3probspeak ss3painbothr ss3painlimts ss3painmedof ss3painwhe1 ss3painwhe2 ss3painwhe3 ss3painwhe4 ss3painwhe5 ss3painwhe6 ss3painwhe7 ss3painwhe8 ss3painwhe9 ss3painwhe10 ss3painwhe11 ss3painwhe12 ss3painwhe13 ss3probbreat ss3prbbrlimt ss3strnglmup ss3uplimtact ss3lwrbodstr ss3lwrbodimp ss3lowenergy ss3loenlmtat ss3prbbalcrd ss3prbbalcnt pc3walk6blks pc3walk3blks pc3up20stair pc3up10stair pc3car20pnds pc3car10pnds pc3geonknees pc3bendover pc3hvobovrhd pc3rechovrhd pc3opnjarwhd pc3grspsmobj cp3memrygood cp3knownspyr cp3chgthink1 cp3chgthink2 cp3chgthink3 cp3chgthink4 cp3chgthink5 cp3chgthink6 cp3chgthink7 cp3chgthink8 cp3memcogpr1 cp3memcogpr2 cp3memcogpr3 cp3memcogpr4 cp3dad8dem cg3speaktosp cg3quesremem cg3reascano1 cg3reascano2 cg3reascano3 cg3reascano4 cg3reascano5 cg3reascano6 cg3reascano7 cg3reascano8 cg3reascano9 cg3ratememry cg3ofmemprob cg3memcom1yr cg3todaydat1 cg3todaydat2 cg3todaydat3 cg3todaydat5 cg3todaydat4 cg3todaydat6 cg3prewrdrcl cg3dwrdlstnm cg3wrdsrcal1 cg3wrdsrcal2 cg3wrdsrcal3 cg3wrdsrcal4 cg3wrdsrcal5 cg3wrdsrcal6 cg3wrdsrcal7 cg3wrdsrcal8 cg3wrdsrcal9 cg3wrdsrca10 cg3dwrdimmrc cg3dwrdinone cg3dwrdirref cg3wrdsntlst cg3numnotlst cg3probreca1 cg3probreca2 cg3probreca3 cg3probreca4 cg3probreca5 cg3dclkdraw cg3dclkimgcl cg3atdrwclck cg3presidna1 cg3presidna2 cg3presidna3 cg3presidna4 cg3vpname1 cg3vpname2 cg3vpname3 cg3vpname4 cg3wrdsdcal1 cg3wrdsdcal2 cg3wrdsdcal3 cg3wrdsdcal4 cg3wrdsdcal5 cg3wrdsdcal6 cg3wrdsdcal7 cg3wrdsdcal8 cg3wrdsdcal9 cg3wrdsdca10 cg3dwrddlyrc cg3dwrddnone cg3dwrddrref cg3wrdnotlst cg3numwrdnot cg3dwrd1rcl cg3dwrd2rcl cg3dwrd3rcl cg3dwrd4rcl cg3dwrd5rcl cg3dwrd6rcl cg3dwrd7rcl cg3dwrd8rcl cg3dwrd9rcl cg3dwrd10rcl cg3dwrd1dly cg3dwrd2dly cg3dwrd3dly cg3dwrd4dly cg3dwrd5dly cg3dwrd6dly cg3dwrd7dly cg3dwrd8dly cg3dwrd9dly cg3dwrd10dly mo3outoft mo3outcane mo3outwalkr mo3outwlchr mo3outsctr mo3outhlp mo3outslf mo3outdif mo3outyrgo mo3outwout ha3laun ha3launslf ha3whrmachi1 ha3whrmachi2 ha3whrmachi3 ha3whrmachi4 ha3whrmachi5 ha3whrmachi6 ha3dlaunreas ha3laundif ha3launoft ha3launwout ha3shop ha3shopslf ha3howpaygr1 ha3howpaygr2 ha3howpaygr3 ha3howpaygr4 ha3howpaygr5 ha3howpaygr6 ha3howpaygr7 ha3howgtstr1 ha3howgtstr2 ha3howgtstr3 ha3howgtstr4 ha3howgtstr5 ha3howgtstr6 ha3howgtstr7 ha3howgtstr8 ha3shopcart ha3shoplean ha3dshopreas ha3shopdif ha3shopoft ha3shopwout ha3meal ha3mealslf ha3restamels ha3mealwheel ha3oftmicrow ha3dmealreas ha3mealdif ha3mealoft ha3mealwout ha3bank ha3bankslf ha3dbankreas ha3bankdif ha3bankoft ha3bankwout ha3money ha3moneyhlp ha3dlaunsfdf ha3dshopsfdf ha3dmealsfdf ha3dbanksfdf ha3dmealwhl ha3dmealtkot sc3eatdev sc3eatdevoft sc3eathlp sc3eatslfoft sc3eatslfdif sc3eatwout sc3showrbat1 sc3showrbat2 sc3showrbat3 sc3bdevdec sc3prfrshbth sc3scusgrbrs sc3shtubseat sc3bathhlp sc3bathoft sc3bathdif sc3bathyrgo sc3bathwout sc3usvartoi1 sc3usvartoi2 sc3usvartoi3 sc3usvartoi4 sc3toilhlp sc3toiloft sc3toildif sc3toilwout sc3dresoft sc3dresdev sc3dreshlp sc3dresslf sc3dresdif sc3dresyrgo sc3dreswout sc3deatdevi sc3deathelp sc3deatsfdf sc3dbathdevi sc3dbathhelp sc3dbathsfdf sc3dtoildevi sc3dtoilhelp sc3dtoilsfdf sc3ddresdevi sc3ddreshelp sc3ddressfdf mc3meds mc3medstrk mc3medsslf mc3whrgtmed1 mc3whrgtmed2 mc3whrgtmed3 mc3whrgtmed4 mc3howpkupm1 mc3howpkupm2 mc3howpkupm3 mc3medsrem mc3dmedsreas mc3medsdif mc3medsyrgo mc3medsmis mc3havregdoc mc3regdoclyr mc3hwgtregd1 mc3hwgtregd2 mc3hwgtregd3 mc3hwgtregd4 mc3hwgtregd5 mc3hwgtregd6 mc3hwgtregd7 mc3hwgtregd8 mc3hwgtregd9 mc3ansitindr mc3tpersevr1 mc3tpersevr2 mc3tpersevr3 mc3tpersevr4 mc3chginspln mc3anhlpwdec mc3dmedssfdf sd3smokesnow sd3numcigday ip3covmedcad ip3mgapmedsp ip3cmedicaid ip3covtricar ip3nginslast ip3nginsnurs w3anfinwgt0 w3varstrat w3varunit r1dbirthmth r1dbirthyr r1dintvwrage hh1modob hh1yrdob hh1dspousage rl1primarace rl1hisplatno r2dintvwrage hh2dspousage r2ddeathage pd2mthdied pd2yrdied yearsample r3status r3spstat r3spstatdtyr r2status r2spstat r2spstatdtyr r1status r1spstat r1spstatdtyr
capture drop  r4dresid is4resptype r4d2intvrage re4spadrsnew re4intplace re4newstrct re4dresistrct re4dcensdiv hc4health hc4disescn1 hc4disescn2 hc4disescn3 hc4disescn4 hc4disescn5 hc4disescn6 hc4disescn7 hc4disescn8 hc4disescn9 hc4disescn10 hc4cancerty1 hc4brokebon1 hc4brokebon2 hc4hosptstay hc4hosovrnht hc4knesrgyr hc4hipsrgyr hc4catrsrgyr hc4backsrgyr hc4hartsrgyr hc4fllsinmth hc4worryfall hc4worrylimt hc4faleninyr hc4multifall hc4depresan1 hc4depresan2 hc4depresan3 hc4depresan4 hc4aslep30mn hc4trbfalbck hc4sleepmed ht4placedesc hh4marchange hh4martlstat hh4yrendmarr hh4newspoprt hh4spgender hh4dspouage hh4dspageall hh4spouseduc hh4spoupchlp hh4livwthspo hh4placekind hh4dmarstat hh4dlvngarrg hh4dhshldnum hh4dhshldchd hh4dspouseid ss4heringaid ss4hearphone ss4convwradi ss4convquiet ss4glasseswr ss4seewellst ss4seestvgls ss4glasscls ss4othvisaid ss4glrednewp ss4probchswl ss4probspeak ss4painbothr ss4painlimts ss4painmedof ss4painwhe1 ss4painwhe2 ss4painwhe3 ss4painwhe4 ss4painwhe5 ss4painwhe6 ss4painwhe7 ss4painwhe8 ss4painwhe9 ss4painwhe10 ss4painwhe11 ss4painwhe12 ss4painwhe13 ss4probbreat ss4prbbrlimt ss4strnglmup ss4uplimtact ss4lwrbodstr ss4lwrbodimp ss4lowenergy ss4loenlmtat ss4prbbalcrd ss4prbbalcnt pc4walk6blks pc4walk3blks pc4up20stair pc4up10stair pc4car20pnds pc4car10pnds pc4geonknees pc4bendover pc4hvobovrhd pc4rechovrhd pc4opnjarwhd pc4grspsmobj cp4memrygood cp4knownspyr cp4chgthink1 cp4chgthink2 cp4chgthink3 cp4chgthink4 cp4chgthink5 cp4chgthink6 cp4chgthink7 cp4chgthink8 cp4memcogpr1 cp4memcogpr2 cp4memcogpr3 cp4memcogpr4 cp4dad8dem cg4speaktosp cg4quesremem cg4reascano1 cg4reascano2 cg4reascano3 cg4reascano4 cg4reascano5 cg4reascano6 cg4reascano7 cg4reascano8 cg4reascano9 cg4ratememry cg4ofmemprob cg4memcom1yr cg4todaydat1 cg4todaydat2 cg4todaydat3 cg4todaydat4 cg4todaydat5 cg4todaydat6 cg4prewrdrcl cg4dwrdlstnm cg4wrdsrcal1 cg4wrdsrcal2 cg4wrdsrcal3 cg4wrdsrcal4 cg4wrdsrcal5 cg4wrdsrcal6 cg4wrdsrcal7 cg4wrdsrcal8 cg4wrdsrcal9 cg4wrdsrcal10 cg4dwrdimmrc cg4dwrdinone cg4dwrdirref cg4wrdsntlst cg4numnotlst cg4probreca1 cg4probreca2 cg4probreca3 cg4probreca4 cg4probreca5 cg4dclkdraw cg4dclkimgcl cg4atdrwclck cg4presidna1 cg4presidna2 cg4presidna3 cg4presidna4 cg4vpname1 cg4vpname2 cg4vpname3 cg4vpname4 cg4wrdsdcal1 cg4wrdsdcal2 cg4wrdsdcal3 cg4wrdsdcal4 cg4wrdsdcal5 cg4wrdsdcal6 cg4wrdsdcal7 cg4wrdsdcal8 cg4wrdsdcal9 cg4wrdsdca10 cg4dwrddlyrc cg4dwrddnone cg4dwrddrref cg4wrdnotlst cg4numwrdnot cg4dwrd1rcl cg4dwrd2rcl cg4dwrd3rcl cg4dwrd4rcl cg4dwrd5rcl cg4dwrd6rcl cg4dwrd7rcl cg4dwrd8rcl cg4dwrd9rcl cg4dwrd10rcl cg4dwrd1dly cg4dwrd2dly cg4dwrd3dly cg4dwrd4dly cg4dwrd5dly cg4dwrd6dly cg4dwrd7dly cg4dwrd8dly cg4dwrd9dly cg4dwrd10dly mo4outoft mo4outcane mo4outwalkr mo4outwlchr mo4outsctr mo4outhlp mo4outslf mo4outdif mo4outyrgo mo4outwout ha4laun ha4launslf ha4whrmachi1 ha4whrmachi2 ha4whrmachi3 ha4whrmachi4 ha4whrmachi5 ha4whrmachi6 ha4dlaunreas ha4laundif ha4launoft ha4launwout ha4shop ha4shopslf ha4howpaygr1 ha4howpaygr2 ha4howpaygr3 ha4howpaygr4 ha4howpaygr5 ha4howpaygr6 ha4howpaygr7 ha4howgtstr1 ha4howgtstr2 ha4howgtstr3 ha4howgtstr4 ha4howgtstr5 ha4howgtstr6 ha4howgtstr7 ha4howgtstr8 ha4shopcart ha4shoplean ha4dshopreas ha4shopdif ha4shopoft ha4shopwout ha4meal ha4mealslf ha4restamels ha4mealwheel ha4oftmicrow ha4dmealreas ha4mealdif ha4mealoft ha4mealwout ha4bank ha4bankslf ha4dbankreas ha4bankdif ha4bankoft ha4bankwout ha4money ha4moneyhlp ha4dlaunsfdf ha4dshopsfdf ha4dmealsfdf ha4dbanksfdf ha4dmealwhl ha4dmealtkot sc4eatdev sc4eatdevoft sc4eathlp sc4eatslfoft sc4eatslfdif sc4eatwout sc4showrbat1 sc4showrbat2 sc4showrbat3 sc4bdevdec sc4prfrshbth sc4scusgrbrs sc4shtubseat sc4bathhlp sc4bathoft sc4bathdif sc4bathyrgo sc4bathwout sc4usvartoi1 sc4usvartoi2 sc4usvartoi3 sc4usvartoi4 sc4toilhlp sc4toiloft sc4toildif sc4toilwout sc4dresoft sc4dresdev sc4dreshlp sc4dresslf sc4dresdif sc4dresyrgo sc4dreswout sc4deatdevi sc4deathelp sc4deatsfdf sc4dbathdevi sc4dbathhelp sc4dbathsfdf sc4dtoildevi sc4dtoilhelp sc4dtoilsfdf sc4ddresdevi sc4ddreshelp sc4ddressfdf mc4meds mc4medstrk mc4medsslf mc4whrgtmed1 mc4whrgtmed2 mc4whrgtmed3 mc4whrgtmed4 mc4howpkupm1 mc4howpkupm2 mc4howpkupm3 mc4medsrem mc4dmedsreas mc4medsdif mc4medsyrgo mc4medsmis mc4havregdoc mc4regdoclyr mc4hwgtregd1 mc4hwgtregd2 mc4hwgtregd3 mc4hwgtregd4 mc4hwgtregd5 mc4hwgtregd6 mc4hwgtregd7 mc4hwgtregd8 mc4hwgtregd9 mc4ansitindr mc4tpersevr1 mc4tpersevr2 mc4tpersevr3 mc4tpersevr4 mc4chginspln mc4anhlpwdec mc4dmedssfdf sd4smokesnow sd4numcigday ip4covmedcad ip4mgapmedsp ip4cmedicaid ip4covtricar ip4nginslast ip4nginsnurs w4anfinwgt0 w4varstrat w4varunit r3dintvwrage hh3dspousage r3ddeathage pd3mthdied pd3yrdied r4dintvwrage pd4mthdied pd4yrdied r4ddeathage hh4dspousage r4status r4spstat r4spstatdtyr
capture drop  mo1oftgoarea mo1oflvslepr mo1insdcane mo1insdwalkr mo1insdwlchr mo1insdsctr mo1oftholdwl mo1insdhlp mo1insdslf mo1insddif mo1insdyrgo mo1insdwout mo1beddev mo1bedhlp mo1bedslf mo1beddif mo1bedwout mo1doutsfdf mo1doutdevi mo1douthelp mo1dinsdsfdf mo1dinsddevi mo1dinsdhelp mo1dbedsfdf mo1dbeddevi mo1dbedhelp mo2oftgoarea mo2oflvslepr mo2insdcane mo2insdwalkr mo2insdwlchr mo2insdsctr mo2oftholdwl mo2insdhlp mo2insdslf mo2insddif mo2insdyrgo mo2insdwout mo2beddev mo2bedhlp mo2bedslf mo2beddif mo2bedwout mo2doutsfdf mo2doutdevi mo2douthelp mo2dinsdsfdf mo2dinsddevi mo2dinsdhelp mo2dbedsfdf mo2dbeddevi mo2dbedhelp mo3oftgoarea mo3oflvslepr mo3insdcane mo3insdwalkr mo3insdwlchr mo3insdsctr mo3oftholdwl mo3insdhlp mo3insdslf mo3insddif mo3insdyrgo mo3insdwout mo3beddev mo3bedhlp mo3bedslf mo3beddif mo3bedwout mo3doutsfdf mo3doutdevi mo3douthelp mo3dinsdsfdf mo3dinsddevi mo3dinsdhelp mo3dbedsfdf mo3dbeddevi mo3dbedhelp mo4oftgoarea mo4oflvslepr mo4insdcane mo4insdwalkr mo4insdwlchr mo4insdsctr mo4oftholdwl mo4insdhlp mo4insdslf mo4insddif mo4insdyrgo mo4insdwout mo4beddev mo4bedhlp mo4bedslf mo4beddif mo4bedwout mo4doutsfdf mo4doutdevi mo4douthelp mo4dinsdsfdf mo4dinsddevi mo4dinsdhelp mo4dbedsfdf mo4dbeddevi mo4dbedhelp
saveold "E:\nhats\data\NHATS working data\round_1_5_clean_helper_added_old_trunc1.dta", replace


H="Categorizing a cetain set of Variables (6b_Categorizing_Variables_1)"
use "E:\nhats\data\NHATS working data\round_1_5_clean_helper_added_old_trunc1.dta", clear

 
 tab dem_3_cat, missing
 replace dem_3_cat = . if dem_3_cat == -1
 tab dem_3_cat, gen(dem_cat)
 label var dem_cat1 "Dementia: Probable"
 label var dem_cat2 "Dementia: Possible"
 label var dem_cat3 "Dementia: No Dementia"

 tab maritalstat

 replace maritalstat = . if maritalstat == -9
  tab maritalstat, gen(marital)
 label var marital1 "Marital Stat: Married"
 label var marital2 "Marital Stat: Live w/Partner"
 label var marital3 "Marital Stat: Separated"
 label var marital4 "Marital Stat: Divorced"
 label var marital5 "Marital Stat: Widowed"
 label var marital6 "Marital Stat: Never Married"
 gen spouse = 1 if maritalstat == 1 | maritalstat == 2
 replace spouse = 0 if maritalstat == 3 | maritalstat == 4 | maritalstat==5 | maritalstat == 6
 replace spouse = -7 if maritalstat == -7
 replace spouse = -8 if maritalstat == -8
 tab spouse
 label var spouse "Marital Stat: Married or Live w/Partner"
   
 tab income_cat, gen(income_cat)
 label var income_cat1 "Income: <15,000"
 label var income_cat2 "Income: 15-29,999"
 label var income_cat3 "Income: 30-59,999"
 label var income_cat4 "Income: >60,000"
 
 gen race_cat_1 = race_cat
 replace race_cat_1 = . if race_cat < 0
 tab race_cat_1, gen(race_cat)
 label var race_cat1 "Race: White (Non-His)"
 replace race_cat1 = -7 if race_cat == -7
 replace race_cat1 = -8 if race_cat == -8
 label var race_cat2 "Race: Black (Non-His)"
 replace race_cat2 = -7 if race_cat == -7
 replace race_cat2 = -8 if race_cat == -8
 label var race_cat3 "Race: Other"
 replace race_cat3 = -7 if race_cat == -7
 replace race_cat3 = -8 if race_cat == -8
 label var race_cat4 "Race: Hispanic"
 replace race_cat4 = -7 if race_cat == -7
 replace race_cat4 = -8 if race_cat == -8
 
 tab education
 gen education_1 = education
 replace education_1 = . if education < 0
 tab education_1, gen(education_cat)
  foreach vars in education_cat{ 
	 foreach w in 1 2 3 4{
	 replace `vars'`w' = -7 if education == -7
	 replace `vars'`w' = -8 if education == -8
	 }
 }
 label var education_cat1 "Education: < HS"
 label var education_cat2 "Education: High School"
 label var education_cat3 "Education: Some College"
 label var education_cat4 "Education: >= Bachelors"
 
 gen srh_1 = srh
 replace srh_1 = . if srh < 0
 tab srh_1, gen(srh_cat)
 foreach vars in srh_cat{ 
	 foreach w in 1 2 3 4 5{
	 replace `vars'`w' = -7 if srh == -7
	 replace `vars'`w' = -8 if srh == -8
	 }
}
 label var srh_cat1 "SRH: Excellent"
 label var srh_cat2 "SRH: Very Good"
 label var srh_cat3 "SRH: Good"
 label var srh_cat4 "SRH: Fair"
 label var srh_cat5 "SRH: Poor"
 
 gen memory_1 = memory
 replace memory_1 = . if memory <0
 tab memory_1, gen(memory_cat)
 foreach vars in memory_cat{ 
	 foreach w in 1 2 3 4 5 {
	 replace `vars'`w' = -7 if memory == -7
	 replace `vars'`w' = -8 if memory == -8
	 }
}
 label var memory_cat1 "Memory: Excellent"
 label var memory_cat2 "Memory: Very Good"
 label var memory_cat3 "Memory: Good"
 label var memory_cat4 "Memory: Fair"
 label var memory_cat5 "Memory: Poor"
 
 

 saveold "E:\nhats\data\NHATS working data\round_1_5_clean_helper_added_old_trunc_lab1.dta", replace


H="Creating Table 1. Variables Created Thus Far (6c_table1_update(11_24_15))"
use "E:\nhats\data\NHATS working data\round_1_4_clean_helper_added_old_trunc_lab1.dta" ,clear

gen n=1

local democvars age 
local demoivars female community_dwelling race_cat1 race_cat2 race_cat3 race_cat4 proxy_ivw spouse education_cat1 education_cat2 education_cat3 education_cat4 ///
income_cat1 income_cat2 income_cat3 income_cat4 medicaid medigap mc_partd tricare private_ltc otherlang ///
srh_cat1 srh_cat2 srh_cat3 srh_cat4 srh_cat5 sr_ami_ever sr_stroke_ever sr_cancer_ever sr_hip_ever sr_heart_dis_ever sr_htn_ever sr_ra_ever sr_osteoprs_ever ///
sr_diabetes_ever sr_lung_dis_ever sr_dementia_ever dem_cat1 dem_cat2 dem_cat3 
local democvars1 sr_gad2_score sr_phq2_score
local demoivars1 sr_gad2_anxiety sr_phq2_depressed  ///
memory_cat1 memory_cat2 memory_cat3 memory_cat4 memory_cat5 fall_last_month adl_eat_help adl_bath_help adl_toil_help adl_dres_help adl_ins_help adl_bed_help iadl_laun_help iadl_shop_help iadl_meal_help iadl_bank_help iadl_meds_help ///
reg_doc_have reg_doc_seen reg_doc_homevisit sr_hosp_ind
local democvars2

label var otherlang "Speak a Language other than English?"
label var s "Has help while getting around home"
label var adl_bed_help "Has help getting out of bed"


foreach x of local demoivars {
	tab `x',m
	
}

gen prob_dementia=dem_3_cat==1 if dem_3_cat!=.

local rn : word count `democvars' `demoivars' `democvars1' `demoivars1' `democvars2'  n

local r=1 
local c=1

mat demo=J(`rn',12,.)

foreach i in 4  {
	foreach x of local democvars {
		sum `x' if wave==`i' & `x' >= 0
		mat demo[`r',`c']=r(mean)
		mat demo[`r',`c'+1]=r(sd)
		sum n if `x'==. & wave==`i'
		mat demo[`r',`c'+2]=r(N)
		sum n if `x'==. & wave==`i' & SP_completed == 1
		mat demo[`r',`c'+3]=r(N)
		sum n if `x'==-7 & wave==`i'
		mat demo[`r',`c'+4]=r(N)
		sum n if `x'==-8 & wave==`i'
		mat demo[`r',`c'+5]=r(N)
		local r=`r'+1
}
	foreach x of local demoivars {
		sum `x' if wave==`i' & `x' >= 0
		mat demo[`r',`c']=r(N)*r(mean)
		mat demo[`r',`c'+1]=r(mean)*100
		sum n if `x'==. & wave==`i'
		mat demo[`r',`c'+2]=r(N)
		sum n if `x'==. & wave==`i' & SP_completed == 1
		mat demo[`r',`c'+3]=r(N)
		sum n if `x'==-7 & wave==`i'
		mat demo[`r',`c'+4]=r(N)
		sum n if `x'==-8 & wave==`i'
		mat demo[`r',`c'+5]=r(N)		
		local r=`r'+1
}
	foreach x of local democvars1 {
		sum `x' if wave==`i' & `x' >= 0
		mat demo[`r',`c']=r(mean)
		mat demo[`r',`c'+1]=r(sd)
		sum n if `x'==. & wave==`i'
		mat demo[`r',`c'+2]=r(N)
		sum n if `x'==. & wave==`i' & SP_completed == 1
		mat demo[`r',`c'+3]=r(N)
		sum n if `x'==-7 & wave==`i'
		mat demo[`r',`c'+4]=r(N)
		sum n if `x'==-8 & wave==`i'
		mat demo[`r',`c'+5]=r(N)
		local r=`r'+1
}
	foreach x of local demoivars1 {
		sum `x' if wave==`i' & `x' >= 0
		mat demo[`r',`c']=r(N)*r(mean)
		mat demo[`r',`c'+1]=r(mean)*100
		sum n if `x'==. & wave==`i'
		mat demo[`r',`c'+2]=r(N)
		sum n if `x'==. & wave==`i' & SP_completed == 1
		mat demo[`r',`c'+3]=r(N)
		sum n if `x'==-7 & wave==`i'
		mat demo[`r',`c'+4]=r(N)
		sum n if `x'==-8 & wave==`i'
		mat demo[`r',`c'+5]=r(N)
		local r=`r'+1
}
	foreach x of local democvars2 {
		sum `x' if wave==`i' & `x' >= 0
		mat demo[`r',`c']=r(mean)
		mat demo[`r',`c'+1]=r(sd)
		sum n if `x'==. & wave==`i'
		mat demo[`r',`c'+2]=r(N)
		sum n if `x'==. & wave==`i' & SP_completed == 1
		mat demo[`r',`c'+3]=r(N)
		sum n if `x'==-7 & wave==`i'
		mat demo[`r',`c'+4]=r(N)
		sum n if `x'==-8 & wave==`i'
		mat demo[`r',`c'+5]=r(N)		
		local r=`r'+1
}

	sum n if wave == `i'
	mat demo[`r',`c']=r(N)
	label var n "N"
	local r=1
}

mat rownames demo=`democvars' `demoivars' `democvars1' `demoivars1' `democvars2'  n

frmttable using "E:\nhats\nhats_wave4_missing_new.rtf", statmat(demo) varlabels ctitles( "" "Mean/N, W1" "SD/%" "N Missing" "Missing Not Community" ///
"Refused" "Don't Know" ) sdec(0,2,0,0,0,0) replace


H="NSOC Data Cleaning Part 1 (1_nsoc_nhats_setup1)"
//get caregivers dataset from nsoc 
//note: this links in the cleaned version of the Round 1 SP interviews
//created in the file "4_r12_cleaning_3.do" file


capture log close
clear all
set more off

logs E:\nhats\nhats_code\NHATS data setup\logs
//local logs /Users/rebeccagorges/Documents/data/nhats/logs/
log using `logs'1_nsoc_nhats_setup1.txt, text replace

local r1raw E:\nhats\data\NHATS Public\round_1\
local r2raw E:\nhats\data\NHATS Public\round_2\
local r3raw E:\nhats\data\NHATS Public\round_3\
local work E:\nhats\data\NHATS working data\
local r1s E:\nhats\data\NHATS Sensitive\r1_sensitive\
local r2s E:\nhats\data\NHATS Sensitive\r2_sensitive\
/*
local r1raw /Users/rebeccagorges/Documents/data/nhats/round_1/
local r2raw /Users/rebeccagorges/Documents/data/nhats/round_2/
local r3raw /Users/rebeccagorges/Documents/data/nhats/round_3/
local work /Users/rebeccagorges/Documents/data/nhats/working/
local r1s /Users/rebeccagorges/Documents/data/nhats/r1_sensitive/
local r2s /Users/rebeccagorges/Documents/data/nhats/r2_sensitive/ 
*/
cd `work'

//get just round 1 sp cleaned interviews, save ds for merging in later
//note need to update this with final clean dataset name
use `work'round_1_3_clean_helper_added.dta if wave==1
save `work'round1_only_clean.dta, replace

//spid is the nhats spid, so if more than one caregiver, more than one row
use `r1s'NSOC_Round_1_File_v2.dta

//merge in sp nsoc elgibility information SP tracker file by sp
merge m:1 spid using `r1s'NSOC_Round_1_SP_Tracker_File.dta 
//shouldn't merge if not elgible for nsoc or no helpers participated
tab fl1dnsoc _merge, missing
tab fl1dnsoccomp _merge, missing //entry in nsoc if number helpers > 0
drop if _merge==2
drop _merge

//merge in the other person nsoc tracker file
merge 1:1 spid opid using `r1s'NSOC_Round_1_OP_Tracker_File.dta
tab _merge
drop if _merge==2
drop _merge

//merge in round 3 tracker file to get indicator of death
merge m:1 spid  using `r3raw'NHATS_Round_3_Tracker_File.dta
drop if _merge==2
drop _merge
//merge in tracker file details
//NSOC_Round_1_SP_Tracker_File.dta

//other person sensitive data to get caregiver age
merge 1:1 spid opid using `r1s'NHATS_Round_1_OP_Sen_Dem_File.dta
drop if _merge==2
drop _merge

//other person main nhats file for other caregiver information
merge 1:1 spid opid using `r1raw'NHATS_Round_1_OP_File_v2.dta
drop if _merge==2
drop _merge

//merge in round 1 sp interviews, probably want to change this when have final
//sp dataset saved
merge m:1 spid using `work'round1_only_clean.dta
drop if _merge==2
drop _merge
******************************************************

//create indicator of those SPIDs that died
gen sp_died=0
replace sp_died=1 if inlist(r2status,62,86) | inlist(r3status,62,86)
la var sp_died "Sample person died r2 or r3"
tab sp_died, missing

save caregiver_ds_nsoc_v1.dta, replace

//how many unique SP's is this?
sort spid 
quietly by spid: gen dup = cond(_N==1,0,_n)
tab dup
replace dup=dup+1
tab dup

drop if dup>1
tab sp_died,missing

*******************************************************
log close


H="NSOC Data Cleaning Part 2 (2_nsoc_cleaning1)"
//cleaning, variable setup of caregiver dataset from nsoc

capture log close
clear all
set more off

logs E:\nhats\nhats_code\NHATS data setup\logs
//local logs /Users/rebeccagorges/Documents/data/nhats/logs/
log using `logs'2_nsoc_nhats_cleaning1.txt, text replace

//PC file paths
local r1raw E:\nhats\data\NHATS Public\round_1\
local r2raw E:\nhats\data\NHATS Public\round_2\
local r3raw E:\nhats\data\NHATS Public\round_3\
local work E:\nhats\data\NHATS working data\
local r1s E:\nhats\data\NHATS Sensitive\r1_sensitive\
local r2s E:\nhats\data\NHATS Sensitive\r2_sensitive\
//Rebecca Mac file paths
/*local r1raw /Users/rebeccagorges/Documents/data/nhats/round_1/
local r2raw /Users/rebeccagorges/Documents/data/nhats/round_2/
local r3raw /Users/rebeccagorges/Documents/data/nhats/round_3/
local work /Users/rebeccagorges/Documents/data/nhats/working
local r1s /Users/rebeccagorges/Documents/data/nhats/r1_sensitive/
local r2s /Users/rebeccagorges/Documents/data/nhats/r2_sensitive/ 
*/
cd `work'

use caregiver_ds_nsoc_v1.dta, replace
******************************************************************
tab op1dnsoc, missing

//per nsoc user guide, use this weight when analysis is at the caregiver level
sum w1cgfinwgt0, detail //caregiver nsoc analytic weight

tab c1dgender, missing //caregiver gender
gen cg_female=1 if c1dgender==2
replace cg_female=0 if c1dgender==1
label var cg_female "Caregiver = female"
tab cg_female, missing

tab c1relatnshp, missing //caregiver relationship to SP
gen cg_relationship_cat=3
replace cg_relationship_cat=1 if c1relatnshp==2
replace cg_relationship_cat =2 if inlist(c1relatnshp,3,4,5,6,7,8)
la def rel 1 "Spouse" 2 "Adult child" 3 "Other"
la val cg_relationship_cat rel
la var cg_relationship_cat "Caregiver relationship"
tab cg_relationship_cat, missing

//ask about this, if want age categories, then fill in from categorical
//variable directly from nhats, don't use actual age
gen cg_age=op1age
replace cg_age=. if inlist(op1age,-8,-7,-1)
sum cg_age, detail

tab op1catgryage if cg_age==., missing

******************************************************************
//caregiver resides in same household, use OP reside in household flag
******************************************************************
******* Not complete, this section needs work! *********
******************************************************************
tab op1prsninhh, missing //caregiver in household
gen cg_lives_with_sp=1 if op1prsninhh==1
replace cg_lives_with_sp=0 if op1prsninhh==2
tab cg_lives_with_sp, missing
tab cg_lives_with_sp cg_relationship_cat, missing

tab op1proxy if cg_lives_with_sp==.
tab livearrang if cg_lives_with_sp==. & cg_relationship_cat==1, missing

//check hh1livwthspo (SP lives with spouse), needs to come from sp interview though
tab hh1livwthspo cg_lives_with_sp  if cg_relationship_cat==1

******************************************************************
//caregiver level of education
tab op1leveledu, missing
tab hh1spouseduc if op1leveledu==. & cg_relationship_cat==1, missing
******************************************************************
//caregiver health
tab che1health, missing //caregiver self reported health
gen cg_srh=che1health
replace cg_srh=. if che1health==-8 | che1health==-7
la val cg_srh srh
gen cg_srh_fp=1 if inlist(cg_srh,4,5)
replace cg_srh_fp=0 if inlist(cg_srh,1,2,3)
la var cg_srh "Caregiver self reported health 1-5"
la var cg_srh_fp "Caregiver SHR fair/poor"
tab cg_srh cg_srh_fp, missing

************************
//identify those that helped in last year  but not in last month
//excluded from HHS Informal Caregiving for Older Americans: Analysis of the 2011 NSOC
//April 2014 report dataset (n=11)
tab cca1hlplstyr, missing

***************************************************************
//identify care activities helped with
//household chores (laundry, cleaning, meal prep)
tab cca1hwoftchs, missing //how often help w/ hh chores
tab cca1hwoftshp, missing //how often help with shopping
tab cca1hlpordmd //ever help order rx
tab cca1hlpbnkng //ever help banking

tab cca1hwoftpc //how often personal care
tab cca1hwofthom //how often help getting around home or leaving home

tab cca1hwoftdrv //how often drive places
tab cca1hwoftott //how often went with on other transportation

//help medical care in the last month, yes/no
gen help_healthcare=0
foreach v in med shot mdtk exrcs diet teeth feet skin{
replace help_healthcare=1 if cca1hlp`v'==1
}
tab help_healthcare, missing

//help coordinate medical care with providers, insurance, etc? in last year
gen help_coordhc=0
foreach v in mdapt spkdr insrn othin{
replace help_coordhc=1 if cca1hlp`v'==1
}
tab help_coordhc, missing


************************
//save the dataset
save caregiver_ds_nsoc_clean_v2.dta, replace
************************
log close


H="NSOC Data Cleaning Part 3 (3_nsoc_add_helper_hours)"
//adds in imputed caregiver hours from the SP / OP data processing
//these are hours self reported by SP, not the hours reported in the NSOC dataset

capture log close
clear all
set more off

local logs E:\nhats\nhats_code\NHATS data setup\logs
//local logs /Users/rebeccagorges/Documents/data/nhats/logs/
log using `logs'3_nsoc_nhats_add_imp_help_hrs.txt, text replace

local r1raw E:\nhats\data\NHATS Public\round_1\
local r2raw E:\nhats\data\NHATS Public\round_2\
local r3raw E:\nhats\data\NHATS Public\round_3\
local work E:\nhats\data\NHATS working data\
local r1s E:\nhats\data\NHATS Sensitive\r1_sensitive\
local r2s E:\nhats\data\NHATS Sensitive\r2_sensitive\
/*local r1raw /Users/rebeccagorges/Documents/data/nhats/round_1/
local r2raw /Users/rebeccagorges/Documents/data/nhats/round_2/
local r3raw /Users/rebeccagorges/Documents/data/nhats/round_3/
local work /Users/rebeccagorges/Documents/data/nhats/working
local r1s /Users/rebeccagorges/Documents/data/nhats/r1_sensitive/
local r2s /Users/rebeccagorges/Documents/data/nhats/r2_sensitive/ 
*/
cd `work'

************************************************************************
//this includes helper information aggregated to the sp-wave level
use caregiver_ds_nsoc_clean_v2.dta, replace 

sum tot_hrsmonth_help_i, detail

gen prim_cg_ind=0
replace prim_cg_ind=1 if prim_helper_opid==opid

la var prim_cg_ind "Caregiver is Primary helper"
tab prim_cg_ind, missing

//merge in individual helper OP level data from imputed helper dataset
merge 1:1 spid opid wave using R1_hrs_imputed_added.dta, ///
 keepusing(impute_cat op_hrsmth_i op_numdays_i ln_opdhrsmth_i ///
 op_ind_hrsmth spouse otherrel nonrel)

drop if _merge==2 //drop obs where OP is not in the NSOC dataset

tab cg_relationship_cat spouse, missing

************************************************************************
log close


H="Import NSOC"

/************************** NSOC DATA SETUP ********************************/

proc import out = RAW_NSOC
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NSOC_Round_1_File_v2_old.dta"
			replace;
run;
proc import out = RAW_OP
			datafile = "E:\nhats\data\NHATS Public\round_1\NHATS_Round_1_OP_File_old.dta"
			replace;
run;
proc import out = RAW_OP_SENSITIVE
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NHATS_Round_1_OP_Sen_Dem_File_old.dta"
			replace;
run;
proc import out = NSOC_SP_Tracker
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NSOC_Round_1_SP_Tracker_File.dta"
			replace;
run;
proc import out = NSOC_OP_Tracker
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NSOC_Round_1_OP_Tracker_File.dta"
			replace;
run;
proc import out=raw_nhats_r1
			datafile = "E:\nhats\data\NHATS Public\round_1\NHATS_Round_1_SP_File_old.dta"
			replace;
run; 

/**Final NHATS Database**/
data final_nhats;
set nhats.nhats_all_obs;
if complete = 1;
run;

H="Cleaning NHATS"
libname nhats "E:\nhats\data\NHATS working data";

/***** Import SP NHATS Data *****/
proc import out=raw_nhats_r1
			datafile = "E:\nhats\data\NHATS Public\round_1\NHATS_Round_1_SP_File_old.dta";
run;
proc import out=raw_nhats_r2
			datafile = "E:\nhats\data\NHATS Public\round_2\NHATS_Round_2_SP_File_old.dta";
run;
proc import out=raw_nhats_r3
			datafile = "E:\nhats\data\NHATS Public\round_3\NHATS_Round_3_SP_File_old.dta";
run;
proc import out=nhats_r1_sen
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NHATS_Round_1_SP_Sen_Dem_File.dta";
run;
proc import out=nhats_r2_sen
			datafile = "E:\nhats\data\NHATS Sensitive\r2_sensitive\NHATS_Round_2_SP_Sen_Dem_File.dta";
run;

/***** Import OP NHATS Data *****/

proc import out=nhats_r1_OP
			datafile = "E:\nhats\data\NHATS Public\round_1\NHATS_Round_1_OP_File_old.dta";
run;
proc import out=nhats_r2_OP
			datafile = "E:\nhats\data\NHATS Public\round_2\NHATS_Round_2_OP_File_old.dta";
run;
proc import out=nhats_r3_OP
			datafile = "E:\nhats\data\NHATS Public\round_3\NHATS_Round_3_OP_File_old.dta";
run;
proc import out=nhats_r1_OP_sen
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NHATS_Round_1_OP_Sen_Dem_File.dta";
run;
proc import out=nhats_r2_OP_sen
			datafile = "E:\nhats\data\NHATS Sensitive\r2_sensitive\NHATS_Round_2_OP_Sen_Dem_File.dta";
run;

/***** Import Tracker Files *****/

proc import out=raw_nhats_r1_tracker
			datafile = "E:\nhats\data\NHATS Public\round_1\NHATS_Round_1_Tracker_File.dta";
run;
proc import out=raw_nhats_r2_tracker
			datafile = "E:\nhats\data\NHATS Public\round_2\NHATS_Round_2_Tracker_File.dta";
run;
proc import out=raw_nhats_r3_tracker
			datafile = "E:\nhats\data\NHATS Public\round_3\NHATS_Round_3_Tracker_File.dta";
run;
proc import out=nhats_nsoc_tracker
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NSOC_Round_1_SP_Tracker_File.dta";
run;

/***** NHATS/NSOC Data set from Rebecca *****/

proc import out=nhats
			datafile = "E:\nhats\data\NHATS working data\round_1_3_clean_helper_added_old.dta";
run;

/*************** SAMPLE CREATION ***************/

/** Died/Loss to Follow-up on Wave 2 and Wave 3 **/
proc sql;
create table nhats_died_ind
as select a.spid, a.is1resptype, b.is2resptype , b.is2reasnprx7, c.is3resptype , c.is3reasnprx7
from raw_nhats_r1 a
left join raw_nhats_r2 b
on a.spid = b.spid
left join raw_nhats_r3 c
on a.spid = c.spid;
quit;
data nhats_died_ind1;
set nhats_died_ind;

/* FROM NHATS Documentation for answering deceased question: 
"You have selected SP Decseased. If SP is STILL LIVING, select a
different option. If SP is deceased, select supress to confirm."*/
/*Died on 12 Month follow-up*/
died = 0;
if is2reasnprx7 = 1 then died = 1;
if is2reasnprx7 = -9 then died = .;
label died = "Died on 12 Month follow-up";
/*Died within 24 months*/
died_24 = 0;
if is2reasnprx7 = 1 or is3reasnprx7 = 1 then died_24 = 1;
if is2reasnprx7 = -9 or is3reasnprx7 = -9 then died_24 = .;
label died_24 = "Died within 24 months";
run;
/*frequency check*/
proc freq data=nhats_died_ind1;
table died died_24 died*died_24;
run;
/*keeping only relevant information*/
data nhats_died_ind2;
set nhats_died_ind1 (keep = spid died died_24);
run;
/*PERMANENT DATASET OF ALL DIED WITHIN WAVE 2 AND 3 OF THE SP WHO WERE IN WAVE 1*/
data nhats.died_indicator;
set nhats_died_ind2;
run;

/********* Sensitive Data Extraction ********/

data nhats_r1_sen_1;
set nhats_r1_sen;
age = r1dintvwrage;
run;
proc means data=nhats_r1_sen_1;
var age;
run;

/******* Pre-main nhats database merge *******/

proc sql;
create table raw_nhats_r1_1
as select a.*, b.died, b.died_24, c.age
from raw_nhats_r1 a
left join nhats.died_indicator b
on a.spid = b.spid
left join nhats_r1_sen_1 c
on a.spid = c.spid;
quit;

proc freq data=raw_nhats_r1_1;
table hh1dlvngarrg;
run;

data nhats_wave1;
set raw_nhats_r1_1;

/*drop 56 weight variables*/
drop w1anfinwgt1-w1anfinwgt56;

/*Community Dwelling Variable. If the variable = "Community" or "Residential Care Resident not nursing home"*/
/*none missing from the raw database*/
community_dwelling = 0;
if r1dresid = 1 or r1dresid = 2 then community_dwelling = 1;
label community_dwelling = "SP in Community/Residential Care Resident";

/*Gender Variable*/
gender = .;
if r1dgender = 2 then gender = 1;
if r1dgender = 1 then gender = 0;
label gender = "Gender: 0 = Male, 1 = Female";

/* Education Variable. Greater than High School */
education = .;
if el1higstschl < 4 then education = 1;
if el1higstschl = 4 then education = 2;
if el1higstschl >= 5 and el1higstschl <= 7 then education = 3;
if el1higstschl >= 8 and el1higstschl <= 9 then education = 4;
label education = "Education: 1 = <HS 2 = HS 3 = Some College 4 = >= College";
gt_hs_edu = .;
if el1higstschl >= 4 then gt_hs_edu = 1;
if el1higstschl > 0  and el1higstschl < 4 then gt_hs_edu = 0;
label gt_hs_edu = "Greater than/Equal to High School";

/* White(Non-Hispanic) definition if the race variable is DK/RF then I set that as missing*/
race_cat = rl1dracehisp;
if rl1dracehisp = 5 | rl1dracehisp = 6 then race_cat = .;
label race_cat = "Race: 1 = White, 2 = Black, 3 = Other, 4 = Hispanic";
if rl1dracehisp = 1 then white = 1;
if rl1dracehisp = 2 or rl1dracehisp = 3 or rl1dracehisp = 4 then white = 0;
if rl1dracehisp = 5 or rl1dracehisp = 6 then white = .;
label white = "White (Non-Hispanic)";

/* Married Variable. All missing stays missing */
married = 0;
if hh1martlstat = 1 then married = 1;
if hh1martlstat < 0 then married = .;
label Married = "Married";

/* Living Arrangement */
living_arrang = hh1dlvngarrg;
if hh1dlvngarrg < 0 then living_arrang = .;
label living_arrang = "Living Arrangement: 1 = Alone, 2 = Spouse/Partner, 3 = S/P + Other, 4 = Other";
live_alone = .;
if living_arrang = 1 then live_alone = 1;
if living_arrang > 1 then live_alone = 0;

/*Changing ADL numbers. If the answers to ADL questions are "yes" or "can't do"*/
if ls1evdayact1 = 1 or ls1evdayact1 = 3 then adl_eating = 1;
if ls1evdayact1 = 2 then adl_eating = 0;
if ls1evdayact2 = 1 or ls1evdayact2 = 3 then adl_bed = 1;
if ls1evdayact2 = 2 then adl_bed = 0;
if ls1evdayact3 = 1 or ls1evdayact3 = 3 then adl_chair = 1;
if ls1evdayact3 = 2 then adl_chair = 0;
if ls1evdayact4 = 1 or ls1evdayact4 = 3 then adl_walk_in = 1;
if ls1evdayact4 = 2 then adl_walk_in = 0;
if ls1evdayact5 = 1 or ls1evdayact5 = 3 then adl_walk_out = 1;
if ls1evdayact5 = 2 then adl_walk_out = 0;
if ls1evdayact6 = 1 or ls1evdayact6 = 3 then adl_dress = 1;
if ls1evdayact6 = 2 then adl_dress = 0;
if ls1evdayact7 = 1 or ls1evdayact7 = 3 then adl_bathe = 1;
if ls1evdayact7 = 2 then adl_bathe = 0;
if ls1evdayact8 = 1 or ls1evdayact8 = 3 then adl_toilet = 1;
if ls1evdayact8 = 2 then adl_toilet = 0;

/*changing IADL Numbers. If the answers on First IADL (Able to?) are "No" AND if the other IADL question (Keep from?) = "Yes"*/
if ls1ableto1 = 2 and ls1diskefrm1 = 1 then iadl_meals = 1;
if ls1ableto1 = 2 and ls1diskefrm1 = 2 then iadl_meals = 0;
if ls1ableto1 = 1 then iadl_meals = 0;
if ls1ableto2 = 2 and ls1diskefrm2 = 1 then iadl_laundry = 1;
if ls1ableto2 = 2 and ls1diskefrm2 = 2 then iadl_laundry = 0;
if ls1ableto2 = 1 then iadl_laundry = 0;
if ls1ableto3 = 2 and ls1diskefrm3 = 1 then iadl_housewk = 1;
if ls1ableto3 = 2 and ls1diskefrm3 = 2 then iadl_housewk = 0;
if ls1ableto3 = 1 then iadl_housewk = 0;
if ls1ableto4 = 2 and ls1diskefrm4 = 1 then iadl_shop = 1;
if ls1ableto4 = 2 and ls1diskefrm4 = 2 then iadl_shop = 0;
if ls1ableto4 = 1 then iadl_shop = 0;
if ls1ableto5 = 2 and ls1diskefrm5 = 1 then iadl_money = 1;
if ls1ableto5 = 2 and ls1diskefrm5 = 2 then iadl_money = 0;
if ls1ableto5 = 1 then iadl_money = 0;
if ls1ableto6 = 2 and ls1diskefrm6 = 1 then iadl_meds = 1;
if ls1ableto6 = 2 and ls1diskefrm6 = 2 then iadl_meds = 0;
if ls1ableto6 = 1 then iadl_meds = 0;
if ls1ableto7 = 2 and ls1diskefrm7 = 1 then iadl_phone = 1;
if ls1ableto7 = 2 and ls1diskefrm7 = 2 then iadl_phone = 0;
if ls1ableto7 = 1 then iadl_phone = 0;


/*SUM of the ADLs. Create three categories. (0, 1/2, >=3) */
sum_adl = sum(adl_eating, adl_bed, adl_chair, adl_walk_in, adl_walk_out, adl_dress, adl_bathe, adl_toilet);
sum_adl_cat = 0;
if sum_adl = 1 or sum_adl = 2 then sum_adl_cat = 1;
if sum_adl > 2 then sum_adl_cat = 2;
if sum_adl = . then sum_adl_cat = .;
label sum_adl = "Sum of all ADLs/IADLs";
label sum_adl_cat = "Num. of ADL/IADL Category (0, 1/2, >=3)";

/* INDICATOR OF ANY ADL/IADLs. Needed for Caregiving Project with Katherine*/
ADL_IADL_ind = 0;
if adl_eating = 1| adl_bed = 1 | adl_chair = 1 | adl_walk_in = 1 | adl_walk_out = 1 | adl_dress = 1 | 
adl_bathe = 1 | adl_toilet = 1|iadl_meals = 1 | iadl_laundry = 1 | iadl_housewk = 1 | iadl_shop = 1 | 
iadl_money = 1 | iadl_meds = 1 | iadl_phone = 1 then ADL_IADL_ind = 1;
if sum_adl = . then ADL_IADL_ind = .;
label adl_iadl_ind = "Indicator if any of ADLs/IADLs at all";



run;
proc freq data=nhats_wave1;
table community_dwelling adl_eating adl_bed adl_chair adl_walk_in adl_walk_out adl_dress adl_bathe adl_toilet
iadl_meals iadl_laundry iadl_housewk iadl_shop iadl_money iadl_meds iadl_phone white married gt_hs_edu
sum_adl sum_adl_cat ADL_IADL_ind;
run;

proc freq data=nhats_nsoc_tracker;
table fl1dnsoc fl1dnsoccomp;
run;

data nhats_nsoc_tracker1;
set nhats_nsoc_tracker;
eligible = 0;
if fl1dnsoc = 1 then eligible = 1;
complete = 0;
if fl1dnsoccomp > 0 then complete = 1;
total_caregiver_comp = fl1dnsoccomp;
if fl1dnsoccomp < 0 then total_caregiver_comp = .;
label eligible = "Eligible for NSOC interview";
label complete = "Completed Interview";
label total_caregiver_comp = "Total Caregivers that Completed Interview";
run;
proc freq data=nhats_nsoc_tracker1;
table eligible complete total_caregiver_comp;
run;

proc sql;
create table nhats_wave1_1
as select a.*, b.eligible, b.complete, b.total_caregiver_comp
from nhats_wave1 a
left join nhats_nsoc_tracker1 b
on a.spid = b.spid;
quit;

proc freq data=nhats_wave1_1;
table eligible complete total_caregiver_comp;
run;

data nhats.nhats_wave1_all_obs;
set nhats_wave1_1;
run;

data raw_nhats_r2_1;
set raw_nhats_r2;
drop w2anfinwgt1-w2anfinwgt56;
run;

proc sql;
create table nhats_wave12
as select a.*, 

H="Cleaning NSOC"

/**Final NSOC Database**/
data final_nhats;
set nhats.nhats_all_obs;
if complete = 1;
run;
proc freq data=final_nhats;
table died cs1dreconcil;
run;

proc freq data = RAW_OP;
table op1prsninhh op1martlstat op1numchldrn op1ishelper op1sppayshlp cs1dreconcil;
run;
proc freq data = raw_op_sensitive;
table op1age op1catgryage;
run;

/*Adding in the OP Demographics to the NSOC dataset*/
proc sql;
create table raw_nsoc1
as select a.*, b.op1prsninhh, b.op1martlstat, b.op1numchldrn, b.op1ishelper, b.op1sppayshlp, b.op1leveledu,
c.op1age, c.op1catgryage, d.cs1dreconcil, d.hh1martlstat, d.hh1dhshldnum, d.died, d.died_24
from raw_nsoc a
left join raw_op b
on a.spid = b.spid
and a.opid = b.opid
left join raw_op_sensitive c
on a.spid = c.spid
and a.opid = c.opid
left join final_nhats d
on a.spid = d.spid;
quit;

proc freq data= raw_nsoc1;
table op1prsninhh op1martlstat op1numchldrn op1ishelper op1sppayshlp op1age op1catgryage op1leveledu cs1dreconcil hh1martlstat hh1dhshldnum;
run;

data nsoc;
set raw_nsoc1;

/*** Drop the variations of the NSOC Weight Variable. Use primarily "w1cgfinwgt0" for full Sample ***/

drop w1cgfinwgt1 - w1cgfinwgt56;

/*Creating Spouse Variable */
if cg_spouse = .;
if c1relatnshp = 2 then cg_spouse = 1;
if c1relatnshp ~= 2 then cg_spouse = 0;
/*gathering total hours a day/week/month/other */
total_hours_day = cdc1hlphrsdy + 0;
if total_hours_day < 0 then total_hours_day = .;
total_hours_week = cdc1hlpdyswk + 0;
if total_hours_week < 0 then total_hours_week = .;
total_hours_month = cdc1hlpdysmt + 0;
if total_hours_month < 0 then total_hours_month = .;
total_hours_other = cdc1hlphrlmt + 0;
if total_hours_other < 0 then total_hours_other = .;
other_flag = 0;
if cdc1hlphrmvf ~= 1 then other_flag=1;
/*if the cargiver was a regular then you calculated it days a week per day and multiply that by 4*/
if cdc1hlpsched = 1 then total_hours = total_hours_week * total_hours_day * 4;
/*if they were not a regular than you calculated the total days in the month by total hours*/
if cdc1hlpsched ~= 1 then total_hours = total_hours_month * total_hours_day;
if other_flag = 1 then total_hours = total_hours_other;

/* LIVING CHILDREN MISSING DATA */
Any_Living_Children_SP = 0;
if cs1dreconcil ~= 3 then Any_Living_Children_SP = 1;
Any_Living_Children_CG = .;
if chd1chldlvng = 2 then Any_Living_Children_CG = 0;
if chd1chldlvng = 1 then Any_Living_Children_CG = 1;
if cg_spouse = 1 then cg_living_children = Any_Living_Children_SP;
if cg_spouse = 0 then cg_living_children = Any_Living_Children_CG;
drop Any_Living_Children_SP Any_Living_Children_CG;

/*MARITAL STATUS MISSING DATA */
if cg_spouse = 1 then cg_Marital_status = hh1martlstat;
if cg_spouse = 0 then cg_marital_status = chd1martstat;
if cg_marital_status = . then cg_Marital_Status =op1martlstat; 

/*NUMBER IN HOUSEHOLD */
if cg_spouse = 1 then cg_total_in_hh = hh1dhshldnum;
if cg_spouse = 0 then cg_total_in_hh = chd1numinhh;
if cg_total_in_hh < 0 then cg_total_in_hh = .;

/*EDUCATION OF CAREGIVER */
if cg_spouse = 1 then cg_educ = op1leveledu;
if cg_spouse = 0 then cg_educ = chd1educ;
if cg_educ < 0 then cg_educ = .;

run;
proc freq data=nsoc;
table cs1dreconcil  chd1chldlvng cg_living_children;
run;
data ko.nsoc_raw;
set nsoc;
run;

H="NHATS Setup"
libname nhats "E:\nhats\data\NHATS working data";

/***** Import SP NHATS Data *****/
proc import out=raw_nhats_r1
			datafile = "E:\nhats\data\NHATS Public\round_1\NHATS_Round_1_SP_File_old.dta";
run;
proc import out=raw_nhats_r2
			datafile = "E:\nhats\data\NHATS Public\round_2\NHATS_Round_2_SP_File_old.dta";
run;
proc import out=raw_nhats_r3
			datafile = "E:\nhats\data\NHATS Public\round_3\NHATS_Round_3_SP_File_old.dta";
run;
proc import out=nhats_r1_sen
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NHATS_Round_1_SP_Sen_Dem_File.dta";
run;
proc import out=nhats_r2_sen
			datafile = "E:\nhats\data\NHATS Sensitive\r2_sensitive\NHATS_Round_2_SP_Sen_Dem_File.dta";
run;

/***** Import OP NHATS Data *****/

proc import out=nhats_r1_OP
			datafile = "E:\nhats\data\NHATS Public\round_1\NHATS_Round_1_OP_File_old.dta";
run;
proc import out=nhats_r2_OP
			datafile = "E:\nhats\data\NHATS Public\round_2\NHATS_Round_2_OP_File_old.dta";
run;
proc import out=nhats_r3_OP
			datafile = "E:\nhats\data\NHATS Public\round_3\NHATS_Round_3_OP_File_old.dta";
run;
proc import out=nhats_r1_OP_sen
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NHATS_Round_1_OP_Sen_Dem_File.dta";
run;
proc import out=nhats_r2_OP_sen
			datafile = "E:\nhats\data\NHATS Sensitive\r2_sensitive\NHATS_Round_2_OP_Sen_Dem_File.dta";
run;

/***** Import Tracker Files *****/

proc import out=raw_nhats_r1_tracker
			datafile = "E:\nhats\data\NHATS Public\round_1\NHATS_Round_1_Tracker_File.dta";
run;
proc import out=raw_nhats_r2_tracker
			datafile = "E:\nhats\data\NHATS Public\round_2\NHATS_Round_2_Tracker_File.dta";
run;
proc import out=raw_nhats_r3_tracker
			datafile = "E:\nhats\data\NHATS Public\round_3\NHATS_Round_3_Tracker_File.dta";
run;
proc import out=nhats_nsoc_tracker
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NSOC_Round_1_SP_Tracker_File.dta";
run;

/***** NHATS/NSOC Data set from Rebecca *****/

proc import out=nhats_rg
			datafile = "E:\nhats\data\NHATS working data\round_1_3_clean_helper_added_old.dta";
run;
proc export data = nhats_rg
			outfile = "E:\nhats\data\NHATS working data\round_1_3_clean_helper_added_old_backup.dta"
			replace;
run;
proc export data=nhats_rg outfile = "E:\nhats\data\NHATS working data\round_1_3_clean_helper_added_old.csv" dbms = csv replace label;
run;

/*************** SAMPLE CREATION ***************/

/** Died/Loss to Follow-up on Wave 2 and Wave 3 **/
proc sql;
create table nhats_died_ind
as select a.spid, a.is1resptype, b.is2resptype , b.is2reasnprx7, c.is3resptype , c.is3reasnprx7
from raw_nhats_r1 a
left join raw_nhats_r2 b
on a.spid = b.spid
left join raw_nhats_r3 c
on a.spid = c.spid;
quit;
data nhats_died_ind1;
set nhats_died_ind;

/* FROM NHATS Documentation for answering deceased question: 
"You have selected SP Decseased. If SP is STILL LIVING, select a
different option. If SP is deceased, select supress to confirm."*/
/*Died on 12 Month follow-up*/
died = 0;
if is2reasnprx7 = 1 then died = 1;
if is2reasnprx7 = -9 then died = .;
label died = "Died on 12 Month follow-up";
/*Died within 24 months*/
died_24 = 0;
if is2reasnprx7 = 1 or is3reasnprx7 = 1 then died_24 = 1;
if is2reasnprx7 = -9 or is3reasnprx7 = -9 then died_24 = .;
label died_24 = "Died within 24 months";
run;
/*frequency check*/
proc freq data=nhats_died_ind1;
table died died_24 died*died_24;
run;
/*keeping only relevant information*/
data nhats_died_ind2;
set nhats_died_ind1 (keep = spid died died_24);
run;
/*PERMANENT DATASET OF ALL DIED WITHIN WAVE 2 AND 3 OF THE SP WHO WERE IN WAVE 1*/
data nhats.died_indicator;
set nhats_died_ind2;
run;

/********* Sensitive Data Extraction ********/

data nhats_r1_sen_1;
set nhats_r1_sen;
age = r1dintvwrage;
run;
proc means data=nhats_r1_sen_1;
var age;
run;

/******* Pre-main nhats database merge *******/

proc sql;
create table raw_nhats_r1_1
as select a.*, b.died, b.died_24, c.age as age_w1
from raw_nhats_r1 a
left join nhats.died_indicator b
on a.spid = b.spid
left join nhats_r1_sen_1 c
on a.spid = c.spid;
quit;

proc freq data=raw_nhats_r1_1;
table hh1dlvngarrg;
run;

data nhats_wave1;
set raw_nhats_r1_1;

/*drop 56 weight variables*/
drop w1anfinwgt1-w1anfinwgt56;

/*Community Dwelling Variable. If the variable = "Community" or "Residential Care Resident not nursing home"*/
/*none missing from the raw database*/
community_dwelling = 0;
if r1dresid = 1 or r1dresid = 2 then community_dwelling = 1;
label community_dwelling = "SP in Community/Residential Care Resident";

/*Gender Variable*/
gender = .;
if r1dgender = 2 then gender = 1;
if r1dgender = 1 then gender = 0;
label gender = "Gender: 0 = Male, 1 = Female";

/* Education Variable. Greater than High School */
education = .;
if el1higstschl < 4 then education = 1;
if el1higstschl = 4 then education = 2;
if el1higstschl >= 5 and el1higstschl <= 7 then education = 3;
if el1higstschl >= 8 and el1higstschl <= 9 then education = 4;
label education = "Education: 1 = <HS 2 = HS 3 = Some College 4 = >= College";
gt_hs_edu = .;
if el1higstschl >= 4 then gt_hs_edu = 1;
if el1higstschl > 0  and el1higstschl < 4 then gt_hs_edu = 0;
label gt_hs_edu = "Greater than/Equal to High School";

/* White(Non-Hispanic) definition if the race variable is DK/RF then I set that as missing*/
race_cat = rl1dracehisp;
if rl1dracehisp = 5 | rl1dracehisp = 6 then race_cat = .;
label race_cat = "Race: 1 = White, 2 = Black, 3 = Other, 4 = Hispanic";
if rl1dracehisp = 1 then white = 1;
if rl1dracehisp = 2 or rl1dracehisp = 3 or rl1dracehisp = 4 then white = 0;
if rl1dracehisp = 5 or rl1dracehisp = 6 then white = .;
label white = "White (Non-Hispanic)";

/* Married Variable. All missing stays missing */
married = 0;
if hh1martlstat = 1 then married = 1;
if hh1martlstat < 0 then married = .;
label Married = "Married";

/* Living Arrangement */
living_arrang = hh1dlvngarrg;
if hh1dlvngarrg < 0 then living_arrang = .;
label living_arrang = "Living Arrangement: 1 = Alone, 2 = Spouse/Partner, 3 = S/P + Other, 4 = Other";
live_alone = .;
if living_arrang = 1 then live_alone = 1;

if living_arrang > 1 then live_alone = 0;

/*Changing ADL numbers. If the answers to ADL questions are "yes" or "can't do"*/
if ls1evdayact1 = 1 or ls1evdayact1 = 3 then adl_eating = 1;
if ls1evdayact1 = 2 then adl_eating = 0;
if ls1evdayact2 = 1 or ls1evdayact2 = 3 then adl_bed = 1;
if ls1evdayact2 = 2 then adl_bed = 0;
if ls1evdayact3 = 1 or ls1evdayact3 = 3 then adl_chair = 1;
if ls1evdayact3 = 2 then adl_chair = 0;
if ls1evdayact4 = 1 or ls1evdayact4 = 3 then adl_walk_in = 1;
if ls1evdayact4 = 2 then adl_walk_in = 0;
if ls1evdayact5 = 1 or ls1evdayact5 = 3 then adl_walk_out = 1;
if ls1evdayact5 = 2 then adl_walk_out = 0;
if ls1evdayact6 = 1 or ls1evdayact6 = 3 then adl_dress = 1;
if ls1evdayact6 = 2 then adl_dress = 0;
if ls1evdayact7 = 1 or ls1evdayact7 = 3 then adl_bathe = 1;
if ls1evdayact7 = 2 then adl_bathe = 0;
if ls1evdayact8 = 1 or ls1evdayact8 = 3 then adl_toilet = 1;
if ls1evdayact8 = 2 then adl_toilet = 0;

/*changing IADL Numbers. If the answers on First IADL (Able to?) are "No" AND if the other IADL question (Keep from?) = "Yes"*/
if ls1ableto1 = 2 and ls1diskefrm1 = 1 then iadl_meals = 1;
if ls1ableto1 = 2 and ls1diskefrm1 = 2 then iadl_meals = 0;
if ls1ableto1 = 1 then iadl_meals = 0;
if ls1ableto2 = 2 and ls1diskefrm2 = 1 then iadl_laundry = 1;
if ls1ableto2 = 2 and ls1diskefrm2 = 2 then iadl_laundry = 0;
if ls1ableto2 = 1 then iadl_laundry = 0;
if ls1ableto3 = 2 and ls1diskefrm3 = 1 then iadl_housewk = 1;
if ls1ableto3 = 2 and ls1diskefrm3 = 2 then iadl_housewk = 0;
if ls1ableto3 = 1 then iadl_housewk = 0;
if ls1ableto4 = 2 and ls1diskefrm4 = 1 then iadl_shop = 1;
if ls1ableto4 = 2 and ls1diskefrm4 = 2 then iadl_shop = 0;
if ls1ableto4 = 1 then iadl_shop = 0;
if ls1ableto5 = 2 and ls1diskefrm5 = 1 then iadl_money = 1;
if ls1ableto5 = 2 and ls1diskefrm5 = 2 then iadl_money = 0;
if ls1ableto5 = 1 then iadl_money = 0;
if ls1ableto6 = 2 and ls1diskefrm6 = 1 then iadl_meds = 1;
if ls1ableto6 = 2 and ls1diskefrm6 = 2 then iadl_meds = 0;
if ls1ableto6 = 1 then iadl_meds = 0;
if ls1ableto7 = 2 and ls1diskefrm7 = 1 then iadl_phone = 1;
if ls1ableto7 = 2 and ls1diskefrm7 = 2 then iadl_phone = 0;
if ls1ableto7 = 1 then iadl_phone = 0;


/*SUM of the ADLs. Create three categories. (0, 1/2, >=3) */
sum_adl = sum(adl_eating, adl_bed, adl_chair, adl_walk_in, adl_walk_out, adl_dress, adl_bathe, adl_toilet);
sum_adl_cat = 0;
if sum_adl = 1 or sum_adl = 2 then sum_adl_cat = 1;
if sum_adl > 2 then sum_adl_cat = 2;
if sum_adl = . then sum_adl_cat = .;
label sum_adl = "Sum of all ADLs/IADLs";
label sum_adl_cat = "Num. of ADL/IADL Category (0, 1/2, >=3)";

/* INDICATOR OF ANY ADL/IADLs. Needed for Caregiving Project with Katherine*/
ADL_IADL_ind = 0;
if adl_eating = 1| adl_bed = 1 | adl_chair = 1 | adl_walk_in = 1 | adl_walk_out = 1 | adl_dress = 1 | 
adl_bathe = 1 | adl_toilet = 1|iadl_meals = 1 | iadl_laundry = 1 | iadl_housewk = 1 | iadl_shop = 1 | 
iadl_money = 1 | iadl_meds = 1 | iadl_phone = 1 then ADL_IADL_ind = 1;
if sum_adl = . then ADL_IADL_ind = .;
label adl_iadl_ind = "Indicator if any of ADLs/IADLs at all";



run;
proc freq data=nhats_wave1;
table community_dwelling adl_eating adl_bed adl_chair adl_walk_in adl_walk_out adl_dress adl_bathe adl_toilet
iadl_meals iadl_laundry iadl_housewk iadl_shop iadl_money iadl_meds iadl_phone white married gt_hs_edu
sum_adl sum_adl_cat ADL_IADL_ind;
run;

proc freq data=nhats_nsoc_tracker;
table fl1dnsoc fl1dnsoccomp;
run;

data nhats_nsoc_tracker1;
set nhats_nsoc_tracker;
eligible = 0;
if fl1dnsoc = 1 then eligible = 1;
complete = 0;
if fl1dnsoccomp > 0 then complete = 1;
total_caregiver_comp = fl1dnsoccomp;
if fl1dnsoccomp < 0 then total_caregiver_comp = .;
label eligible = "Eligible for NSOC interview";
label complete = "Completed Interview";
label total_caregiver_comp = "Total Caregivers that Completed Interview";
run;
proc freq data=nhats_nsoc_tracker1;
table eligible complete total_caregiver_comp;
run;

proc sql;
create table nhats_wave1_1
as select a.*, b.eligible, b.complete, b.total_caregiver_comp
from nhats_wave1 a
left join nhats_nsoc_tracker1 b
on a.spid = b.spid;
quit;

proc freq data=nhats_wave1_1;
where community_dwelling = 1;
table eligible complete total_caregiver_comp;
run;

data nhats.nhats_wave1_all_obs;
set nhats_wave1_1;
run;

data raw_nhats_r2_1;
set raw_nhats_r2;
drop w2anfinwgt1-w2anfinwgt56;
run;

proc sql;
create table nhats_wave12
as select a.spid, a.died, a.died_24, a.age_w1, a.community_dwelling, a.gender, a.education, a.gt_hs_edu, a.race_cat, a.white, a.married, a.living_arrang, a.live_alone,
a.adl_eating, a.adl_bed, a.adl_chair, a.adl_walk_in, a.adl_walk_out, a.adl_dress, a.adl_bathe, a.adl_toilet, a.iadl_meals, a.iadl_laundry, a.iadl_housewk, a.iadl_shop,
a.iadl_money, a.iadl_meds, a.iadl_phone, a.sum_adl, a.sum_adl_cat, a.ADL_IADL_ind, a.eligible, a.complete, a.total_caregiver_comp, b.*
from nhats_wave1_1 a
inner join raw_nhats_r2_1 b
on a.spid = b.spid;
quit;

data test;
set nhats.nhats_wave1_all_obs;
if ADL_IADL_ind = 1;run;
proc freq data=test;
table died;
run;



H="NSOC Setup"
libname ko "E:\nhats\data\Projects\Caregivers";
libname nhats "E:\nhats\data\NHATS working data";


/************************** NSOC DATA SETUP ********************************/

proc import out = RAW_NSOC
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NSOC_Round_1_File_v2_old.dta"
			replace;
run;
proc freq data=raw_nsoc;
table c1dintdays;
run;
proc import out = RAW_OP
			datafile = "E:\nhats\data\NHATS Public\round_1\NHATS_Round_1_OP_File_old.dta"
			replace;
run;
proc import out = RAW_OP_SENSITIVE
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NHATS_Round_1_OP_Sen_Dem_File_old.dta"
			replace;
run;
proc import out = NSOC_SP_Tracker
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NSOC_Round_1_SP_Tracker_File.dta"
			replace;
run;
proc import out = NSOC_OP_Tracker
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NSOC_Round_1_OP_Tracker_File.dta"
			replace;
run;
proc import out=raw_nhats_r1
			datafile = "E:\nhats\data\NHATS Public\round_1\NHATS_Round_1_SP_File_old.dta"
			replace;
run; 
proc import out=raw_nhats_r2_sens
			datafile = "E:\nhats\data\NHATS Sensitive\r2_sensitive\NHATS_Round_2_SP_Sen_Dem_File.dta"
			replace;
run;

/**Final NSOC Database**/
data final_nhats;
set nhats.Nhats_wave1_all_obs;
run;
proc freq data=final_nhats;
table died cs1dreconcil;
run;

proc freq data = RAW_OP;
table op1prsninhh op1martlstat op1numchldrn op1ishelper op1sppayshlp cs1dreconcil;
run;
proc freq data = raw_op_sensitive;
table op1age op1catgryage;
run;

/*Adding in the OP Demographics to the NSOC dataset*/
proc sql;
create table raw_nsoc1
as select a.*, b.op1prsninhh, b.op1martlstat, b.op1numchldrn, b.op1ishelper, b.op1sppayshlp, b.op1leveledu, b.op1prsninhh,
c.op1age, c.op1catgryage, d.hh1livwthspo, d.cs1dreconcil, d.hh1martlstat, d.hh1dhshldnum, d.died, d.died_24, d.complete, d.ADL_IADL_ind
from raw_nsoc a
left join raw_op b
on a.spid = b.spid
and a.opid = b.opid
left join raw_op_sensitive c
on a.spid = c.spid
and a.opid = c.opid
left join final_nhats d
on a.spid = d.spid;
quit;

proc freq data= raw_nsoc1;
table op1prsninhh op1martlstat op1numchldrn op1ishelper op1sppayshlp op1age op1catgryage op1leveledu cs1dreconcil hh1martlstat hh1dhshldnum chd1educ
c1relatnshp chd1martstat chi1medicare cca1hwget2sp op1prsninhh hh1livwthspo cca1hlpothin;
run;

proc freq data=raw_nsoc1;

table cec1wrk4pay;
run;
proc freq data=nsoc;
table cg_spouse;
run;
data nsoc;
set raw_nsoc1;

/*** Drop the variations of the NSOC Weight Variable. Use primarily "w1cgfinwgt0" for full Sample ***/

drop w1cgfinwgt1 - w1cgfinwgt56;

/*female variable*/
cg_female = .;
if c1dgender = 1 then cg_female = 0;
if c1dgender = 2 then cg_female = 1;

/*Creating Spouse Variable */
cg_spouse = .;
if c1relatnshp = 2 then cg_spouse = 1;
if c1relatnshp ~= 2 then cg_spouse = 0;
/*Relationship Categorical Variable. If Spouse then Cat = 1, if any form of their child (bio, in-law, step) then cat = 2 others are equal to 0*/
cg_relationship_cat = 3;
if c1relatnshp = 2 then cg_relationship_cat = 1;
if c1relatnshp >= 3 and c1relatnshp <= 8 then cg_relationship_cat = 2;
/*antoher categorical: 1 = spouse, 2 = daughter (any), 3 = son (any), 4 = any relative, 5 = other non-relative*/
cg_relationship_cat1 = .;
if c1relatnshp = 2 then cg_relationship_cat1 = 1;
if c1relatnshp = 3 |  c1relatnshp = 5 | c1relatnshp = 7 then cg_relationship_cat1 = 2;
if c1relatnshp = 4 |  c1relatnshp = 6 | c1relatnshp = 8 then cg_relationship_cat1 = 3;
if (c1relatnshp >= 9 and c1relatnshp <= 29) OR c1relatnshp = 91 then cg_relationship_cat1 = 4;
if (c1relatnshp >= 30 and c1relatnshp <= 39) OR c1relatnshp = 92 then cg_relationship_cat1 = 5;

/*gathering total hours a day/week/month/other */
total_hours_day = cdc1hlphrsdy + 0;
if total_hours_day < 0 then total_hours_day = .;
total_hours_week = cdc1hlpdyswk + 0;
if total_hours_week < 0 then total_hours_week = .;
total_days_month = cdc1hlpdysmt + 0;
if total_days_month < 0 then total_days_month = .;
total_hours_other = cdc1hlphrlmt + 0;
if total_hours_other < 0 then total_hours_other = .;
other_flag = 0;
if cdc1hlphrmvf ~= 1 then other_flag=1;
/*if the cargiver was a regular then you calculated it days a week per day and multiply that by 4*/
if cdc1hlpsched = 1 then total_hours = total_hours_week * total_hours_day * 4;
/*if they were not a regular than you calculated the total days in the month by total hours*/
if cdc1hlpsched ~= 1 then total_hours = total_days_month * total_hours_day;
if other_flag = 1 then total_hours = total_hours_other;

/* LIVING CHILDREN MISSING DATA */
Any_Living_Children_SP = 0;
if cs1dreconcil ~= 3 then Any_Living_Children_SP = 1;
Any_Living_Children_CG = .;
if chd1chldlvng = 2 then Any_Living_Children_CG = 0;
if chd1chldlvng = 1 then Any_Living_Children_CG = 1;
if cg_spouse = 1 then cg_living_children = Any_Living_Children_SP;
if cg_spouse = 0 then cg_living_children = Any_Living_Children_CG;
drop Any_Living_Children_SP Any_Living_Children_CG;

/*MARITAL STATUS MISSING DATA */
if cg_spouse = 1 then cg_Marital_status = hh1martlstat;
if cg_spouse = 0 then cg_marital_status = chd1martstat;
if cg_marital_status = . then cg_Marital_Status =op1martlstat; 
cg_marr_part_ind = .;
if cg_marital_status = 1 or cg_marital_status = 2 then cg_marr_part_ind = 1;
if cg_marital_status >= 3 then cg_marr_part_ind = 0;

/*NUMBER IN HOUSEHOLD */
if cg_spouse = 1 then cg_total_in_hh = hh1dhshldnum;
if cg_spouse = 0 then cg_total_in_hh = chd1numinhh;
if cg_total_in_hh < 0 then cg_total_in_hh = .;

/*EDUCATION OF CAREGIVER */
if cg_spouse = 1 then cg_educ = op1leveledu;
if cg_spouse = 0 then cg_educ = chd1educ;
if cg_educ < 0 then cg_educ = .;
cg_gt_hs = .;
if cg_educ >= 4 then cg_gt_hs = 1;
if cg_educ < 4 and cg_educ >= 0 then cg_gt_hs = 0;

/* Caregiver Medicare */
cg_medicare = .;
if chi1medicare = 1 then cg_medicare = 1;
if chi1medicare = 2 then cg_medicare = 0;

/* Lives with SP */
if cg_spouse = 1 then cg_lives_with_SP = hh1livwthspo;
if cg_spouse = 0 then cg_lives_with_sp = op1prsninhh;
if cg_lives_with_SP < 0 then cg_lives_with_sp = .;

run;
proc freq data=nsoc;
table cg_relationship_cat1 cpp1wrk4pay cec1wrk4pay;
run;
proc means data=nsoc;
var total_hours;
run;
proc print data = nsoc (obs = 100);
where cec1wrk4pay = 2;
var cec1wrk4pay cec1ownbusns cec1unpdwrk cec1misswork cec1look4wrk cec1hrsweek cec1hrslstwk cec1hrslast;
run;
data test;
set nsoc (keep = spid op1prsninhh hh1livwthspo c1relatnshp cg_spouse cg_lives_with_sp);
run;
proc freq data=nsoc;
table
che1hrtattck che1othheart che1arthrits che1diabetes che1lungdis
che1cancer cca1hwoftpc cca1hwofthom cca1hwoftshp cca1hwoftchs
cca1hlpbnkng cca1hlpmed cca1hlpmdapt cca1hlpspkdr cca1hlpordmd
cca1hlpinsrn cca1hlpdiet cca1hlpfeet cca1hlpskin cca1hlpexrcs
cca1hlpteeth cca1hlpmdtk cca1hlpshot

cac1moreconf cac1dealbetr cac1closr2sp cac1moresat cac1exhaustd cac1toomuch cac1notime cac1uroutchg
cac1diffinc cac1diffemo cac1diffphy che1fltltin;
run;

proc format;
value yesno_ 1 = "Yes"
			 0 = "No"
			 . = "Missing";
value cat1_  1 = "Every Day"
			 2 = "Most Days"
			 3 = "Some Days"
			 4 = "Rarely"
			 5 = "Never";
value cat1a_ 1 = "Every/Most/Some Days"
			 0 = "Rarely/Never";
value cat2_  1 = "Very Much"
			 2 = "Somewhat"
			 3 = "Not So Much";
value cat2a_ 1 = "Very Much/Somewhat"
			 0 = "Not So Much";
value cat3_  1 = "Not At All"
			 2 = "Several Days"
			 3 = "More Than Half The Days"
			 4 = "Nearly Every Day";
value cat3a_ 0 = "Not At All"
			 1 = "At least Sever Days";
run;
option nospool;
proc freq data=nsoc;
table che1sleeptrb trb_back_sleep;
run;
%let varlist = che1hrtattck che1othheart che1arthrits che1diabetes che1lungdis che1cancer che1pain che1brethprb che1lowenrgy  che1lost10lb che1highbld che1osteoprs che1seeing che1hearing;
%let varlist1 = ever_heart_attack ever_heart_disease ever_arthritis ever_diabetes ever_lung_dis ever_cancer ever_pain ever_breath_prob ever_low_enrgy  lost_10_lbs_yr ever_high_bp
ever_osteoperosis ever_diff_seeing ever_diff_hearing;
%macro ever_disease;
%let i = 1;
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%do %while(&var ne );
data nsoc;
set nsoc;
&var1 = .;
if &var = 1 then &var1 = 1;
if &var = 2 then &var1 = 0; 
run;
proc freq data=nsoc;
table &var &var1;
format &var1 yesno_.;
run;
%let i = %eval(&i + 1);
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%end;
%mend;
%ever_disease;

%let varlist = che1fltltlin che1fltdown che1fltnervs che1fltworry;
%let varlist1 = felt_lit_interest felt_depressed felt_nervous felt_worry;
%macro ever_disease1;
%let i = 1;
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%do %while(&var ne );

data nsoc;
set nsoc;
&var1 = .;
if &var = 1 then &var1 = 1;
if &var = 2 then &var1 = 2;
if &var = 3 then &var1 = 3;
if &var = 4 then &var1 = 4;
&var1._di = .;
if &var = 2 or &var = 3 or &var = 4 then &var1._di = 1;
if &var = 1 then &var1._di = 0;

run;
proc freq data=nsoc;
table &var &var1 &var1._di;
format &var1 cat3_. &var1._di cat3a_.;
run;

%let i = %eval(&i + 1);
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%end;
%mend;
%ever_disease1;

%let varlist = che1health che1painlmt che1brethlmt che1enrgylmt cca1hwoftpc cca1hwofthom cca1hwoftshp cca1hwoftchs che1sleeptrb;
%let varlist1 =  self_health pain_lim_act breath_lim_act enrgy_lim_act help_personal_care help_get_around help_shopping help_chores trb_back_sleep;
%macro help1;
%let i = 1;
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%do %while(&var ne );
data nsoc;
set nsoc;
&var1 = .;
if &var = 1 then &var1 = 1;
if &var = 2 then &var1 = 2;
if &var = 3 then &var1 = 3;
if &var = 4 then &var1 = 4;
if &var = 5 then &var1 = 5;
&var1._di = .;
if &var = 1 or &var = 2 or &var = 3 then &var1._di = 1;
if &var = 4 or &var = 5 then &var1._di = 0;

run;
proc freq data=nsoc;
table &var &var1 &var1._di;
format &var1 cat1_. &var1._di cat1a_.;
run;

%let i = %eval(&i + 1);
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%end;
%mend;
%help1;

%let varlist = cca1hlpbnkng cca1hlpmed cca1hlpmdapt cca1hlpspkdr cca1hlpordmd cca1hlpinsrn cca1hlpothin cse1hlpgtdev cse1homsafer cse1hlppdhlp cca1hlpdiet cca1hlpfeet cca1hlpskin cca1hlpexrcs cca1hlpteeth cca1hlpmdtk cca1hlpshot cse1frfamhlp cpp1wrk4pay;
%let varlist1 = help_bills help_track_meds help_make_appts help_speak_doc help_order_med help_insurance help_insurance_oth help_mob_dev help_home_safe help_paid_helpr help_diet help_foot help_skin help_exercise help_teeth help_medical_task help_shots_injection friend_help work_4_pay;
%macro help2;
%let i = 1;
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%do %while(&var ne );
data nsoc;
set nsoc;
&var1 = .;
if &var = 1 then &var1 = 1;
if &var = 2 then &var1 = 0; 
run;
proc freq data=nsoc;
table &var &var1;
format &var1 yesno_.;
run;
%let i = %eval(&i + 1);
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%end;
%mend;
%help2;
proc freq data=nsoc;
table help_mob_dev help_home_safe help_paid_helpr;
run;

data nsoc;
set nsoc;
if help_insurance = 1 | help_insurance_oth = 1 then help_insurance_any = 1;
if help_insurance = 0 and help_insurance_oth = 0 then help_insurance_any = 0;
run;

%let varlist = cac1moreconf cac1dealbetr cac1closr2sp cac1moresat cac1exhaustd cac1toomuch cac1notime cac1uroutchg;
%let varlist1 = gain_more_conf gain_deal_better gain_closer2SP gain_more_satisfied neg_exhausted neg_too_much neg_no_time neg_no_routine;
%macro gain_neg;
%let i = 1;
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%do %while(&var ne );
data nsoc;
set nsoc;
&var1 = .;
if &var = 1 then &var1 = 1;
if &var = 2 then &var1 = 2;
if &var = 3 then &var1 = 3;
&var1._di = .;
if &var = 1 or &var = 2 then &var1._di = 1;
if &var = 3 then &var1._di = 0;
run;
proc freq data=nsoc;
table &var &var1 &var1._di;
format &var1 cat2_. &var1._di cat2a_.;
run;
%let i = %eval(&i + 1);
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%end;
%mend;
%gain_neg;
option spool;
proc freq data=nsoc;
table cac1diffinc cac1diffinlv;
run;
%let varlist = cac1diffinc cac1diffemo cac1diffphy;
%let varlist1 = diff_financial diff_emotional diff_physical;
%macro difficulty;
%let i = 1;
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%do %while(&var ne );
data nsoc;
set nsoc;
&var1 = .;
if &var = 1 then &var1 = 1;
if &var = 2 then &var1 = 0; 
run;
proc freq data=nsoc;
table &var &var1;
format &var1 yesno_.;
run;
%let i = %eval(&i + 1);
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%end;
%mend;
%difficulty;
%let varlist = cac1diffinlv cac1diffemlv cac1diffphlv;
%let varlist1 = diff_financial_lv diff_emotional_lv diff_physical_lv;
%let varlist2 = cac1diffinc cac1diffemo cac1diffphy;
ods rtf body = "E:\nhats\data\Projects\Caregivers\logs\diffculty_levels.rtf";
%macro difficulty1;
%let i = 1;
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%let var2 = %scan(&varlist2, &i);
%do %while(&var ne );

data nsoc;
set nsoc;
&var1 = .;
if &var2 = 2 then &var1 = 0;
if &var = 1 then &var1 = 1;
if &var = 2 then &var1 = 2;
if &var = 3 then &var1 = 3;
if &var = 4 then &var1 = 4;
if &var = 5 then &var1 = 5;
&var1._di = .;
if &var2 = 2 then &var1._di = 0;
if &var = 1 or &var = 2 or &var = 3 then &var1._di = 0;
if &var = 4 or &var = 5 then &var1._di = 1;
run;
proc freq data=nsoc;
table &var &var1 &var1._di;
run;
%let i = %eval(&i + 1);
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%let var2 = %scan(&varlist2, &i);
%end;
%mend;
%difficulty1;
ods rtf close;

%let varlist = cdc1hlpsched cdc1hlpyrpls chi1medicaid;
%let varlist1 = help_regular_sched help_longer_than_yr cg_medicaid;
%macro misc_binary;
%let i = 1;
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%do %while(&var ne );
data nsoc;
set nsoc;
&var1 = .;
if &var = 1 then &var1 = 1;
if &var = 2 then &var1 = 0; 
run;
proc freq data=nsoc;
table &var &var1;
format &var1 yesno_.;
run;
%let i = %eval(&i + 1);
%let var = %scan(&varlist,&i);
%let var1 = %scan(&varlist1, &i);
%end;
%mend;
%misc_binary;

/*
proc sql;
create table nsoc1
as select a.*, b.cg_age as age1, b.dem_3_cat, b.sr_gad2_anxiety, b.sr_phq2_depressed
from nsoc a
left join nsoc_rg b
on a.spid = b.spid and a.opid = b.opid;
quit;
proc freq data=nsoc_rg;
table dem_3_cat sr_gad2_anxiety sr_phq2_depressed;
run;
proc freq data=nsoc1;
table dem_3_cat sr_gad2_anxiety sr_phq2_depressed;
run; 
*/
data ko.nsoc_raw1;
set nsoc;
run;
proc freq data=ko.nsoc_raw1;
table diff_physical_lv_di;
run;

/*****AGE CATEGORIES********/


/*Bringing in raw OP, but change to bring in the final OP: TO DO LATER*/
proc import out = RAW_OP_SENS
			datafile = "E:\nhats\data\NHATS Sensitive\r1_sensitive\NHATS_Round_1_OP_Sen_Dem_File_old.dta"
			replace;
run;
proc freq data=raw_op_sens;
table op1catgryage;
run;

data nsoc;
set ko.nsoc_raw1;
run;
proc freq data=nsoc;
table chd1cgbrthyr;
run;

/*bring in variables regarding year and month of brith.*/
proc sql;
create table raw_op_sens1
as select a.*, b.op1dage, b.op1dcatgryag, c.chd1cgbrthmt, c.chd1cgbrthyr
from raw_op_sens a
left join raw_op b
on a.spid = b.spid and
a.opid = b.opid
left join nsoc c
on a.spid = c.spid and
a.opid = c.opid;
quit;
proc freq data=raw_op_sens1;
where op1catgryage < 0;
table op1dage;
run;
proc freq data=raw_op_sens1;
where op1age<=0 and op1catgryage < 0;
table chd1cgbrthyr;
run;
/*all op continuous variable have some sort of categorical variable*/
proc means data=raw_op_sens1 n nmiss mean median min max std;
where op1dage >0;
var op1age;
run;

data test;
set raw_op_sens1;
if op1dage = 1;
run;


/*AGE CATEGORIES
1 - UNDER 20
2 - 20-24
3 - 25-29
4 - 30-34
5 - 35-39
6 - 40-44
7 - 45-49
8 - 50-54
9 - 55-59
10 - 60-64
11 - 65-69
12 - 70-74
13 - 75-79
14 - 80-84
15 - 85-89
16 - 90 +
*/

data raw_op_sens2;
set raw_op_sens1;
/*use the regular categorical variable and add in sensitive categories for the ones that are missing*/
if op1dage < 0 and op1catgryage >0 then op1dage = op1catgryage;
if op1dage <0 then op1dage = .;
if op1dage >16 then op1dage = 16;


if chd1cgbrthyr > 0 then cg_age_approx = 2011 - chd1cgbrthyr;

/*based on categories*/

if cg_age_approx < 20 and cg_age_approx > 0 and op1dage = . then op1dage = 1;
if cg_age_approx >= 20 and cg_age_approx <=24 and op1dage = . then op1dage = 2;
if cg_age_approx >= 25 and cg_age_approx <=29 and op1dage = .  then op1dage = 3;
if cg_age_approx >= 30 and cg_age_approx <=34 and op1dage = .  then op1dage = 4;
if cg_age_approx >= 35 and cg_age_approx <=39 and op1dage = .  then op1dage = 5;
if cg_age_approx >= 40 and cg_age_approx <=44 and op1dage = .  then op1dage = 6;
if cg_age_approx >= 45 and cg_age_approx <=49 and op1dage = .  then op1dage = 7;
if cg_age_approx >= 50 and cg_age_approx <=54 and op1dage = .  then op1dage = 8;
if cg_age_approx >= 55 and cg_age_approx <=59 and op1dage = .  then op1dage = 9;
if cg_age_approx >= 60 and cg_age_approx <=64 and op1dage = .  then op1dage = 10;
if cg_age_approx >= 65 and cg_age_approx <=69 and op1dage = .  then op1dage = 11;
if cg_age_approx >= 70 and cg_age_approx <=74 and op1dage = .  then op1dage = 12;
if cg_age_approx >= 75 and cg_age_approx <=79 and op1dage = .  then op1dage = 13;
if cg_age_approx >= 80 and cg_age_approx <=84 and op1dage = .  then op1dage = 14;
if cg_age_approx >= 85 and cg_age_approx <=89 and op1dage = .  then op1dage = 15;
if cg_age_approx >= 90 and op1dage = .  then op1dage = 16;


rename op1dage = cg_age_cat;
run;
proc freq data=raw_op_sens2;
table cg_age_cat ;
run;


proc sql;
create table nsoc_w_age
as select a.*, b.cg_age_cat
from nsoc a
left join raw_op_sens2 b
on a.spid = b.spid
and a.opid = b.opid;
quit;
proc freq data=nsoc_w_age;
table cg_age_cat ;
run;
proc freq data=nsoc_w_age;
where cg_age_cat = .;
table cg_spouse;
run;

data nsoc1;
set nsoc_w_age;
run;

/**Age in Continuous Form (non-intervals)**/


data nsoc_age;
set nsoc1 (keep = spid opid chd1cgbrthyr chd1cgbrthmt c1intmonth);
run;
proc sql;
create table nsoc_age1
as select a.*, b.op1age
from nsoc_age a
left join raw_op_sens b
on a.spid = b.spid and a.opid = b.opid;
quit;
proc freq data=nsoc_age1;
table op1age;
run;
data nsoc_age1;
set nsoc_age1;
cg_age = op1age;
if cg_age = -1|cg_age=-7|cg_age=-8 then cg_age = .;
if op1age < 0 and chd1cgbrthyr >0 and c1intmonth >= chd1cgbrthmt then cg_age = 2011-chd1cgbrthyr;
if op1age < 0 and chd1cgbrthyr >0 and c1intmonth < chd1cgbrthmt then cg_age = 2011-chd1cgbrthyr-1;
run;
proc means data=nsoc_age1;
var cg_age;
run;

proc sql;
create table nsoc_age2
as select a.*, b.cg_age
from nsoc1 a
left join nsoc_age1 b
on a.spid = b.spid and a.opid = b.opid;
quit;
proc means data=nsoc_age2;
var cg_age;
run;

data nsoc1;
set nsoc_age2;
run;

proc means data=nsoc_pay;
var cec1hrsweek cec1hrslstwk;
run;

data nsoc_pay;
set nsoc1 ;
/*paid last week variable binary 1/0*/
paid_last_week = cec1wrk4pay;
if cec1wrk4pay < 0 then paid_last_week = .;
if cec1wrk4pay = 2 | cec1wrk4pay = 3 then paid_last_week = 0;

if cec1hrslstwk < 0 then cec1hrslstwk = .;
if cec1wrk4pay = 1 then paid_hours = cec1hrslstwk;


if paid_hours <=20 and paid_hours~= . then paid_hours_cat = 0;
if paid_hours >=21 and paid_hours<=39 then paid_hours_cat = 1;
if paid_hours >=40 then paid_hours_cat = 2;
/*if they didn't work last week then their paid hours is 0 and their category is zero*/
if paid_last_week = 0 then paid_hours = 0;
if paid_last_week = 0 then paid_hours_cat = 0;
run;
/*
ods rtf body = "E:\nhats\projects\Caregivers_KO\11242015\Pay_Hours.rtf";
proc freq data=nsoc_pay;
table cec1wrk4pay paid_last_week paid_hours_cat paid_hours;
run;
proc means data=nsoc_pay;
var paid_hours;
run;
ods rtf close;
*/
data nsoc1;
set nsoc_pay;
run;



proc freq data=nsoc1;
table che1fltltlin;
run;
data nsoc_phq_gad;
set nsoc1;
if che1fltltlin >= 0 then cg_depr_pqq1 = che1fltltlin;
if che1fltdown >= 0 then cg_depr_pqq2 = che1fltdown;
if che1fltnervs >= 0 then cg_depr_gad1 = che1fltnervs;
if che1fltworry >= 0 then cg_depr_gad2 = che1fltworry;
cg_depr_pqq1 = cg_depr_pqq1-1;
cg_depr_pqq2 = cg_depr_pqq2-1;
cg_depr_gad1 = cg_depr_gad1-1;
cg_depr_gad2 = cg_depr_gad2-1;
cg_phq2_score = sum(cg_depr_pqq1, cg_depr_pqq2);
cg_gad2_score = sum(cg_depr_gad1, cg_depr_gad2);
cg_phq2_depressed = .;
if cg_phq2_score >= 3 then cg_phq2_depressed = 1;
else if cg_phq2_score < 3 and cg_phq2_score ~= . then cg_phq2_depressed = 0;
cg_gad2_anxiety = .;
if cg_gad2_score >= 3 then cg_gad2_anxiety = 1;
else if cg_gad2_score < 3 and cg_gad2_score ~= . then cg_gad2_anxiety = 0;
run;
/*
ods rtf body = "E:\nhats\projects\Caregivers_KO\11242015\PHG_GAD.rtf";
proc freq data=nsoc_phq_gad;
table cg_depr_pqq1 cg_depr_pqq2 cg_depr_gad1 cg_depr_gad2 cg_phq2_score cg_gad2_score cg_phq2_depressed cg_gad2_anxiety;
run;
ods rtf close;
*/
data nsoc1;
set nsoc_phq_gad;
run;
proc freq data=nsoc1;
table diff_physical_lv_di;
run;


proc freq data=nsoc1;
table cca1lstmhlpd;
run;

data flag_no_help_month;
set nsoc1;
if cca1hlplstyr = 1 then flag_no_help_mth = 1;
run;
proc freq data=flag_no_help_month;
table flag_no_help_mth;
run;

data nsoc1;
set flag_no_help_month;
run;
proc freq data=nsoc1;
table diff_physical_lv_di;
run;

/*************************** HALF WAY POINT SAVE **********************************/

data nhats.nsoc1_half;
set nsoc1;
run;

/*************************** HALF WAY POINT SAVE **********************************/

proc freq data=nhats.nhats_wave1_all_obs;
table died;
run;
proc sql;
create table raw_op_sp_dies
as select a.*, b.died, c.op1dnsoc as nsoc_eligible
from raw_op a
left join  nhats.nhats_wave1_all_obs b
on a.spid = b.spid
left join nsoc_op_tracker c
on a.spid = c.spid and a.opid = c.opid;
quit;
proc freq data=raw_op_sp_dies;
table died nsoc_eligible;
run;
data raw_op_sp_dies1;
set raw_op_sp_dies;
if died ~= .;
run;
proc freq data=raw_op_sp_dies1;
table died nsoc_eligible;
run;
proc sort data=nsoc1 out=nsoc1a;
by spid opid;
run;
data nsoc_helper_num;
set nsoc1a;
if died ~= .;
by spid opid;
retain informal_nsoc_comp informal_nsoc_comp_i;
informal_nsoc_comp = informal_nsoc_comp + 1;
if first.spid then do ;
informal_nsoc_comp = 1;
informal_nsoc_comp_i = 1;
end;
run;

data test;
set nsoc_helper_num (keep = spid opid informal_nsoc_comp informal_nsoc_comp_i);
run;
proc freq data = nsoc_helper_num;
table informal_nsoc_comp informal_nsoc_comp_i;
run;
data nsoc_helper_num1;
set nsoc_helper_num;
by spid opid;
if last.spid;
run;
proc freq data = nsoc_helper_num1;
table informal_nsoc_comp informal_nsoc_comp_i;
run; 

proc sql;
create table raw_op_inf_cg
as select a.*, b.informal_nsoc_comp, c.informal_nsoc_comp_i
from raw_op_sp_dies1 a
left join nsoc_helper_num1 b
on a.spid = b.spid
left join nsoc_helper_num c
on a.spid = c.spid and a.opid = c.opid;
quit;
proc freq data=raw_op_inf_cg;
table op1relatnshp informal_nsoc_comp informal_nsoc_comp_i nsoc_eligible;
run;
data test;
set raw_op_inf_cg (keep = spid opid nsoc_eligible informal_nsoc_comp informal_nsoc_comp_i);
run;
data raw_op_inf_cg1;
set raw_op_inf_cg;
/*if they did not complete the NSOC then set them as "0"*/
if informal_nsoc_comp_i = . then informal_nsoc_comp_i = 0;
/*Only include the SPs that had at least one of the caregivers that completed the NSOC interview*/
if informal_nsoc_comp ~= .;
/*helpers who were NSOC eligible but were not interviewed*/
if nsoc_eligible >= 1 and nsoc_eligible <=5 then nsoc_eligible_i = 1;
if nsoc_eligible_i ~= 1 then nsoc_eligible_i = 0;
/*Note which person is a qualified "helper"*/
all_helpers = .;
if op1ishelper = 1 then all_helpers = 1;
if all_helpers ~= 1 then all_helpers = 0;
/*Is any family*/
is_family = .;
if (op1relatnshp >=1 and op1relatnshp <= 29 )|op1relatnshp=91 then is_family = 1;
if is_family ~= 1 then is_family = 0;
/*paid indicator*/
helper_informal = .;
/*if it's -1 then it's bc of the spouse. Check Box HL5. Spouse is considered as Unpaid Helper. */
if all_helpers = 0 then helper_informal = 0;
if all_helpers = 1 and is_family = 1 then helper_informal = 1;
if all_helpers = 1 and op1paidhelpr = -1 then helper_informal = 1;
if all_helpers = 1 and is_family = 0 and op1paidhelpr = 2 /*(answered No)*/ then helper_informal = 1;
if all_helpers = 1 and is_family = 0 and (op1paidhelpr = 1) then helper_informal = 0;
/*helper family CHANGED in 12/10/2015 from being actual family to indication of them being unpaid. */
all_helper_family = .;
if all_helpers = 1 and helper_informal = 1 then all_helper_family = 1;
if all_helper_family ~= 1 then all_helper_family = 0;
run;
proc freq data=raw_op_inf_cg1;
table all_helpers all_helper_family helper_informal ;
run;
proc freq data=raw_op_inf_cg1;
table helper_informal*op1relatnshp;
run;
proc freq data=raw_op_inf_cg1;
where helper_informal = .;
table all_helpers is_family op1paidhelpr op1relatnshp;
run;
/*
data test;
set raw_op_inf_cg1 (keep = spid opid op1ishelper op1paidhelpr op1relatnshp);
run;
proc freq data=test;
table op1relatnshp op1ishelper op1paidhelpr;
run;
data test1;
set test;
if op1ishelper = 1;
run;
proc freq data=test1;
table op1relatnshp op1paidhelpr;
run;
proc freq data=raw_op_inf_cg1;
table op1relatnshp is_family informal_nsoc_comp informal_nsoc_comp_i nsoc_eligible all_helpers all_helper_family is_imm_family all_helper_imm_family;
run;
data test;
set raw_op_inf_cg1 (keep = spid opid nsoc_eligible informal_nsoc_comp informal_nsoc_comp_i nsoc_eligible_i op1ishelper all_helpers all_helper_family);
run;
proc sort data=test;
by spid opid;
run;
proc sort data=raw_op_inf_cg1;
by spid opid;
run;
*/
data raw_op_inf_cg2;
set raw_op_inf_cg1;
by spid opid;
retain informal_nsoc_elig all_helper_tot all_helper_family_tot ;
informal_nsoc_elig = informal_nsoc_elig + nsoc_eligible_i;
all_helper_tot = all_helper_tot + all_helpers;
all_helper_family_tot = all_helper_family_tot + all_helper_family;
if first.spid then do;
informal_nsoc_elig = nsoc_eligible_i;
all_helper_tot=all_helpers;
all_helper_family_tot = all_helper_family;
end;
run;
proc freq data=raw_op_inf_cg2;
table all_helper_family_tot;
run;
data test1;
set raw_op_inf_cg2 (keep = spid opid nsoc_eligible helper_informal informal_nsoc_comp informal_nsoc_comp_i nsoc_eligible_i op1ishelper all_helpers informal_nsoc_elig all_helper_tot all_helper_family_tot);
run;
data raw_op_inf_cg3;
set raw_op_inf_cg2;
by spid opid;
if last.spid;
diff_helper = all_helper_tot - informal_nsoc_comp;
run;
proc freq data=raw_op_inf_cg3;
table diff_helper;
run;
data test3;
set raw_op_inf_cg3 (keep = spid opid nsoc_eligible helper_informal informal_nsoc_comp informal_nsoc_comp_i nsoc_eligible_i op1ishelper all_helpers informal_nsoc_elig all_helper_tot all_helper_family_tot );
run;
/*
ods rtf body = "E:\nhats\data\Projects\Caregivers\logs\Total_Helper.rtf";
proc freq data=raw_op_inf_cg3;
table informal_nsoc_comp  all_helper_tot diff_helper all_helper_family_tot;
run;
ods rtf close;
*/
proc sql;
create table nsoc_helpers
as select a.*, b.informal_nsoc_comp, b.informal_nsoc_elig, b.all_helper_tot, b.all_helper_family_tot
from nsoc1 a 
left join raw_op_inf_cg3 b
on a.spid = b.spid;
quit;

proc freq data=nsoc_helpers;
table informal_nsoc_comp informal_nsoc_elig all_helper_tot all_helper_family_tot ;
run;
proc sql;
create table nsoc_helpers0
as select a.*, b.helper_informal
from nsoc_helpers a
left join raw_op_inf_cg1 b
on a.spid = b.spid and
a.opid = b.opid;
quit;
proc freq data=nsoc_helpers0;
table helper_informal;
run;

data test(keep = spid);
set nsoc_helpers ;
if all_helper_tot = 1;
run;
data nsoc_helpers1;
set nsoc_helpers0;
/*solo CG in da houuuuuse*/
solo_cg = 0;
if all_helper_tot = 1 then solo_cg = 1;
/*No Other Family Member*/
solo_cg_fam = .;
if helper_informal = 1 and all_helper_family_tot = 1 then solo_cg_fam = 1;
if helper_informal = 1 and all_helper_family_tot > 1 then solo_cg_fam = 0;
if helper_informal = 0 and all_helper_family_tot = 0 then solo_cg_fam = 1;
if helper_informal = 0 and all_helper_family_tot > 0 then solo_cg_fam = 0;
run;

proc freq data=nsoc_helpers1;
table helper_informal is_imm_family solo_cg solo_cg_fam ;
run;
proc freq data=nsoc_helpers1;
where helper_informal = 1;
table all_helper_family_tot;
run;
proc freq data=nsoc_helpers1;
table informal_nsoc_comp all_helper_tot;
run;

/************* ONLY EOL Helpers *****************/

data nsoc_helpers2;
set nsoc_helpers1;
if died = 1;
run;
/*
ods rtf body = "E:\nhats\data\Projects\Caregivers\logs\Solo_Caregiver_Numbers.rtf";
proc freq data=nsoc_helpers2;
table solo_cg_fam  ;
run;
proc freq data=nsoc_helpers2;
where solo_cg_fam = 1;
table all_helper_tot all_helper_family_tot;
run;
proc freq data=nsoc_helpers2;
table solo_cg  ;
run;
proc freq data=nsoc_helpers2;
where solo_cg = 1;
table all_helper_tot;
run;
ods rtf close;
*/
/************* ONLY EOL Helpers *****************/

proc sql;
create table nsoc1
as select *
from nhats.Nsoc1_half a
left join nsoc_helpers1 b
on a.spid = b.spid and a.opid = b.opid;
quit;

proc freq data=nsoc1;
table diff_physical_lv_di;
run;

/*********** Interview Date **************/

data nsoc_int_date;
set nsoc1;
int_month = c1intmonth;
if int_month >=5 then int_year = 2011;
run;

proc freq data=nsoc_int_date;
table c1intmonth int_month int_year;
run;

data raw_nhats_r2_death_dates;
set raw_nhats_r2_sens (keep = spid pd2mthdied pd2yrdied);
run;

proc sql;
create table nsoc_int2death
as select a.*, b.pd2mthdied as month_died, b.pd2yrdied as year_died
from nsoc_int_date a
left join raw_nhats_r2_death_dates b
on a.spid = b.spid;
quit;
data nsoc_int2death;
set nsoc_int2death;
if month_died = -1 then month_died = .;
if year_died = -1 then year_died = .;
run;
proc freq data=nsoc_int2death;
table died month_died year_died;
run;


/*Interview to Death*/
data nsoc_int2death1;
set nsoc_int2death;
if year_died = 1 then year_died = 2011;
if year_died = 2 then year_died = 2012;
if year_died ~= . then year_sep = year_died - int_year;
if month_died ~= . then month_sep = month_died - int_month;
if year_sep = 1 then year_sep_months = 12;
if year_sep = 0 then year_sep_months = 0;

months_to_death = year_sep_months + month_sep;
/*take out the dates that are negative. Confirmed with Katherine, we are assuming they are a fluke*/
if months_to_death < 0 then months_to_death = .;
run;
proc freq data=nsoc_int2death1;
table c1intmonth   month_died year_died year_sep month_sep year_sep_months months_to_death;
run;
data test;
set nsoc_int2death1 (keep = spid opid c1intmonth month_died year_died year_sep month_sep year_sep_months months_to_death);
if months_to_death < 0 and months_to_death ~= .;
run;
data nsoc1;
set nsoc_int2death1;
run;

/*Hours of Care additions. Could be more efficient I know. */
data dc_additions;
set nsoc1;
total_hours_month = total_hours;
if total_hours = . and cdc1hlpsched = 1 then total_hours_month = total_hours_day * total_hours_week * 4;

if cdc1hlpyrs ~= -1 then helper_num_yrs = cdc1hlpyrs;
if helper_num_yrs = . & cdc1hlpyrpls = 2 then helper_num_yrs = 0;
if helper_num_yrs = . & cdc1hlpyrst ~= -1 then helper_num_yrs = 2011 - cdc1hlpyrst;

run;
proc freq data=dc_additions;
table helper_num_yrs;
run;
proc freq data=dc_additions;
table  total_hours total_hours_month helper_num_yrs;
run;

data nsoc1;
set dc_additions;
run;

proc freq data=nsoc1;
where all_helper_tot = 1;
table  informal_nsoc_comp;
run;
proc freq data=nsoc1;
where died = 1;
table all_helper_tot cg_spouse;
run;

data indicators;
set nsoc1;
run;
data nsoc1;
set indicators;
run;

proc freq data=nsoc1;
table diff_emotional_lv_di ;
run;



/****** Living in household **********/
/****** OP1PRSNINHH is the variable for if the person is in the household ******/
/****** This is answered they answer three questions in the the NHATS Questionnaire ******/
/****** hh1livwthspo hh1proxlivsp hh1othlvhere if they answer yes or no (particularly if ******/
/****** the person also has an opid (spouse: hh1dspouseid, proxy: is1dproxyid)) then ******/
/****** then they will appear in the OP File. For those that didn't answer these questions, ******/
/****** then we can probably assume that these people don't live in the household ******/

proc sql;
create table opfile_hh1
as select a.*, b.hh1livwthspo, c.hh1proxlivsp, d.hh1othlvhere, d.hh1dlvngarrg, d.hh1livwthspo as SP_answered_spo, d.hh1proxlivsp as SP_ans_prox,d.hh1othlvhere as SP_ans_oth, d.r1dresid
from raw_op a
left join raw_nhats_r1 b
on a.spid = b.spid and a.opid = b.hh1dspouseid
left join raw_nhats_r1 c
on a.spid = c.spid and a.opid = c.is1dproxyid
left join raw_nhats_r1 d
on a.spid = d.spid;
quit;
proc freq data= opfile_hh1;
table op1prsninhh;
run;
proc freq data=opfile_hh1;
table in_hh;
run;
data opfile_hh_final;
set opfile_hh1;
lives_in_hh = .;
/*if the living arrangement says that they live with spouse and the person is the spouse then that person should be coded as a person in the hh*/
if (hh1dlvngarrg = 2 | hh1dlvngarrg = 3) and op1relatnshp = 2 then op1prsninhh = 1;
if op1prsninhh = 1 and lives_in_hh = . then lives_in_hh = 1;
if op1prsninhh = 0 and lives_in_hh = . then lives_in_hh = 0;
if op1chnotinhh = 1 and lives_in_hh = . then lives_in_hh = 0;
if op1soclntwrk = 1 and lives_in_hh = . then lives_in_hh = 0;
if op1contctflg = 1 and lives_in_hh = . then lives_in_hh = 0;
if op1spcaredfr = 1 and lives_in_hh = . then lives_in_hh = 0;
if op1ishelper = 1 and lives_in_hh = . then lives_in_hh = 0;
if op1dflmiss = 1 and lives_in_hh = . then lives_in_hh = 0;
if op1dsocwrkfl = 1 and lives_in_hh = . then lives_in_hh = 0;
if op1relatnshp = 37 and lives_in_hh = . then lives_in_hh = 0;
if hh1dlvngarrg = 1 and lives_in_hh = . then lives_in_hh = 0;
run;
proc freq data=opfile_hh_final;
table op1prsninhh lives_in_hh;
run;
data nsoc1;
set nsoc1;
drop lives_in_hh;
run;
proc sql; 
create table nsoc_w_hh
as select a.*, b.lives_in_hh
from nsoc1 a
left join opfile_hh_final b
on a.spid = b.spid and a.opid = b.opid;
quit;
proc freq data=nsoc_w_hh;
table lives_in_hh;
run;

data nsoc1;
set nsoc_w_hh;
run;

proc freq data=nsoc1;
table diff_emotional_lv_di ;
run;
/*
ods rtf body = "E:\nhats\data\Projects\Caregivers\logs\solo_cg_fam_xtab_spouse.rtf";
proc freq data=nsoc1;
where died = 1;
table cg_spouse*solo_cg;
run;
proc freq data=nsoc1;
where solo_cg = 1 and died = 1;
table cg_relationship_cat;
run;
proc freq data=nsoc1;
where died = 1;
table cg_spouse*solo_cg_fam;
run;
proc freq data=nsoc1;
where solo_cg_fam = 1 and died = 1;
table cg_relationship_cat;
run;
ods rtf close;
*/

data nhats_op;
set ko.helpers1a;
if op1dochlp = -1 then op1dochlp = 0;
run;
proc freq data=nhats_op;
table op1dochlp;
run;
proc sql;
create table op_additions
as select a.*, b.op1dochlp
from nsoc1 a
left join nhats_op b
on a.spid = b.spid and a.opid = b.opid;
quit;
proc freq data=op_additions;
table op1dochlp;
run;
data nsoc1;
set op_additions;
run;
data ko.nsoc_full;
set nsoc1;
run;
proc export data=nsoc1 outfile = "E:\nhats\data\Projects\Caregivers\nsoc_FULL.dta" dbms = dta replace;
run;

/*no lfu*/
data no_lfu;
set nsoc1;
if died = . then delete;
run;
data nsoc1;
set no_lfu;
run;

data ko.nsoc_final;
set nsoc1;
run;


H="NSOC Setup stata"
clear all
set more off
capture log close

cd "E:\nhats\data\NHATS Sensitive\r1_sensitive"

use NSOC_Round_1_File_v2.dta

merge 1:1 spid opid using NSOC_Round_1_OP_Tracker_File.dta, gen(m1) keep(match master)
merge 1:1 spid opid using NHATS_Round_1_OP_Sen_Dem_File.dta, gen(m8) keep(match master)
merge 1:m spid opid using "E:\nhats\data\NHATS cleaned\op_round_1_4.dta", gen(m2) keep(match master)
keep if wave==1
merge m:1 spid using NSOC_Round_1_SP_Tracker_File.dta, gen(m3) keep(match master)
tostring opid, replace
merge 1:1 spid opid using "E:\nhats\data\NHATS Public\round_1\NHATS_Round_1_OP_File_v2.dta", ///
gen(m4) keep(match master)
merge m:1 spid using "E:\nhats\data\NHATS Public\round_1\NHATS_Round_1_SP_File.dta", ///
gen(m5) keep(match master)
merge m:1 spid using "E:\nhats\data\NHATS Sensitive\r2_sensitive\NHATS_Round_2_SP_Sen_Dem_File.dta", ///
gen(m6) keep(match master) 
merge m:1 spid wave using "E:\nhats\data\NHATS cleaned\sp_round_1_4.dta", gen(m7) ///
keep(match master) keepusing(death*)
gen cgfinwgt=w1cgfinwgt0
gen cgvarunit=c1varunit
gen cgvarstrat=c1varstrat
gen startsnow=.
gen cg_female=c1dgender==2
gen cg_spouse=c1relatnshp==2
gen cg_relationship_cat=cg_spouse
replace cg_relationship_cat=2 if c1relatnshp>=3 & c1relatnshp<=8
replace cg_relationship_cat=3 if cg_relationship_cat==0
gen cg_relationship_cat1=cg_relationship_cat
replace cg_relationship_cat1=2 if inlist(c1relatnshp,3,5,7)
replace cg_relationship_cat1=3 if inlist(c1relatnshp,4,6,8)
replace cg_relationship_cat1=4 if (c1relatnshp>=9 & c1relatnshp<=29) | ///
 c1relatnshp==91
replace c1relatnshp=5 if (c1relatnshp>=30 & c1relatnshp==92)
gen total_hours_day=cdc1hlphrsdy
gen total_days_week=cdc1hlpdyswk
gen total_days_month=cdc1hlpdysmt 
gen total_hours_other=cdc1hlphrlmt
gen other_flag=cdc1hlphrmvf!=1

foreach x in hours_day days_week days_month hours_other {
	replace total_`x'=. if total_`x'<0
}
gen total_hours=total_days_week*total_hours_day*(52/12) if cdc1hlpsched==1
replace total_hours=total_days_month*total_hours_day if missing(total_hours)
replace total_hours=total_hours_other if other_flag==1
gen total_hours_week=total_hours/(52/12)

gen any_living_children_sp=cs1dreconcil!=3
gen any_living_children_cg=chd1chldlvng if chd1chldlvng==1
replace any_living_children_cg=0 if chd1chldlvng==2
gen cg_living_children=any_living_children_sp if cg_spouse==1
replace cg_living_children=any_living_children_cg if cg_spouse!=1
drop any_living*

gen cg_marital_status=hh1martlstat if cg_spouse==1
replace cg_marital_status=chd1martstat if cg_spouse==0
replace cg_marital_status=op1martlstat if cg_marital_status==.
gen cg_marr_part_ind=cg_marital_status<3 if !missing(cg_marital_status)

gen cg_total_in_hh=hh1dhshldnum if cg_spouse==1
replace cg_total_in_hh=chd1numinhh if cg_spouse==0
replace cg_total_in_hh=. if cg_total_in_hh<0

gen cg_educ=op1leveledu if cg_spouse==1
replace cg_educ=chd1educ if cg_spouse==0
replace cg_educ=. if cg_educ<0
gen cg_gt_hs=cg_educ>=4 if !missing(cg_educ)

gen cg_medicare=chi1medicare==1 if inlist(chi1medicare,1,2)
gen cg_lives_with_sp=hh1livwthspo if cg_spouse==1
replace cg_lives_with_sp=op1prsninhh if cg_spouse==0
replace cg_lives_with_sp=. if cg_lives_with_sp<0
replace cg_lives_with_sp=0 if cg_lives_with_sp==2
gen cg_medicaid=chi1medicaid==1 if chi1medicaid>0
gen ever_heart_attack=che1hrta==1 if che1hrta>0
gen ever_heart_disease=che1othheart==1 if che1othheart>0
gen ever_arthritis=che1arthrits==1 if che1arthrits>0
gen ever_diabetes=che1diabetes==1 if che1diabetes>0
gen ever_lung_dis=che1lungdis==1 if che1lungdis>0
gen ever_cancer=che1cancer==1 if che1cancer>0
gen ever_pain=che1pain==1 if che1pain>0
gen ever_breath_prob=che1brethprb==1 if che1brethprb>0
gen ever_low_enrgy=che1lowenrgy==1 if che1lowenrgy>0
gen ever_high_bp=che1highbld==1 if che1highbld>0
gen lost_10_lbs_yr=che1lost10lb==1 if che1lost10lb>0
gen ever_osteoperosis=che1osteoprs==1 if che1osteoprs>0
gen ever_diff_seeing=che1seeing==1 if che1seeing>0
gen ever_diff_hearing=che1hearing==1 if che1hearing>0

gen cg_srh=che1health if che1health>0
gen cg_srh_pf=inlist(cg_srh, 4,5) if !missing(cg_srh)

by spid, sort: egen mosthelped=max(total_hours)
gen cg_primary_nsoc=total_hours==mosthelped
by spid cg_primary_nsoc, sort: gen numprim=_N if cg_primary_nsoc==1
gen cg_primary_source=1 if numprim==1
gen primsp=1 if numprim==2 & cg_spouse==1 & cg_primary_nsoc==1
sum spid if primsp==1
replace cg_primary_source=2 if primsp==1
replace cg_primary_nsoc=0 if spid==r(mean) & primsp==.
gen child=inlist(c1relatnshp,3,4) if cg_primary_nsoc==1 & numprim==2
by spid cg_primary_nsoc, sort: egen anychild=max(child)
replace cg_primary_nsoc=0 if anychild==1 & child==0
by spid cg_primary_nsoc, sort: replace numprim=_N if cg_primary_nsoc==1
replace cg_primary_source=2 if child==1 & anychild==1 & numprim==1
gsort spid -cg_primary_nsoc -op_hrsm
by spid: replace cg_primary_nsoc=0 if _n>1
replace cg_primary_source=3 if cg_primary_nsoc==1 & cg_primary_source==.
drop anychild child primsp mosthelped numprim
local v1 che1health che1painlmt che1brethlmt che1enrgylmt cca1hwoftpc ///
cca1hwofthom cca1hwoftshp cca1hwoftchs che1sleeptrb
local v2 self_health pain_lim_act breath_lim_act enrgy_lim_act ///
help_personal_care help_get_around help_shopping help_chores trb_back_sleep 
gen ever_enrgy=ever_low_enrgy
local v3 ever_pain ever_breath_prob ever_low_enrgy
forvalues i=1/9 {
	local va1=word("`v1'",`i')
	local va2=word("`v2'",`i')
	gen `va2'=`va1' if `va1'>0
	foreach x in pain breath enrgy {
	if "`va2'"=="`x'_lim_act" {
		replace `va2'=5 if ever_`x'==0
}
}
	gen `va2'_di=`va2'<4 if !missing(`va2')
}
drop ever_enrgy
local v1 cca1hlpbnkng cca1hlpmed cca1hlpmdapt cca1hlpspkdr cca1hlpordmd cca1hlpinsrn ///
cca1hlpothin cse1hlpgtdev cse1homsafer cse1hlppdhlp cca1hlpdiet cca1hlpfeet ///
cca1hlpskin cca1hlpexrcs cca1hlpteeth cca1hlpmdtk cca1hlpshot cse1frfamhlp cpp1wrk4pay ///
cdc1hlpsched cdc1hlpyrpls cec1wrk4pay
local v2 help_bills help_track_meds help_make_appts help_speak_doc help_order_med ///
help_insurance help_insurance_oth help_mob_dev help_home_safe help_paid_helpr ///
help_diet help_foot help_skin help_exercise help_teeth help_medical_task ///
help_shots_injection friend_help work_4_pay help_regular_sched help_longer_than_yr ///
paid_last_week

local vn : word count `v1'
forvalues i=1/`vn' {
	local va1=word("`v1'",`i')
	local va2=word("`v2'",`i')
	gen `va2'=`va1'==1 if `va1'>0
}

gen paid_hours=cec1hrslstwk if cec1hrslstwk>0
replace paid_hours=0 if paid_last_week==0
gen paid_hours_cat=paid_hours>20 if !missing(paid_hours)
*replace paid_hours_cat=1 if paid_hours>20 if !missing(paid_hours)
replace paid_hours_cat=2 if paid_hours>=40 & !missing(paid_hours)

gen help_insurance_any=help_insurance if !missing(help_insurance)
replace help_insurance_any=1 if help_insurance_oth==1

local v1 cac1moreconf cac1dealbetr cac1closr2sp cac1moresat cac1exhaustd ///
cac1toomuch cac1notime cac1uroutchg
local v2 gain_more_conf gain_deal_better gain_closer2sp gain_more_satisfied ///
 neg_exhausted neg_too_much neg_no_time neg_no_routine
 
local vn : word count `v1'
forvalues i=1/`vn' {
	local va1=word("`v1'",`i')
	local va2=word("`v2'",`i')
	gen `va2'_di=`va1'<3 if `va1'>0
}

local v1 cac1diffinlv cac1diffemlv cac1diffphlv
local v2 diff_financial_lv diff_emotional_lv diff_physical_lv
local v3 cac1diffinc cac1diffemo cac1diffphy
local vn : word count `v1'
forvalues i=1/`vn' {
	local va1=word("`v1'",`i')
	local va2=word("`v2'",`i')
	local va3=word("`v3'",`i')
	gen `va2'=`va3'==1 if `va3'>0
	gen `va2'_di=`va1'>3 if !missing(`va2') & `va3'>-2
}

gen cg_ivw_month=c1intmonth if c1intmonth>0
gen cg_ivw_year=2011 if c1intmonth>0
gen cg_ivw_date=mdy(cg_ivw_month,1,cg_ivw_year)
gen cg_birth_year=chd1cgbrthyr if chd1cgbrthyr>0
gen cg_birth_month=chd1cgbrthmt if chd1cgbrthmt>0
gen cg_age=cg_ivw_year-chd1cgbrthyr if chd1cgbrthyr>0
replace cg_age=cg_age-1 if cg_ivw_month>=cg_birth_month
replace cg_age=op1age if cg_age==. & op1age>0
gen cg_age_cat=floor(((cg_age-20)/5)+2)
replace cg_age_cat=op1dage if op1dage>0 & cg_age_cat==.
replace cg_age_cat=op1cat if op1cat>0 & cg_age_cat==.
replace cg_age_cat=1 if cg_age_cat<1
replace cg_age_cat=16 if cg_age_cat>16 & !missing(cg_age_cat)


gen num_help_years=cdc1hlpyrs if cdc1hlpyrs>0
replace num_help_years=0 if cdc1hlpyrpls==2
replace num_help_years=cg_ivw_year-cdc1hlpyrst if cdc1hlpyrst>0 & num_help_years==.

/*note, why do we base it on the categorical from the OP?
gen cg_age_cat=op1dage if op1dage>0
replace cg_age_cat=cg_agecat if missing(cg_age_cat)*/
/*
gen felt_lit_interest=che1fltltlin>1 if che1fltltlin>0
gen felt_depressed=che1fltdown>1 if che1fltdown>0
gen felt_nervous=che1fltnervs>1 if che1fltnervs>0
gen felt_worry=che1fltworry>1 if che1fltworry>0
*/
local v1 che1fltltlin che1fltdown che1fltnervs che1fltworry
local v2 cg_depr_pqq1 cg_depr_pqq2 cg_depr_gad1 cg_depr_gad2
local v3 felt_lit_interest felt_depressed felt_nervous felt_worry
local vn : word count `v1'
forvalues i=1/`vn' {
	local va1=word("`v1'",`i')
	local va2=word("`v2'",`i')
	local va3=word("`v3'",`i')
	gen `va2'=`va1'-1 if `va1'>0
	gen `va3'=`va1'>1 if `va1'>0
}
gen cg_phq2_score=cg_depr_pqq1+cg_depr_pqq2
gen cg_gad2_score=cg_depr_gad1+cg_depr_gad2
gen cg_phq2_depressed=cg_phq2_score>=3 if !missing(cg_phq2_score)
gen cg_gad2_anxiety=cg_gad2_score>=3 if !missing(cg_gad2_score)
gen flag_no_help_mth=cca1hlplsty==1
gen solo_cg=n_helpers==1 if !missing(n_helpers)
gen solo_cg_fam=n_family_helpers==1 & op_family==1 if !missing(n_family_helpers)
gen solo_cg_informal=n_helpers-n_paid_helpers==1
gen cg_ivw_to_sp_death=death_date-cg_ivw_date
replace cg_ivw_to_sp_death=. if cg_ivw_to_sp_death<0 
gen cg_ivw_to_sp_death_mos=floor(cg_ivw_to_sp_death/30.4)
gen lives_in_hh=op1prsninhh==1
//code as living w/ if spouse and says lives w/ spouse
replace lives_in_hh=inlist(hh1dlvngarrg,2,3) if spouse==1 & lives_in_hh==0

//transportationboth cg and sp
gen cg_drive_sp=inlist(cca1hwoftdrv,1,2,3) if !missing(cca1hwoftdrv)
label var cg_drive_sp "Drove SP Some/Most/Everyday"
drop c1dgender c1relatnshp c1intmonth c1dintdays cca1hwoftchs cca1hwoftshp cca1hlpordmd cca1hlpbnkng cca1cmpgrcry cca1cmpordrx cca1cmpbnkng cca1hwoftpc cca1hwofthom cca1hlplft cca1hlpspt cca1hlpstd cca1hwoftlft cca1hwoftspt cca1hwoftstd cca1hwoftdrv cca1hwoftott cca1hlpmed cca1hlpshot cca1hlpmdtk cca1hlpexrcs cca1hlpdiet cca1hlpteeth cca1hlpfeet cca1hlpskin cca1hlpmdapt cca1hlpspkdr cca1hlpinsrn cca1hlpothin cca1hwget2sp cca1tm2spunt cca1tm2spmin cca1tm2sphrs cca1hlplstyr cca1lstmhlpd cdc1hlpsched cdc1hlpdyswk cdc1hlpdysmt cdc1hlphrsdy cdc1hlphrmvf cdc1hlphrlmt cdc1hlphrpc cdc1hlphrpce cdc1hlpyrpls cdc1hlpmthst cdc1hlpunit cdc1hlpyrs cdc1hlpyrst cdc1hlpyrs5p cac1joylevel cac1arguelv cac1spapprlv cac1nerveslv cac1moreconf cac1dealbetr cac1closr2sp cac1moresat cac1diffinc cac1diffemo cac1diffphy cac1diffinlv cac1diffemlv cac1diffphlv cac1fmlydisa cac1exhaustd cac1toomuch cac1notime cac1uroutchg cse1frfamtlk cse1frfamact cse1frfamhlp cse1spptgrp cse1srv2hlp cse1training cse1fndfnhlp cse1hwfnd1 cse1hwfnd2 cse1hwfnd3 cse1hwfnd4 cse1hwfnd5 cse1hwfnd6 cse1look4hlp cse1look1 cse1look2 cse1look3 cse1look4 cse1look5 cse1look6 cse1hlpgtdev cse1homsafer cse1hlppdhlp cpp1vstfrfam cpp1hlpkptvs cpp1impvst cpp1gorelgs cpp1hlpkptrl cpp1imprel cpp1prtgroup ccp1hlpkptgr cpp1impgroup cpp1go4fun cpp1hlpkptgo cpp1impgo cpp1wrk4pay cpp1hlpkptwk cpp1volun cpp1hlpkptvo cpp1careothr cpp1hlpkptca che1health che1hrtattck che1othheart che1highbld che1arthrits che1osteoprs che1diabetes che1lungdis che1cancer che1seeing che1hearing che1cncrskin che1cncrbrst che1cncrpros che1cncroth che1pain che1painlmt che1brethprb che1brethlmt che1armstr che1armlmt che1legstr che1leglmt che1lowenrgy che1enrgylmt che1sleeptrb che1sleepint che1weight che1heightft che1heightin che1lost10lb che1try2lose che1moodcher che1moodpcfl che1moodfull che1moodbord che1moodlone che1moodupst che1fltltlin che1fltdown che1fltnervs che1fltworry che1lifemng che1feelconf che1gaveup che1lifegood che1lifelone che1easychng che1rcvrqick chd1martstat chd1marendmt chd1marendyr chd1chldlvng chd1numchild chd1numchu18 chd1numinhh chd1educ chd1educsprt chd1cgbrthmt chd1spbrthmt cec1wrk4pay cec1ownbusns cec1unpdwrk cec1misswork cec1look4wrk cec1wrkmulti cec1hrsweek cec1hrslstwk cec1hrslast cec1hrswork cec1flexhrs cec1wrksched cec1msswrkmt cec1mswkvctn cec1mswksick cec1mswkhelp cec1mswkfmly cec1mswkpers cec1mswkunit cec1mswkhlph cec1mswkhlpd cec1wkhrperd cec1hlpafwk1 cec1hlpafwk2 cec1busntype cec1occuptn cec1worktype cec1occpdscr chi1medicare chi1medigap chi1medicaid chi1privinsr chi1tricare chi1uninsurd chi1insrtype chi1ownhome chi1chckacct chi1svgsacct chi1certdpst chi1retrplan chi1mutlfnds chi1income chi1inc200pv chi1inc100pv chi1inc400pv chi1paymeds chi1payinsur chi1paymbdvc chi1paysfty chi1payasdvc chi1payhmhlp chi1pay1000 chi1pay2000 chi1pay500 chi1gifttosp chi1gift500 chi1gift1000 chi1gift100 chi1fromsp chi1frsp500 chi1frsp1000 chi1frsp100 c1varstrat c1varunit w1cgfinwgt0 w1cgfinwgt1 w1cgfinwgt2 w1cgfinwgt3 w1cgfinwgt4 w1cgfinwgt5 w1cgfinwgt6 w1cgfinwgt7 w1cgfinwgt8 w1cgfinwgt9 w1cgfinwgt10 w1cgfinwgt11 w1cgfinwgt12 w1cgfinwgt13 w1cgfinwgt14 w1cgfinwgt15 w1cgfinwgt16 w1cgfinwgt17 w1cgfinwgt18 w1cgfinwgt19 w1cgfinwgt20 w1cgfinwgt21 w1cgfinwgt22 w1cgfinwgt23 w1cgfinwgt24 w1cgfinwgt25 w1cgfinwgt26 w1cgfinwgt27 w1cgfinwgt28 w1cgfinwgt29 w1cgfinwgt30 w1cgfinwgt31 w1cgfinwgt32 w1cgfinwgt33 w1cgfinwgt34 w1cgfinwgt35 w1cgfinwgt36 w1cgfinwgt37 w1cgfinwgt38 w1cgfinwgt39 w1cgfinwgt40 w1cgfinwgt41 w1cgfinwgt42 w1cgfinwgt43 w1cgfinwgt44 w1cgfinwgt45 w1cgfinwgt46 w1cgfinwgt47 w1cgfinwgt48 w1cgfinwgt49 w1cgfinwgt50 w1cgfinwgt51 w1cgfinwgt52 w1cgfinwgt53 w1cgfinwgt54 w1cgfinwgt55 w1cgfinwgt56 chd1cgbrthyr chd1spbrthyr op1dnsoc m1 wave opishelper_allw yearnotmonth disab justone numact oneact spouse otherrel nonrel daughter son oth_fam op_adl_insd op_adl_bed op_adl_eat op_adl_bath op_adl_toil op_adl_dres op_iadl_laun op_iadl_shop op_iadl_meal op_iadl_bank op_iadl_meds regular impute_cat op_hrsmth_i paid rc_staff primary_cg max_hrs_helped num_primary_cg prim_helper_cat op_relationship_cat tot_hrsmonth_help_i n_helpers tot_hrswk_help_i op_family n_family_helpers ind_family_helper n_paid_helpers ind_paid_helper ind_rc_staff num_helpers_cat phrs tot_hrsmonth_paid_i tot_hrswk_paid_i op_hrswk_i m2 fl1dnsoc fl1dnsoccnt fl1dcgphncnt fl1dcgadonly fl1dnsoccomp m3 op1proxy op1relatnshp op1gender op1spouprtnr op1leveledu op1prsninhh op1childinhh op1dage op1chnotinhh op1martlstat op1numchldrn op1anychdu18 op1numchdu18 op1soclntwrk op1dcatgryag op1dsocwrkfl op1outhlp op1insdhlp op1bedhlp op1tkplhlp1 op1tkplhlp2 op1launhlp op1shophlp op1mealhlp op1bankhlp op1moneyhlp op1eathlp op1bathhlp op1toilhlp op1dreshlp op1medshlp op1dochlp op1dochlpmst op1insurhlp op1spcaredfr op1chhlpfin op1hlpchfin op1ishelper op1helpsched op1numdayswk op1numdaysmn op1numhrsday op1paidhelpr op1sppayshlp op1govpayhlp op1inspayhlp op1othpayhlp op1payunit op1hourlypay op1weeklypay op1monthlypy op1progmpaid op1dhrsmth op1contctflg op1dflmiss op1dmissadd op1dprobdup op1ddupeid m4 r1dresid r1dresidr r1breakoffst r1breakoffqt is1resptype is1reasnprx1 is1reasnprx2 is1reasnprx3 is1reasnprx4 is1reasnprx5 is1reasnprx6 is1reasnprx9 r1dgender r1d2intvrage is1prxyrelat is1prxygendr is1famrrutin is1dproxyid re1resistrct re1bldgfl re1dcensdiv fl1structure fl1bldgfl hc1health hc1disescn1 hc1disescn2 hc1disescn3 hc1disescn4 hc1disescn5 hc1disescn6 hc1disescn7 hc1disescn8 hc1disescn9 hc1disescn10 hc1cancerty1 hc1dementage hc1brokebon1 hc1brokebon2 hc1serdisill hc1hosptstay hc1hosovrnht hc1kneesurg hc1knesrgyr hc1ageknesur hc1hipsurg hc1hipsrgyr hc1agehipsur hc1catarsurg hc1catrsrgyr hc1agecatsur hc1bckspnsur hc1backsrgyr hc1agebcksrg hc1heartsurg hc1hartsrgyr hc1agehrtsrg hc1fllsinmth hc1worryfall hc1worrylimt hc1faleninyr hc1multifall hc1depresan1 hc1depresan2 hc1depresan3 hc1depresan4 hc1aslep30mn hc1trbfalbck hc1sleepmed ht1longlived ht1mthslived ht1yrslived ht1longer5yr ht1placedesc ht1retiresen ht1diffareun ht1helpmedbd ht1meals ht1spacename fl1facility fl1hotype fl1retirecom se1servcoff1 se1servcoff2 se1servcoff3 se1servcoff4 se1servcoff5 se1servcoff6 se1servcoff7 se1servcoff8 se1servcoff9 se1servused1 se1servused2 se1servused3 se1servused4 se1servused5 se1servused6 se1servused7 se1servused8 se1servused9 se1payservi1 se1payservi2 se1payservi3 se1payservi4 se1payservi5 se1payservi6 se1payservi7 se1payservi8 se1payservi9 hh1martlstat hh1yrendmarr hh1yrsmarliv hh1spgender hh1d2spouage hh1spouseduc hh1spoupchlp hh1livwthspo hh1placekind hh1proxlivsp hh1othlvhere hh1dspouseid hh1dlvngarrg hh1dhshldnum hh1dhshldchd cs1dreconcil cs1sistrsnum cs1brthrsnum cs1dnumchild cs1dnmstpchd cs1dnumdaugh cs1dnumson sn1dnumsn fl1noonetalk ho1entrstair ho1entrccomn ho1entrnramp ho1bldgamen1 ho1bldgamen2 ho1bldgamen3 ho1bldgamen4 ho1levelsflr ho1homeamen1 ho1homeamen2 ho1homeamen3 ho1bathprivt ho1bathamen1 ho1bathamen2 ho1bathamen3 ho1bathamen4 ho1bathamen5 ho1bathamen6 ho1bathamen7 ho1kitchnprv ho1kitchncom ho1microwave fl1onefloor fl1bathgrbbr fl1bathseat fl1raisedtlt fl1tltgrbbr em1modhere1 em1addlstyr1 em1addlstyr2 em1addlstyr3 em1addlstyr4 em1addlstyr5 em1addlstyr6 em1addlstyr7 em1payyufam1 em1payyufam2 em1payyufam3 em1payyufam4 em1payyufam5 em1payyufam6 em1payyufam7 em1paydevce1 em1paydevce2 em1paydevce3 em1paydevce4 em1paydevce5 em1paydevce6 em1paydevce7 em1paydevce8 em1paydevce9 em1payaltgth em1morls1000 em1morls100 cm1knowwell cm1willnghlp cm1peoptrstd te1cellphone te1othrphone te1computer te1compoth te1emailtext te1oftnemail te1online te1shoponli1 te1shoponli2 te1shoponli3 te1intrntmd1 te1intrntmd2 te1intrntmd3 md1canewlker md1cane md1walker md1wheelchar md1whelcrspc md1scooter md1scterinsp fl1cane fl1walker fl1wheelchr fl1whlchrhom fl1scooter fl1scooterhm ss1heringaid ss1hearphone ss1convwradi ss1convquiet ss1glasseswr ss1seewellst ss1seestvgls ss1glasscls ss1othvisaid ss1glrednewp ss1probchswl ss1probspeak ss1painbothr ss1painlimts ss1painmedof ss1painwhe1 ss1painwhe2 ss1painwhe3 ss1painwhe4 ss1painwhe5 ss1painwhe6 ss1painwhe7 ss1painwhe8 ss1painwhe9 ss1painwhe10 ss1painwhe11 ss1painwhe12 ss1painwhe13 ss1probbreat ss1prbbrlimt ss1strnglmup ss1uplimtact ss1lwrbodstr ss1lwrbodimp ss1lowenergy ss1loenlmtat ss1prbbalcrd ss1prbbalcnt pc1walk6blks pc1walk3blks pc1up20stair pc1up10stair pc1car20pnds pc1car10pnds pc1geonknees pc1bendover pc1hvobovrhd pc1rechovrhd pc1opnjarwhd pc1grspsmobj cp1memrygood cp1knownspyr cp1chgthink1 cp1chgthink2 cp1chgthink3 cp1chgthink4 cp1chgthink5 cp1chgthink6 cp1chgthink7 cp1chgthink8 cp1memcogpr1 cp1memcogpr2 cp1memcogpr3 cp1memcogpr4 cg1speaktosp cg1quesremem cg1reascano1 cg1reascano2 cg1reascano3 cg1reascano4 cg1reascano5 cg1reascano6 cg1reascano7 cg1reascano8 cg1reascano9 cg1ratememry cg1ofmemprob cg1memcom1yr cg1todaydat1 cg1todaydat2 cg1todaydat3 cg1todaydat4 cg1todaydat5 cg1prewrdrcl cg1dwrdlstnm cg1wrdsrcal1 cg1wrdsrcal2 cg1wrdsrcal3 cg1wrdsrcal4 cg1wrdsrcal5 cg1wrdsrcal6 cg1wrdsrcal7 cg1wrdsrcal8 cg1wrdsrcal9 cg1wrdsrca10 cg1dwrdimmrc cg1dwrdinone cg1dwrdirref cg1wrdsntlst cg1numnotlst cg1probreca1 cg1probreca2 cg1probreca3 cg1probreca4 cg1dclkdraw cg1dclkimgcl cg1atdrwclck cg1presidna1 cg1presidna2 cg1presidna3 cg1presidna4 cg1vpname1 cg1vpname2 cg1vpname3 cg1vpname4 cg1wrdsdcal1 cg1wrdsdcal2 cg1wrdsdcal3 cg1wrdsdcal4 cg1wrdsdcal5 cg1wrdsdcal6 cg1wrdsdcal7 cg1wrdsdcal8 cg1wrdsdcal9 cg1wrdsdca10 cg1dwrddlyrc cg1dwrddnone cg1dwrddrref cg1wrdnotlst cg1numwrdnot cg1dwrd1rcl cg1dwrd2rcl cg1dwrd3rcl cg1dwrd4rcl cg1dwrd5rcl cg1dwrd6rcl cg1dwrd7rcl cg1dwrd8rcl cg1dwrd9rcl cg1dwrd10rcl cg1dwrd1dly cg1dwrd2dly cg1dwrd3dly cg1dwrd4dly cg1dwrd5dly cg1dwrd6dly cg1dwrd7dly cg1dwrd8dly cg1dwrd9dly cg1dwrd10dly mo1outoft mo1outcane mo1outwalkr mo1outwlchr mo1outsctr mo1outhlp mo1outslf mo1outdif mo1outyrgo mo1outwout mo1oftgoarea mo1oflvslepr mo1insdcane mo1insdwalkr mo1insdwlchr mo1insdsctr mo1oftholdwl mo1insdhlp mo1insdslf mo1insddif mo1insdyrgo mo1insdwout mo1beddev mo1bedhlp mo1bedslf mo1beddif mo1bedwout mo1doutsfdf mo1doutdevi mo1douthelp mo1dinsdsfdf mo1dinsddevi mo1dinsdhelp mo1dbedsfdf mo1dbeddevi mo1dbedhelp fl1didntleav fl1ntlvrmslp dm1helpmobil dm1helpyrmor dm1yrsgethlp dm1mthgethlp dm1lstyrcane dm1caneforyr dm1yrsuscane dm1mtfrtcane dm1mobhelp65 dm1snc65mohl dm1at65uscan dm1snc65uscn dm1dhlpyr dm1dhlpst dm1dhlpend dm1dhlpyrs dm1ddeviyr dm1ddevist dm1ddeviend dm1ddeviyrs dt1oftedrive dt1lastdrove dt1mthltdrov dt1yrlstdrov dt1mthagodrv dt1yragoldrv dt1ageltdrov dt1avoidriv1 dt1avoidriv2 dt1avoidriv3 dt1avoidriv4 dt1getoplcs1 dt1getoplcs2 dt1getoplcs3 dt1getoplcs4 dt1getoplcs5 dt1getoplcs6 dt1getoplcs7 dt1otfrfamtk fl1drives fl1drvlstyr ha1laun ha1launslf ha1whrmachi1 ha1whrmachi2 ha1whrmachi3 ha1whrmachi4 ha1whrmachi5 ha1whrmachi6 ha1dlaunreas ha1laundif ha1launoft ha1launwout ha1shop ha1shopslf ha1howpaygr1 ha1howpaygr2 ha1howpaygr3 ha1howpaygr4 ha1howpaygr5 ha1howpaygr6 ha1howpaygr7 ha1howgtstr1 ha1howgtstr2 ha1howgtstr3 ha1howgtstr4 ha1howgtstr5 ha1howgtstr6 ha1howgtstr7 ha1howgtstr8 ha1shopcart ha1shoplean ha1dshopreas ha1shopdif ha1shopoft ha1shopwout ha1meal ha1mealslf ha1restamels ha1oftmicrow ha1dmealreas ha1mealdif ha1mealoft ha1mealwout ha1bank ha1bankslf ha1dbankreas ha1bankdif ha1bankoft ha1bankwout ha1money ha1moneyhlp ha1dlaunsfdf ha1dshopsfdf ha1dmealsfdf ha1dbanksfdf ha1dmealwhl ha1dmealtkot sc1eatdev sc1eatdevoft sc1eathlp sc1eatslfoft sc1eatslfdif sc1eatwout sc1showrbat1 sc1showrbat2 sc1showrbat3 sc1prfrshbth sc1scusgrbrs sc1shtubseat sc1bathhlp sc1bathoft sc1bathdif sc1bathyrgo sc1bathwout sc1usvartoi1 sc1usvartoi2 sc1usvartoi3 sc1usvartoi4 sc1toilhlp sc1toiloft sc1toildif sc1toilwout sc1dresoft sc1dresdev sc1dreshlp sc1dresslf sc1dresdif sc1dresyrgo sc1dreswout sc1deatdevi sc1deathelp sc1deatsfdf sc1dbathdevi sc1dbathhelp sc1dbathsfdf sc1dtoildevi sc1dtoilhelp sc1dtoilsfdf sc1ddresdevi sc1ddreshelp sc1ddressfdf fl1showering fl1takingbth fl1washingup ds1gethlpeat ds1hlpmrtnyr ds1yrsgethlp ds1mthgethlp ds1gthptrn65 ds1gthpsin65 ds1dhlpyr ds1dhlpst ds1dhlpend ds1dhlpyrs mc1meds mc1medstrk mc1medsslf mc1whrgtmed1 mc1whrgtmed2 mc1whrgtmed3 mc1whrgtmed4 mc1howpkupm1 mc1howpkupm2 mc1howpkupm3 mc1medsrem mc1dmedsreas mc1medsdif mc1medsyrgo mc1medsmis mc1havregdoc mc1regdoclyr mc1hwgtregd1 mc1hwgtregd2 mc1hwgtregd3 mc1hwgtregd4 mc1hwgtregd5 mc1hwgtregd6 mc1hwgtregd7 mc1hwgtregd8 mc1hwgtregd9 mc1ansitindr mc1tpersevr1 mc1tpersevr2 mc1tpersevr3 mc1tpersevr4 mc1chginspln mc1anhlpwdec mc1dmedssfdf pa1vistfrfam pa1hlkepfvst pa1trkpfrvis pa1impvstfam pa1attrelser pa1htkfrrlsr pa1trprrelsr pa1imprelser pa1clbmtgrac pa1hlkpfrclb pa1trprkpfgr pa1imparclub pa1outfrenjy pa1hlkpgoenj pa1trprgoout pa1impouteny pa1workfrpay pa1hlkpfrwrk pa1voltrwork pa1hlkpfrvol pa1prcranoth pa1evrgowalk pa1vigoractv pa1helmfvact pa1dfavact sd1smokedreg sd1smokesnow sd1numcigday sd1agesrtsmk sd1agelstsmk pe1whhndsign pe1surghdwrt pe1surgyside pe1flruppain pe1sideflrup pe1surgarmsh pe1sidsurgar pe1surgyhips pe1sidhipsrg pe1stndwhold pe1upchbyslf pe1wlkdsself fl1lefthand fl1righthand fl1eiherhand fl1lftgrptst fl1rhtgrptst fl1charstnds fl1balstands fl1wlkingrse ba1dblssadm ba1dblstadm ba1dblftadm ba1dblopadm ba1dblcladm wa1dwlkadm ch1dschradm ch1drchradm gr1dgripadm wc1dwaistadm pk1dpeakadm ab1datemonth ab1dateyear in1strtabhrs in1strtabmin in1strtmampm ba1sxsresult ba1blstdsecs ba1blstdhndr ba1rsn1ssstd ba1rsn2ssstd ba1rsn3ssstd ba1rsn4ssstd ba1rsn9ssstd ba1stdmreslt ba1stdmsecs ba1stdmhndr ba1rsn1ststd ba1rsn2ststd ba1rsn3ststd ba1rsn4ststd ba1rsn9ststd ba1ftdmreslt ba1ftdmsecs ba1ftdmhndr ba1rsn1ftstd ba1rsn2ftstd ba1rsn3ftstd ba1rsn4ftstd ba1rsn9ftstd ba11leoreslt ba11leosfsec ba11leohndr ba1rsn11leo ba1rsn21leo ba1rsn31leo ba1rsn41leo ba1rsn91leo ba11lecreslt ba11lecsfsec ba11lechndr ba1rsn11lec ba1rsn21lec ba1rsn31lec ba1rsn41lec ba1rsn91lec wa1wlkcorspc wa1wkaidused wa1wlkc1rslt wa1wlkc1secs wa1wlk1hndr wa1rsn11wkc wa1rsn21wkc wa1rsn31wkc wa1rsn41wkc wa1rsn51wkc wa1rsn91wkc wa1wkaidusc2 wa1wlkc2rslt wa1wlkc2secs wa1wlk2hndr wa1rsn12wkc wa1rsn22wkc wa1rsn32wkc wa1rsn42wkc wa1rsn92wkc ch1chravail ch1chstcompl ch1chairheit ch1whlchrusd ch1sgchstres ch1armuse ch1rsn11chs ch1rsn21chs ch1rsn31chs ch1rsn41chs ch1rsn51chs ch1rsn91chs ch12chstrslt ch1chstndsec ch1chstdhndr ch1chstddone ch1chstntdn1 ch1chstntdn2 ch1chstntdn3 ch1chstntdn4 ch1chstntdn5 ch1chstntdn9 ch1chstntat1 ch1chstntat2 ch1chstntat3 ch1chstntat4 ch1chstntat9 gr1handtstd1 gr1adjgr1ps3 gr1grp1reslt gr1grp1rdng gr1grp1noat1 gr1grp1noat2 gr1grp1noat3 gr1grp1noat4 gr1grp1noat9 gr1handtstd2 gr1adjgr2ps3 gr1grp2reslt gr1grp2rdng gr1grp2noat1 gr1grp2noat2 gr1grp2noat3 gr1grp2noat4 gr1grp2noat9 wc1measdiff1 wc1measdiff2 wc1measdiff3 wc1measdiff4 wc1measdiff5 wc1measdiff6 wc1measdiff9 wc1waistrslt wc1wstmsrinc wc1wstmsrqrt wc1wstbulkcl wc1whomeasur wc1wstpostn wc1wstnotat1 wc1wstnotat2 wc1wstnotat3 wc1wstnotat4 wc1wstnotat5 wc1wstnotat9 pk1pkarf1pos pk1pkarfl1ef pk1pkarfl1rs pk1pkarfl1rd pk1pk1noatt1 pk1pk1noatt2 pk1pk1noatt3 pk1pk1noatt4 pk1pk1noatt9 pk1paf2posit pk1pkafl3eff pk1pkarfl2rs pk1pkarfl2rd pk1pk2noatt1 pk1pk2noatt2 pk1pk2noatt3 pk1pk2noatt4 pk1pk2noatt9 cl1endtimhrs cl1endtimmin cl1endtmampm r1dnhatssppb r1dnhatsbasc r1dnhatswksc r1dnhatschsc r1dnhatsgrav r1dnhatsgrb r1dnhatspkav r1dnhatspkb r1dsppbmiss r1dorigsppb r1dorigbasc r1dorigwksc r1dorigchsc hw1currweigh hw1weighat50 hw1lst10pnds hw1trytolose hw1howtallft hw1howtallin hw1tal50feet hw1tal50inch el1borninus el1hlthchild el1fingrowup el1lvbhpar15 el1lvwmofaor el1higstschl el1mothalive el1fathalive el1dage2us el1dsameres rl1condspanh rl1spkothlan rl1unspokeng rl1spkengwel rl1dracehisp va1serarmfor va1memnatgrd wb1offelche1 wb1offelche2 wb1offelche3 wb1offelche4 wb1truestme1 wb1truestme2 wb1truestme3 wb1truestme4 wb1ageyofeel wb1agrwstmt1 wb1agrwstmt2 wb1agrwstmt3 ip1covmedcad ip1otdrugcov ip1mgapmedsp ip1cmedicaid ip1covtricar ip1nginsnurs ip1typcarco1 ip1typcarco2 ip1typcarco3 ip1paypremms ip1longhadpl ip1numyears ip1agepurpol lf1workfpay lf1abstlstwk lf1wrkplstmn lf1mrthnonjb lf1hrswkwork lf1hrwrkltwk lf1hrwrklstw lf1oftpaid lf1lstpaychk lf1pychkamnt lf1perhrpay lf1perdaypay lf1ernfrmwrk lf1occupaton lf1doccpctgy lf1diffwrknw lf1huswifwrk lf1huwpaearn hp1ownrentot hp1mrtpadoff hp1mthlymort hp1mortpaymt hp1whnpayoff hp1amtstlowe hp1amoutowed hp1homevalue hp1homvalamt hp1payrent hp1rentamt hp1rentamout hp1sec8pubsn ia1recsspa1 ia1recsspa2 ia1recsspa3 ia1howrecssp ia1recssils1 ia1recssils2 ia1recssils3 ia1rvapayls1 ia1rvapayls2 ia1rvapayls3 ia1penjobou1 ia1penjobou2 ia1penjobou3 ia1iraothac1 ia1iraothac2 ia1iraothac3 ia1mutfdstk1 ia1mutfdstk2 ia1mutfdstk3 ia1mutfdstk4 ia1ownbond1 ia1ownbond2 ia1ownbond3 ia1ownbond4 ia1bnkacccd1 ia1bnkacccd2 ia1bnkacccd3 ia1bnkacccd4 ia1bnkacccd5 ia1bnkacccd6 ia1bnkacccd7 ia1bnkacccd8 ia1bnkacccd9 ia1bnkaccc10 ia1bnkaccc11 ia1bnkaccc12 ia1realestt1 ia1realestt2 ia1realestt3 ia1realestt4 ia1ssrrpymnt ia1ssrrjtamt ia1ssrrjtest ia1ssrrspamt ia1ssrrspest ia1ssrrptamt ia1ssrrptest ia1ssipymnt ia1ssijtamt ia1ssijtest ia1ssispamt ia1ssispest ia1ssiptamt ia1ssiptest ia1vapymnt ia1vajtamt ia1vajtest ia1vaspamt ia1vaspest ia1vaptamt ia1vaptest ia1penpymt ia1penjtamt ia1penjtest ia1penspamt ia1penspest ia1penptamt ia1penptest ia1retworth ia1retjtwrt ia1retjtest ia1retspwrt ia1retspest ia1retptwrt ia1retptest ia1rtlmwdrw ia1rtlmjtwdr ia1rtlmjtest ia1rtlmspwdr ia1rtlmspest ia1rtlmptwdr ia1rtlmptest ia1rtyrwdrw ia1rtyrjtamt ia1rtyrjtest ia1rtyrspamt ia1rtyrspest ia1rtyrptamt ia1rtyrptest ia1skbdwrth ia1skbdjtwrt ia1skbdjtest ia1bndjtest ia1skbdspwrt ia1skbdspest ia1bndspest ia1skbdptwrt ia1skbdptest ia1bndptest ia1bkcdwrth ia1bkcdjtwrt ia1bkcdjtest ia1bnkjtest ia1bkcdspwrt ia1bkcdspest ia1bnkspest ia1bkcdptwrt ia1bkcdptest ia1bnkptest ia1itdvinc ia1itdvjtamt ia1itdvjtest ia1itdvspamt ia1itdvspest ia1itdvptamt ia1itdvptest ia1brewrt ia1brejtwrt ia1brejtest ia1brespwrt ia1brespest ia1breptwrt ia1breptest ia1breiinc ia1breijtamt ia1breijtest ia1breispamt ia1breispest ia1breiptamt ia1breiptest ia1totinc ia1toincimf ia1toincim1 ia1toincim2 ia1toincim3 ia1toincim4 ia1toincim5 ia1toincesjt ia1eincimjf ia1eincimj1 ia1eincimj2 ia1eincimj3 ia1eincimj4 ia1eincimj5 ia1toincessg ia1eincimsf ia1eincims1 ia1eincims2 ia1eincims3 ia1eincims4 ia1eincims5 co1owncartrv co1manyvhcls co1valuevehi co1vehivalue ew1pycredbal ew1crecardeb ew1credcdmed ew1amtcrdmed ew1medpaovtm ew1ampadovrt ew1finhlpfam ew1whohelfi1 ew1whohelfi2 ew1atchhelyr ew1fingftfam ew1whregoth1 ew1whregoth2 ew1whregoth3 ew1amthlpgiv ew1progneed1 ew1progneed2 ew1progneed3 ls1evdayact1 ls1evdayact2 ls1evdayact3 ls1evdayact4 ls1evdayact5 ls1evdayact6 ls1evdayact7 ls1evdayact8 ls1ableto1 ls1ableto2 ls1ableto3 ls1ableto4 ls1ableto5 ls1ableto6 ls1ableto7 ls1diskefrm1 ls1diskefrm2 ls1diskefrm3 ls1diskefrm4 ls1diskefrm5 ls1diskefrm6 ls1diskefrm7 ir1spattitud ir1undrstand ir1sppresent ir1intvwhlp ir1prsnhlp1 ir1prsnhlp2 ir1prsnhlp3 ir1prsnhlp4 ir1prsnhlp5 ir1prsnhlp6 ir1prsnhlp91 ir1sessions ir1sessrsn1 ir1sessrsn2 ir1sessrsn3 ir1sessrsn91 ir1conhomapt ir1insidhome ir1condihom1 ir1condihom2 ir1condihom3 ir1condihom4 ir1condihom5 ir1clutterr1 ir1clutterr2 ir1areacond1 ir1areacond2 ir1areacond3 ir1areacond4 ir1condhome1 ir1condhome2 ir1condhome3 ir1condhome4 ir1condhome5 ir1fqphnprsn fq1dfacdescr fq1dosfacd fq1prtlivnam fq1dfacarea fq1dosfaca fq1assdnrsng fq1othrlevls fq1whotlevl1 fq1whotlevl2 fq1whotlevl3 fq1whotlevl4 fq1whotlevl5 fq1servaval1 fq1servaval2 fq1servaval3 fq1servaval4 fq1servaval5 fq1servaval6 fq1servaval7 fq1servaval8 fq1servaval9 fq1paysourc1 fq1paysourc2 fq1paysourc3 fq1paysourc4 fq1paysourc5 fq1paysourc6 fq1totalpaym fq1mnthlyamt fq1primpayer fq1govsource fq1dlocsp w1anfinwgt0 w1anfinwgt1 w1anfinwgt2 w1anfinwgt3 w1anfinwgt4 w1anfinwgt5 w1anfinwgt6 w1anfinwgt7 w1anfinwgt8 w1anfinwgt9 w1anfinwgt10 w1anfinwgt11 w1anfinwgt12 w1anfinwgt13 w1anfinwgt14 w1anfinwgt15 w1anfinwgt16 w1anfinwgt17 w1anfinwgt18 w1anfinwgt19 w1anfinwgt20 w1anfinwgt21 w1anfinwgt22 w1anfinwgt23 w1anfinwgt24 w1anfinwgt25 w1anfinwgt26 w1anfinwgt27 w1anfinwgt28 w1anfinwgt29 w1anfinwgt30 w1anfinwgt31 w1anfinwgt32 w1anfinwgt33 w1anfinwgt34 w1anfinwgt35 w1anfinwgt36 w1anfinwgt37 w1anfinwgt38 w1anfinwgt39 w1anfinwgt40 w1anfinwgt41 w1anfinwgt42 w1anfinwgt43 w1anfinwgt44 w1anfinwgt45 w1anfinwgt46 w1anfinwgt47 w1anfinwgt48 w1anfinwgt49 w1anfinwgt50 w1anfinwgt51 w1anfinwgt52 w1anfinwgt53 w1anfinwgt54 w1anfinwgt55 w1anfinwgt56 w1varstrat w1varunit m5 r1dbirthmth r1dbirthyr r2dintvwrage hh2mthendmar hh2modob hh2yrdob hh2dspousage hh2dmodoball hh2dyrdoball hh2spageall r2ddeathage pd2mthdied pd2yrdied m6 death_date death_month death_year m7 startsnow


foreach x of varlist * {
if "`x'"!="opid" {
destring `x', replace
replace `x'=. if `x'<0
}
}
save "E:\nhats\data\NHATS cleaned\nsoc_round_1.dta", replace
/*
gen mine=1
append using "E:\nhats\data\Projects\Caregivers\nsoc_FULL.dta"

foreach x of varlist * {
if "`x'"!="spid" & "`x'"!="opid" {
duplicates tag spid opid `x', gen(dup)
sum dup
if r(sd)==0 &r(mean)==1 {
drop `x'
}
drop dup
}
}


H="NSOC Round II Setup Stata"
clear all
set more off
capture log close

cd "E:\nhats\data\NHATS Sensitive\r5_sensitive"

use NSOC_Round_5_File.dta

merge 1:1 spid opid using NSOC_Round_5_OP_Tracker_File.dta, gen(m1) keep(match master)
merge 1:1 spid opid using NHATS_Round_5_OP_Sen_Dem_File.dta, gen(m8) keep(match master)
merge 1:m spid opid using "E:\nhats\data\NHATS cleaned\op_round_1_5.dta", gen(m2) keep(match master)
keep if wave==1
merge m:1 spid using NSOC_Round_5_SP_Tracker_File.dta, gen(m3) keep(match master)
tostring opid, replace
merge 1:1 spid opid using "E:\nhats\data\NHATS Public\round_5\NHATS_Round_5_OP_File.dta", ///
gen(m4) keep(match master)
merge m:1 spid using "E:\nhats\data\NHATS Public\round_5\NHATS_Round_5_SP_File.dta", ///
gen(m5) keep(match master)
*merge m:1 spid using "E:\nhats\data\NHATS Sensitive\r2_sensitive\NHATS_Round_2_SP_Sen_Dem_File.dta", ///
*gen(m6) keep(match master) 
merge m:1 spid wave using "E:\nhats\data\NHATS cleaned\sp_round_1_5.dta", gen(m7) ///
keep(match master) keepusing(death*)

*15:45 1/25/2017
gen cgfinwgt=w5cgfinwgt0
gen cgvarunit=c5varunit
gen cgvarstrat=c5varstrat
gen startsnow=.
gen cg_female=c5dgender==2
gen cg_spouse=c5relatnshp==2
gen cg_relationship_cat=cg_spouse
replace cg_relationship_cat=2 if c5relatnshp>=3 & c5relatnshp<=8
replace cg_relationship_cat=3 if cg_relationship_cat==0
gen cg_relationship_cat1=cg_relationship_cat
replace cg_relationship_cat1=2 if inlist(c5relatnshp,3,5,7)
replace cg_relationship_cat1=3 if inlist(c5relatnshp,4,6,8)
replace cg_relationship_cat1=4 if (c5relatnshp>=9 & c5relatnshp<=29) | ///
 c5relatnshp==91
replace c5relatnshp=5 if (c5relatnshp>=30 & c5relatnshp==92)
gen total_hours_day=cdc5hlphrsdy
gen total_days_week=cdc5hlpdyswk
gen total_days_month=cdc5hlpdysmt 
gen total_hours_other=cdc5hlphrlmt
gen other_flag=cdc5hlphrmvf!=1

foreach x in hours_day days_week days_month hours_other {
	replace total_`x'=. if total_`x'<0
}
gen total_hours=total_days_week*total_hours_day*(52/12) if cdc5hlpsched==1
replace total_hours=total_days_month*total_hours_day if missing(total_hours)
replace total_hours=total_hours_other if other_flag==1
gen total_hours_week=total_hours/(52/12)

gen any_living_children_sp=cs5dnumchild>0
gen any_living_children_cg=chd5chldlvng if chd5chldlvng==1
replace any_living_children_cg=0 if chd5chldlvng==2
gen cg_living_children=any_living_children_sp if cg_spouse==1
replace cg_living_children=any_living_children_cg if cg_spouse!=1
drop any_living*

gen cg_marital_status=hh5martlstat if cg_spouse==1
replace cg_marital_status=chd5martstat if cg_spouse==0
replace cg_marital_status=op5martlstat if cg_marital_status==.
gen cg_marr_part_ind=cg_marital_status<3 if !missing(cg_marital_status)

gen cg_total_in_hh=hh5dhshldnum if cg_spouse==1
replace cg_total_in_hh=chd5numinhh if cg_spouse==0
replace cg_total_in_hh=. if cg_total_in_hh<0

gen cg_educ=op5leveledu if cg_spouse==1
replace cg_educ=chd5educ if cg_spouse==0
replace cg_educ=. if cg_educ<0
gen cg_gt_hs=cg_educ>=4 if !missing(cg_educ)

gen cg_medicare=chi5medicare==1 if inlist(chi5medicare,1,2)
gen cg_lives_with_sp=hh5livwthspo if cg_spouse==1
replace cg_lives_with_sp=op5prsninhh if cg_spouse==0
replace cg_lives_with_sp=. if cg_lives_with_sp<0
replace cg_lives_with_sp=0 if cg_lives_with_sp==2
gen cg_medicaid=chi5medicaid==1 if chi5medicaid>0
gen ever_heart_attack=che5hrta==1 if che5hrta>0
gen ever_heart_disease=che5othheart==1 if che5othheart>0
gen ever_arthritis=che5arthrits==1 if che5arthrits>0
gen ever_diabetes=che5diabetes==1 if che5diabetes>0
gen ever_lung_dis=che5lungdis==1 if che5lungdis>0
gen ever_cancer=che5cancer==1 if che5cancer>0
gen ever_pain=che5pain==1 if che5pain>0
gen ever_breath_prob=che5brethprb==1 if che5brethprb>0
gen ever_low_enrgy=che5lowenrgy==1 if che5lowenrgy>0
gen ever_high_bp=che5highbld==1 if che5highbld>0
gen lost_10_lbs_yr=che5lost10lb==1 if che5lost10lb>0
gen ever_osteoperosis=che5osteoprs==1 if che5osteoprs>0
gen ever_diff_seeing=che5seeing==1 if che5seeing>0
gen ever_diff_hearing=che5hearing==1 if che5hearing>0

gen cg_srh=che5health if che5health>0
gen cg_srh_pf=inlist(cg_srh, 4,5) if !missing(cg_srh)

by spid, sort: egen mosthelped=max(total_hours)
gen cg_primary_nsoc=total_hours==mosthelped
by spid cg_primary_nsoc, sort: gen numprim=_N if cg_primary_nsoc==1
gen cg_primary_source=1 if numprim==1
gen primsp=1 if numprim==2 & cg_spouse==1 & cg_primary_nsoc==1
sum spid if primsp==1
replace cg_primary_source=2 if primsp==1
replace cg_primary_nsoc=0 if spid==r(mean) & primsp==.
gen child=inlist(c5relatnshp,3,4) if cg_primary_nsoc==1 & numprim==2
by spid cg_primary_nsoc, sort: egen anychild=max(child)
replace cg_primary_nsoc=0 if anychild==1 & child==0
by spid cg_primary_nsoc, sort: replace numprim=_N if cg_primary_nsoc==1
replace cg_primary_source=2 if child==1 & anychild==1 & numprim==1
gsort spid -cg_primary_nsoc -op_hrsm
by spid: replace cg_primary_nsoc=0 if _n>1
replace cg_primary_source=3 if cg_primary_nsoc==1 & cg_primary_source==.
drop anychild child primsp mosthelped numprim
local v1 che5health che5painlmt che5brethlmt che5enrgylmt cca5hwoftpc ///
cca5hwofthom cca5hwoftshp cca5hwoftchs che5sleeptrb
local v2 self_health pain_lim_act breath_lim_act enrgy_lim_act ///
help_personal_care help_get_around help_shopping help_chores trb_back_sleep 
gen ever_enrgy=ever_low_enrgy
local v3 ever_pain ever_breath_prob ever_low_enrgy
forvalues i=1/9 {
	local va1=word("`v1'",`i')
	local va2=word("`v2'",`i')
	gen `va2'=`va1' if `va1'>0
	foreach x in pain breath enrgy {
	if "`va2'"=="`x'_lim_act" {
		replace `va2'=5 if ever_`x'==0
}
}
	gen `va2'_di=`va2'<4 if !missing(`va2')
}
drop ever_enrgy
local v1 cca5hlpbnkng cca5hlpmed cca5hlpmdapt cca5hlpspkdr cca5hlpordmd cca5hlpinsrn ///
cca5hlpothin cse1hlpgtdev cse1homsafer cse1hlppdhlp cca5hlpdiet cca5hlpfeet ///
cca5hlpskin cca5hlpexrcs cca5hlpteeth cca5hlpmdtk cca5hlpshot cse5frfamhlp cpp5wrk4pay ///
cdc5hlpsched cdc5hlpyrpls cec5wrk4pay
local v2 help_bills help_track_meds help_make_appts help_speak_doc help_order_med ///
help_insurance help_insurance_oth help_mob_dev help_home_safe help_paid_helpr ///
help_diet help_foot help_skin help_exercise help_teeth help_medical_task ///
help_shots_injection friend_help work_4_pay help_regular_sched help_longer_than_yr ///
paid_last_week

local vn : word count `v1'
forvalues i=1/`vn' {
	local va1=word("`v1'",`i')
	local va2=word("`v2'",`i')
	gen `va2'=`va1'==1 if `va1'>0
}

gen paid_hours=cec5hrslstwk if cec5hrslstwk>0
replace paid_hours=0 if paid_last_week==0
gen paid_hours_cat=paid_hours>20 if !missing(paid_hours)
replace paid_hours_cat=1 if paid_hours>20 & !missing(paid_hours)
replace paid_hours_cat=2 if paid_hours>=40 & !missing(paid_hours)

gen help_insurance_any=help_insurance if !missing(help_insurance)
replace help_insurance_any=1 if help_insurance_oth==1

local v1 cac5moreconf cac5dealbetr cac5closr2sp cac5moresat cac5exhaustd ///
cac5toomuch cac5notime cac5uroutchg
local v2 gain_more_conf gain_deal_better gain_closer2sp gain_more_satisfied ///
 neg_exhausted neg_too_much neg_no_time neg_no_routine
 
local vn : word count `v1'
forvalues i=1/`vn' {
	local va1=word("`v1'",`i')
	local va2=word("`v2'",`i')
	gen `va2'_di=`va1'<3 if `va1'>0
}

local v1 cac5diffinlv cac5diffemlv cac5diffphlv
local v2 diff_financial_lv diff_emotional_lv diff_physical_lv
local v3 cac5diffinc cac5diffemo cac5diffphy
local vn : word count `v1'
forvalues i=1/`vn' {
	local va1=word("`v1'",`i')
	local va2=word("`v2'",`i')
	local va3=word("`v3'",`i')
	gen `va2'=`va3'==1 if `va3'>0
	gen `va2'_di=`va1'>3 if !missing(`va2') & `va3'>-2
}

gen cg_ivw_month=c5intmonth if c5intmonth>0
gen cg_ivw_year=2011 if c5intmonth>0
gen cg_ivw_date=mdy(cg_ivw_month,1,cg_ivw_year)
gen cg_birth_year=chd5cgbrthyr if chd5cgbrthyr>0
gen cg_birth_month=chd5cgbrthmt if chd5cgbrthmt>0
gen cg_age=cg_ivw_year-chd5cgbrthyr if chd5cgbrthyr>0
replace cg_age=cg_age-1 if cg_ivw_month>=cg_birth_month
replace cg_age=op5age if cg_age==. & op5age>0
gen cg_age_cat=floor(((cg_age-20)/5)+2)
replace cg_age_cat=op5dage if op5dage>0 & cg_age_cat==.
*replace cg_age_cat=op5cat if op5cat>0 & cg_age_cat==.
replace cg_age_cat=1 if cg_age_cat<1
*replace cg_age_cat=16 if cg_age_cat>16 & !missing(cg_age_cat)


gen num_help_years=cdc5hlpyrs if cdc5hlpyrs>0
replace num_help_years=0 if cdc5hlpyrpls==2
replace num_help_years=cg_ivw_year-cdc5hlpyrst if cdc5hlpyrst>0 & num_help_years==.

/*note, why do we base it on the categorical from the OP?
gen cg_age_cat=op5dage if op5dage>0
replace cg_age_cat=cg_agecat if missing(cg_age_cat)*/
/*
gen felt_lit_interest=che5fltltlin>1 if che5fltltlin>0
gen felt_depressed=che5fltdown>1 if che5fltdown>0
gen felt_nervous=che5fltnervs>1 if che5fltnervs>0
gen felt_worry=che5fltworry>1 if che5fltworry>0
*/
local v1 che5fltltlin che5fltdown che5fltnervs che5fltworry
local v2 cg_depr_pqq1 cg_depr_pqq2 cg_depr_gad1 cg_depr_gad2
local v3 felt_lit_interest felt_depressed felt_nervous felt_worry
local vn : word count `v1'
forvalues i=1/`vn' {
	local va1=word("`v1'",`i')
	local va2=word("`v2'",`i')
	local va3=word("`v3'",`i')
	gen `va2'=`va1'-1 if `va1'>0
	gen `va3'=`va1'>1 if `va1'>0
}
gen cg_phq2_score=cg_depr_pqq1+cg_depr_pqq2
gen cg_gad2_score=cg_depr_gad1+cg_depr_gad2
gen cg_phq2_depressed=cg_phq2_score>=3 if !missing(cg_phq2_score)
gen cg_gad2_anxiety=cg_gad2_score>=3 if !missing(cg_gad2_score)
gen flag_no_help_mth=cca5hlplsty==1
gen solo_cg=n_helpers==1 if !missing(n_helpers)
gen solo_cg_fam=n_family_helpers==1 & op_family==1 if !missing(n_family_helpers)
gen solo_cg_informal=n_helpers-n_paid_helpers==1
gen cg_ivw_to_sp_death=death_date-cg_ivw_date
replace cg_ivw_to_sp_death=. if cg_ivw_to_sp_death<0 
gen cg_ivw_to_sp_death_mos=floor(cg_ivw_to_sp_death/30.4)
gen lives_in_hh=op1prsninhh==1
//code as living w/ if spouse and says lives w/ spouse
replace lives_in_hh=inlist(hh5dlvngarrg,2,3) if spouse==1 & lives_in_hh==0

//transportationboth cg and sp
gen cg_drive_sp=inlist(cca5hwoftdrv,1,2,3) if !missing(cca5hwoftdrv)
label var cg_drive_sp "Drove SP Some/Most/Everyday"

drop spid opid c5relatnshp c5intmonth c5dintdays cca5hwoftchs cca5hwoftshp cca5hlpordmd cca5hlpbnkng cca5cmpgrcry cca5cmpordrx cca5cmpbnkng cca5hwoftpc cca5hwofthom cca5hlplft cca5hlpspt cca5hlpstd cca5hwoftlft cca5hwoftspt cca5hwoftstd cca5hwoftdrv cca5hwoftott cca5hlpmed cca5hlpshot cca5hlpmdtk cca5hlpexrcs cca5hlpdiet cca5hlpteeth cca5hlpfeet cca5hlpskin cca5hlpmdapt cca5hlpspkdr cca5hlpinsrn cca5hlpothin cca5hlpdramt cca5hwget2sp cca5tm2spunt cca5tm2spmin cca5tm2sphrs flcca5routing cca5hlplstyr cca5lstmhlpd cdc5hlpsched cdc5hlpdyswk cdc5hlpdysmt cdc5hlphrsdy cdc5hlphrmvf cdc5hlphrlmt cdc5hlphrpc cdc5hlphrpce cdc5hlpyrpls cdc5hlpmthst cdc5hlpunit cdc5hlpyrs cdc5hlpyrst cdc5hlpyrs5p cac5joylevel cac5arguelv cac5spapprlv cac5nerveslv cac5moreconf cac5dealbetr cac5closr2sp cac5moresat cac5diffinc cac5diffemo cac5diffphy cac5diffinlv cac5diffemlv cac5diffphlv cac5fmlydisa cac5careamt flcac5routing cac5exhaustd cac5toomuch cac5notime cac5uroutchg cse5frfamtlk cse5frfamact cse5frfamhlp cse5spptgrp cse5srv2hlp cse5training cse5fndfnhlp cse5hwfnd1 cse5hwfnd2 cse5hwfnd3 cse5hwfnd4 cse5hwfnd5 cse5hwfnd6 cse5look4hlp cse5look1 cse5look2 cse5look3 cse5look4 cse5look5 cse5look6 cse1hlpgtdev cse1homsafer cse1hlppdhlp cpp5vstfrfam cpp5hlpkptvs cpp5impvst cpp5gorelgs cpp5hlpkptrl cpp5imprel cpp5prtgroup cpp5hlpkptgr cpp5impgroup cpp5go4fun cpp5hlpkptgo cpp5impgo cpp5wrk4pay cpp5hlpkptwk cpp5volun cpp5hlpkptvo cpp5careothr cpp5hlpkptca che5health che5hrtattck che5othheart che5highbld che5arthrits che5osteoprs che5diabetes che5lungdis che5cancer che5seeing che5hearing che5cncrskin che5cncrbrst che5cncrpros che5cncroth che5pain che5painlmt che5brethprb che5brethlmt che5armstr che5armlmt che5legstr che5leglmt che5lowenrgy che5enrgylmt che5sleeptrb che5sleepint flche5routing che5weight che5heightft che5heightin che5lost10lb che5try2lose che5moodcher che5moodpcfl che5moodfull che5moodbord che5moodlone che5moodupst che5fltltlin che5fltdown che5fltnervs che5fltworry che5lifemng che5feelconf che5gaveup che5lifegood che5lifelone che5easychng che5rcvrqick chd5martstat chd5dmartstat chd5marendmt chd5marendyr chd5chldlvng chd5numchild chd5dnumchild chd5numchu18 chd5numinhh chd5dnuminhh flchd5routing chd5educ chd5deduc chd5educsprt chd5deducsprt chd5cgbrthmt chd5dcgbrthmt chd5cgbrthyr chd5dcgbrthyr chd5age chd5spbrthmt chd5dspbrthmt chd5spbrthyr chd5dspbrthyr chd5dspouage c5dgender crl5dcgracehisp crl5draceimpfl cec5wrk4pay cec5ownbusns cec5unpdwrk cec5misswork cec5look4wrk cec5wrkmulti cec5hrsweek cec5hrslstwk cec5hrslast cec5hrswork cec5flexhrs cec5wrksched cec5msswrkmt cec5mswkvctn cec5mswksick cec5mswkhelp cec5mswkfmly cec5mswkpers cec5mswkunit cec5mswkhlph cec5mswkhlpd cec5wkhrperd cec5hlpafwk1 cec5hlpafwk2 cec5busntype cec5occuptn cec5worktype cec5occpdscr chi5medicare chi5medigap chi5medicaid chi5privinsr chi5tricare chi5uninsurd chi5insrtype chi5ownhome chi5chckacct chi5svgsacct chi5certdpst chi5retrplan chi5mutlfnds chi5income chi5inc200pv chi5inc100pv chi5inc400pv chi5paymeds chi5payinsur chi5paymbdvc chi5paysfty chi5payasdvc chi5payhmhlp chi5pay1000 chi5pay2000 chi5pay500 chi5gifttosp chi5gift500 chi5gift1000 chi5gift100 chi5fromsp chi5frsp500 chi5frsp1000 chi5frsp100 c5varstrat c5varunit w5cgfinwgt0 w5cgfinwgt1 w5cgfinwgt2 w5cgfinwgt3 w5cgfinwgt4 w5cgfinwgt5 w5cgfinwgt6 w5cgfinwgt7 w5cgfinwgt8 w5cgfinwgt9 w5cgfinwgt10 w5cgfinwgt11 w5cgfinwgt12 w5cgfinwgt13 w5cgfinwgt14 w5cgfinwgt15 w5cgfinwgt16 w5cgfinwgt17 w5cgfinwgt18 w5cgfinwgt19 w5cgfinwgt20 w5cgfinwgt21 w5cgfinwgt22 w5cgfinwgt23 w5cgfinwgt24 w5cgfinwgt25 w5cgfinwgt26 w5cgfinwgt27 w5cgfinwgt28 w5cgfinwgt29 w5cgfinwgt30 w5cgfinwgt31 w5cgfinwgt32 w5cgfinwgt33 w5cgfinwgt34 w5cgfinwgt35 w5cgfinwgt36 w5cgfinwgt37 w5cgfinwgt38 w5cgfinwgt39 w5cgfinwgt40 w5cgfinwgt41 w5cgfinwgt42 w5cgfinwgt43 w5cgfinwgt44 w5cgfinwgt45 w5cgfinwgt46 w5cgfinwgt47 w5cgfinwgt48 w5cgfinwgt49 w5cgfinwgt50 w5cgfinwgt51 w5cgfinwgt52 w5cgfinwgt53 w5cgfinwgt54 w5cgfinwgt55 w5cgfinwgt56


foreach x of varlist * {
if "`x'"!="opid" {
destring `x', replace
replace `x'=. if `x'<0
}
}
save "E:\nhats\data\NHATS cleaned\nsoc_round_5.dta", replace
/*
gen mine=1
append using "E:\nhats\data\Projects\Caregivers\nsoc_FULL.dta"

foreach x of varlist * {
if "`x'"!="spid" & "`x'"!="opid" {
duplicates tag spid opid `x', gen(dup)
sum dup
if r(sd)==0 &r(mean)==1 {
drop `x'
}
drop dup
}
}
