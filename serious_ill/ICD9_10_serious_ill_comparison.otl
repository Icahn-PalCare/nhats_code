= V4 Outline MultiLine NoSorting TabWidth=30

H="Comparison of SMIs in ICD9 and ICD10 in NHATS"
/* 
********************HEADING******************** 

Project Name: Serious Illness Comparison in ICD-9 and ICD-10

Date Started: 2/7/19 (date moved from "Serious Illness Definition" code)

Primary Investigator: Amy Kelley
Funding Source: ?

Created by: EBL

Primary Analyst: EBL
Secondary Analyst: OR

Datasets Used: NHATS, NHATS-linked Medicare claims

Simple Outline:  Compare Serious Illness identification using ICD-9 and ICD-10.  Compare NHATS wave 4 (2014, all ICD-9) and 6 (2016, all ICD-10) on population characteristics and six-month outcomes in Medicare claims.  As of 2/7/19, we don't yet have 2017 Medicare data, so some of the follow-up time is truncated for the 2016 cohort.


*/
 
//STATA
// Global Macros use $ symbol to be called. 

//Intermediate Data Path
global intpath "E:\nhats\data\Projects\serious_ill\icd910\int_data"

// Final Data Path
global datapath "E:\nhats\data\Projects\serious_ill\icd910\final_data"

//Log files path
global logpath "E:\nhats\data\Projects\serious_ill\logs"


//SAS 

/*nhats cleaned path*/
libname nhats 'E:\nhats\data\NHATS cleaned';

/*medicare xwalk and claims path*/
libname medi 'E:\nhats\data\20180625 NHATS CMS Data\merged';

/*project data paths*/
libname proj_int 'E:\nhats\data\projects\serious_ill\icd910\int_data';
libname proj_fin 'E:\nhats\data\projects\serious_ill\icd910\final_data';
libname proj_ref 'E:\nhats\data\projects\serious_ill\ref_data';


H="Get index date"
/*

Created by: EBL 
Date Created: 2/7/19

Updated by: 
Date Updated:

Notes: Must update when update NHATS for new waves or get updated CMS data

*************************************************
*/

proc import datafile="E:\nhats\data\NHATS cleaned\sp_round_1_7.dta" out=proj_int.nhats replace; run;


data index1;
set proj_int.nhats (keep=spid ivw_date ivw_month ivw_year);
index_date=ivw_date;
index_month=ivw_month;
index_year=ivw_year;
run;


proc import out=xwalk
	    datafile = "E:\nhats\data\20180625 NHATS CMS Data\merged stata\xwalk_2016.dta" replace; 
run;


proc sql;
create table index as select a.*, b.bene_id
from index1 a left join
xwalk b 
on a.spid=b.spid;
quit;

proc sort data=index out=proj_int.index nodupkey;
by spid bene_id index_year;
run;


H="get continuous FFS before index"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************


/*sort claims denominator file*/

proc sort data=medi.mbsf_06_16 out=mbsf  nodupkey;
by bene_id year;
run;

proc sort data=proj_int.index out=index1 nodupkey;
by bene_id index_year;
run;

/*get mbsf just for interview year*/

proc sql; 
create table mbsf_index_year as select
a.*,b.buyin12,b.year,b.hmoind12
from index1 a inner join
mbsf b
on trim(left(a.bene_id))=trim(left(b.bene_id)) 
and a.index_year=b.year;
quit;


proc sql;
select count(distinct bene_id) from mbsf_index_year;
quit;



data mbsf_index_year2;
set mbsf_index_year;
if length(trim(left(buyin12)))=12 and index_month>0 then do;
buyin_iy=substr(trim(left(buyin12)),1,index_month);
hmo_iy=substr(trim(left(HMOIND12)),1,index_month);
end;
else do;
buyin_iy=trim(left(buyin12));
hmo_iy=trim(left(HMOIND12));
end;
format index_date date9.;
run;
proc means n;
var index_month;
run;

proc sql;
create table mbsf_index_year_bef as select
a.bene_id,a.year as index_year,
b.year as index_year_bef,
b.year, b.buyin12,b.HMOIND12
from mbsf_index_year a inner join
mbsf b
on trim(left(a.bene_id))=trim(left(b.bene_id))
and 0<a.year-b.year<=1 order by bene_id,year;
quit;


/* and the year before... 1922 have the -2 year dn file*/
proc sql;
create table mbsf_index_year_2bef as select
a.bene_id,a.bene_id,a.index_year,a.index_year_bef,
b.year as index_year_2bef,
b.year,b.buyin12,b.HMOIND12
from mbsf_index_year_bef a inner join
mbsf b
on trim(left(a.bene_id))=trim(left(b.bene_id))
and 0<a.index_year_bef-b.year<=1 order by bene_id,year;
quit;

/*merge the insurance data for death year, -1 and -2 years into single dataset*/
proc sql;
create table all_insurance as select a.*,b.buyin12 as buyin_bef,b.HMOIND12 as hmo_bef from
mbsf_index_year2 a
left join
mbsf_index_year_bef b
on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_year=b.index_year;
quit;

proc sql;
create table all_insurance2 as select a.*,b.buyin12 as buyin_2bef,b.HMOIND12 as hmo_2bef from
all_insurance a
left join
mbsf_index_year_2bef b
on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_year=b.index_year; 
quit;


/*merge death year and year before death buy-in and hmo variables
Trim so the final variable _6m is 6 months pre-death
Note: indicator variables for parts a and b and hmo are null if don't
have information for full 6 months pre-death*/
data all_insurance3;
set all_insurance2;
buyin_2y=trimn(left(buyin_2bef))||trimn(left(buyin_bef))||trimn(left(buyin_iy));
hmo_2y=trimn(left(hmo_2bef))||trimn(left(hmo_bef))||trimn(left(hmo_iy));

buyin_2y_r=reverse(trim(buyin_2y));
hmo_2y_r=reverse(trim(hmo_2y));


/*create length of continous a&b and non-hmo coverage vars*/
if indexc(buyin_2y_r,"0","1","2","A","B")=0 then part_ab_n_mos=length(buyin_2y_r)-1;
if indexc(buyin_2y_r,"0","1","2","A","B") then part_ab_n_mos=indexc(buyin_2y_r,"0","1","2","A","B")-1;
if indexc(hmo_2y_r,"1","2","4","A","B","C")=0 then non_hmo_d_n_mos=length(hmo_2y_r)-1;
if indexc(hmo_2y_r,"1","2","4","A","B","C") then non_hmo_d_n_mos=indexc(hmo_2y_r,"1","2","4","A","B","C")-1;
if part_ab_n_mos<=non_hmo_d_n_mos then cont_ffs_n_mos=part_ab_n_mos;
if non_hmo_d_n_mos<part_ab_n_mos then cont_ffs_n_mos=non_hmo_d_n_mos;
run;


data proj_int.ffs_before;
set all_insurance3;
run;


H="get continuous FFS after index"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************


/*sort claims denominator file*/

proc sort data=medi.mbsf_06_16 out=mbsf  nodupkey;
by bene_id year;
run;

proc sort data=proj_int.index out=index1 nodupkey;
by bene_id index_year;
run;

/*get mbsf just for interview year*/

proc sql; 
create table mbsf_index_year as select
a.*,b.buyin12,b.year,b.hmoind12
from index1 a inner join
mbsf b
on trim(left(a.bene_id))=trim(left(b.bene_id)) 
and a.index_year=b.year;
quit;


proc sql;
select count(distinct bene_id) from mbsf_index_year;
quit;



data mbsf_index_year2;
set mbsf_index_year;
if length(trim(left(buyin12)))=12 and index_month>0 then do;
buyin_iy=substr(trim(left(buyin12)),index_month,13-index_month);
hmo_dy=substr(trim(left(HMOIND12)),index_month,13-index_month);
buyin_at_death=substr(trim(left(buyin12)),index_month,1);
hmo_at_death=substr(trim(left(HMOIND12)),index_month,1);
end;
else do;
buyin_iy=trim(left(buyin12));
hmo_iy=trim(left(HMOIND12));
end;
format index_date date9.;
run;
proc means n;
var index_month;
run;


proc sql;
create table mbsf_index_year_aft as select
a.bene_id,a.bene_id,a.year as index_year,
b.year as index_year_aft,
b.year,b.buyin12,b.HMOIND12
from mbsf_index_year a inner join
mbsf b
on trim(left(a.bene_id))=trim(left(b.bene_id))
and a.year-b.year=-1 order by bene_id,year;
quit;


/* and the year aftore... 1790 have the +2 year dn file*/
proc sql;
create table mbsf_index_year_2aft as select
a.bene_id,a.bene_id,a.index_year,a.index_year_aft,
b.year as index_year_2aft,
b.year,b.buyin12,b.HMOIND12
from mbsf_index_year_aft a inner join
mbsf b
on trim(left(a.bene_id))=trim(left(b.bene_id))
and a.index_year_aft-b.year=-1 order by bene_id,year;
quit;

/*merge the insurance data for death year, +1 and +2 years into single dataset*/
proc sql;
create table all_insurance as select a.*,b.buyin12 as buyin_aft,b.HMOIND12 as hmo_aft from
mbsf_index_year2 a
left join
mbsf_index_year_aft b
on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_year=b.index_year;
quit;

proc sql;
create table all_insurance2 as select a.*,b.buyin12 as buyin_2aft,b.HMOIND12 as hmo_2aft from
all_insurance a
left join
mbsf_index_year_2aft b
on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_year=b.index_year;
quit;


/*merge death year and year aftore death buy-in and hmo variables
Trim so the final variable _p6m is 6 months post-death
Note: indicator variables for parts a and b and hmo are null if don't
have information for full 6 months post-death*/
data all_insurance3;
set all_insurance2;
buyin_2y=trimn(left(buyin_iy))||trimn(left(buyin_aft))||trimn(left(buyin_2aft));
hmo_2y=trimn(left(hmo_dy))||trimn(left(hmo_aft))||trimn(left(hmo_2aft));

/*create length of continous a&b and non-hmo coverage vars*/
if indexc(buyin_2y,"0","1","2","A","B")=0 then part_ab_p_mos=length(buyin_2y);
if indexc(buyin_2y,"0","1","2","A","B") then part_ab_p_mos=indexc(buyin_2y,"0","1","2","A","B");
if indexc(hmo_2y,"1","2","4","A","B","C")=0 then non_hmo_d_p_mos=length(hmo_2y);
if indexc(hmo_2y,"1","2","4","A","B","C") then non_hmo_d_p_mos=indexc(hmo_2y,"1","2","4","A","B","C");
if indexc(buyin_at_death,"0","1","2","A","B")=1 then part_ab_at_death=0;
if indexc(buyin_at_death,"0","1","2","A","B")=0 then part_ab_at_death=1;
if indexc(hmo_at_death,"1","2","4","A","B","C")=1 then hmo_d_at_death=1;
if indexc(hmo_at_death,"1","2","4","A","B","C")=0 then hmo_d_at_death=0;

if part_ab_p_mos<=non_hmo_d_p_mos then cont_ffs_p_mos=part_ab_p_mos;
if non_hmo_d_p_mos<part_ab_p_mos then cont_ffs_p_mos=non_hmo_d_p_mos;
run;

data proj_int.ffs_after;
set all_insurance3;
run;

H="get claims before index"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************

/*Get claims 1 year and 2 year before each interview*/
/*Step 2: pull claims lists using xwalk and ivw date*/

proc sort data=proj_int.index out=index1 nodupkey;
by bene_id index_year;
run;

/****************************************************************************/
/* Macro to pull claims lists, saves lists to int_data folder               */
/****************************************************************************/
%macro claims_pre(days_start=,days_bef_index=,yrs=,source=);

proc sql;
create table &source._meet_&days_bef_index. as select a.index_date,a.index_year,b.*
from proj_int.index a inner join
medi.&source._&yrs. b 
on trim(left(a.bene_id))=trim(left(b.bene_id))
and &days_start<=a.index_date-b.disch_date<=&days_bef_index;
quit;

%mend;

/*run to get claims list 6 mo pre-ivw for ip*/
%claims_pre(days_start=0,days_bef_index=183,yrs=06_16,source=ip);
%claims_pre(days_start=0,days_bef_index=183,yrs=09_16,source=snf);
%claims_pre(days_start=0,days_bef_index=183,yrs=09_16,source=op);
%claims_pre(days_start=0,days_bef_index=183,yrs=09_16,source=pb);
%claims_pre(days_start=0,days_bef_index=183,yrs=09_16,source=hh);
%claims_pre(days_start=0,days_bef_index=183,yrs=09_16,source=hs);
%claims_pre(days_start=0,days_bef_index=183,yrs=09_16,source=dm);
/*1yr*/
%claims_pre(days_start=0,days_bef_index=365,yrs=06_16,source=ip);
%claims_pre(days_start=0,days_bef_index=365,yrs=09_16,source=snf);
%claims_pre(days_start=0,days_bef_index=365,yrs=09_16,source=op);
%claims_pre(days_start=0,days_bef_index=365,yrs=09_16,source=pb);
%claims_pre(days_start=0,days_bef_index=365,yrs=09_16,source=hh);
%claims_pre(days_start=0,days_bef_index=365,yrs=09_16,source=hs);
%claims_pre(days_start=0,days_bef_index=365,yrs=09_16,source=dm);

/*2yrs*/
%claims_pre(days_start=0,days_bef_index=730,yrs=06_16,source=ip);
%claims_pre(days_start=0,days_bef_index=730,yrs=09_16,source=snf);
%claims_pre(days_start=0,days_bef_index=730,yrs=09_16,source=op);
%claims_pre(days_start=0,days_bef_index=730,yrs=09_16,source=pb);
%claims_pre(days_start=0,days_bef_index=730,yrs=09_16,source=hh);
%claims_pre(days_start=0,days_bef_index=730,yrs=09_16,source=hs);
%claims_pre(days_start=0,days_bef_index=730,yrs=09_16,source=dm);

%macro ip_drop(days_bef_index=);
data proj_int.ip_meet_&days_bef_index.;
set ip_meet_&days_bef_index.(keep=bene_id index_year index_date admit_date disch_date 
  ADMTG_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 ICD_PRCDR_CD1-ICD_PRCDR_CD25 icarecnt crnrydaycnt erdaycnt clm_ip_admsn_type_cd
  PRCDR_DT1-PRCDR_DT25 hcpcscd1-hcpcscd49);
run;
%mend ip_drop;

%macro snf_drop(days_bef_index=);
data proj_int.snf_meet_&days_bef_index.;
set snf_meet_&days_bef_index.(keep=bene_id index_year index_date admit_date disch_date 
  ADMTG_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 ICD_PRCDR_CD1-ICD_PRCDR_CD25 
 PRCDR_DT1-PRCDR_DT25 );
run;
%mend snf_drop;


/*hh*/
%macro hh_drop(days_bef_index=);
data proj_int.hh_meet_&days_bef_index.;
set hh_meet_&days_bef_index.(keep=bene_id index_year index_date admit_date PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 );
run;
%mend hh_drop;

/*hs*/
%macro hs_drop(days_bef_index=);
data proj_int.hs_meet_&days_bef_index.;
set hs_meet_&days_bef_index.(keep=bene_id index_year index_date admit_date PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25);
run;
%mend hs_drop;

/*dme*/
%macro dm_drop(days_bef_index=);
data proj_int.dm_meet_&days_bef_index.;
set dm_meet_&days_bef_index.(keep=bene_id index_year index_date admit_date 
PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD12 h_o2);
run;
%mend dm_drop;

/*op*/
%macro op_drop(days_bef_index=);
data proj_int.op_meet_&days_bef_index.;
set op_meet_&days_bef_index.(keep=bene_id index_year index_date admit_date disch_date
PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 erdaycnt obs_stay);
run;
%mend op_drop;

/*carrier*/
%macro pb_drop(days_bef_index=);
data proj_int.pb_meet_&days_bef_index.;
set pb_meet_&days_bef_index.(keep=bene_id index_year index_date admit_date disch_date
PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD12 hcpcscd1-hcpcscd13);
run;
%mend pb_drop;

%ip_drop(days_bef_index=183);
%op_drop(days_bef_index=183);
%pb_drop(days_bef_index=183);
%snf_drop(days_bef_index=183);
%hh_drop(days_bef_index=183);
%dm_drop(days_bef_index=183);
%hs_drop(days_bef_index=183);
%ip_drop(days_bef_index=365);
%ip_drop(days_bef_index=730);
%snf_drop(days_bef_index=365);
%snf_drop(days_bef_index=730);
%hh_drop(days_bef_index=365);
%hh_drop(days_bef_index=730);
%hs_drop(days_bef_index=365);
%hs_drop(days_bef_index=730);
%dm_drop(days_bef_index=365);
%dm_drop(days_bef_index=730);
%op_drop(days_bef_index=365);
%op_drop(days_bef_index=730);
%pb_drop(days_bef_index=365);
%pb_drop(days_bef_index=730);



/****************************************************************************/
/****************************************************************************/
/* Macro to pull dx from claims lists, saves dx lists to int_data folder    */
/****************************************************************************/

%macro dx_time_range(range1=, range2=, days_bef_core=);

/*Process carrier medicare claims to pull out dx codes
Multiple lines per each BID*/
data pb_last_&range2._dx(keep=bene_id index_year diag);
set proj_int.pb_meet_&days_bef_core.(keep=bene_id index_year PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD12 hcpcscd1-hcpcscd13);
array dx PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD12;
do over dx;
diag=dx ;
output;
end;
run;
/*check for and remove duplicates, note this doesn't remove blanks*/
proc sort data=pb_last_&range2._dx out=pb_last_&range2._dx2 nodupkey;
by bene_id index_year diag;
run;


/*Process outpatient medicare claims to pull out dx codes
Dataset being created: op_last_&range2._dx2*/
data op_last_&range2._dx(keep=bene_id index_year diag);
set proj_int.op_meet_&days_bef_core.(keep=bene_id index_year PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25  );
array dx PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 ;
do over dx;
diag=dx ;
output;
end;
run;
proc sort data=op_last_&range2._dx out=op_last_&range2._dx2 nodupkey;
by bene_id index_year diag;
run;

proc contents data=proj_int.ip_meet_365; run;


/*Dataset being created: ip_last_&range2._dx2*/
data ip_last_&range2._dx(keep=bene_id index_year diag);
set proj_int.ip_meet_&days_bef_core.(keep=bene_id index_year ADMTG_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 hcpcscd1-hcpcscd49);
array dx ADMTG_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 ;
do over dx;
diag=dx ;
output;
end;
run;
proc sort data=ip_last_&range2._dx out=ip_last_&range2._dx2 nodupkey;
by bene_id index_year diag;
run;

/*Dataset being created: snf_last_&range2._dx2*/
data snf_last_&range2._dx(keep=bene_id index_year diag);
set proj_int.snf_meet_&days_bef_core.(keep=bene_id index_year ADMTG_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 );
array dx ADMTG_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 ;
do over dx;
diag=dx ;
output;
end;
run;
proc sort data=snf_last_&range2._dx out=snf_last_&range2._dx2 nodupkey;
by bene_id index_year diag;
run;

/*Process dme medicare claims to pull out dx codes
Dataset being created: dm_last_&range2._dx2*/
data dm_last_&range2._dx(keep=bene_id index_year diag);
set proj_int.dm_meet_&days_bef_core.(keep=bene_id index_year PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD12 );
array dx PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD12 ;
do over dx;
diag=dx ;
output;
end;
run;
proc sort data=dm_last_&range2._dx out=dm_last_&range2._dx2 nodupkey;
by bene_id index_year diag;
run;

/*Process hh medicare claims to pull out dx codes
Dataset being created: dm_last_&range2._dx2*/
data hh_last_&range2._dx(keep=bene_id index_year diag);
set proj_int.hh_meet_&days_bef_core.(keep=bene_id index_year PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 );
array dx PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 ;
do over dx;
diag=dx ;
output;
end;
run;
proc sort data=hh_last_&range2._dx out=hh_last_&range2._dx2 nodupkey;
by bene_id index_year diag;
run;

/*Process hs medicare claims to pull out dx codes
Dataset being created: dm_last_&range2._dx2*/
data hs_last_&range2._dx(keep=bene_id index_year diag);
set proj_int.hs_meet_&days_bef_core.(keep=bene_id index_year PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 );
array dx PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 ;
do over dx;
diag=dx ;
output;
end;
run;
proc sort data=hs_last_&range2._dx out=hs_last_&range2._dx2 nodupkey;
by bene_id index_year diag;
run;


/*set diag variable length = 7 chars since that's the max length from the mc claims
Need to do this because length varies across the different mc claim types*/
data hs_last_&range2._dx3;
length diag $7;
set hs_last_&range2._dx2;
run;
data hh_last_&range2._dx3;
length diag $7;
set hh_last_&range2._dx2;
run;
data ip_last_&range2._dx3;
length diag $7;
set ip_last_&range2._dx2;
run;
data snf_last_&range2._dx3;
length diag $7;
set snf_last_&range2._dx2;
run;
data dm_last_&range2._dx3;
length diag $7;
set dm_last_&range2._dx2;
run;
data op_last_&range2._dx3;
length diag $7;
set op_last_&range2._dx2;
run;
data pb_last_&range2._dx3;
length diag $7;
set pb_last_&range2._dx2;
run;


/*merge diagnoses from each claim type into single dataset*/
data dx_all_last_1&range2.;
set hs_last_&range2._dx3
hh_last_&range2._dx3
ip_last_&range2._dx3
snf_last_&range2._dx3
dm_last_&range2._dx3
op_last_&range2._dx3
pb_last_&range2._dx3;
run;

proc sql;
create table dx_all_last_&range2. as select * from
proj_int.index a 
left join 
dx_all_last_1&range2. b
on a.bene_id=b.bene_id and a.index_year=b.index_year;
quit; 

proc sort data=dx_all_last_&range2.(where=(diag~="")) out=proj_int.dx_&range1._&range2 nodupkey;
by bene_id index_year diag;
run;


%mend;

/*1 and 2 years pre-interview: proj_int.dx_0_1yr, proj_int.dx_0_2yr */
%dx_time_range(range1=0, range2=6m, days_bef_core=183);
%dx_time_range(range1=0, range2=1yr, days_bef_core=365);
%dx_time_range(range1=0, range2=2yr, days_bef_core=730);



data dx_all_last_6m_w_dups;
set hs_last_6m_dx
hh_last_6m_dx
ip_last_6m_dx
snf_last_6m_dx
dm_last_6m_dx
op_last_6m_dx
pb_last_6m_dx;
if diag~='.';
run;



/*****************************************/
/*check dementia diagnosis frequencies, need to pull this into main dataset
dx list is from Elixhauser code*/
data proj_int.dem_dx_freq;
set dx_all_last_6m_w_dups;
	dementia=0;
	dem_icd10=0;
	if (substr(diag,1,4) in ('3310','3311','3312','2900','2901',
             '2902','2903','2912','2948','2949') or
		substr(diag,1,5) in ('29410','29411','29040','29041','29042','29043')) 
		and dementia=0 
          then dementia=1;
/*ICD-10*/		

if (substr(diag,1,5)='F0150'
or substr(diag,1,5)='F0151'
or substr(diag,1,5)='F0280'
or substr(diag,1,5)='F0281'
or substr(diag,1,5)='F0390'
or substr(diag,1,5)='F0391'
or substr(diag,1,4)='F051'
or substr(diag,1,5)='F1027'
or substr(diag,1,5)='F1097'
or substr(diag,1,4)='G300'
or substr(diag,1,4)='G301'
or substr(diag,1,4)='G308'
or substr(diag,1,4)='G309'
or substr(diag,1,5)='G3101'
or substr(diag,1,5)='G3109'
or substr(diag,1,4)='G311'
or substr(diag,1,5)='G3183'
or substr(diag,1,4)='A811'
or substr(diag,1,4)='A812'
or substr(diag,1,4)='A818'
or substr(diag,1,5)='A8100'
or substr(diag,1,5)='A8101'
or substr(diag,1,5)='A8109'
or substr(diag,1,5)='A8181'
or substr(diag,1,5)='A8182'
or substr(diag,1,5)='A8183'
) 
		and dem_icd10=0 
          then dem_icd10=1;
if dem_icd10=1 then dementia=1;
run;



H="get claims after index"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************

/*Get claims 1 year and 2 year before each interview*/
/*Step 2: pull claims lists using xwalk and ivw date*/

proc sort data=proj_int.index out=index1 nodupkey;
by bene_id index_year;
run;

/****************************************************************************/
/* Macro to pull claims lists, saves lists to int_data folder               */
/****************************************************************************/
%macro claims_post(days_start=,days_aft_index=,yrs=,source=);

proc sql;
create table &source._meet_&days_aft_index.p as select a.*,b.index_date,b.index_year
from medi.&source._&yrs. a inner join
proj_int.index b 
on trim(left(a.bene_id))=trim(left(b.bene_id))
and &days_start<=a.admit_date-b.index_date<=&days_aft_index;
quit;

%mend;

/*run to get claims list 6 mo pre-ivw for ip*/
%claims_post(days_start=0,days_aft_index=183,yrs=06_16,source=ip);

/*6m*/
%claims_post(days_start=0,days_aft_index=183,yrs=06_16,source=ip);
%claims_post(days_start=0,days_aft_index=183,yrs=09_16,source=snf);
%claims_post(days_start=0,days_aft_index=183,yrs=09_16,source=op);
%claims_post(days_start=0,days_aft_index=183,yrs=09_16,source=pb);
%claims_post(days_start=0,days_aft_index=183,yrs=09_16,source=hh);
%claims_post(days_start=0,days_aft_index=183,yrs=09_16,source=hs);
%claims_post(days_start=0,days_aft_index=183,yrs=09_16,source=dm);

/*1yr*/
%claims_post(days_start=0,days_aft_index=365,yrs=06_16,source=ip);
%claims_post(days_start=0,days_aft_index=365,yrs=09_16,source=snf);
%claims_post(days_start=0,days_aft_index=365,yrs=09_16,source=op);
%claims_post(days_start=0,days_aft_index=365,yrs=09_16,source=pb);
%claims_post(days_start=0,days_aft_index=365,yrs=09_16,source=hh);
%claims_post(days_start=0,days_aft_index=365,yrs=09_16,source=hs);
%claims_post(days_start=0,days_aft_index=365,yrs=09_16,source=dm);

/*2yrs*/
%claims_post(days_start=0,days_aft_index=730,yrs=06_16,source=ip);
%claims_post(days_start=0,days_aft_index=730,yrs=09_16,source=snf);
%claims_post(days_start=0,days_aft_index=730,yrs=09_16,source=op);
%claims_post(days_start=0,days_aft_index=730,yrs=09_16,source=pb);
%claims_post(days_start=0,days_aft_index=730,yrs=09_16,source=hh);
%claims_post(days_start=0,days_aft_index=730,yrs=09_16,source=hs);
%claims_post(days_start=0,days_aft_index=730,yrs=09_16,source=dm);

%macro ip_drop(days_aft_index=);
data proj_int.ip_meet_&days_aft_index.p;
set ip_meet_&days_aft_index.p(keep=clm_pmt_amt clm_pass_thru_per_diem_amt bene_id index_year index_date admit_date disch_date 
  ADMTG_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 ICD_PRCDR_CD1-ICD_PRCDR_CD25 crnrydaycnt icarecnt erdaycnt clm_ip_admsn_type_cd
  PRCDR_DT1-PRCDR_DT25 PRNCPAL_DGNS_CD);
run;
%mend ip_drop;

%macro snf_drop(days_aft_index=);
data proj_int.snf_meet_&days_aft_index.p;
set snf_meet_&days_aft_index.p(keep=clm_pmt_amt bene_id index_year index_date admit_date disch_date 
  ADMTG_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 ICD_PRCDR_CD1-ICD_PRCDR_CD25 
 PRCDR_DT1-PRCDR_DT25 PRNCPAL_DGNS_CD);
run;
%mend snf_drop;


/*hh*/
%macro hh_drop(days_aft_index=);
data proj_int.hh_meet_&days_aft_index.p;
set hh_meet_&days_aft_index.p(keep=clm_pmt_amt bene_id index_year index_date admit_date PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 );
run;
%mend hh_drop;

/*hs*/
%macro hs_drop(days_aft_index=);
data proj_int.hs_meet_&days_aft_index.p;
set hs_meet_&days_aft_index.p(keep=clm_pmt_amt bene_id index_year index_date admit_date PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25);
run;
%mend hs_drop;

/*dme*/
%macro dm_drop(days_aft_index=);
data proj_int.dm_meet_&days_aft_index.p;
set dm_meet_&days_aft_index.p(keep=clm_pmt_amt bene_id index_year index_date admit_date
PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD12 );
run;
%mend dm_drop;

/*op*/
%macro op_drop(days_aft_index=);
data proj_int.op_meet_&days_aft_index.p;
set op_meet_&days_aft_index.p(keep=clm_pmt_amt bene_id index_year index_date admit_date disch_date
PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD25 erdaycnt);
run;
%mend op_drop;

/*carrier*/
%macro pb_drop(days_aft_index=);
data proj_int.pb_meet_&days_aft_index.p;
set pb_meet_&days_aft_index.p(keep=clm_pmt_amt bene_id index_year index_date admit_date disch_date
PRNCPAL_DGNS_CD ICD_DGNS_CD1-ICD_DGNS_CD12 );
run;
%mend pb_drop;

%ip_drop(days_aft_index=183);
%ip_drop(days_aft_index=365);
%ip_drop(days_aft_index=730);
%snf_drop(days_aft_index=183);
%snf_drop(days_aft_index=365);
%snf_drop(days_aft_index=730);
%hh_drop(days_aft_index=183);
%hh_drop(days_aft_index=365);
%hh_drop(days_aft_index=730);
%hs_drop(days_aft_index=183);
%hs_drop(days_aft_index=365);
%hs_drop(days_aft_index=730);
%dm_drop(days_aft_index=183);
%dm_drop(days_aft_index=365);
%dm_drop(days_aft_index=730);
%op_drop(days_aft_index=183);
%op_drop(days_aft_index=365);
%op_drop(days_aft_index=730);
%pb_drop(days_aft_index=183);
%pb_drop(days_aft_index=365);
%pb_drop(days_aft_index=730);
 

H="**********************************"


H="Must run all below if change any above"


H="***********************************"


H="Dartmouth"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************
*/
data proj_int.index;


/*Add indicator variables for the Dartmouth chronic diseases */

/*Dartmouth code

This program reads through the diagnosis codes of patient abstract records in a hospital
    file and identifies whether the record belongs to one (or more) of 9 different chronic 
	diseases from the Dartmouth Index.  The groups are identified by using the Enhanced ICD-9-CM
    diagnosis codes from pdf "List of ICD-9_CM codes by Chronic Disease Category 
	(Nine chronic conditions used in the dartmouth atlas of health care 2008) from March 3, 2008*/


/****************************************************************************/
/* Rename variables macro                                                   */
/****************************************************************************/

%macro rename(lib,dsn,pre);
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "Before Renaming All Variables";
run;
proc sql noprint;
select nvar into :num_vars
from dictionary.tables
where libname="&LIB" and
memname="&DSN";
select distinct(name) into :var1-
:var%TRIM(%LEFT(&num_vars))
from dictionary.columns
where libname="&LIB" and
memname="&DSN";
quit;
run;
proc datasets library=&LIB;
modify &DSN;
rename
%do i=1 %to &num_vars;
&&var&i=&&var&i.._&pre 
%end;
;
quit;
run;
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "After Renaming All Variables";
run;
%mend rename;


%macro dartmouth(range1=,range2=);

data dx_dartmouth;
set proj_int.dx_&range1._&range2.(rename=(diag=dx_0));
dx=trim(left(dx_0));

if dx~="" then do;

*initialize variables;
   dartmouth_1=0;
   dartmouth_1a=0;
   dartmouth_1b=0;
   dartmouth_2=0;
   dartmouth_3=0;
   dartmouth_4=0;
   dartmouth_5=0;
   dartmouth_6=0;
      dartmouth_7=0;
	     dartmouth_8=0;
		    dartmouth_9=0;
			   dartmouth_10=0;
			      dartmouth_11=0;
				     dartmouth_12=0;
					    dartmouth_13=0;
						   dartmouth_14=0;
						      dartmouth_15=0;
							     dartmouth_16=0;
								    dartmouth_17=0;

*do over dx;
	*Cancer with poor prognosis;
	if (substr(dx,1,4) in('1500','1501','1502','1503','1504','1505','1508','1509','1510','1511','1512',
			 	'1513','1514','1515','1516','1518','1519','1550','1551','1552','1570','1571',
			 	'1572','1573','1574','1578','1579','1580','1588','1589','1620','1622','1623',
			 	'1624','1625','1628','1629','1630','1631','1638','1639','1830','1832','1833',
			 	'1834','1835','1838','1839','1910','1911','1912','1913','1914','1915','1916',
			 	'1917','1918','1919','2890') 
		or substr(dx,1,5) in('20400','20410','20420','20480','20490','20500','20510',
				'20520','20530','20580','20590','20600','20610','20620','20680','20690','20700',
				'20710','20720','20780','20800','20810','20820','20880'))
               and dartmouth_1a=0
               then dartmouth_1a=1;
	*Metastatic Cancer;
	if (substr(dx,1,4) in('1960','1961','1962','1963','1965','1966','1968','1969','1970','1971','1972',
				'1973','1974','1975','1976','1977','1978','1980','1981','1982','1983','1984',
				'1985','1986','1987','1990','1991') or 
		substr(dx,1,5) in('19881','19882','19889'))
				and dartmouth_1b=0
				then dartmouth_1b=1;
	*Malignant Cancer, Leukemia;
	if dartmouth_1a=1 or dartmouth_1b=1 then dartmouth_1=1;
	*COPD;
	if (substr(dx,1,3) in('494','496','501','515') or
		substr(dx,1,4) in('4911,4918,4919,4920,4928,4940,4941,5064') or
		substr(dx,1,5) in('49120,49121,49122,49310,49311,49312,49320,49321,49322,49390,49391,49392'))
				and dartmouth_2=0
				then dartmouth_2=1;
	*CAD;
	if (substr(dx,1,3)='412' or
		substr(dx,1,4) in('4111','4118','4130','4139','4140','4148','4149') or
		substr(dx,1,5) in('41181','41189','41400','41401','41402','41403','41404','41405','41406','41407'))
				and dartmouth_3=0
				then dartmouth_3=1;
	*CHF;
	if (substr(dx,1,4) in('4280','4281','4282','4283','4284','4289') or
		substr(dx,1,5) in('42820','42821','42822','42823','42830','42831','42832','42833','42840','42841',
								'42842','42843','40201','40211','40291','39891','40401','40403','40411','40491',
								'40493'))
				and dartmouth_4=0
				then dartmouth_4=1;
	*PVD;
	if (substr(dx,1,4) in('4400','4401','4403','4408','4409','4410','4411','4412','4413','4414','4415','4416',
								'4417','4419','4439') or
		substr(dx,1,5) in('44020','44021','44022','44023','44024','44029','44030','44031','44032','44100','44101','44102','44103'))
				and dartmouth_5=0
				then dartmouth_5=1;
	*Severe Chronic Liver Disease;
	if substr(dx,1,4) in('5712','5715','5716','5723')
				and dartmouth_6=0
				then dartmouth_6=1;
	*Diabetes w/ End Organ Damage;
	if ((substr(dx,1,3)='250' and substr(dx,4,1) in('4','5','6','7','9') and substr(dx,5,1) in('0','1','2','3')) or
		substr(dx,1,4)='3572' or
		substr(dx,1,5) in('36641','36201','36202'))
				and dartmouth_7=0
				then dartmouth_7=1;
	*Renal Failure;
	if (substr(dx,1,3)='585' or
		substr(dx,1,4) in('5851','5852','5853','5854','5855','5856','5859','V451','V560','V568') or
		substr(dx,1,5) in('40301','40311','40391'))
				and dartmouth_8=0
				then dartmouth_8=1;
	*Dementia;
	if (substr(dx,1,3)='797' or
		substr(dx,1,4) in('2900','2903','2908','2909','2940','2941','2948','2949','3310','3312') or
		substr(dx,1,5) in('29101','29011','29012','29013','29020','29021','29040','29041','29042',
								'29043','29410','29411'))
				and dartmouth_9=0
				then dartmouth_9=1;

end;

run;

/*get count of each comorbidity for each id-core year combination*/
proc sql;
create table cha_test1 as
select distinct bene_id,index_year,
sum(dartmouth_1a) as dmouth_a,
sum(dartmouth_1b) as dmouth_b,
sum(dartmouth_1) as cha_1,
sum(dartmouth_2) as cha_2,
sum(dartmouth_3) as cha_3,
sum(dartmouth_4) as cha_4,
sum(dartmouth_5) as cha_5,
sum(dartmouth_6) as cha_6,
sum(dartmouth_7) as cha_7,
sum(dartmouth_8) as cha_8,
sum(dartmouth_9) as cha_9
from dx_dartmouth
group by bene_id,index_year;
quit;

/*convert counts of diagnoses for each comorbidity to indicator variables*/ 
data dartmouth_1(keep=bene_id index_year dmouth_1-dmouth_9 dmouth_index dmouth_index_wt);
set cha_test1;
array list_cha cha_1-cha_9;
array list_cha_bin dmouth_1-dmouth_9 ;

do over list_cha;
  list_cha_bin=0;

  if list_cha>0 then do;
    list_cha_bin=1;
   end;

end;
/*replace cancer subtypes with indicators*/
if dmouth_a>1 then dmouth_a=1;
if dmouth_b>1 then dmouth_b=1;
/*note this dmouth_index count count is not weighted for morbidity*/
dmouth_index=dmouth_1+dmouth_2+dmouth_3+dmouth_4+dmouth_5+dmouth_6+dmouth_7+dmouth_8+dmouth_9;


label dmouth_a ="Poor prognosis cancer, Dartmouth";
label dmouth_b ="Metastatic cancer, Dartmouth";
label dmouth_1 ="Malignant Cancer or Leukemia, Dartmouth";
label dmouth_2 ="Chronic Pulmonary Disease, Dartmouth";
label dmouth_3 ="CAD, Dartmouth";
label dmouth_4 ="CHF, Dartmouth";
label dmouth_5 ="PVD, Dartmouth";
label dmouth_6 ="Severe Chronic Liver Disease, Dartmouth";
label dmouth_7 ="Diabetes w/ End Organ Damage, Dartmouth";
label dmouth_8 ="Renal Failure, Dartmouth";
label dmouth_9 ="Dementia, Dartmouth";
label dmouth_index ="Count Chronic Diseases, Dartmouth";

run;

/*merge into list of obs with ffs mc 6m prior to ivw*/
proc sort data=dartmouth_1 out=test nodupkey;
by bene_id index_year;
run;



%rename(WORK,TEST,&range1._&range2);

data proj_int.dmouth_&range1._&range2.(rename =(bene_id_&range1._&range2=bene_id
index_year_&range1._&range2=index_year));
set test;
keep bene_id_&range1._&range2 dmouth: index_year:;
run;
proc sort data=proj_int.dmouth_&range1._&range2.;
by bene_id index_year;
run;

%mend;

%dartmouth(range1=0, range2=6m);
%dartmouth(range1=0, range2=1yr);



proc freq; run;

H="Elixhauser"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************

/*Note elixhauser comorbidities diagnosis lists are modified for the 
purposes of this project, do not copy and paste this Elixhauser code 
for use in other projects!!
*/

/****************************************************************************/
/* Rename variables macro                                                   */
/****************************************************************************/

%macro rename(lib,dsn,pre);
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "Before Renaming All Variables";
run;
proc sql noprint;
select nvar into :num_vars
from dictionary.tables
where libname="&LIB" and
memname="&DSN";
select distinct(name) into :var1-
:var%TRIM(%LEFT(&num_vars))
from dictionary.columns
where libname="&LIB" and
memname="&DSN";
quit;
run;
proc datasets library=&LIB;
modify &DSN;
rename
%do i=1 %to &num_vars;
&&var&i=&&var&i.._&pre 
%end;
;
quit;
run;
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "After Renaming All Variables";
run;
%mend rename;




/****************************************************************************/
/* Elixhauser comorbidities macro                                           */
/****************************************************************************/
/*Note elixhauser comorbidities diagnosis lists are modified for the 
purposes of this project, do not copy and paste this Elixhauser code 
for use in other projects!!*/

%macro elixhauser(range1=, range2=);

data dx_31_comor;
set proj_int.dx_&range1._&range2(rename=(diag=dx_0));
dx=trim(left(dx_0));

if dx~="" then do;

comorbi_1=0;
comorbi_2=0;
comorbi_3=0;
comorbi_4=0;
comorbi_5=0;
comorbi_6=0;
comorbi_7=0;
comorbi_8=0;
comorbi_9=0;
comorbi_10=0;
comorbi_11=0;
comorbi_12=0;
comorbi_13=0;
comorbi_14=0;
comorbi_15=0;
comorbi_16=0;
comorbi_17=0;
comorbi_18=0;
comorbi_19=0;
comorbi_20=0;
comorbi_21=0;
comorbi_22=0;
comorbi_23=0;
comorbi_24=0;
comorbi_25=0;
comorbi_26=0;
comorbi_27=0;
comorbi_28=0;
comorbi_29=0;
comorbi_30=0;
*end of intialize of 30 binary variables;
*add dementia and CAD and ALS;
dementia=0;
cad=0;
als=0;
renal_dis=0;

*do over dx;
	*Congestive Heart Failure;
	if (substr(dx,1,5)='39891' or
		substr(dx,1,5)='40211' or
		substr(dx,1,5)='40291' or
		substr(dx,1,5)='40411' or
		substr(dx,1,5)='40413' or
		substr(dx,1,5)='40491' or
		substr(dx,1,5)='40493' or
		substr(dx,1,3)='428') 
		and comorbi_1=0 
		then comorbi_1=1;*add one binary variables here.;
	if (substr(dx,1,4)='I099' or
		substr(dx,1,4)='I110' or
		substr(dx,1,4)='I130' or
		substr(dx,1,4)='I132' or
		substr(dx,1,4)='I255' or
		substr(dx,1,4)='I420' or
		substr(dx,1,4)='I425' or
		substr(dx,1,4)='I426' or
		substr(dx,1,4)='I427' or
		substr(dx,1,4)='I428' or
		substr(dx,1,4)='I429' or
		substr(dx,1,3)='I43' or
		substr(dx,1,4)='P290' or
		substr(dx,1,3)='I50') 
		and comorbi_1=0 
		then comorbi_1=1;

		*Cariac Arrhythmias;
	if (substr(dx,1,5)='42610' or
		substr(dx,1,5)='42611' or
		substr(dx,1,5)='42613' or
		substr(dx,1,4)='4262' or
		substr(dx,1,4)='4263' or
		substr(dx,1,4)='4264' or
		substr(dx,1,5)='42650' or
		substr(dx,1,5)='42651' or
		substr(dx,1,5)='42652' or
		substr(dx,1,5)='42653' or
		substr(dx,1,4)='4266' or
		substr(dx,1,4)='4267' or
		substr(dx,1,4)='4268' or
		substr(dx,1,4)='4270' or
		substr(dx,1,4)='4272' or
		substr(dx,1,5)='42731' or
		substr(dx,1,5)='42760' or
		substr(dx,1,4)='4279' or
		substr(dx,1,4)='7850' or
		substr(dx,1,4)='V450' or
		substr(dx,1,4)='V533')
			and comorbi_2=0 
		then comorbi_2=1;
	if (substr(dx,1,4)='I441' or
		substr(dx,1,4)='I442' or
		substr(dx,1,4)='I443' or
		substr(dx,1,4)='I456' or
		substr(dx,1,4)='I459' or
		substr(dx,1,3)='I47' or
		substr(dx,1,3)='I48' or
		substr(dx,1,3)='I49' or
		substr(dx,1,4)='ROOO' or
		substr(dx,1,4)='ROO1' or
		substr(dx,1,4)='ROO8' or
		substr(dx,1,4)='R000' or
		substr(dx,1,4)='R001' or
		substr(dx,1,4)='R008' or
		substr(dx,1,4)='T821' or
		substr(dx,1,4)='Z450' or
		substr(dx,1,4)='Z950')
			and comorbi_2=0 
		then comorbi_2=1;
	* Valvular Disease ;
	if (substr(dx,1,5)='09320' or
		substr(dx,1,5)='09321' or
		substr(dx,1,5)='09322' or
		substr(dx,1,5)='09323' or
		substr(dx,1,5)='09324' or
		substr(dx,1,3)='394' or
		substr(dx,1,3)='395' or
		substr(dx,1,3)='396' or
		substr(dx,1,4)='3970' or
		substr(dx,1,4)='3971' or
		substr(dx,1,4)='4240' or
		substr(dx,1,4)='4241' or
		substr(dx,1,4)='4242' or
		substr(dx,1,4)='4243' or
		substr(dx,1,4)='4244' or
		substr(dx,1,4)='4245' or
		substr(dx,1,4)='4246' or
		substr(dx,1,4)='4247' or
		substr(dx,1,4)='4248' or
		substr(dx,1,5)='42490' or
		substr(dx,1,5)='42491' or
		substr(dx,1,4)='7463' or
		substr(dx,1,4)='7464' or
		substr(dx,1,4)='7465' or
		substr(dx,1,4)='7466' or
		substr(dx,1,4)='V422' or
		substr(dx,1,4)='V433')
			and comorbi_3=0 
		then comorbi_3=1;
	if (substr(dx,1,4)='A520' or
		substr(dx,1,4)='I05' or
		substr(dx,1,3)='I06' or
		substr(dx,1,3)='I07' or
		substr(dx,1,3)='I08' or
		substr(dx,1,4)='I091' or
		substr(dx,1,4)='I098' or
		substr(dx,1,3)='I34' or
		substr(dx,1,3)='I35' or
		substr(dx,1,3)='I36' or
		substr(dx,1,3)='I37' or
		substr(dx,1,3)='I38' or
		substr(dx,1,3)='I39' or
		substr(dx,1,4)='Q230' or
		substr(dx,1,4)='Q231' or
		substr(dx,1,4)='Q232' or
		substr(dx,1,4)='Q233' or
		substr(dx,1,4)='Z952' or
		substr(dx,1,4)='Z954')
			and comorbi_3=0 
		then comorbi_3=1;
	*Pulmonary Circulation Disorders;
	if (substr(dx,1,3)='416' or
		substr(dx,1,4)='4179')
			and comorbi_4=0 
		then comorbi_4=1;
	if (substr(dx,1,3)='I26' or
		substr(dx,1,3)='I27' or
		substr(dx,1,4)='I280' or
		substr(dx,1,4)='I288' or
		substr(dx,1,4)='I289')
			and comorbi_4=0 
		then comorbi_4=1;
	*Peripheral Vascular Disorders;
	if (substr(dx,1,3)='440' or
		substr(dx,1,4)='4412' or
		substr(dx,1,4)='4414' or
		substr(dx,1,4)='4417' or
		substr(dx,1,4)='4419' or
		substr(dx,1,4)='4431' or
		substr(dx,1,4)='4432' or
		substr(dx,1,4)='4438' or
		substr(dx,1,4)='4439' or
		substr(dx,1,4)='4471' or
		substr(dx,1,4)='5571' or
		substr(dx,1,4)='5579' or
		substr(dx,1,4)='V434')
			and comorbi_5=0 
		then comorbi_5=1;
	if (substr(dx,1,3)='I70' or
		substr(dx,1,3)='I71' or
		substr(dx,1,4)='I731' or
		substr(dx,1,4)='I738' or
		substr(dx,1,4)='I739' or
		substr(dx,1,4)='I771' or
		substr(dx,1,4)='I790' or
		substr(dx,1,4)='I792' or
		substr(dx,1,4)='K551' or
		substr(dx,1,4)='K558' or
		substr(dx,1,4)='K559' or
		substr(dx,1,4)='X958' or
		substr(dx,1,4)='Z959')
			and comorbi_5=0 
		then comorbi_5=1;
	*Hypertension;
	if ((substr(dx,1,4)='4011' or
		substr(dx,1,4)='4019')) or
	   ((substr(dx,1,5)='40210' or
		substr(dx,1,5)='40290' or
		substr(dx,1,5)='40410' or
		substr(dx,1,5)='40490' or
		substr(dx,1,5)='40511' or
		substr(dx,1,5)='40519' or
		substr(dx,1,5)='40591' or
		substr(dx,1,5)='40599')) 
			and comorbi_6=0 
		then comorbi_6=1;
	if (substr(dx,1,3)='I10' or
		substr(dx,1,3)='I11' or
	    substr(dx,1,3)='I12' or
		substr(dx,1,3)='I13' or
		substr(dx,1,3)='I15')
			and comorbi_6=0 
		then comorbi_6=1;
	*Paralysis;	
	if (substr(dx,1,4)='3420' or
		substr(dx,1,5)='34210' or
		substr(dx,1,5)='34211' or
		substr(dx,1,5)='34212' or
		substr(dx,1,4)='3429' or
		substr(dx,1,3)='343' or
		substr(dx,1,3)='344')
			and comorbi_7=0 
		then comorbi_7=1;
	if (substr(dx,1,4)='G041' or
		substr(dx,1,4)='G114' or
		substr(dx,1,4)='G801' or
		substr(dx,1,4)='G802' or
		substr(dx,1,3)='G81' or
		substr(dx,1,3)='G82' or
		substr(dx,1,4)='G830' or 
		substr(dx,1,4)='G831' or 
		substr(dx,1,4)='G832' or 
		substr(dx,1,4)='G833' or 
		substr(dx,1,4)='G834' or 
		substr(dx,1,4)='G839')
			and comorbi_7=0 
		then comorbi_7=1;
	*Other Neurological Disorders;
	if (substr(dx,1,4)='3319' or
		substr(dx,1,4)='3320' or
		substr(dx,1,4)='3334' or
		substr(dx,1,4)='3335' or
		substr(dx,1,3)='334' or
		substr(dx,1,3)='335' or
		substr(dx,1,3)='340' or
		substr(dx,1,4)='3411' or
		substr(dx,1,4)='3418' or
		substr(dx,1,4)='3419' or
		substr(dx,1,5)='34500' or
		substr(dx,1,5)='34501' or
		substr(dx,1,5)='34510' or
		substr(dx,1,5)='34511' or
		substr(dx,1,4)='3454' or
		substr(dx,1,5)='34550' or
		substr(dx,1,5)='34551' or
		substr(dx,1,4)='3458' or
		substr(dx,1,5)='34590' or
		substr(dx,1,5)='34591' or
		substr(dx,1,4)='3481' or
		substr(dx,1,4)='3483' or
		substr(dx,1,4)='7803' or
		substr(dx,1,4)='7843') 
			and comorbi_8=0 
		then comorbi_8=1;	
	if (substr(dx,1,3)='G10' or
		substr(dx,1,3)='G13' or
		substr(dx,1,3)='G20' or
		substr(dx,1,3)='G22' or
		substr(dx,1,4)='G254' or
		substr(dx,1,4)='G255' or
		substr(dx,1,4)='G312' or
		substr(dx,1,4)='G318' or
		substr(dx,1,4)='G319' or
		substr(dx,1,3)='G32' or
		substr(dx,1,3)='G35' or
		substr(dx,1,3)='G36' or
		substr(dx,1,3)='G37' or
		substr(dx,1,3)='G40' or
		substr(dx,1,3)='G41' or
		substr(dx,1,4)='G931' or
		substr(dx,1,4)='G934' or
		substr(dx,1,4)='R470' or
		substr(dx,1,4)='R560') 
			and comorbi_8=0 
		then comorbi_8=1;	
		*Chronic Pulmonary Disease;
	if (substr(dx,1,3)='490' or
		substr(dx,1,3)='491' or
		substr(dx,1,3)='492' or
		substr(dx,1,4)='4930' or
		substr(dx,1,4)='4931' or
		substr(dx,1,4)='4932' or
		substr(dx,1,4)='4938' or
		substr(dx,1,5)='49390' or
		substr(dx,1,5)='49391' or
		substr(dx,1,3)='494' or
		substr(dx,1,3)='495' or
		substr(dx,1,3)='496' or
		substr(dx,1,3)='497' or
		substr(dx,1,3)='498' or
		substr(dx,1,3)='499' or
		substr(dx,1,3)='500' or
		substr(dx,1,3)='501' or
		substr(dx,1,3)='502' or
		substr(dx,1,3)='503' or
		substr(dx,1,3)='504' or
		substr(dx,1,3)='505' or
		substr(dx,1,4)='5064') 
			and comorbi_9=0 
		then comorbi_9=1;	
	if (substr(dx,1,4)='I278' or
		substr(dx,1,4)='I279' or
		substr(dx,1,3)='J40' or
		substr(dx,1,3)='J41' or
		substr(dx,1,3)='J42' or
		substr(dx,1,3)='J43' or
		substr(dx,1,3)='J44' or
		substr(dx,1,3)='J45' or
		substr(dx,1,3)='J46' or
		substr(dx,1,3)='J47' or
		substr(dx,1,3)='J60' or
		substr(dx,1,3)='J61' or
		substr(dx,1,3)='J62' or
		substr(dx,1,3)='J63' or
		substr(dx,1,3)='J64' or
		substr(dx,1,3)='J65' or
		substr(dx,1,3)='J66' or
		substr(dx,1,3)='J67' or
		substr(dx,1,4)='J684' or
		substr(dx,1,4)='J701' or
		substr(dx,1,4)='J703') 
			and comorbi_9=0 
		then comorbi_9=1;	
		*Diabetes, uncomplicated;
	if (substr(dx,1,4)='2500' or
		substr(dx,1,4)='2501' or
		substr(dx,1,4)='2502' or
		substr(dx,1,4)='2503') 
			and comorbi_10=0 
		then comorbi_10=1;
	if (substr(dx,1,4)='E100' or
		substr(dx,1,4)='E101' or
		substr(dx,1,4)='E109' or
		substr(dx,1,4)='E110' or
		substr(dx,1,4)='E111' or
		substr(dx,1,4)='E119' or
		substr(dx,1,4)='E120' or
		substr(dx,1,4)='E121' or
		substr(dx,1,4)='E129' or
		substr(dx,1,4)='E130' or
		substr(dx,1,4)='E131' or
		substr(dx,1,4)='E139' or
		substr(dx,1,4)='E140' or
		substr(dx,1,4)='E141' or
		substr(dx,1,4)='E149') 
			and comorbi_10=0 
		then comorbi_10=1;
	*Diabetes, complicated;
	if (substr(dx,1,4)='2504' or
		substr(dx,1,4)='2505' or
		substr(dx,1,4)='2506' or
		substr(dx,1,4)='2507' or
		substr(dx,1,4)='2509') 
			and comorbi_11=0 
		then comorbi_11=1;
	if (substr(dx,1,4)='E102' or
		substr(dx,1,4)='E103' or
		substr(dx,1,4)='E104' or
		substr(dx,1,4)='E105' or
		substr(dx,1,4)='E106' or
		substr(dx,1,4)='E107' or
		substr(dx,1,4)='E108' or
		substr(dx,1,4)='E112' or
		substr(dx,1,4)='E113' or
		substr(dx,1,4)='E114' or
		substr(dx,1,4)='E115' or
		substr(dx,1,4)='E116' or
		substr(dx,1,4)='E117' or
		substr(dx,1,4)='E118' or
		substr(dx,1,4)='E122' or
		substr(dx,1,4)='E123' or
		substr(dx,1,4)='E124' or
		substr(dx,1,4)='E125' or
		substr(dx,1,4)='E126' or
		substr(dx,1,4)='E127' or
		substr(dx,1,4)='E128' or
		substr(dx,1,4)='E132' or
		substr(dx,1,4)='E133' or
		substr(dx,1,4)='E134' or
		substr(dx,1,4)='E135' or
		substr(dx,1,4)='E136' or
		substr(dx,1,4)='E137' or
		substr(dx,1,4)='E138' or
		substr(dx,1,4)='E142' or
		substr(dx,1,4)='E143' or
		substr(dx,1,4)='E144' or
		substr(dx,1,4)='E145' or
		substr(dx,1,4)='E146' or
		substr(dx,1,4)='E147' or
		substr(dx,1,4)='E148') 
			and comorbi_11=0 
		then comorbi_11=1;
		*Hypothyroidism;
	if (substr(dx,1,3)='243' or
		substr(dx,1,4)='2440' or
		substr(dx,1,4)='2441' or
		substr(dx,1,4)='2442' or
		substr(dx,1,4)='2448' or
		substr(dx,1,4)='2449') 	
			and comorbi_12=0 
		then comorbi_12=1;
	if (substr(dx,1,3)='E00' or
		substr(dx,1,3)='E01' or
		substr(dx,1,3)='E02' or
		substr(dx,1,3)='E03' or
		substr(dx,1,4)='E890') 	
			and comorbi_12=0 
		then comorbi_12=1;
		*Renal Failure;
	*Original list modified to drop 2 codes  585 and V568;
	if (substr(dx,1,5)='40311' or
		substr(dx,1,5)='40391' or
		substr(dx,1,5)='40412' or
		substr(dx,1,5)='40492' or
		substr(dx,1,3)='586' or
		substr(dx,1,4)='V420' or
		substr(dx,1,4)='V451' or
		substr(dx,1,4)='V560') 
			and comorbi_13=0 
		then comorbi_13=1;
	if (substr(dx,1,4)='I120' or
		substr(dx,1,4)='I131' or
		substr(dx,1,4)='N185' or
		substr(dx,1,4)='N186' or
		substr(dx,1,3)='N19' or
		substr(dx,1,4)='N250' or
		substr(dx,1,4)='Z490' or
		substr(dx,1,4)='Z491' or
		substr(dx,1,4)='Z492' or
		substr(dx,1,4)='Z940' or
		substr(dx,1,4)='Z992') 
			and comorbi_13=0 
		then comorbi_13=1;
	*Advanced Liver Disease or Cirrhosis;
	*Code list modified from orig Elix;
	*572.4 hepatorenal syndrome must be added; 
	*Remove '07032' or – chronic hep B, '07033' or – chronic hep B, '07054' or – chronic hep C, '5713' or – 
		alcoholic liver damage, '5714' or – chronic hepatitis;
	if (substr(dx,1,4)='4560' or
		substr(dx,1,4)='4561' or
		substr(dx,1,5)='45620' or
		substr(dx,1,5)='45621' or
		substr(dx,1,4)='5710' or
		substr(dx,1,4)='5712' or
		substr(dx,1,4)='5715' or
		substr(dx,1,4)='5716' or
		substr(dx,1,4)='5718' or
		substr(dx,1,4)='5719' or
		substr(dx,1,4)='5723' or
		substr(dx,1,4)='5724' or
		substr(dx,1,4)='5728' or
		substr(dx,1,4)='V427') 
			and comorbi_14=0 
		then comorbi_14=1;
/*1/25/19--changed liver to reflect just what we want in the ICD-10 codes*/
		if (substr(dx,1,5)='I8500'
		or substr(dx,1,5)='I8501'
		or substr(dx,1,5)='I8510'
		or substr(dx,1,5)='I8511'
		or substr(dx,1,4)='K702'
		or substr(dx,1,5)='K7030'
		or substr(dx,1,5)='K7031'
		or substr(dx,1,5)='K7040'
		or substr(dx,1,5)='K7041'
		or substr(dx,1,5)='K7210'
		or substr(dx,1,5)='K7290'
		or substr(dx,1,4)='K740'
		or substr(dx,1,4)='K741'
		or substr(dx,1,4)='K742'
		or substr(dx,1,4)='K743'
		or substr(dx,1,4)='K744'
		or substr(dx,1,4)='K745'
		or substr(dx,1,5)='K7460'
		or substr(dx,1,5)='K7469'
		or substr(dx,1,4)='K766'
		or substr(dx,1,4)='K767') 
					and comorbi_14=0 
		then comorbi_14=1;
	*Peptic Ulcer Disease excluding bleeding;
	if (substr(dx,1,5)='53170' or
		substr(dx,1,5)='53190' or
		substr(dx,1,5)='53270' or
		substr(dx,1,5)='53290' or
		substr(dx,1,5)='53370' or
		substr(dx,1,5)='53390' or
		substr(dx,1,5)='53470' or
		substr(dx,1,5)='53490' or
		substr(dx,1,5)='V1271') 
			and comorbi_15=0 
		then comorbi_15=1;
	if (substr(dx,1,4)='K257' or
		substr(dx,1,4)='K259' or
		substr(dx,1,4)='K267' or
		substr(dx,1,4)='K269' or
		substr(dx,1,4)='K277' or
		substr(dx,1,4)='K279' or
		substr(dx,1,4)='K287' or
		substr(dx,1,4)='K289') 
			and comorbi_15=0 
		then comorbi_15=1;
		*AIDS;
	if (substr(dx,1,3)='042' or
		substr(dx,1,3)='043' or
		substr(dx,1,3)='044') 
			and comorbi_16=0 
		then comorbi_16=1;
		if (substr(dx,1,3)='B20' or
		substr(dx,1,3)='B21' or
		substr(dx,1,3)='B22' or
		substr(dx,1,3)='B24') 
			and comorbi_16=0 
		then comorbi_16=1;
	*Lymphoma;
	if (substr(dx,1,3)='200' or
		substr(dx,1,3)='201' or
		substr(dx,1,4)='2020' or
		substr(dx,1,4)='2021' or
		substr(dx,1,4)='2022' or
		substr(dx,1,4)='2023' or
		substr(dx,1,4)='2025' or
		substr(dx,1,4)='2026' or
		substr(dx,1,4)='2027' or
		substr(dx,1,4)='2028' or
		substr(dx,1,4)='2029' or
		substr(dx,1,4)='2030' or
		substr(dx,1,4)='2038' or
		substr(dx,1,4)='2386' or
		substr(dx,1,4)='2733' or
		substr(dx,1,5)='V1071' or
		substr(dx,1,5)='V1072' or
		substr(dx,1,5)='V1079')
			and comorbi_17=0 
		then comorbi_17=1;
	if (substr(dx,1,3)='C81' or
		substr(dx,1,3)='C82' or
		substr(dx,1,3)='C83' or
		substr(dx,1,3)='C84' or
		substr(dx,1,3)='C85' or
		substr(dx,1,3)='C88' or
		substr(dx,1,3)='C96' or
		substr(dx,1,4)='C900' or
		substr(dx,1,4)='C902')
			and comorbi_17=0 
		then comorbi_17=1;
		*Metastatic Cancer or Hematologic Cancer;
	*Modified to add lukemias;
	if (substr(dx,1,3)='196' or
		substr(dx,1,3)='197' or
		substr(dx,1,3)='198' or
		substr(dx,1,3)='199' or
		substr(dx,1,3)='204' or
		substr(dx,1,3)='205' or
		substr(dx,1,3)='206' or
		substr(dx,1,3)='207' or
		substr(dx,1,3)='208') 
			and comorbi_18=0 
		then comorbi_18=1;	
	if (substr(dx,1,3)='C77' or
		substr(dx,1,3)='C78' or
		substr(dx,1,3)='C79' or
		substr(dx,1,3)='C80') 
			and comorbi_18=0 
		then comorbi_18=1;	
		*Solid Tumor without Metastisis;
	if (substr(dx,1,2)='14' or
		substr(dx,1,2)='15' or
		substr(dx,1,2)='16' or
		substr(dx,1,3)='170' or
		substr(dx,1,3)='171' or
		substr(dx,1,3)='172' or
		substr(dx,1,3)='174' or
		substr(dx,1,3)='175' or
		substr(dx,1,3)='179' or
		substr(dx,1,2)='18' or
		substr(dx,1,3)='190' or
		substr(dx,1,3)='191' or
		substr(dx,1,3)='192' or
		substr(dx,1,3)='193' or
		substr(dx,1,3)='194' or
		substr(dx,1,3)='195' or
		substr(dx,1,3)='V10')
			and comorbi_19=0 
		then comorbi_19=1;
	if (substr(dx,1,2)='C0' or
		substr(dx,1,2)='C1' or
		substr(dx,1,3)='C20' or
		substr(dx,1,3)='C21' or
		substr(dx,1,3)='C22' or
		substr(dx,1,3)='C23' or
		substr(dx,1,3)='C24' or
		substr(dx,1,3)='C25' or
		substr(dx,1,3)='C26' or
		substr(dx,1,3)='C30' or
		substr(dx,1,3)='C31' or
		substr(dx,1,3)='C32' or
		substr(dx,1,3)='C33' or
		substr(dx,1,3)='C34' or
		substr(dx,1,3)='C37' or
		substr(dx,1,3)='C38' or
		substr(dx,1,3)='C39' or
		substr(dx,1,3)='C40' or
		substr(dx,1,3)='C41' or
		substr(dx,1,3)='C43' or
		substr(dx,1,3)='C45' or
		substr(dx,1,3)='C46' or
		substr(dx,1,3)='C47' or
		substr(dx,1,3)='C48' or
		substr(dx,1,3)='C49' or
		substr(dx,1,3)='C50' or
		substr(dx,1,3)='C51' or
		substr(dx,1,3)='C52' or
		substr(dx,1,3)='C53' or
		substr(dx,1,3)='C54' or
		substr(dx,1,3)='C55' or
		substr(dx,1,3)='C56' or
		substr(dx,1,3)='C57' or
		substr(dx,1,3)='C58' or
		substr(dx,1,3)='C60' or
		substr(dx,1,3)='C61' or
		substr(dx,1,3)='C62' or
		substr(dx,1,3)='C63' or
		substr(dx,1,3)='C64' or
		substr(dx,1,3)='C65' or
		substr(dx,1,3)='C66' or
		substr(dx,1,3)='C67' or
		substr(dx,1,3)='C68' or
		substr(dx,1,3)='C69' or
		substr(dx,1,3)='C70' or
		substr(dx,1,3)='C71' or
		substr(dx,1,3)='C72' or
		substr(dx,1,3)='C73' or
		substr(dx,1,3)='C74' or
		substr(dx,1,3)='C75' or
		substr(dx,1,3)='C76' or
		substr(dx,1,3)='C97')
			and comorbi_19=0 
		then comorbi_19=1;
		*Rheumatoid Arthritis/Collagen Vascular Diseases;
	if (substr(dx,1,4)='7010' or
		substr(dx,1,3)='710' or
		substr(dx,1,3)='714' or
		substr(dx,1,3)='720' or
		substr(dx,1,3)='725') 
			and comorbi_20=0 
		then comorbi_20=1;
	if (substr(dx,1,4)='L940' or
		substr(dx,1,4)='L941' or
		substr(dx,1,4)='L943' or
		substr(dx,1,3)='M05' or
		substr(dx,1,3)='M06' or
		substr(dx,1,3)='M08' or
		substr(dx,1,4)='M120' or
		substr(dx,1,4)='M123' or
		substr(dx,1,3)='M30' or
		substr(dx,1,4)='M310' or
		substr(dx,1,4)='M311' or
		substr(dx,1,4)='M312' or
		substr(dx,1,4)='M313' or
		substr(dx,1,3)='M32' or
		substr(dx,1,3)='M33' or
		substr(dx,1,3)='M34' or
		substr(dx,1,3)='M35' or
		substr(dx,1,3)='M45' or
		substr(dx,1,4)='M461' or
		substr(dx,1,4)='M468' or
		substr(dx,1,4)='M469') 
			and comorbi_20=0 
		then comorbi_20=1;
		*Coagulopathy;
	*Coagulopathy;
	if (substr(dx,1,3)='286' or
		substr(dx,1,4)='2871' or
		substr(dx,1,4)='2873' or
		substr(dx,1,4)='2874' or
		substr(dx,1,4)='2875') 
			and comorbi_21=0 
		then comorbi_21=1;
	if (substr(dx,1,3)='D65' or
		substr(dx,1,3)='D66' or
		substr(dx,1,3)='D67' or
		substr(dx,1,3)='D68' or
		substr(dx,1,4)='D691' or
		substr(dx,1,4)='D693' or
		substr(dx,1,4)='D694' or
		substr(dx,1,4)='D695' or
		substr(dx,1,4)='D696') 
			and comorbi_21=0 
		then comorbi_21=1;
	*Obesity;
	if (substr(dx,1,4)='2780'  or
		substr(dx,1,3)='E66')  
			and comorbi_22=0 
		then comorbi_22=1;
	*Weight Loss;
	if (substr(dx,1,3)='260' or
		substr(dx,1,3)='261' or
		substr(dx,1,3)='262' or
		substr(dx,1,3)='263' or
		substr(dx,1,3)='E40' or
		substr(dx,1,3)='E41' or
		substr(dx,1,3)='E42' or
		substr(dx,1,3)='E43' or
		substr(dx,1,3)='E44' or
		substr(dx,1,3)='E45' or
		substr(dx,1,3)='E46' or
		substr(dx,1,4)='R634' or
		substr(dx,1,3)='R64' ) 
			and comorbi_23=0 
		then comorbi_23=1;	
	*Fluid and Electrolyte Disorders;
	if (substr(dx,1,3)='276' or
		substr(dx,1,4)='E222' or
		substr(dx,1,3)='E86' or
		substr(dx,1,3)='E87' ) 
			and comorbi_24=0 
		then comorbi_24=1;
	*Blood Loss Anemia;
	if (substr(dx,1,4)='2800' or
		substr(dx,1,4)='D500' ) 
			and comorbi_25=0 
		then comorbi_25=1;
	*Deficiency Anemias;
	if (substr(dx,1,4)='2801' or
		substr(dx,1,4)='2808' or
		substr(dx,1,4)='2809' or
		substr(dx,1,4)='2859' or
		substr(dx,1,4)='D508' or
		substr(dx,1,3)='D509' or
		substr(dx,1,3)='D51' or
		substr(dx,1,3)='D52' or
		substr(dx,1,3)='D53' ) 
			and comorbi_26=0 
		then comorbi_26=1;
	*Alcohol Abuse;
	if (substr(dx,1,4)='2911' or
		substr(dx,1,4)='2912' or
		substr(dx,1,4)='2915' or
		substr(dx,1,4)='2918' or
		substr(dx,1,4)='2919' or
		substr(dx,1,4)='3039' or
		substr(dx,1,4)='3050' or
		substr(dx,1,4)='V113' or
		substr(dx,1,3)='F10' or
		substr(dx,1,3)='E52' or
		substr(dx,1,4)='G621' or
		substr(dx,1,4)='I426' or
		substr(dx,1,4)='K292' or
		substr(dx,1,4)='K700' or
		substr(dx,1,4)='K703' or
		substr(dx,1,4)='K709' or
		substr(dx,1,3)='T51' or
		substr(dx,1,4)='Z502' or
		substr(dx,1,4)='Z715' or
		substr(dx,1,4)='Z722') 
			and comorbi_27=0 
		then comorbi_27=1;
	*Drug Abuse;
	if (substr(dx,1,4)='2920' or
		substr(dx,1,5)='29282' or
		substr(dx,1,5)='29283' or
		substr(dx,1,5)='29284' or
		substr(dx,1,5)='29289' or
		substr(dx,1,4)='2929' or
		substr(dx,1,3)='304' or
		substr(dx,1,4)='3052' or
		substr(dx,1,4)='3053' or
		substr(dx,1,4)='3054' or
		substr(dx,1,4)='3055' or
		substr(dx,1,4)='3056' or
		substr(dx,1,4)='3057' or
		substr(dx,1,4)='3058' or
		substr(dx,1,4)='3059' or
		substr(dx,1,3)='F11' or
		substr(dx,1,3)='F12' or
		substr(dx,1,3)='F13' or
		substr(dx,1,3)='F14' or
		substr(dx,1,3)='F15' or
		substr(dx,1,3)='F16' or
		substr(dx,1,3)='F18' or
		substr(dx,1,3)='F19' or
		substr(dx,1,4)='Z715' or
		substr(dx,1,4)='Z722')
			and comorbi_28=0 
		then comorbi_28=1;	
	*Psychoses;
	if (substr(dx,1,3)='295' or
		substr(dx,1,3)='296' or
		substr(dx,1,3)='297' or
		substr(dx,1,3)='298' or
		substr(dx,1,4)='2991' or
		substr(dx,1,3)='F20' or
		substr(dx,1,3)='F22' or
		substr(dx,1,3)='F23' or
		substr(dx,1,3)='F24' or
		substr(dx,1,3)='F25' or
		substr(dx,1,3)='F28' or
		substr(dx,1,3)='F29' or
		substr(dx,1,4)='F302' or
		substr(dx,1,4)='F312' or
		substr(dx,1,4)='F315' ) 
			and comorbi_29=0 
		then comorbi_29=1;
	*Depression;
	if (substr(dx,1,4)='3004' or
		substr(dx,1,5)='30112' or
		substr(dx,1,4)='3090' or
		substr(dx,1,4)='3091' or
		substr(dx,1,3)='311' or
		substr(dx,1,3)='294' or
		substr(dx,1,4)='F313' or
		substr(dx,1,4)='F314' or
		substr(dx,1,4)='F315' or
		substr(dx,1,3)='F32' or
		substr(dx,1,3)='F33' or
		substr(dx,1,4)='F341' or
		substr(dx,1,4)='F412' or
		substr(dx,1,4)='F432' )
			and comorbi_30=0 
		then comorbi_30=1;

	*Dementia;
	if (substr(dx,1,4) in ('3310','3311','3312','2900','2901',
             '2902','2903','2912','2948','2949') or
		substr(dx,1,5) in ('29410','29411','29040','29041','29042','29043')) 
		and dementia=0 
          then dementia=1;
/*dementia*/
if (substr(dx,1,5)='F0150'
or substr(dx,1,5)='F0151'
or substr(dx,1,5)='F0280'
or substr(dx,1,5)='F0281'
or substr(dx,1,5)='F0390'
or substr(dx,1,5)='F0391'
or substr(dx,1,4)='F051'
or substr(dx,1,5)='F1027'
or substr(dx,1,5)='F1097'
or substr(dx,1,4)='G300'
or substr(dx,1,4)='G301'
or substr(dx,1,4)='G308'
or substr(dx,1,4)='G309'
or substr(dx,1,5)='G3101'
or substr(dx,1,5)='G3109'
or substr(dx,1,4)='G311'
or substr(dx,1,5)='G3183'
or substr(dx,1,4)='A811'
or substr(dx,1,4)='A812'
or substr(dx,1,4)='A818'
or substr(dx,1,5)='A8100'
or substr(dx,1,5)='A8101'
or substr(dx,1,5)='A8109'
or substr(dx,1,5)='A8181'
or substr(dx,1,5)='A8182'
or substr(dx,1,5)='A8183'
)  
		and dementia=0 
          then dementia=1;
	*CAD coronary artery disease;
	if (substr(dx,1,4) in ('4140','4142','4143','4148','4149') or 
		substr(dx,1,3) in ('410','411','412','413') or
		substr(dx,1,5) in ('V4581','V4582'))
		and cad=0 
          then cad=1;

	*ALS Amyotrophic lateral sclerosis;
	if (substr(dx,1,5)='33520') and als=0 
		then als=1;

*Renal Disease, new variable;
	*To identify diabetese with complications;
	if (substr(dx,1,5)='40311' or
		substr(dx,1,5)='40391' or
		substr(dx,1,5)='40412' or
		substr(dx,1,5)='40492' or
		substr(dx,1,3)='585' or
		substr(dx,1,3)='586' or
		substr(dx,1,4)='V420' or
		substr(dx,1,4)='V451' or
		substr(dx,1,4)='V560' or
		substr(dx,1,4)='V568') 
			and renal_dis=0 
		then renal_dis=1;

end;

run;

/*get count of each comorbidity for each id-core year combination*/
proc sql;
create table com_test1 as
select distinct bene_id,index_year,
sum(comorbi_1) as com_1,
sum(comorbi_2) as com_2,
sum(comorbi_3) as com_3,
sum(comorbi_4) as com_4,
sum(comorbi_5) as com_5,
sum(comorbi_6) as com_6,
sum(comorbi_7) as com_7,
sum(comorbi_8) as com_8,
sum(comorbi_9) as com_9,
sum(comorbi_10) as com_10,
sum(comorbi_11) as com_11,
sum(comorbi_12) as com_12,
sum(comorbi_13) as com_13,
sum(comorbi_14) as com_14,
sum(comorbi_15) as com_15,
sum(comorbi_16) as com_16,
sum(comorbi_17) as com_17,
sum(comorbi_18) as com_18,
sum(comorbi_19) as com_19,
sum(comorbi_20) as com_20,
sum(comorbi_21) as com_21,
sum(comorbi_22) as com_22,
sum(comorbi_23) as com_23,
sum(comorbi_24) as com_24,
sum(comorbi_25) as com_25,
sum(comorbi_26) as com_26,
sum(comorbi_27) as com_27,
sum(comorbi_28) as com_28,
sum(comorbi_29) as com_29,
sum(comorbi_30) as com_30,
sum(dementia) as dementia,
sum(cad) as cad,
sum(als) as als,
sum(renal_dis) as renal_dis
from dx_31_comor
group by bene_id,index_year;
quit;

/*convert counts of diagnoses for each comorbidity to indicator variables*/ 
data comorbidity_1(keep=bene_id index_year comorb_1-comorb_34 comorb_all);
set com_test1;
array list_com com_1-com_30 dementia cad als renal_dis;
array list_com_bin comorb_1-comorb_34 ;

do over list_com;
  list_com_bin=0;

  if list_com>0 then do;
    list_com_bin=1;
   end;

end;
/*note this comorb_all count does not include CAD or ALS or Renal disease*/
comorb_all=comorb_1+comorb_2+comorb_3+comorb_4+comorb_5+comorb_6+comorb_7+comorb_8+comorb_9+comorb_10
+comorb_11+comorb_12+comorb_13+comorb_14+comorb_15+comorb_16+comorb_17+comorb_18+comorb_19+comorb_20
+comorb_21+comorb_22+comorb_23+comorb_24+comorb_25+comorb_26+comorb_27+comorb_28+comorb_29+comorb_30
+comorb_31;

run;

/*merge in to list of core ivw dates for those with ffs mc, age=65+ */
proc sort data=comorbidity_1 nodupkey;
by bene_id index_year;
run;

data proj_int.elix_&range1._&range2;
set comorbidity_1 ;

label comorb_1 ="Congestive Heart Failure";
label comorb_2 ="Cardiac Arrhythmias";
label comorb_3 ="Valvular Disease";
label comorb_4 ="Pulmonary Circulation Disorders";
label comorb_5 ="Peripheral Vascular Disorders";
label comorb_6 ="Hypertension";
label comorb_7 ="Paralysis";
label comorb_8 ="Other Neurological Disorders";
label comorb_9 ="Chronic Pulmonary Disease";
label comorb_10 ="Diabetes, uncomplicated";
label comorb_11 ="Diabetes, complicated";
label comorb_12 ="Hypothyroidism";
label comorb_13 ="Renal Failure";
label comorb_14 ="Advanced Liver Disease or Cirrhosis";
label comorb_15 ="Peptic Ulcer Disease excluding bleeding";
label comorb_16 ="AIDS";
label comorb_17 ="Lymphoma";
label comorb_18 ="Metastatic or Hematologic Cancer";
label comorb_19 ="Solid Tumor without Metastisis";
label comorb_20 ="Rheumatoid Arthritis/Collagen Vascular Diseases";
label comorb_21 ="Coagulopathy";
label comorb_22 ="Obesity";
label comorb_23 ="Weight Loss";
label comorb_24 ="Fluid and Electrolyte Disorders";
label comorb_25 ="Blood Loss Anemia";
label comorb_26 ="Deficiency Anemias";
label comorb_27 ="Alcohol Abuse";
label comorb_28 ="Drug Abuse";
label comorb_29 ="Psychoses";
label comorb_30 ="Depression";
label comorb_31 ="Dementia";
label comorb_32 ="CAD";
label comorb_33 ="ALS";
label comorb_34 ="Renal Disease";
label comorb_all ="Count of Elix comorbidities";
run;

data test;
set proj_int.elix_&range1._&range2;
run;

%rename(WORK,TEST,&range1._&range2);

data proj_int.elix_&range1._&range2._2(rename =(bene_id_&range1._&range2=bene_id
index_year_&range1._&range2=index_year));
set test;
keep bene_id_&range1._&range2 comorb: index_year:;
run;
proc sort data=proj_int.elix_&range1._&range2._2;
by bene_id index_year;
run;

%mend;

/*Run for 1 year, 2 year datasets, resulting datasets are proj_int.elix_0_1yr_2, proj_int.elix_0_2yr_2*/
%elixhauser(range1=0, range2=6m);
%elixhauser(range1=0, range2=1yr);
%elixhauser(range1=0, range2=2yr);

proc freq data=proj_int.elix_0_1yr_2;
table comorb:;
run;

proc freq data=proj_int.elix_0_2yr_2;
table comorb:;
run;




/*this is merged into the main dataset when the elixhauser indicator variables 
in the next section*/
proc sql;
create table dem_dx_freq_2 as select distinct bene_id,index_year,
sum(dementia) as dem_dx_6m label="count dementia dx 6m pre core ivw"
 from proj_int.dem_dx_freq group by bene_id,index_year;
quit;

/* merge in the 1 year count of dementia diagnoses from the previous section*/
proc sql;
create table elix_6m_dm_dx_count as select a.*,b.dem_dx_6m from
proj_int.elix_0_6m_2 a left join
dem_dx_freq_2 b
on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_year=b.index_year;
quit;

/*overwrite the previously saved dataset with one with the additional dementia variable added*/
data proj_int.elix_0_6m_2;
set elix_6m_dm_dx_count;
if comorb_31_0_6m=0 and dem_dx_6m<=0 then dem_dx_6m=0;
run;

proc freq data=proj_int.elix_0_6m_2;
table comorb:;
run;

 

H="Charlson"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************


/*Add indicator variables for the Charlson comorbidities
and Charlson weighted and unweighted index */

/*Charlson code

This program reads through the diagnosis codes of patient abstract records in a hospital
    file and identifies whether the record belongs to one (or more) of 17 different Charlson
    Comorbidity Index (CCI) groups.  The groups are identified by using the Enhanced ICD-9-CM
    diagnosis codes listed in Quan et al., "Coding Algorithms for Defining Comorbidities
    in ICD-9-CM and ICD-10 Administrative Data", Medical Care:43(11), Nov. 2005 p1130-1139.*/

/*final datasets to be merged are proj_int.charls_0_1yr and proj_int.charls_0_2yr*/

/****************************************************************************/
/* Rename variables macro                                                   */
/****************************************************************************/

%macro rename(lib,dsn,pre);
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "Before Renaming All Variables";
run;
proc sql noprint;
select nvar into :num_vars
from dictionary.tables
where libname="&LIB" and
memname="&DSN";
select distinct(name) into :var1-
:var%TRIM(%LEFT(&num_vars))
from dictionary.columns
where libname="&LIB" and
memname="&DSN";
quit;
run;
proc datasets library=&LIB;
modify &DSN;
rename
%do i=1 %to &num_vars;
&&var&i=&&var&i.._&pre 
%end;
;
quit;
run;
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "After Renaming All Variables";
run;
%mend rename;


%macro charlson(range1=,range2=);

data dx_charlson;
set proj_int.dx_&range1._&range2.(rename=(diag=dx_0));
dx=trim(left(dx_0));

if dx~="" then do;

*initialize variables;
   charlson_1=0;
   charlson_2=0;
   charlson_3=0;
   charlson_4=0;
   charlson_5=0;
   charlson_6=0;
      charlson_7=0;
	     charlson_8=0;
		    charlson_9=0;
			   charlson_10=0;
			      charlson_11=0;
				     charlson_12=0;
					    charlson_13=0;
						   charlson_14=0;
						      charlson_15=0;
							     charlson_16=0;
								    charlson_17=0;

*do over dx;
   *Myocardial Infarction;
   if(substr(dx,1,3)='410' or
               substr(dx,1,3)='412')
               and charlson_1=0
               then charlson_1=1;
   *Congestive heart failure;
   if(substr(dx,1,5)='39891' or
               substr(dx,1,5)='40201' or
               substr(dx,1,5)='40211' or
               substr(dx,1,5)='40291' or
               substr(dx,1,5)='40401' or
               substr(dx,1,5)='40403' or
               substr(dx,1,5)='40411' or
               substr(dx,1,5)='40413' or
               substr(dx,1,5)='40491' or
               substr(dx,1,5)='40493' or
               substr(dx,1,4)='4254' or
               substr(dx,1,4)='4255' or
               substr(dx,1,4)='4256' or
               substr(dx,1,4)='4257' or
               substr(dx,1,4)='4258' or
               substr(dx,1,4)='4259' or
               substr(dx,1,3)='428')
               and charlson_2=0
               then charlson_2=1;
   *Periphral Vascular Disease;
    if(substr(dx,1,4)='0930' or
               substr(dx,1,4)='4373' or
               substr(dx,1,3)='440' or
               substr(dx,1,3)='441' or
               substr(dx,1,4)='4431' or
               substr(dx,1,4)='4432' or
               substr(dx,1,4)='4438' or
               substr(dx,1,4)='4439' or
               substr(dx,1,4)='4471' or
               substr(dx,1,4)='5571' or
               substr(dx,1,4)='5579' or
               substr(dx,1,4)='V434')
               and charlson_3=0
               then charlson_3=1;
    *Cerebrovascular Disease ;
        if(substr(dx,1,5)='36234' or
               substr(dx,1,3)='430' or
               substr(dx,1,3)='431' or
               substr(dx,1,3)='432' or
               substr(dx,1,3)='433' or
               substr(dx,1,3)='434' or
               substr(dx,1,3)='435' or
               substr(dx,1,3)='436' or
               substr(dx,1,3)='437' or
               substr(dx,1,3)='438')
               and charlson_4=0
               then charlson_4=1;
    *Dementia ;
       if(substr(dx,1,3)='290' or
               substr(dx,1,4)='2941' or
               substr(dx,1,4)='3312')
               and charlson_5=0
               then charlson_5=1;
   *Chronic Pulmonary Disease ;
        if(substr(dx,1,5)='4168' or
               substr(dx,1,4)='4169' or
               substr(dx,1,3)='490' or
               substr(dx,1,3)='491' or
               substr(dx,1,3)='492' or
               substr(dx,1,3)='493' or
               substr(dx,1,3)='494' or
               substr(dx,1,3)='495' or
               substr(dx,1,3)='496' or
               substr(dx,1,3)='500' or
               substr(dx,1,3)='501' or
               substr(dx,1,3)='502' or
               substr(dx,1,3)='503' or
               substr(dx,1,3)='504' or
               substr(dx,1,3)='505' or
               substr(dx,1,4)='5064' or
               substr(dx,1,4)='5081' or
               substr(dx,1,4)='5088')
               and charlson_6=0
               then charlson_6=1;
*Connective Tissue Disease-Rheumatic Disease;
         if(substr(dx,1,4)='4465' or
               substr(dx,1,4)='7100' or
               substr(dx,1,4)='7101' or
               substr(dx,1,4)='7102' or
               substr(dx,1,4)='7103' or
               substr(dx,1,4)='7104' or
               substr(dx,1,4)='7140' or
               substr(dx,1,4)='7141' or
               substr(dx,1,4)='7142' or
               substr(dx,1,4)='7148' or
               substr(dx,1,3)='725')
               and charlson_7=0
               then charlson_7=1;
 *Peptic Ulcer Disease;
         if(substr(dx,1,3)='531' or
               substr(dx,1,3)='532' or
               substr(dx,1,3)='533' or
               substr(dx,1,3)='534')
               and charlson_8=0
               then charlson_8=1;
*Mild Liver Disease ;
         if(substr(dx,1,5)='07022' or
               substr(dx,1,5)='07023' or
               substr(dx,1,5)='07032' or
               substr(dx,1,5)='07033' or
               substr(dx,1,5)='07044' or
               substr(dx,1,5)='07054' or
               substr(dx,1,4)='0706' or
               substr(dx,1,4)='0709' or
               substr(dx,1,3)='570' or
               substr(dx,1,3)='571' or
               substr(dx,1,4)='5733' or
               substr(dx,1,4)='5734' or
               substr(dx,1,4)='5738' or
               substr(dx,1,4)='5739' or
               substr(dx,1,4)='V427')
               and charlson_9=0
               then charlson_9=1;
*Diabetes without complications ;
         if(substr(dx,1,4)='2500' or
               substr(dx,1,4)='2501' or
               substr(dx,1,4)='2502' or
               substr(dx,1,4)='2503' or
               substr(dx,1,4)='2508' or
               substr(dx,1,4)='2509')
               and charlson_10=0
               then charlson_10=1;
*Diabetes, complicated;
	if (substr(dx,1,4)='2504' or
		substr(dx,1,4)='2505' or
		substr(dx,1,4)='2506' or
		substr(dx,1,4)='2507')
		and charlson_11=0
                then charlson_11=1;
*Paraplegia and Hemiplegia ;
	if (substr(dx,1,4)='3341' or
		substr(dx,1,3)='342' or
		substr(dx,1,3)='343' or
		substr(dx,1,4)='3440' or
		substr(dx,1,4)='3441' or
		substr(dx,1,4)='3442' or
		substr(dx,1,4)='3443' or
                substr(dx,1,4)='3444' or
		substr(dx,1,4)='3445' or
		substr(dx,1,4)='3446' or
		substr(dx,1,4)='3449')
		and charlson_12=0
                then charlson_12=1;
* Renal Disease ;
	if (substr(dx,1,5)='40301' or
		substr(dx,1,5)='40311' or
		substr(dx,1,5)='40391' or
		substr(dx,1,5)='40402' or
		substr(dx,1,5)='40403' or
		substr(dx,1,5)='40412' or
		substr(dx,1,5)='40413' or
                substr(dx,1,5)='40492' or
		substr(dx,1,5)='40493' or
		substr(dx,1,3)='582' or
		substr(dx,1,4)='5830' or
                substr(dx,1,4)='5831' or
                substr(dx,1,4)='5832' or
                substr(dx,1,4)='5834' or
                substr(dx,1,4)='5836' or
                substr(dx,1,4)='5837' or
                substr(dx,1,3)='585' or
                substr(dx,1,3)='586' or
                substr(dx,1,4)='5880' or
                substr(dx,1,4)='V420' or
                substr(dx,1,4)='V451' or
                substr(dx,1,3)='V56' )
		and charlson_13=0
                then charlson_13=1;
*Cancer ;
	if (substr(dx,1,2)='14' or
		substr(dx,1,2)='15' or
		substr(dx,1,2)='16' or
		substr(dx,1,3)='170' or
		substr(dx,1,3)='171' or
		substr(dx,1,3)='172' or
		substr(dx,1,3)='174' or
		substr(dx,1,3)='175' or
		substr(dx,1,3)='176' or
		substr(dx,1,3)='179' or
		substr(dx,1,2)='18' or
		substr(dx,1,3)='190' or
		substr(dx,1,3)='191' or
		substr(dx,1,3)='192' or
		substr(dx,1,3)='193' or
		substr(dx,1,3)='194' or
		substr(dx,1,3)='195' or
                substr(dx,1,3)='200' or
                substr(dx,1,3)='201' or
                substr(dx,1,3)='202' or
                substr(dx,1,3)='203' or
                substr(dx,1,3)='204' or
                substr(dx,1,3)='205' or
                substr(dx,1,3)='206' or
                substr(dx,1,3)='207' or
                substr(dx,1,3)='208' or
                substr(dx,1,3)='2386' )
		and charlson_14=0
                then charlson_14=1;
* Moderate or Severe Liver Disease ;
	if (substr(dx,1,4)='4560' or
		substr(dx,1,4)='4561' or
		substr(dx,1,4)='4562' or
		substr(dx,1,4)='5722' or
		substr(dx,1,4)='5723' or
		substr(dx,1,4)='5724' or
      		substr(dx,1,4)='5728' )
		and charlson_15=0
                then charlson_15=1;
  * Metastatic Carcinoma ;
	if (substr(dx,1,3)='196' or
		substr(dx,1,3)='197' or
		substr(dx,1,3)='198' or
		substr(dx,1,3)='199' )
		and charlson_16=0
                then charlson_16=1;
  * AIDS/HIV ;
	if (substr(dx,1,3)='042' or
		substr(dx,1,3)='043' or
		substr(dx,1,3)='044' )
		and charlson_17=0
                then charlson_17=1;

end;

run;

/*get count of each comorbidity for each id-core year combination*/
proc sql;
create table cha_test1 as
select distinct bene_id,index_year,
sum(charlson_1) as cha_1,
sum(charlson_2) as cha_2,
sum(charlson_3) as cha_3,
sum(charlson_4) as cha_4,
sum(charlson_5) as cha_5,
sum(charlson_6) as cha_6,
sum(charlson_7) as cha_7,
sum(charlson_8) as cha_8,
sum(charlson_9) as cha_9,
sum(charlson_10) as cha_10,
sum(charlson_11) as cha_11,
sum(charlson_12) as cha_12,
sum(charlson_13) as cha_13,
sum(charlson_14) as cha_14,
sum(charlson_15) as cha_15,
sum(charlson_16) as cha_16,
sum(charlson_17) as cha_17
from dx_charlson
group by bene_id,index_year;
quit;

/*convert counts of diagnoses for each comorbidity to indicator variables*/ 
data charlson_1(keep=bene_id index_year charls_1-charls_17 charls_index charls_index_wt);
set cha_test1;
array list_cha cha_1-cha_17;
array list_cha_bin charls_1-charls_17 ;

do over list_cha;
  list_cha_bin=0;

  if list_cha>0 then do;
    list_cha_bin=1;
   end;

end;
/*note this charls_index count count is not weighted for morbidity*/
charls_index=charls_1+charls_2+charls_3+charls_4+charls_5+charls_6+charls_7+charls_8+charls_9+charls_10
+charls_11+charls_12+charls_13+charls_14+charls_15+charls_16+charls_17;
/*now morbidity weighted*/
charls_index_wt=charls_1+charls_2+charls_3+charls_4+charls_5+charls_6+charls_7+charls_8+charls_9+charls_10
+2*charls_11+2*charls_12+2*charls_13+2*charls_14+3*charls_15+6*charls_16+6*charls_17;

label charls_1 ="Myocardial infarction, Charlson";
label charls_2 ="Congestive Heart Failure, Charlson";
label charls_3 ="Peripheral Vascular Disease, Charlson";
label charls_4 ="Cerebrovascular disease, Charlson";
label charls_5 ="Dementia, Charlson";
label charls_6 ="Chronic Pulmonary Disease, Charlson";
label charls_7 ="Rheumatic disease, Charlson";
label charls_8 ="Peptic ulcer disease, Charlson";
label charls_9 ="Mild liver disease, Charlson";
label charls_10 ="Diabetes, uncomplicated, Charlson";
label charls_11 ="Diabetes, complicated, Charlson";
label charls_12 ="Hemiplegia or paraplegia, Charlson";
label charls_13 ="Renal disease, Charlson";
label charls_14 ="Any malignancy except neoplasm of skin, Charlson";
label charls_15 ="Mod or severe liver disease, Charlson";
label charls_16 ="Metastatic solid tumor, Charlson";
label charls_17 ="AIDS/HIV, Charlson";
label charls_index ="Charlson score index, not weighted";
label charls_index_wt ="Charlson score index, weighted";

run;

/*merge into list of obs with ffs mc 6m prior to ivw*/
proc sort data=charlson_1 out=test nodupkey;
by bene_id index_year;
run;



%rename(WORK,TEST,&range1._&range2);

data proj_int.charls_&range1._&range2.(rename =(bene_id_&range1._&range2=bene_id
index_year_&range1._&range2=index_year));
set test;
keep bene_id_&range1._&range2 charls: index_year:;
run;
proc sort data=proj_int.charls_&range1._&range2.;
by bene_id index_year;
run;

%mend;

%charlson(range1=0, range2=6m);
%charlson(range1=0, range2=1yr);
%charlson(range1=0, range2=2yr);

proc freq data=proj_int.charls_0_1yr;
table charls:;
run;

proc freq data=proj_int.charls_0_6m;
table charls:;
run;



H="CCW"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************


/*CMS Data Warehouse Chronic Conditions*/
/*final datasets to merge are proj_int.chronic_21_1yr3_0 & proj_int.chronic_21_2yr3_0*/
/****************************************************************************/
/*First get the dx list into dot format using Stata*/
/****************************************************************************/

/*export to Stata*/
proc export data=proj_int.dx_0_6m
outfile="E:\nhats\data\projects\pal_perf_scale\int_data\dx_0_6m.dta" replace;
run;

proc export data=proj_int.dx_0_1yr
outfile="E:\nhats\data\projects\pal_perf_scale\int_data\dx_0_1yr.dta" replace;
run;

proc export data=proj_int.dx_0_2yr
outfile="E:\nhats\data\projects\pal_perf_scale\int_data\dx_0_2yr.dta" replace;
run;

/****************************************************************************/
/****************************************************************************/
/*SWITCH TO STATA HERE*/
/****************************************************************************/
/****************************************************************************/

capture log close
clear
set more off
local datapath E:\nhats\data\projects\pal_perf_scale\int_data

use `datapath'\dx_0_6m.dta,clear

// convert diagnosis codes to string variables, tostring diag,gen(icd9_c)
gen new=ltrim(diag)
icd9 check new,gen(icd9_c)
replace new="" if icd9_c>0 
// convert into dot format (ex 12.1 instead of 121)
icd9 clean new,dots 

replace diag=new
drop icd9_c new

save `datapath'\dx_0_6m_2.dta,replace
outsheet using `datapath'\dx_0_6m_2.csv, comma replace


use `datapath'\dx_0_1yr.dta,clear

// convert diagnosis codes to string variables, tostring diag,gen(icd9_c)
gen new=ltrim(diag)
icd9 check new,gen(icd9_c)
replace new="" if icd9_c>0 
// convert into dot format (ex 12.1 instead of 121)
icd9 clean new,dots 

replace diag=new
drop icd9_c new

save `datapath'\dx_0_1yr_2.dta,replace
outsheet using `datapath'\dx_0_1yr_2.csv, comma replace


clear all

use `datapath'\dx_0_2yr.dta,clear

// convert diagnosis codes to string variables, tostring diag,gen(icd9_c)
gen new=ltrim(diag)
icd9 check new,gen(icd9_c)
replace new="" if icd9_c>0 
// convert into dot format (ex 12.1 instead of 121)
icd9 clean new,dots 

replace diag=new
drop icd9_c new

save `datapath'\dx_0_2yr_2.dta,replace
outsheet using `datapath'\dx_0_2yr_2.csv, comma replace


/****************************************************************************/
/****************************************************************************/
/*SWITCH TO SAS HERE*/
/****************************************************************************/
/****************************************************************************/
/****************************************************************************/
/* Rename variables macro                                                   */
/****************************************************************************/

%macro rename(lib,dsn,pre);
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "Before Renaming All Variables";
run;
proc sql noprint;
select nvar into :num_vars
from dictionary.tables
where libname="&LIB" and
memname="&DSN";
select distinct(name) into :var1-
:var%TRIM(%LEFT(&num_vars))
from dictionary.columns
where libname="&LIB" and
memname="&DSN";
quit;
run;
proc datasets library=&LIB;
modify &DSN;
rename
%do i=1 %to &num_vars;
&&var&i=&&var&i.._&pre 
%end;
;
quit;
run;
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "After Renaming All Variables";
run;
%mend rename;


proc import 
datafile="E:\nhats\data\projects\pal_perf_scale\int_data\dx_0_1yr_2.csv" 
out=dx_0_1yr_2 replace;
run;

proc import 
datafile="E:\nhats\data\projects\pal_perf_scale\int_data\dx_0_6m_2.csv" 
out=dx_0_6m_2 replace;
run;

proc import 
datafile="E:\nhats\data\projects\pal_perf_scale\int_data\dx_0_2yr_2.csv" 
out=dx_0_2yr_2 replace;
run;

/*bring in excel list of dx codes associated with each chronic condition*/
proc import 
datafile='E:\nhats\data\projects\serious_ill\ref_data\chronic_21_condition_icd9.xls'
out=icd9_21_chronic dbms=xls replace;
run;

proc contents data=icd9_21_chronic;
run;

/*creates macro variables of each of the chronic conditions listing of dx codes*/
proc sql;
select icd_9 into :chronic_desc1-:chronic_desc21 from icd9_21_chronic;
quit;
%put &chronic_desc10;
%put &chronic_desc5;

/*******************************************************************/
/*Macro to generate chronic conditions indicators using dx codes   */
/*******************************************************************/

%macro cc(precore=);

data list_&precore._dx;
set dx_0_&precore._2;
array list CC_1_AMI
CC_2_ALZH
CC_3_ALZHDMTA
CC_4_ATRIALFB
CC_5_CATARACT
CC_6_CHRNKIDN
CC_7_COPD
CC_8_CHF
CC_9_DIABETES
CC_10_GLAUCOMA
CC_11_HIPFRAC
CC_12_ISCHMCHT
CC_13_DEPRESSN
CC_14_OSTEOPRS
CC_15_RA_OA
CC_16_STRKETIA
CC_17_CNCRBRST
CC_18_CNCRCLRC
CC_19_CNCRPRST
CC_20_CNCRLUNG
CC_21_CNCREndM;
do over list ;
list=0;
end;

diag_string=diag;

/* for dx codes that begin with numbers, process chronic cond variables*/
if anydigit(substr(trim(left(diag_string)),1,1))=1 then do;
diag=diag_string+0;

if diag in (&chronic_desc1) then CC_1_AMI=1;
if diag in (&chronic_desc2)  then CC_2_ALZH=1;
if diag in (&chronic_desc3)  then CC_3_ALZHDMTA=1;
if diag in (&chronic_desc4) then CC_4_ATRIALFB=1;
if diag in (&chronic_desc5) then CC_5_CATARACT=1;
if diag in (&chronic_desc6) then CC_6_CHRNKIDN=1;
if diag in (&chronic_desc7) then CC_7_COPD=1;
if diag in (&chronic_desc8) then CC_8_CHF=1;
if diag in (&chronic_desc9) then CC_9_DIABETES=1;
if diag in (&chronic_desc10) then CC_10_GLAUCOMA=1;
if diag in (&chronic_desc11) then CC_11_HIPFRAC=1;
if diag in (&chronic_desc12) then CC_12_ISCHMCHT=1;
if diag in (&chronic_desc13) then CC_13_DEPRESSN=1;
if diag in (&chronic_desc14) then CC_14_OSTEOPRS=1;
if diag in (&chronic_desc15) then CC_15_RA_OA=1;
if diag in (&chronic_desc16) then CC_16_STRKETIA=1;
if diag in (&chronic_desc17) then CC_17_CNCRBRST=1;
if diag in (&chronic_desc18) then CC_18_CNCRCLRC=1;
if diag in (&chronic_desc19) then CC_19_CNCRPRST=1;
if diag in (&chronic_desc20) then CC_20_CNCRLUNG=1;
if diag in (&chronic_desc21) then CC_21_CNCREndM=1;
end;

/*Process with dx codes that start with letters
Only two of them in the list*/
if anydigit(substr(trim(left(diag_string)),1,1))=0 then do;
if trim(left(diag_string)) in ("V431") then CC_5_CATARACT=1;
if trim(left(diag_string)) in ("V801") then CC_10_GLAUCOMA=1;
end;

run;


proc sql;
create table bid_dx_0_&precore. as
select distinct bene_id,index_year,
sum(CC_1_AMI) as CC_1_AMI,
sum(CC_2_ALZH) as CC_2_ALZH,
sum(CC_3_ALZHDMTA) as CC_3_ALZHDMTA,
sum(CC_4_ATRIALFB) as CC_4_ATRIALFB,
sum(CC_5_CATARACT) as CC_5_CATARACT,
sum(CC_6_CHRNKIDN) as CC_6_CHRNKIDN,
sum(CC_7_COPD) as CC_7_COPD,
sum(CC_8_CHF) as CC_8_CHF,
sum(CC_9_DIABETES) as CC_9_DIABETES,
sum(CC_10_GLAUCOMA) as CC_10_GLAUCOMA,
sum(CC_11_HIPFRAC) as CC_11_HIPFRAC,
sum(CC_12_ISCHMCHT) as CC_12_ISCHMCHT,
sum(CC_13_DEPRESSN) as CC_13_DEPRESSN,
sum(CC_14_OSTEOPRS) as CC_14_OSTEOPRS,
sum(CC_15_RA_OA) as CC_15_RA_OA,
sum(CC_16_STRKETIA) as CC_16_STRKETIA,
sum(CC_17_CNCRBRST) as CC_17_CNCRBRST,
sum(CC_18_CNCRCLRC) as CC_18_CNCRCLRC,
sum(CC_19_CNCRPRST) as CC_19_CNCRPRST,
sum(CC_20_CNCRLUNG) as CC_20_CNCRLUNG,
sum(CC_21_CNCREndM) as CC_21_CNCREndM

from list_&precore._dx group by bene_id,index_year;
quit;

proc sort data=bid_dx_0_&precore. nodupkey;
by bene_id index_year;
run;

/*convert to chronic condition vars. to binary variables*/
 data bid_dx_0_&precore.3;
 set bid_dx_0_&precore.;
 array list CC_1_AMI
CC_2_ALZH
CC_3_ALZHDMTA
CC_4_ATRIALFB
CC_5_CATARACT
CC_6_CHRNKIDN
CC_7_COPD
CC_8_CHF
CC_9_DIABETES
CC_10_GLAUCOMA
CC_11_HIPFRAC
CC_12_ISCHMCHT
CC_13_DEPRESSN
CC_14_OSTEOPRS
CC_15_RA_OA
CC_16_STRKETIA
CC_17_CNCRBRST
CC_18_CNCRCLRC
CC_19_CNCRPRST
CC_20_CNCRLUNG
CC_21_CNCREndM
;
do over list ;
if list>0 then list=1;
if list<=0 then list=0;
end;

/*create aggregated indicators*/
CC_AMI_isch=CC_1_AMI|CC_12_ISCHMCHT;
CC_alzheim=CC_2_ALZH|CC_3_ALZHDMTA;
CC_cncr_chronic=CC_17_CNCRBRST | CC_18_CNCRCLRC | CC_19_CNCRPRST | CC_20_CNCRLUNG | 
	CC_21_CNCREndM ;
run;

proc means;
var CC_1_AMI
CC_2_ALZH
CC_3_ALZHDMTA
CC_4_ATRIALFB
CC_5_CATARACT
CC_6_CHRNKIDN
CC_7_COPD
CC_8_CHF
CC_9_DIABETES
CC_10_GLAUCOMA
CC_11_HIPFRAC
CC_12_ISCHMCHT
CC_13_DEPRESSN
CC_14_OSTEOPRS
CC_15_RA_OA
CC_16_STRKETIA
CC_17_CNCRBRST
CC_18_CNCRCLRC
CC_19_CNCRPRST
CC_20_CNCRLUNG
CC_21_CNCREndM;
run;

/*run rename macro*/
data test;
set bid_dx_0_&precore.3;
run;

%rename(WORK,TEST,&precore.);

data proj_int.chronic_21_&precore.3_0;
set test;
bene_id=bene_id_&precore.;
index_year=index_year_&precore.;
drop bene_id_&precore. index_year_&precore.;
run;

%mend;

/*2 datasets are proj_int.chronic_21_1yr_0 and proj_int.chronic_21_2yr_0*/
%cc(precore=6m);
%cc(precore=1yr);
%cc(precore=2yr);

data proj_int.ccw;
set proj_int.chronic_21_6m3_0;
index_year2=input(index_year,8.);
drop index_year;
rename index_year2=index_year;
run;


H="CCW from ICD-10"
/*

Created by: EBL
Date Created: 4/23/19

Updated by:
Date Updated:




**************************************************


/*Add indicator variables for the ccw comorbidities
and ccw weighted and unweighted index */

/*ccw code

This program reads through the diagnosis codes of patient abstract records in a hospital
    file and identifies whether the record belongs to one (or more) of 17 different ccw
    Comorbidity Index (CCI) groups.  The groups are identified by using the Enhanced ICD-9-CM
    diagnosis codes listed in Quan et al., 'Coding Algorithms for Defining Comorbidities
    in ICD-9-CM and ICD-10 Administrative Data', Medical Care:43(11), Nov. 2005 p1130-1139.*/

/*final datasets to be merged are proj_int.ccw_0_1yr and proj_int.ccw_0_2yr*/

/****************************************************************************/
/* Rename variables macro                                                   */
/****************************************************************************/

%macro rename(lib,dsn,pre);
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "Before Renaming All Variables";
run;
proc sql noprint;
select nvar into :num_vars
from dictionary.tables
where libname="&LIB" and
memname="&DSN";
select distinct(name) into :var1-
:var%TRIM(%LEFT(&num_vars))
from dictionary.columns
where libname="&LIB" and
memname="&DSN";
quit;
run;
proc datasets library=&LIB;
modify &DSN;
rename
%do i=1 %to &num_vars;
&&var&i=&&var&i.._&pre 
%end;
;
quit;
run;
options pageno=1 nodate;
proc contents data=&lib..&dsn;
title "After Renaming All Variables";
run;
%mend rename;



%macro ccw(range1=,range2=);

data dx_ccw;
set proj_int.dx_&range1._&range2.(rename=(diag=dx_0));
dx=trim(left(dx_0));

if dx~='' then do;

*initialize variables;
   ccw_1=0;
   ccw_2=0;
   ccw_3=0;
   ccw_4=0;
   ccw_5=0;
   ccw_6=0;
      ccw_7=0;
	     ccw_8=0;
		    ccw_9=0;
			   ccw_10=0;
			      ccw_11=0;
				     ccw_12=0;
					    ccw_13=0;
						   ccw_14=0;
						      ccw_15=0;
							     ccw_16=0;
								    ccw_17=0;
	     ccw_18=0;
		    ccw_19=0;
			   ccw_20=0;
			      ccw_21=0;
				     ccw_22=0;
					    ccw_23=0;
						   ccw_24=0;
						      ccw_25=0;
							     ccw_26=0;
								    ccw_27=0;
*do over dx;
   *Acquired Hypothyroidism;
   if (substr(dx,1,4) =	'2441'
or substr(dx,1,4) =	'2442'
or substr(dx,1,4) =	'2443'
or substr(dx,1,4) =	'2448'
or substr(dx,1,4) =	'2449'
or substr(dx,1,4) =	'2440'
or substr(dx,1,4) =	'E018'
or substr(dx,1,3) =	'E02'
or substr(dx,1,4) =	'E032'
or substr(dx,1,4) =	'E033'
or substr(dx,1,4) =	'E038'
or substr(dx,1,4) =	'E039'
or substr(dx,1,4) =	'E890')

               and ccw_1=0
               then ccw_1=1;
   *AMI;
   if (substr(dx,1,5) =	'41001'
or substr(dx,1,5) =	'41011'
or substr(dx,1,5) =	'41021'
or substr(dx,1,5) =	'41031'
or substr(dx,1,5) =	'41041'
or substr(dx,1,5) =	'41051'
or substr(dx,1,5) =	'41061'
or substr(dx,1,5) =	'41071'
or substr(dx,1,5) =	'41081'
or substr(dx,1,5) =	'41091'
or substr(dx,1,5) =	'I2101'
or substr(dx,1,5) =	'I2102'
or substr(dx,1,5) =	'I2109'
or substr(dx,1,5) =	'I2111'
or substr(dx,1,5) =	'I2119'
or substr(dx,1,5) =	'I2121'
or substr(dx,1,5) =	'I2129'
or substr(dx,1,4) =	'I213'
or substr(dx,1,4) =	'I214'
or substr(dx,1,4) =	'I219'
or substr(dx,1,5) =	'I21A1'
or substr(dx,1,5) =	'I21A9'
or substr(dx,1,4) =	'I220'
or substr(dx,1,4) =	'I221'
or substr(dx,1,4) =	'I222'
or substr(dx,1,4) =	'I228'
or substr(dx,1,4) =	'I229')
               and ccw_2=0
               then ccw_2=1;
   *Alzheimers Disease;
    if (substr(dx,1,4) =	'3310'
or substr(dx,1,4) =	'G300'
or substr(dx,1,4) =	'G301'
or substr(dx,1,4) =	'G308'
or substr(dx,1,4) =	'G309')
               and ccw_3=0
               then ccw_3=1;
    *Alzheimers and Related Disorders or Senile Dementia ;
     if (substr(dx,1,5) =	'29011'
or substr(dx,1,5) =	'29012'
or substr(dx,1,5) =	'29013'
or substr(dx,1,5) =	'29010'
or substr(dx,1,5) =	'29021'
or substr(dx,1,5) =	'29020'
or substr(dx,1,4) =	'2903'
or substr(dx,1,5) =	'29041'
or substr(dx,1,5) =	'29042'
or substr(dx,1,5) =	'29043'
or substr(dx,1,5) =	'29040'
or substr(dx,1,5) =	'29000'
or substr(dx,1,5) =	'29411'
or substr(dx,1,5) =	'29410'
or substr(dx,1,5) =	'29421'
or substr(dx,1,5) =	'29420'
or substr(dx,1,4) =	'2948'
or substr(dx,1,4) =	'2940'
or substr(dx,1,5) =	'33111'
or substr(dx,1,5) =	'33119'
or substr(dx,1,4) =	'3312'
or substr(dx,1,4) =	'3317'
or substr(dx,1,4) =	'3310'
or substr(dx,1,3) =	'797'
or substr(dx,1,5) =	'F0150'
or substr(dx,1,5) =	'F0151'
or substr(dx,1,5) =	'F0280'
or substr(dx,1,5) =	'F0281'
or substr(dx,1,5) =	'F0390'
or substr(dx,1,5) =	'F0391'
or substr(dx,1,3) =	'F04'
or substr(dx,1,3) =	'F05'
or substr(dx,1,4) =	'F061'
or substr(dx,1,4) =	'F068'
or substr(dx,1,4) =	'G138'
or substr(dx,1,4) =	'G300'
or substr(dx,1,4) =	'G301'
or substr(dx,1,4) =	'G308'
or substr(dx,1,4) =	'G309'
or substr(dx,1,5) =	'G3101'
or substr(dx,1,5) =	'G3109'
or substr(dx,1,4) =	'G311'
or substr(dx,1,4) =	'G312'
or substr(dx,1,3) =	'G94'
or substr(dx,1,5) =	'R4181'
or substr(dx,1,3) =	'R54')
               and ccw_4=0
               then ccw_4=1;
   *Anemia ;
       if (substr(dx,1,4) =	'2801'
or substr(dx,1,4) =	'2808'
or substr(dx,1,4) =	'2809'
or substr(dx,1,4) =	'2800'
or substr(dx,1,4) =	'2811'
or substr(dx,1,4) =	'2812'
or substr(dx,1,4) =	'2813'
or substr(dx,1,4) =	'2814'
or substr(dx,1,4) =	'2818'
or substr(dx,1,4) =	'2819'
or substr(dx,1,4) =	'2810'
or substr(dx,1,4) =	'2821'
or substr(dx,1,4) =	'2822'
or substr(dx,1,4) =	'2823'
or substr(dx,1,5) =	'28241'
or substr(dx,1,5) =	'28242'
or substr(dx,1,5) =	'28243'
or substr(dx,1,5) =	'28244'
or substr(dx,1,5) =	'28245'
or substr(dx,1,5) =	'28246'
or substr(dx,1,5) =	'28247'
or substr(dx,1,5) =	'28249'
or substr(dx,1,5) =	'28240'
or substr(dx,1,4) =	'2825'
or substr(dx,1,5) =	'28261'
or substr(dx,1,5) =	'28262'
or substr(dx,1,5) =	'28263'
or substr(dx,1,5) =	'28264'
or substr(dx,1,5) =	'28268'
or substr(dx,1,5) =	'28269'
or substr(dx,1,5) =	'28260'
or substr(dx,1,4) =	'2827'
or substr(dx,1,4) =	'2828'
or substr(dx,1,4) =	'2829'
or substr(dx,1,4) =	'2820'
or substr(dx,1,5) =	'28311'
or substr(dx,1,5) =	'28319'
or substr(dx,1,4) =	'2831'
or substr(dx,1,4) =	'2832'
or substr(dx,1,4) =	'2839'
or substr(dx,1,4) =	'2830'
or substr(dx,1,5) =	'28401'
or substr(dx,1,5) =	'28409'
or substr(dx,1,5) =	'28411'
or substr(dx,1,5) =	'28412'
or substr(dx,1,5) =	'28419'
or substr(dx,1,4) =	'2842'
or substr(dx,1,5) =	'28481'
or substr(dx,1,5) =	'28489'
or substr(dx,1,4) =	'2849'
or substr(dx,1,4) =	'2851'
or substr(dx,1,5) =	'28521'
or substr(dx,1,5) =	'28522'
or substr(dx,1,5) =	'28529'
or substr(dx,1,4) =	'2853'
or substr(dx,1,4) =	'2858'
or substr(dx,1,4) =	'2859'
or substr(dx,1,4) =	'2850'
or substr(dx,1,4) =	'D500'
or substr(dx,1,4) =	'D501'
or substr(dx,1,4) =	'D508'
or substr(dx,1,4) =	'D509'
or substr(dx,1,4) =	'D510'
or substr(dx,1,4) =	'D511'
or substr(dx,1,4) =	'D512'
or substr(dx,1,4) =	'D513'
or substr(dx,1,4) =	'D518'
or substr(dx,1,4) =	'D519'
or substr(dx,1,4) =	'D520'
or substr(dx,1,4) =	'D521'
or substr(dx,1,4) =	'D528'
or substr(dx,1,4) =	'D529'
or substr(dx,1,4) =	'D530'
or substr(dx,1,4) =	'D531'
or substr(dx,1,4) =	'D532'
or substr(dx,1,4) =	'D538'
or substr(dx,1,4) =	'D539'
or substr(dx,1,4) =	'D550'
or substr(dx,1,4) =	'D551'
or substr(dx,1,4) =	'D552'
or substr(dx,1,4) =	'D553'
or substr(dx,1,4) =	'D558'
or substr(dx,1,4) =	'D559'
or substr(dx,1,4) =	'D560'
or substr(dx,1,4) =	'D561'
or substr(dx,1,4) =	'D562'
or substr(dx,1,4) =	'D563'
or substr(dx,1,4) =	'D564'
or substr(dx,1,4) =	'D565'
or substr(dx,1,4) =	'D568'
or substr(dx,1,4) =	'D569'
or substr(dx,1,5) =	'D5700'
or substr(dx,1,5) =	'D5701'
or substr(dx,1,5) =	'D5702'
or substr(dx,1,4) =	'D571'
or substr(dx,1,5) =	'D5720'
or substr(dx,1,6) =	'D57211'
or substr(dx,1,6) =	'D57212'
or substr(dx,1,6) =	'D57219'
or substr(dx,1,4) =	'D573'
or substr(dx,1,5) =	'D5740'
or substr(dx,1,6) =	'D57411'
or substr(dx,1,6) =	'D57412'
or substr(dx,1,6) =	'D57419'
or substr(dx,1,5) =	'D5780'
or substr(dx,1,6) =	'D57811'
or substr(dx,1,6) =	'D57812'
or substr(dx,1,6) =	'D57819'
or substr(dx,1,4) =	'D580'
or substr(dx,1,4) =	'D581'
or substr(dx,1,4) =	'D582'
or substr(dx,1,4) =	'D588'
or substr(dx,1,4) =	'D589'
or substr(dx,1,4) =	'D590'
or substr(dx,1,4) =	'D591'
or substr(dx,1,4) =	'D592'
or substr(dx,1,4) =	'D593'
or substr(dx,1,4) =	'D594'
or substr(dx,1,4) =	'D595'
or substr(dx,1,4) =	'D596'
or substr(dx,1,4) =	'D598'
or substr(dx,1,4) =	'D599'
or substr(dx,1,4) =	'D600'
or substr(dx,1,4) =	'D601'
or substr(dx,1,4) =	'D608'
or substr(dx,1,4) =	'D609'
or substr(dx,1,5) =	'D6101'
or substr(dx,1,5) =	'D6109'
or substr(dx,1,4) =	'D611'
or substr(dx,1,4) =	'D612'
or substr(dx,1,4) =	'D613'
or substr(dx,1,6) =	'D61810'
or substr(dx,1,6) =	'D61811'
or substr(dx,1,6) =	'D61818'
or substr(dx,1,5) =	'D6182'
or substr(dx,1,5) =	'D6189'
or substr(dx,1,4) =	'D619'
or substr(dx,1,3) =	'D62'
or substr(dx,1,4) =	'D630'
or substr(dx,1,4) =	'D631'
or substr(dx,1,4) =	'D638'
or substr(dx,1,4) =	'D640'
or substr(dx,1,4) =	'D641'
or substr(dx,1,4) =	'D642'
or substr(dx,1,4) =	'D643'
or substr(dx,1,4) =	'D644'
or substr(dx,1,5) =	'D6481'
or substr(dx,1,5) =	'D6489'
or substr(dx,1,4) =	'D649')
               and ccw_5=0
               then ccw_5=1;
   *Asthma ;
        if (substr(dx,1,5) =	'49301'
or substr(dx,1,5) =	'49302'
or substr(dx,1,5) =	'49311'
or substr(dx,1,5) =	'49312'
or substr(dx,1,5) =	'49310'
or substr(dx,1,5) =	'49321'
or substr(dx,1,5) =	'49322'
or substr(dx,1,5) =	'49320'
or substr(dx,1,5) =	'49381'
or substr(dx,1,5) =	'49382'
or substr(dx,1,5) =	'49391'
or substr(dx,1,5) =	'49392'
or substr(dx,1,5) =	'49390'
or substr(dx,1,5) =	'49300'
or substr(dx,1,5) =	'J4520'
or substr(dx,1,5) =	'J4521'
or substr(dx,1,5) =	'J4522'
or substr(dx,1,5) =	'J4530'
or substr(dx,1,5) =	'J4531'
or substr(dx,1,5) =	'J4532'
or substr(dx,1,5) =	'J4540'
or substr(dx,1,5) =	'J4541'
or substr(dx,1,5) =	'J4542'
or substr(dx,1,5) =	'J4550'
or substr(dx,1,5) =	'J4551'
or substr(dx,1,5) =	'J4552'
or substr(dx,1,6) =	'J45901'
or substr(dx,1,6) =	'J45902'
or substr(dx,1,6) =	'J45909'
or substr(dx,1,6) =	'J45990'
or substr(dx,1,6) =	'J45991'
or substr(dx,1,6) =	'J45998')
               and ccw_6=0
               then ccw_6=1;
*Atrial Fibrillation;
         if (substr(dx,1,5) =	'42731'
or substr(dx,1,4) =	'I480'
or substr(dx,1,4) =	'I481'
or substr(dx,1,4) =	'I482'
or substr(dx,1,5) =	'I4891')
               and ccw_7=0
               then ccw_7=1;
 *Benign Prostatic Hyperplasia;
         if (substr(dx,1,5) =	'60001'
or substr(dx,1,5) =	'60011'
or substr(dx,1,5) =	'60010'
or substr(dx,1,5) =	'60021'
or substr(dx,1,5) =	'60020'
or substr(dx,1,5) =	'60030'
or substr(dx,1,5) =	'60091'
or substr(dx,1,5) =	'60090'
or substr(dx,1,5) =	'60000'
or substr(dx,1,4) =	'N400'
or substr(dx,1,4) =	'N401'
or substr(dx,1,4) =	'N402'
or substr(dx,1,4) =	'N403'
or substr(dx,1,5) =	'N4283')
               and ccw_8=0
               then ccw_8=1;
*Cataract;
         if (substr(dx,1,5) =	'36601'
or substr(dx,1,5) =	'36602'
or substr(dx,1,5) =	'36603'
or substr(dx,1,5) =	'36604'
or substr(dx,1,5) =	'36609'
or substr(dx,1,5) =	'36612'
or substr(dx,1,5) =	'36613'
or substr(dx,1,5) =	'36614'
or substr(dx,1,5) =	'36615'
or substr(dx,1,5) =	'36616'
or substr(dx,1,5) =	'36617'
or substr(dx,1,5) =	'36618'
or substr(dx,1,5) =	'36619'
or substr(dx,1,5) =	'36610'
or substr(dx,1,5) =	'36621'
or substr(dx,1,5) =	'36622'
or substr(dx,1,5) =	'36623'
or substr(dx,1,5) =	'36620'
or substr(dx,1,5) =	'36630'
or substr(dx,1,5) =	'36645'
or substr(dx,1,5) =	'36646'
or substr(dx,1,5) =	'36651'
or substr(dx,1,5) =	'36652'
or substr(dx,1,5) =	'36653'
or substr(dx,1,5) =	'36650'
or substr(dx,1,4) =	'3668'
or substr(dx,1,4) =	'3669'
or substr(dx,1,5) =	'37926'
or substr(dx,1,5) =	'37931'
or substr(dx,1,5) =	'37939'
or substr(dx,1,5) =	'74331'
or substr(dx,1,5) =	'74332'
or substr(dx,1,5) =	'74333'
or substr(dx,1,4) =	'7433'
or substr(dx,1,4) =	'V431'
or substr(dx,1,6) =	'H25011'
or substr(dx,1,6) =	'H25012'
or substr(dx,1,6) =	'H25013'
or substr(dx,1,6) =	'H25019'
or substr(dx,1,6) =	'H25031'
or substr(dx,1,6) =	'H25032'
or substr(dx,1,6) =	'H25033'
or substr(dx,1,6) =	'H25039'
or substr(dx,1,6) =	'H25041'
or substr(dx,1,6) =	'H25042'
or substr(dx,1,6) =	'H25043'
or substr(dx,1,6) =	'H25049'
or substr(dx,1,6) =	'H25091'
or substr(dx,1,6) =	'H25092'
or substr(dx,1,6) =	'H25093'
or substr(dx,1,6) =	'H25099'
or substr(dx,1,5) =	'H2510'
or substr(dx,1,5) =	'H2511'
or substr(dx,1,5) =	'H2512'
or substr(dx,1,5) =	'H2513'
or substr(dx,1,5) =	'H2520'
or substr(dx,1,5) =	'H2521'
or substr(dx,1,5) =	'H2522'
or substr(dx,1,5) =	'H2523'
or substr(dx,1,6) =	'H25811'
or substr(dx,1,6) =	'H25812'
or substr(dx,1,6) =	'H25813'
or substr(dx,1,6) =	'H25819'
or substr(dx,1,5) =	'H2589'
or substr(dx,1,4) =	'H259'
or substr(dx,1,6) =	'H26011'
or substr(dx,1,6) =	'H26012'
or substr(dx,1,6) =	'H26013'
or substr(dx,1,6) =	'H26019'
or substr(dx,1,6) =	'H26031'
or substr(dx,1,6) =	'H26032'
or substr(dx,1,6) =	'H26033'
or substr(dx,1,6) =	'H26039'
or substr(dx,1,6) =	'H26041'
or substr(dx,1,6) =	'H26042'
or substr(dx,1,6) =	'H26043'
or substr(dx,1,6) =	'H26049'
or substr(dx,1,6) =	'H26051'
or substr(dx,1,6) =	'H26052'
or substr(dx,1,6) =	'H26053'
or substr(dx,1,6) =	'H26059'
or substr(dx,1,6) =	'H26061'
or substr(dx,1,6) =	'H26062'
or substr(dx,1,6) =	'H26063'
or substr(dx,1,6) =	'H26069'
or substr(dx,1,5) =	'H2609'
or substr(dx,1,6) =	'H26101'
or substr(dx,1,6) =	'H26102'
or substr(dx,1,6) =	'H26103'
or substr(dx,1,6) =	'H26109'
or substr(dx,1,6) =	'H26111'
or substr(dx,1,6) =	'H26112'
or substr(dx,1,6) =	'H26113'
or substr(dx,1,6) =	'H26119'
or substr(dx,1,6) =	'H26121'
or substr(dx,1,6) =	'H26122'
or substr(dx,1,6) =	'H26123'
or substr(dx,1,6) =	'H26129'
or substr(dx,1,6) =	'H26131'
or substr(dx,1,6) =	'H26132'
or substr(dx,1,6) =	'H26133'
or substr(dx,1,6) =	'H26139'
or substr(dx,1,5) =	'H2620'
or substr(dx,1,6) =	'H26211'
or substr(dx,1,6) =	'H26212'
or substr(dx,1,6) =	'H26213'
or substr(dx,1,6) =	'H26219'
or substr(dx,1,5) =	'H2630'
or substr(dx,1,5) =	'H2631'
or substr(dx,1,5) =	'H2632'
or substr(dx,1,5) =	'H2633'
or substr(dx,1,5) =	'H2640'
or substr(dx,1,6) =	'H26411'
or substr(dx,1,6) =	'H26412'
or substr(dx,1,6) =	'H26413'
or substr(dx,1,6) =	'H26419'
or substr(dx,1,6) =	'H26491'
or substr(dx,1,6) =	'H26492'
or substr(dx,1,6) =	'H26493'
or substr(dx,1,6) =	'H26499'
or substr(dx,1,4) =	'H268'
or substr(dx,1,4) =	'H269'
or substr(dx,1,4) =	'Q120'
or substr(dx,1,4) =	'Z961')
               and ccw_9=0
               then ccw_9=1;
*CKD ;
         if (substr(dx,1,5) =	'01601'
or substr(dx,1,5) =	'01602'
or substr(dx,1,5) =	'01603'
or substr(dx,1,5) =	'01604'
or substr(dx,1,5) =	'01605'
or substr(dx,1,5) =	'01606'
or substr(dx,1,5) =	'01600'
or substr(dx,1,4) =	'1899'
or substr(dx,1,4) =	'1890'
or substr(dx,1,4) =	'2230'
or substr(dx,1,5) =	'23691'
or substr(dx,1,5) =	'24941'
or substr(dx,1,5) =	'24940'
or substr(dx,1,5) =	'25041'
or substr(dx,1,5) =	'25042'
or substr(dx,1,5) =	'25043'
or substr(dx,1,5) =	'25040'
or substr(dx,1,4) =	'2714'
or substr(dx,1,5) =	'27410'
or substr(dx,1,5) =	'28311'
or substr(dx,1,5) =	'40301'
or substr(dx,1,5) =	'40311'
or substr(dx,1,5) =	'40391'
or substr(dx,1,5) =	'40402'
or substr(dx,1,5) =	'40403'
or substr(dx,1,5) =	'40412'
or substr(dx,1,5) =	'40413'
or substr(dx,1,5) =	'40492'
or substr(dx,1,5) =	'40493'
or substr(dx,1,4) =	'4401'
or substr(dx,1,4) =	'4421'
or substr(dx,1,4) =	'5724'
or substr(dx,1,4) =	'5804'
or substr(dx,1,5) =	'58081'
or substr(dx,1,5) =	'58089'
or substr(dx,1,4) =	'5809'
or substr(dx,1,4) =	'5800'
or substr(dx,1,4) =	'5811'
or substr(dx,1,4) =	'5812'
or substr(dx,1,4) =	'5813'
or substr(dx,1,5) =	'58181'
or substr(dx,1,5) =	'58189'
or substr(dx,1,4) =	'5819'
or substr(dx,1,4) =	'5810'
or substr(dx,1,4) =	'5821'
or substr(dx,1,4) =	'5822'
or substr(dx,1,4) =	'5824'
or substr(dx,1,5) =	'58281'
or substr(dx,1,5) =	'58289'
or substr(dx,1,4) =	'5829'
or substr(dx,1,4) =	'5820'
or substr(dx,1,4) =	'5831'
or substr(dx,1,4) =	'5832'
or substr(dx,1,4) =	'5834'
or substr(dx,1,4) =	'5836'
or substr(dx,1,4) =	'5837'
or substr(dx,1,5) =	'58381'
or substr(dx,1,5) =	'58389'
or substr(dx,1,4) =	'5839'
or substr(dx,1,4) =	'5830'
or substr(dx,1,4) =	'5845'
or substr(dx,1,4) =	'5846'
or substr(dx,1,4) =	'5847'
or substr(dx,1,4) =	'5848'
or substr(dx,1,4) =	'5849'
or substr(dx,1,4) =	'5851'
or substr(dx,1,4) =	'5852'
or substr(dx,1,4) =	'5853'
or substr(dx,1,4) =	'5854'
or substr(dx,1,4) =	'5855'
or substr(dx,1,4) =	'5856'
or substr(dx,1,4) =	'5859'
or substr(dx,1,3) =	'586'
or substr(dx,1,3) =	'587'
or substr(dx,1,4) =	'5881'
or substr(dx,1,5) =	'58881'
or substr(dx,1,5) =	'58889'
or substr(dx,1,4) =	'5889'
or substr(dx,1,4) =	'5880'
or substr(dx,1,3) =	'591'
or substr(dx,1,5) =	'75312'
or substr(dx,1,5) =	'75313'
or substr(dx,1,5) =	'75314'
or substr(dx,1,5) =	'75315'
or substr(dx,1,5) =	'75316'
or substr(dx,1,5) =	'75317'
or substr(dx,1,5) =	'75319'
or substr(dx,1,5) =	'75321'
or substr(dx,1,5) =	'75322'
or substr(dx,1,5) =	'75323'
or substr(dx,1,5) =	'75329'
or substr(dx,1,5) =	'75320'
or substr(dx,1,4) =	'7944'
or substr(dx,1,4) =	'0954'
or substr(dx,1,5) =	'A1811'
or substr(dx,1,5) =	'A5275'
or substr(dx,1,4) =	'B520'
or substr(dx,1,4) =	'C641'
or substr(dx,1,4) =	'C642'
or substr(dx,1,4) =	'C649'
or substr(dx,1,4) =	'C689'
or substr(dx,1,5) =	'D3000'
or substr(dx,1,5) =	'D3001'
or substr(dx,1,5) =	'D3002'
or substr(dx,1,5) =	'D4100'
or substr(dx,1,5) =	'D4101'
or substr(dx,1,5) =	'D4102'
or substr(dx,1,5) =	'D4110'
or substr(dx,1,5) =	'D4111'
or substr(dx,1,5) =	'D4112'
or substr(dx,1,5) =	'D4120'
or substr(dx,1,5) =	'D4121'
or substr(dx,1,5) =	'D4122'
or substr(dx,1,4) =	'D593'
or substr(dx,1,5) =	'E0821'
or substr(dx,1,5) =	'E0822'
or substr(dx,1,5) =	'E0829'
or substr(dx,1,5) =	'E0865'
or substr(dx,1,5) =	'E0921'
or substr(dx,1,5) =	'E0922'
or substr(dx,1,5) =	'E0929'
or substr(dx,1,5) =	'E1021'
or substr(dx,1,5) =	'E1022'
or substr(dx,1,5) =	'E1029'
or substr(dx,1,5) =	'E1065'
or substr(dx,1,5) =	'E1121'
or substr(dx,1,5) =	'E1122'
or substr(dx,1,5) =	'E1129'
or substr(dx,1,5) =	'E1165'
or substr(dx,1,5) =	'E1321'
or substr(dx,1,5) =	'E1322'
or substr(dx,1,5) =	'E1329'
or substr(dx,1,4) =	'E748'
or substr(dx,1,4) =	'I120'
or substr(dx,1,4) =	'I129'
or substr(dx,1,4) =	'I130'
or substr(dx,1,5) =	'I1310'
or substr(dx,1,5) =	'I1311'
or substr(dx,1,4) =	'I132'
or substr(dx,1,4) =	'I701'
or substr(dx,1,4) =	'I722'
or substr(dx,1,4) =	'K767'
or substr(dx,1,5) =	'M1030'
or substr(dx,1,6) =	'M10311'
or substr(dx,1,6) =	'M10312'
or substr(dx,1,6) =	'M10319'
or substr(dx,1,6) =	'M10321'
or substr(dx,1,6) =	'M10322'
or substr(dx,1,6) =	'M10329'
or substr(dx,1,6) =	'M10331'
or substr(dx,1,6) =	'M10332'
or substr(dx,1,6) =	'M10339'
or substr(dx,1,6) =	'M10341'
or substr(dx,1,6) =	'M10342'
or substr(dx,1,6) =	'M10349'
or substr(dx,1,6) =	'M10351'
or substr(dx,1,6) =	'M10352'
or substr(dx,1,6) =	'M10359'
or substr(dx,1,6) =	'M10361'
or substr(dx,1,6) =	'M10362'
or substr(dx,1,6) =	'M10369'
or substr(dx,1,6) =	'M10371'
or substr(dx,1,6) =	'M10372'
or substr(dx,1,6) =	'M10379'
or substr(dx,1,5) =	'M1038'
or substr(dx,1,5) =	'M1039'
or substr(dx,1,5) =	'M3214'
or substr(dx,1,5) =	'M3215'
or substr(dx,1,5) =	'M3504'
or substr(dx,1,4) =	'N000'
or substr(dx,1,4) =	'N001'
or substr(dx,1,4) =	'N002'
or substr(dx,1,4) =	'N003'
or substr(dx,1,4) =	'N004'
or substr(dx,1,4) =	'N005'
or substr(dx,1,4) =	'N006'
or substr(dx,1,4) =	'N007'
or substr(dx,1,4) =	'N008'
or substr(dx,1,4) =	'N009'
or substr(dx,1,4) =	'N010'
or substr(dx,1,4) =	'N011'
or substr(dx,1,4) =	'N012'
or substr(dx,1,4) =	'N013'
or substr(dx,1,4) =	'N014'
or substr(dx,1,4) =	'N015'
or substr(dx,1,4) =	'N016'
or substr(dx,1,4) =	'N017'
or substr(dx,1,4) =	'N018'
or substr(dx,1,4) =	'N019'
or substr(dx,1,4) =	'N020'
or substr(dx,1,4) =	'N021'
or substr(dx,1,4) =	'N022'
or substr(dx,1,4) =	'N023'
or substr(dx,1,4) =	'N024'
or substr(dx,1,4) =	'N025'
or substr(dx,1,4) =	'N026'
or substr(dx,1,4) =	'N027'
or substr(dx,1,4) =	'N028'
or substr(dx,1,4) =	'N029'
or substr(dx,1,4) =	'N030'
or substr(dx,1,4) =	'N031'
or substr(dx,1,4) =	'N032'
or substr(dx,1,4) =	'N033'
or substr(dx,1,4) =	'N034'
or substr(dx,1,4) =	'N035'
or substr(dx,1,4) =	'N036'
or substr(dx,1,4) =	'N037'
or substr(dx,1,4) =	'N038'
or substr(dx,1,4) =	'N039'
or substr(dx,1,4) =	'N040'
or substr(dx,1,4) =	'N041'
or substr(dx,1,4) =	'N042'
or substr(dx,1,4) =	'N043'
or substr(dx,1,4) =	'N044'
or substr(dx,1,4) =	'N045'
or substr(dx,1,4) =	'N046'
or substr(dx,1,4) =	'N047'
or substr(dx,1,4) =	'N048'
or substr(dx,1,4) =	'N049'
or substr(dx,1,4) =	'N050'
or substr(dx,1,4) =	'N051'
or substr(dx,1,4) =	'N052'
or substr(dx,1,4) =	'N053'
or substr(dx,1,4) =	'N054'
or substr(dx,1,4) =	'N055'
or substr(dx,1,4) =	'N056'
or substr(dx,1,4) =	'N057'
or substr(dx,1,4) =	'N058'
or substr(dx,1,4) =	'N059'
or substr(dx,1,4) =	'N060'
or substr(dx,1,4) =	'N061'
or substr(dx,1,4) =	'N062'
or substr(dx,1,4) =	'N063'
or substr(dx,1,4) =	'N064'
or substr(dx,1,4) =	'N065'
or substr(dx,1,4) =	'N066'
or substr(dx,1,4) =	'N067'
or substr(dx,1,4) =	'N068'
or substr(dx,1,4) =	'N069'
or substr(dx,1,4) =	'N070'
or substr(dx,1,4) =	'N071'
or substr(dx,1,4) =	'N072'
or substr(dx,1,4) =	'N073'
or substr(dx,1,4) =	'N074'
or substr(dx,1,4) =	'N075'
or substr(dx,1,4) =	'N076'
or substr(dx,1,4) =	'N077'
or substr(dx,1,4) =	'N078'
or substr(dx,1,4) =	'N079'
or substr(dx,1,3) =	'N08'
or substr(dx,1,4) =	'N131'
or substr(dx,1,4) =	'N132'
or substr(dx,1,5) =	'N1330'
or substr(dx,1,5) =	'N1339'
or substr(dx,1,4) =	'N140'
or substr(dx,1,4) =	'N141'
or substr(dx,1,4) =	'N142'
or substr(dx,1,4) =	'N143'
or substr(dx,1,4) =	'N144'
or substr(dx,1,4) =	'N150'
or substr(dx,1,4) =	'N158'
or substr(dx,1,4) =	'N159'
or substr(dx,1,3) =	'N16'
or substr(dx,1,4) =	'N170'
or substr(dx,1,4) =	'N171'
or substr(dx,1,4) =	'N172'
or substr(dx,1,4) =	'N178'
or substr(dx,1,4) =	'N179'
or substr(dx,1,4) =	'N181'
or substr(dx,1,4) =	'N182'
or substr(dx,1,4) =	'N183'
or substr(dx,1,4) =	'N184'
or substr(dx,1,4) =	'N185'
or substr(dx,1,4) =	'N186'
or substr(dx,1,4) =	'N189'
or substr(dx,1,3) =	'N19'
or substr(dx,1,4) =	'N250'
or substr(dx,1,4) =	'N251'
or substr(dx,1,5) =	'N2581'
or substr(dx,1,5) =	'N2589'
or substr(dx,1,4) =	'N259'
or substr(dx,1,4) =	'N261'
or substr(dx,1,4) =	'N269'
or substr(dx,1,5) =	'Q6102'
or substr(dx,1,5) =	'Q6111'
or substr(dx,1,5) =	'Q6119'
or substr(dx,1,4) =	'Q612'
or substr(dx,1,4) =	'Q613'
or substr(dx,1,4) =	'Q614'
or substr(dx,1,4) =	'Q615'
or substr(dx,1,4) =	'Q618'
or substr(dx,1,4) =	'Q620'
or substr(dx,1,5) =	'Q6210'
or substr(dx,1,5) =	'Q6211'
or substr(dx,1,5) =	'Q6212'
or substr(dx,1,4) =	'Q622'
or substr(dx,1,5) =	'Q6231'
or substr(dx,1,5) =	'Q6232'
or substr(dx,1,5) =	'Q6239'
or substr(dx,1,4) =	'R944')
               and ccw_10=0
               then ccw_10=1;
*COPD/Bronchitectasis;
	if (substr(dx,1,3) =	'490'
or substr(dx,1,4) =	'4911'
or substr(dx,1,5) =	'49121'
or substr(dx,1,5) =	'49122'
or substr(dx,1,4) =	'4912'
or substr(dx,1,4) =	'4918'
or substr(dx,1,4) =	'4919'
or substr(dx,1,4) =	'4910'
or substr(dx,1,4) =	'4928'
or substr(dx,1,4) =	'4920'
or substr(dx,1,4) =	'4941'
or substr(dx,1,4) =	'4940'
or substr(dx,1,3) =	'496'
or substr(dx,1,3) =	'J40'
or substr(dx,1,4) =	'J410'
or substr(dx,1,4) =	'J411'
or substr(dx,1,4) =	'J418'
or substr(dx,1,3) =	'J42'
or substr(dx,1,4) =	'J430'
or substr(dx,1,4) =	'J431'
or substr(dx,1,4) =	'J432'
or substr(dx,1,4) =	'J438'
or substr(dx,1,4) =	'J439'
or substr(dx,1,4) =	'J440'
or substr(dx,1,4) =	'J441'
or substr(dx,1,4) =	'J449'
or substr(dx,1,4) =	'J470'
or substr(dx,1,4) =	'J471'
or substr(dx,1,4) =	'J479')
		and ccw_11=0
                then ccw_11=1;
*Depression ;
	if (substr(dx,1,5) =	'29621'
or substr(dx,1,5) =	'29622'
or substr(dx,1,5) =	'29623'
or substr(dx,1,5) =	'29624'
or substr(dx,1,5) =	'29625'
or substr(dx,1,5) =	'29626'
or substr(dx,1,5) =	'29620'
or substr(dx,1,5) =	'29631'
or substr(dx,1,5) =	'29632'
or substr(dx,1,5) =	'29633'
or substr(dx,1,5) =	'29634'
or substr(dx,1,5) =	'29635'
or substr(dx,1,5) =	'29636'
or substr(dx,1,5) =	'29630'
or substr(dx,1,5) =	'29651'
or substr(dx,1,5) =	'29652'
or substr(dx,1,5) =	'29653'
or substr(dx,1,5) =	'29654'
or substr(dx,1,5) =	'29655'
or substr(dx,1,5) =	'29656'
or substr(dx,1,5) =	'29661'
or substr(dx,1,5) =	'29662'
or substr(dx,1,5) =	'29663'
or substr(dx,1,5) =	'29664'
or substr(dx,1,5) =	'29665'
or substr(dx,1,5) =	'29666'
or substr(dx,1,5) =	'29660'
or substr(dx,1,5) =	'29689'
or substr(dx,1,4) =	'2980'
or substr(dx,1,4) =	'3004'
or substr(dx,1,4) =	'3091'
or substr(dx,1,3) =	'311'
or substr(dx,1,5) =	'F3130'
or substr(dx,1,5) =	'F3131'
or substr(dx,1,5) =	'F3132'
or substr(dx,1,4) =	'F314'
or substr(dx,1,4) =	'F315'
or substr(dx,1,5) =	'F3160'
or substr(dx,1,5) =	'F3161'
or substr(dx,1,5) =	'F3162'
or substr(dx,1,5) =	'F3163'
or substr(dx,1,5) =	'F3164'
or substr(dx,1,5) =	'F3175'
or substr(dx,1,5) =	'F3176'
or substr(dx,1,5) =	'F3177'
or substr(dx,1,5) =	'F3178'
or substr(dx,1,5) =	'F3181'
or substr(dx,1,4) =	'F320'
or substr(dx,1,4) =	'F321'
or substr(dx,1,4) =	'F322'
or substr(dx,1,4) =	'F323'
or substr(dx,1,4) =	'F324'
or substr(dx,1,4) =	'F325'
or substr(dx,1,4) =	'F329'
or substr(dx,1,4) =	'F330'
or substr(dx,1,4) =	'F331'
or substr(dx,1,4) =	'F332'
or substr(dx,1,4) =	'F333'
or substr(dx,1,5) =	'F3340'
or substr(dx,1,5) =	'F3341'
or substr(dx,1,5) =	'F3342'
or substr(dx,1,4) =	'F338'
or substr(dx,1,4) =	'F339'
or substr(dx,1,4) =	'F341'
or substr(dx,1,5) =	'F4321'
or substr(dx,1,5) =	'F4323'
)
		and ccw_12=0
                then ccw_12=1;
* Diabetes;
	if (substr(dx,1,5) =	'24901'
or substr(dx,1,5) =	'24911'
or substr(dx,1,5) =	'24910'
or substr(dx,1,5) =	'24921'
or substr(dx,1,5) =	'24920'
or substr(dx,1,5) =	'24931'
or substr(dx,1,5) =	'24930'
or substr(dx,1,5) =	'24941'
or substr(dx,1,5) =	'24940'
or substr(dx,1,5) =	'24951'
or substr(dx,1,5) =	'24950'
or substr(dx,1,5) =	'24961'
or substr(dx,1,5) =	'24960'
or substr(dx,1,5) =	'24971'
or substr(dx,1,5) =	'24970'
or substr(dx,1,5) =	'24981'
or substr(dx,1,5) =	'24980'
or substr(dx,1,5) =	'24991'
or substr(dx,1,5) =	'24990'
or substr(dx,1,5) =	'24900'
or substr(dx,1,5) =	'25001'
or substr(dx,1,5) =	'25002'
or substr(dx,1,5) =	'25003'
or substr(dx,1,5) =	'25011'
or substr(dx,1,5) =	'25012'
or substr(dx,1,5) =	'25013'
or substr(dx,1,5) =	'25010'
or substr(dx,1,5) =	'25021'
or substr(dx,1,5) =	'25022'
or substr(dx,1,5) =	'25023'
or substr(dx,1,5) =	'25020'
or substr(dx,1,5) =	'25031'
or substr(dx,1,5) =	'25032'
or substr(dx,1,5) =	'25033'
or substr(dx,1,5) =	'25030'
or substr(dx,1,5) =	'25041'
or substr(dx,1,5) =	'25042'
or substr(dx,1,5) =	'25043'
or substr(dx,1,5) =	'25040'
or substr(dx,1,5) =	'25051'
or substr(dx,1,5) =	'25052'
or substr(dx,1,5) =	'25053'
or substr(dx,1,5) =	'25050'
or substr(dx,1,5) =	'25061'
or substr(dx,1,5) =	'25062'
or substr(dx,1,5) =	'25063'
or substr(dx,1,5) =	'25060'
or substr(dx,1,5) =	'25071'
or substr(dx,1,5) =	'25072'
or substr(dx,1,5) =	'25073'
or substr(dx,1,5) =	'25070'
or substr(dx,1,5) =	'25081'
or substr(dx,1,5) =	'25082'
or substr(dx,1,5) =	'25083'
or substr(dx,1,5) =	'25080'
or substr(dx,1,5) =	'25091'
or substr(dx,1,5) =	'25092'
or substr(dx,1,5) =	'25093'
or substr(dx,1,5) =	'25090'
or substr(dx,1,5) =	'25000'
or substr(dx,1,4) =	'3572'
or substr(dx,1,5) =	'36201'
or substr(dx,1,5) =	'36202'
or substr(dx,1,5) =	'36203'
or substr(dx,1,5) =	'36204'
or substr(dx,1,5) =	'36205'
or substr(dx,1,5) =	'36206'
or substr(dx,1,5) =	'36641'
or substr(dx,1,5) =	'E0800'
or substr(dx,1,5) =	'E0801'
or substr(dx,1,5) =	'E0810'
or substr(dx,1,5) =	'E0811'
or substr(dx,1,5) =	'E0821'
or substr(dx,1,5) =	'E0822'
or substr(dx,1,5) =	'E0829'
or substr(dx,1,6) =	'E08311'
or substr(dx,1,6) =	'E08319'
or substr(dx,1,7) =	'E083211'
or substr(dx,1,7) =	'E083212'
or substr(dx,1,7) =	'E083213'
or substr(dx,1,7) =	'E083219'
or substr(dx,1,6) =	'E08321'
or substr(dx,1,7) =	'E083291'
or substr(dx,1,7) =	'E083292'
or substr(dx,1,7) =	'E083293'
or substr(dx,1,7) =	'E083299'
or substr(dx,1,6) =	'E08329'
or substr(dx,1,7) =	'E083311'
or substr(dx,1,7) =	'E083312'
or substr(dx,1,7) =	'E083313'
or substr(dx,1,7) =	'E083319'
or substr(dx,1,6) =	'E08331'
or substr(dx,1,7) =	'E083391'
or substr(dx,1,7) =	'E083392'
or substr(dx,1,7) =	'E083393'
or substr(dx,1,7) =	'E083399'
or substr(dx,1,6) =	'E08339'
or substr(dx,1,7) =	'E083411'
or substr(dx,1,7) =	'E083412'
or substr(dx,1,7) =	'E083413'
or substr(dx,1,7) =	'E083419'
or substr(dx,1,6) =	'E08341'
or substr(dx,1,7) =	'E083491'
or substr(dx,1,7) =	'E083492'
or substr(dx,1,7) =	'E083493'
or substr(dx,1,7) =	'E083499'
or substr(dx,1,6) =	'E08349'
or substr(dx,1,7) =	'E083511'
or substr(dx,1,7) =	'E083512'
or substr(dx,1,7) =	'E083513'
or substr(dx,1,7) =	'E083519'
or substr(dx,1,6) =	'E08351'
or substr(dx,1,7) =	'E083521'
or substr(dx,1,7) =	'E083522'
or substr(dx,1,7) =	'E083523'
or substr(dx,1,7) =	'E083529'
or substr(dx,1,7) =	'E083531'
or substr(dx,1,7) =	'E083532'
or substr(dx,1,7) =	'E083533'
or substr(dx,1,7) =	'E083539'
or substr(dx,1,7) =	'E083541'
or substr(dx,1,7) =	'E083542'
or substr(dx,1,7) =	'E083543'
or substr(dx,1,7) =	'E083549'
or substr(dx,1,7) =	'E083551'
or substr(dx,1,7) =	'E083552'
or substr(dx,1,7) =	'E083553'
or substr(dx,1,7) =	'E083559'
or substr(dx,1,7) =	'E083591'
or substr(dx,1,7) =	'E083592'
or substr(dx,1,7) =	'E083593'
or substr(dx,1,7) =	'E083599'
or substr(dx,1,6) =	'E08359'
or substr(dx,1,5) =	'E0836'
or substr(dx,1,7) =	'E0837X1'
or substr(dx,1,7) =	'E0837X2'
or substr(dx,1,7) =	'E0837X3'
or substr(dx,1,7) =	'E0837X9'
or substr(dx,1,5) =	'E0839'
or substr(dx,1,5) =	'E0840'
or substr(dx,1,5) =	'E0841'
or substr(dx,1,5) =	'E0842'
or substr(dx,1,5) =	'E0843'
or substr(dx,1,5) =	'E0844'
or substr(dx,1,5) =	'E0849'
or substr(dx,1,5) =	'E0851'
or substr(dx,1,5) =	'E0852'
or substr(dx,1,5) =	'E0859'
or substr(dx,1,6) =	'E08610'
or substr(dx,1,6) =	'E08618'
or substr(dx,1,6) =	'E08620'
or substr(dx,1,6) =	'E08621'
or substr(dx,1,6) =	'E08622'
or substr(dx,1,6) =	'E08628'
or substr(dx,1,6) =	'E08630'
or substr(dx,1,6) =	'E08638'
or substr(dx,1,6) =	'E08641'
or substr(dx,1,6) =	'E08649'
or substr(dx,1,5) =	'E0865'
or substr(dx,1,5) =	'E0869'
or substr(dx,1,4) =	'E088'
or substr(dx,1,4) =	'E089'
or substr(dx,1,5) =	'E0900'
or substr(dx,1,5) =	'E0901'
or substr(dx,1,5) =	'E0910'
or substr(dx,1,5) =	'E0911'
or substr(dx,1,5) =	'E0921'
or substr(dx,1,5) =	'E0922'
or substr(dx,1,5) =	'E0929'
or substr(dx,1,6) =	'E09311'
or substr(dx,1,6) =	'E09319'
or substr(dx,1,7) =	'E093211'
or substr(dx,1,7) =	'E093212'
or substr(dx,1,7) =	'E093213'
or substr(dx,1,7) =	'E093219'
or substr(dx,1,6) =	'E09321'
or substr(dx,1,7) =	'E093291'
or substr(dx,1,7) =	'E093292'
or substr(dx,1,7) =	'E093293'
or substr(dx,1,7) =	'E093299'
or substr(dx,1,6) =	'E09329'
or substr(dx,1,7) =	'E093311'
or substr(dx,1,7) =	'E093312'
or substr(dx,1,7) =	'E093313'
or substr(dx,1,7) =	'E093319'
or substr(dx,1,6) =	'E09331'
or substr(dx,1,7) =	'E093391'
or substr(dx,1,7) =	'E093392'
or substr(dx,1,7) =	'E093393'
or substr(dx,1,7) =	'E093399'
or substr(dx,1,6) =	'E09339'
or substr(dx,1,7) =	'E093411'
or substr(dx,1,7) =	'E093412'
or substr(dx,1,7) =	'E093413'
or substr(dx,1,7) =	'E093419'
or substr(dx,1,6) =	'E09341'
or substr(dx,1,7) =	'E093491'
or substr(dx,1,7) =	'E093492'
or substr(dx,1,7) =	'E093493'
or substr(dx,1,7) =	'E093499'
or substr(dx,1,6) =	'E09349'
or substr(dx,1,7) =	'E093511'
or substr(dx,1,7) =	'E093512'
or substr(dx,1,7) =	'E093513'
or substr(dx,1,7) =	'E093519'
or substr(dx,1,6) =	'E09351'
or substr(dx,1,7) =	'E093521'
or substr(dx,1,7) =	'E093522'
or substr(dx,1,7) =	'E093523'
or substr(dx,1,7) =	'E093529'
or substr(dx,1,7) =	'E093531'
or substr(dx,1,7) =	'E093532'
or substr(dx,1,7) =	'E093533'
or substr(dx,1,7) =	'E093539'
or substr(dx,1,7) =	'E093541'
or substr(dx,1,7) =	'E093542'
or substr(dx,1,7) =	'E093543'
or substr(dx,1,7) =	'E093549'
or substr(dx,1,7) =	'E093551'
or substr(dx,1,7) =	'E093552'
or substr(dx,1,7) =	'E093553'
or substr(dx,1,7) =	'E093559'
or substr(dx,1,7) =	'E093591'
or substr(dx,1,7) =	'E093592'
or substr(dx,1,7) =	'E093593'
or substr(dx,1,7) =	'E093599'
or substr(dx,1,6) =	'E09359'
or substr(dx,1,5) =	'E0936'
or substr(dx,1,7) =	'E0937X1'
or substr(dx,1,7) =	'E0937X2'
or substr(dx,1,7) =	'E0937X3'
or substr(dx,1,7) =	'E0937X9'
or substr(dx,1,5) =	'E0939'
or substr(dx,1,5) =	'E0940'
or substr(dx,1,5) =	'E0941'
or substr(dx,1,5) =	'E0942'
or substr(dx,1,5) =	'E0943'
or substr(dx,1,5) =	'E0944'
or substr(dx,1,5) =	'E0949'
or substr(dx,1,5) =	'E0951'
or substr(dx,1,5) =	'E0952'
or substr(dx,1,5) =	'E0959'
or substr(dx,1,6) =	'E09610'
or substr(dx,1,6) =	'E09618'
or substr(dx,1,6) =	'E09620'
or substr(dx,1,6) =	'E09621'
or substr(dx,1,6) =	'E09622'
or substr(dx,1,6) =	'E09628'
or substr(dx,1,6) =	'E09630'
or substr(dx,1,6) =	'E09638'
or substr(dx,1,6) =	'E09641'
or substr(dx,1,6) =	'E09649'
or substr(dx,1,5) =	'E0965'
or substr(dx,1,5) =	'E0969'
or substr(dx,1,4) =	'E098'
or substr(dx,1,4) =	'E099'
or substr(dx,1,5) =	'E1010'
or substr(dx,1,5) =	'E1011'
or substr(dx,1,5) =	'E1021'
or substr(dx,1,5) =	'E1022'
or substr(dx,1,5) =	'E1029'
or substr(dx,1,6) =	'E10311'
or substr(dx,1,6) =	'E10319'
or substr(dx,1,7) =	'E103211'
or substr(dx,1,7) =	'E103212'
or substr(dx,1,7) =	'E103213'
or substr(dx,1,7) =	'E103219'
or substr(dx,1,6) =	'E10321'
or substr(dx,1,7) =	'E103291'
or substr(dx,1,7) =	'E103292'
or substr(dx,1,7) =	'E103293'
or substr(dx,1,7) =	'E103299'
or substr(dx,1,6) =	'E10329'
or substr(dx,1,7) =	'E103311'
or substr(dx,1,7) =	'E103312'
or substr(dx,1,7) =	'E103313'
or substr(dx,1,7) =	'E103319'
or substr(dx,1,6) =	'E10331'
or substr(dx,1,7) =	'E103391'
or substr(dx,1,7) =	'E103392'
or substr(dx,1,7) =	'E103393'
or substr(dx,1,7) =	'E103399'
or substr(dx,1,6) =	'E10339'
or substr(dx,1,7) =	'E103411'
or substr(dx,1,7) =	'E103412'
or substr(dx,1,7) =	'E103413'
or substr(dx,1,7) =	'E103419'
or substr(dx,1,6) =	'E10341'
or substr(dx,1,7) =	'E103491'
or substr(dx,1,7) =	'E103492'
or substr(dx,1,7) =	'E103493'
or substr(dx,1,7) =	'E103499'
or substr(dx,1,6) =	'E10349'
or substr(dx,1,7) =	'E103511'
or substr(dx,1,7) =	'E103512'
or substr(dx,1,7) =	'E103513'
or substr(dx,1,7) =	'E103519'
or substr(dx,1,6) =	'E10351'
or substr(dx,1,6) =	'E10359'
or substr(dx,1,5) =	'E1036'
or substr(dx,1,7) =	'E1037X1'
or substr(dx,1,7) =	'E1037X2'
or substr(dx,1,7) =	'E1037X3'
or substr(dx,1,7) =	'E1037X9'
or substr(dx,1,5) =	'E1039'
or substr(dx,1,5) =	'E1040'
or substr(dx,1,5) =	'E1041'
or substr(dx,1,5) =	'E1042'
or substr(dx,1,5) =	'E1043'
or substr(dx,1,5) =	'E1044'
or substr(dx,1,5) =	'E1049'
or substr(dx,1,5) =	'E1051'
or substr(dx,1,5) =	'E1052'
or substr(dx,1,5) =	'E1059'
or substr(dx,1,6) =	'E10610'
or substr(dx,1,6) =	'E10618'
or substr(dx,1,6) =	'E10620'
or substr(dx,1,6) =	'E10621'
or substr(dx,1,6) =	'E10622'
or substr(dx,1,6) =	'E10628'
or substr(dx,1,6) =	'E10630'
or substr(dx,1,6) =	'E10638'
or substr(dx,1,6) =	'E10641'
or substr(dx,1,6) =	'E10649'
or substr(dx,1,5) =	'E1065'
or substr(dx,1,5) =	'E1069'
or substr(dx,1,4) =	'E108'
or substr(dx,1,4) =	'E109'
or substr(dx,1,5) =	'E1100'
or substr(dx,1,5) =	'E1101'
or substr(dx,1,5) =	'E1110'
or substr(dx,1,5) =	'E1111'
or substr(dx,1,5) =	'E1121'
or substr(dx,1,5) =	'E1122'
or substr(dx,1,5) =	'E1129'
or substr(dx,1,6) =	'E11311'
or substr(dx,1,6) =	'E11319'
or substr(dx,1,7) =	'E113211'
or substr(dx,1,7) =	'E113212'
or substr(dx,1,7) =	'E113213'
or substr(dx,1,7) =	'E113219'
or substr(dx,1,6) =	'E11321'
or substr(dx,1,7) =	'E113291'
or substr(dx,1,7) =	'E113292'
or substr(dx,1,7) =	'E113293'
or substr(dx,1,7) =	'E113299'
or substr(dx,1,6) =	'E11329'
or substr(dx,1,7) =	'E113311'
or substr(dx,1,7) =	'E113312'
or substr(dx,1,7) =	'E113313'
or substr(dx,1,7) =	'E113319'
or substr(dx,1,6) =	'E11331'
or substr(dx,1,7) =	'E113391'
or substr(dx,1,7) =	'E113392'
or substr(dx,1,7) =	'E113393'
or substr(dx,1,7) =	'E113399'
or substr(dx,1,6) =	'E11339'
or substr(dx,1,7) =	'E113411'
or substr(dx,1,7) =	'E113412'
or substr(dx,1,7) =	'E113413'
or substr(dx,1,7) =	'E113419'
or substr(dx,1,6) =	'E11341'
or substr(dx,1,7) =	'E113491'
or substr(dx,1,7) =	'E113492'
or substr(dx,1,7) =	'E113493'
or substr(dx,1,7) =	'E113499'
or substr(dx,1,6) =	'E11349'
or substr(dx,1,7) =	'E113511'
or substr(dx,1,7) =	'E113512'
or substr(dx,1,7) =	'E113513'
or substr(dx,1,7) =	'E113519'
or substr(dx,1,6) =	'E11351'
or substr(dx,1,7) =	'E113521'
or substr(dx,1,7) =	'E113522'
or substr(dx,1,7) =	'E113523'
or substr(dx,1,7) =	'E113529'
or substr(dx,1,7) =	'E113531'
or substr(dx,1,7) =	'E113532'
or substr(dx,1,7) =	'E113533'
or substr(dx,1,7) =	'E113539'
or substr(dx,1,7) =	'E113541'
or substr(dx,1,7) =	'E113542'
or substr(dx,1,7) =	'E113543'
or substr(dx,1,7) =	'E113549'
or substr(dx,1,7) =	'E113551'
or substr(dx,1,7) =	'E113552'
or substr(dx,1,7) =	'E113553'
or substr(dx,1,7) =	'E113559'
or substr(dx,1,7) =	'E113591'
or substr(dx,1,7) =	'E113592'
or substr(dx,1,7) =	'E113593'
or substr(dx,1,7) =	'E113599'
or substr(dx,1,6) =	'E11359'
or substr(dx,1,5) =	'E1136'
or substr(dx,1,7) =	'E1137X1'
or substr(dx,1,7) =	'E1137X2'
or substr(dx,1,7) =	'E1137X3'
or substr(dx,1,7) =	'E1137X9'
or substr(dx,1,5) =	'E1139'
or substr(dx,1,5) =	'E1140'
or substr(dx,1,5) =	'E1141'
or substr(dx,1,5) =	'E1142'
or substr(dx,1,5) =	'E1143'
or substr(dx,1,5) =	'E1144'
or substr(dx,1,5) =	'E1149'
or substr(dx,1,5) =	'E1151'
or substr(dx,1,5) =	'E1152'
or substr(dx,1,5) =	'E1159'
or substr(dx,1,6) =	'E11610'
or substr(dx,1,6) =	'E11618'
or substr(dx,1,6) =	'E11620'
or substr(dx,1,6) =	'E11621'
or substr(dx,1,6) =	'E11622'
or substr(dx,1,6) =	'E11628'
or substr(dx,1,6) =	'E11630'
or substr(dx,1,6) =	'E11638'
or substr(dx,1,6) =	'E11641'
or substr(dx,1,6) =	'E11649'
or substr(dx,1,5) =	'E1165'
or substr(dx,1,5) =	'E1169'
or substr(dx,1,4) =	'E118'
or substr(dx,1,4) =	'E119'
or substr(dx,1,5) =	'E1300'
or substr(dx,1,5) =	'E1301'
or substr(dx,1,5) =	'E1310'
or substr(dx,1,5) =	'E1311'
or substr(dx,1,5) =	'E1321'
or substr(dx,1,5) =	'E1322'
or substr(dx,1,5) =	'E1329'
or substr(dx,1,6) =	'E13311'
or substr(dx,1,6) =	'E13319'
or substr(dx,1,7) =	'E133211'
or substr(dx,1,7) =	'E133212'
or substr(dx,1,7) =	'E133213'
or substr(dx,1,7) =	'E133219'
or substr(dx,1,6) =	'E13321'
or substr(dx,1,7) =	'E133291'
or substr(dx,1,7) =	'E133292'
or substr(dx,1,7) =	'E133293'
or substr(dx,1,7) =	'E133299'
or substr(dx,1,6) =	'E13329'
or substr(dx,1,7) =	'E133311'
or substr(dx,1,7) =	'E133312'
or substr(dx,1,7) =	'E133313'
or substr(dx,1,7) =	'E133319'
or substr(dx,1,6) =	'E13331'
or substr(dx,1,7) =	'E133391'
or substr(dx,1,7) =	'E133392'
or substr(dx,1,7) =	'E133393'
or substr(dx,1,7) =	'E133399'
or substr(dx,1,6) =	'E13339'
or substr(dx,1,7) =	'E133411'
or substr(dx,1,7) =	'E133412'
or substr(dx,1,7) =	'E133413'
or substr(dx,1,7) =	'E133419'
or substr(dx,1,6) =	'E13341'
or substr(dx,1,7) =	'E133491'
or substr(dx,1,7) =	'E133492'
or substr(dx,1,7) =	'E133493'
or substr(dx,1,7) =	'E133499'
or substr(dx,1,6) =	'E13349'
or substr(dx,1,7) =	'E133511'
or substr(dx,1,7) =	'E133512'
or substr(dx,1,7) =	'E133513'
or substr(dx,1,7) =	'E133519'
or substr(dx,1,6) =	'E13351'
or substr(dx,1,7) =	'E133521'
or substr(dx,1,7) =	'E133522'
or substr(dx,1,7) =	'E133523'
or substr(dx,1,7) =	'E133529'
or substr(dx,1,7) =	'E133531'
or substr(dx,1,7) =	'E133532'
or substr(dx,1,7) =	'E133533'
or substr(dx,1,7) =	'E133539'
or substr(dx,1,7) =	'E133541'
or substr(dx,1,7) =	'E133542'
or substr(dx,1,7) =	'E133543'
or substr(dx,1,7) =	'E133549'
or substr(dx,1,7) =	'E133551'
or substr(dx,1,7) =	'E133552'
or substr(dx,1,7) =	'E133553'
or substr(dx,1,7) =	'E133559'
or substr(dx,1,6) =	'E13359'
or substr(dx,1,5) =	'E1336'
or substr(dx,1,5) =	'E1339'
or substr(dx,1,5) =	'E1340'
or substr(dx,1,5) =	'E1341'
or substr(dx,1,5) =	'E1342'
or substr(dx,1,5) =	'E1343'
or substr(dx,1,5) =	'E1344'
or substr(dx,1,5) =	'E1349'
or substr(dx,1,5) =	'E1351'
or substr(dx,1,5) =	'E1352'
or substr(dx,1,5) =	'E1359'
or substr(dx,1,6) =	'E13610'
or substr(dx,1,6) =	'E13618'
or substr(dx,1,6) =	'E13620'
or substr(dx,1,6) =	'E13621'
or substr(dx,1,6) =	'E13622'
or substr(dx,1,6) =	'E13628'
or substr(dx,1,6) =	'E13630'
or substr(dx,1,6) =	'E13638'
or substr(dx,1,6) =	'E13641'
or substr(dx,1,6) =	'E13649'
or substr(dx,1,5) =	'E1365'
or substr(dx,1,5) =	'E1369'
or substr(dx,1,4) =	'E138'
or substr(dx,1,4) =	'E139')
		and ccw_13=0
                then ccw_13=1;
*Glaucoma ;
	if (substr(dx,1,5) =	'36285'
or substr(dx,1,5) =	'36501'
or substr(dx,1,5) =	'36502'
or substr(dx,1,5) =	'36503'
or substr(dx,1,5) =	'36504'
or substr(dx,1,5) =	'36511'
or substr(dx,1,5) =	'36512'
or substr(dx,1,5) =	'36513'
or substr(dx,1,5) =	'36515'
or substr(dx,1,5) =	'36510'
or substr(dx,1,5) =	'36521'
or substr(dx,1,5) =	'36522'
or substr(dx,1,5) =	'36523'
or substr(dx,1,5) =	'36524'
or substr(dx,1,5) =	'36520'
or substr(dx,1,5) =	'36531'
or substr(dx,1,5) =	'36532'
or substr(dx,1,5) =	'36541'
or substr(dx,1,5) =	'36542'
or substr(dx,1,5) =	'36543'
or substr(dx,1,5) =	'36551'
or substr(dx,1,5) =	'36552'
or substr(dx,1,5) =	'36559'
or substr(dx,1,5) =	'36561'
or substr(dx,1,5) =	'36562'
or substr(dx,1,5) =	'36563'
or substr(dx,1,5) =	'36564'
or substr(dx,1,5) =	'36565'
or substr(dx,1,5) =	'36560'
or substr(dx,1,5) =	'36581'
or substr(dx,1,5) =	'36582'
or substr(dx,1,5) =	'36583'
or substr(dx,1,5) =	'36589'
or substr(dx,1,4) =	'3659'
or substr(dx,1,5) =	'36500'
or substr(dx,1,5) =	'37714'
or substr(dx,1,6) =	'H40001'
or substr(dx,1,6) =	'H40002'
or substr(dx,1,6) =	'H40003'
or substr(dx,1,6) =	'H40009'
or substr(dx,1,6) =	'H40011'
or substr(dx,1,6) =	'H40012'
or substr(dx,1,6) =	'H40013'
or substr(dx,1,6) =	'H40019'
or substr(dx,1,6) =	'H40031'
or substr(dx,1,6) =	'H40032'
or substr(dx,1,6) =	'H40033'
or substr(dx,1,6) =	'H40039'
or substr(dx,1,6) =	'H40041'
or substr(dx,1,6) =	'H40042'
or substr(dx,1,6) =	'H40043'
or substr(dx,1,6) =	'H40049'
or substr(dx,1,6) =	'H40051'
or substr(dx,1,6) =	'H40052'
or substr(dx,1,6) =	'H40053'
or substr(dx,1,6) =	'H40059'
or substr(dx,1,7) =	'H4010X0'
or substr(dx,1,7) =	'H4010X1'
or substr(dx,1,7) =	'H4010X2'
or substr(dx,1,7) =	'H4010X3'
or substr(dx,1,7) =	'H4010X4'
or substr(dx,1,7) =	'H401110'
or substr(dx,1,7) =	'H401111'
or substr(dx,1,7) =	'H401112'
or substr(dx,1,7) =	'H401113'
or substr(dx,1,7) =	'H401114'
or substr(dx,1,7) =	'H401120'
or substr(dx,1,7) =	'H401121'
or substr(dx,1,7) =	'H401122'
or substr(dx,1,7) =	'H401123'
or substr(dx,1,7) =	'H401124'
or substr(dx,1,7) =	'H401130'
or substr(dx,1,7) =	'H401131'
or substr(dx,1,7) =	'H401132'
or substr(dx,1,7) =	'H401133'
or substr(dx,1,7) =	'H401134'
or substr(dx,1,7) =	'H401190'
or substr(dx,1,7) =	'H401191'
or substr(dx,1,7) =	'H401192'
or substr(dx,1,7) =	'H401193'
or substr(dx,1,7) =	'H401194'
or substr(dx,1,7) =	'H4011X0'
or substr(dx,1,7) =	'H4011X1'
or substr(dx,1,7) =	'H4011X2'
or substr(dx,1,7) =	'H4011X3'
or substr(dx,1,7) =	'H4011X4'
or substr(dx,1,7) =	'H401210'
or substr(dx,1,7) =	'H401211'
or substr(dx,1,7) =	'H401212'
or substr(dx,1,7) =	'H401213'
or substr(dx,1,7) =	'H401214'
or substr(dx,1,7) =	'H401220'
or substr(dx,1,7) =	'H401221'
or substr(dx,1,7) =	'H401222'
or substr(dx,1,7) =	'H401223'
or substr(dx,1,7) =	'H401224'
or substr(dx,1,7) =	'H401230'
or substr(dx,1,7) =	'H401231'
or substr(dx,1,7) =	'H401232'
or substr(dx,1,7) =	'H401233'
or substr(dx,1,7) =	'H401234'
or substr(dx,1,7) =	'H401290'
or substr(dx,1,7) =	'H401291'
or substr(dx,1,7) =	'H401292'
or substr(dx,1,7) =	'H401293'
or substr(dx,1,7) =	'H401294'
or substr(dx,1,7) =	'H401310'
or substr(dx,1,7) =	'H401311'
or substr(dx,1,7) =	'H401312'
or substr(dx,1,7) =	'H401313'
or substr(dx,1,7) =	'H401314'
or substr(dx,1,7) =	'H401320'
or substr(dx,1,7) =	'H401321'
or substr(dx,1,7) =	'H401322'
or substr(dx,1,7) =	'H401323'
or substr(dx,1,7) =	'H401324'
or substr(dx,1,7) =	'H401330'
or substr(dx,1,7) =	'H401331'
or substr(dx,1,7) =	'H401332'
or substr(dx,1,7) =	'H401333'
or substr(dx,1,7) =	'H401334'
or substr(dx,1,7) =	'H401390'
or substr(dx,1,7) =	'H401391'
or substr(dx,1,7) =	'H401392'
or substr(dx,1,7) =	'H401393'
or substr(dx,1,7) =	'H401394'
or substr(dx,1,7) =	'H401410'
or substr(dx,1,7) =	'H401411'
or substr(dx,1,7) =	'H401412'
or substr(dx,1,7) =	'H401413'
or substr(dx,1,7) =	'H401414'
or substr(dx,1,7) =	'H401420'
or substr(dx,1,7) =	'H401421'
or substr(dx,1,7) =	'H401422'
or substr(dx,1,7) =	'H401423'
or substr(dx,1,7) =	'H401424'
or substr(dx,1,7) =	'H401430'
or substr(dx,1,7) =	'H401431'
or substr(dx,1,7) =	'H401432'
or substr(dx,1,7) =	'H401433'
or substr(dx,1,7) =	'H401434'
or substr(dx,1,7) =	'H401490'
or substr(dx,1,7) =	'H401491'
or substr(dx,1,7) =	'H401492'
or substr(dx,1,7) =	'H401493'
or substr(dx,1,7) =	'H401494'
or substr(dx,1,6) =	'H40151'
or substr(dx,1,6) =	'H40152'
or substr(dx,1,6) =	'H40153'
or substr(dx,1,6) =	'H40159'
or substr(dx,1,7) =	'H4020X0'
or substr(dx,1,7) =	'H4020X1'
or substr(dx,1,7) =	'H4020X2'
or substr(dx,1,7) =	'H4020X3'
or substr(dx,1,7) =	'H4020X4'
or substr(dx,1,6) =	'H40211'
or substr(dx,1,6) =	'H40212'
or substr(dx,1,6) =	'H40213'
or substr(dx,1,6) =	'H40219'
or substr(dx,1,7) =	'H402210'
or substr(dx,1,7) =	'H402211'
or substr(dx,1,7) =	'H402212'
or substr(dx,1,7) =	'H402213'
or substr(dx,1,7) =	'H402214'
or substr(dx,1,7) =	'H402220'
or substr(dx,1,7) =	'H402221'
or substr(dx,1,7) =	'H402222'
or substr(dx,1,7) =	'H402223'
or substr(dx,1,7) =	'H402224'
or substr(dx,1,7) =	'H402230'
or substr(dx,1,7) =	'H402231'
or substr(dx,1,7) =	'H402232'
or substr(dx,1,7) =	'H402233'
or substr(dx,1,7) =	'H402234'
or substr(dx,1,7) =	'H402290'
or substr(dx,1,7) =	'H402291'
or substr(dx,1,7) =	'H402292'
or substr(dx,1,7) =	'H402293'
or substr(dx,1,7) =	'H402294'
or substr(dx,1,6) =	'H40231'
or substr(dx,1,6) =	'H40232'
or substr(dx,1,6) =	'H40233'
or substr(dx,1,6) =	'H40239'
or substr(dx,1,6) =	'H40241'
or substr(dx,1,6) =	'H40242'
or substr(dx,1,6) =	'H40243'
or substr(dx,1,6) =	'H40249'
or substr(dx,1,7) =	'H4030X0'
or substr(dx,1,7) =	'H4030X1'
or substr(dx,1,7) =	'H4030X2'
or substr(dx,1,7) =	'H4030X3'
or substr(dx,1,7) =	'H4030X4'
or substr(dx,1,7) =	'H4031X0'
or substr(dx,1,7) =	'H4031X1'
or substr(dx,1,7) =	'H4031X2'
or substr(dx,1,7) =	'H4031X3'
or substr(dx,1,7) =	'H4031X4'
or substr(dx,1,7) =	'H4032X0'
or substr(dx,1,7) =	'H4032X1'
or substr(dx,1,7) =	'H4032X2'
or substr(dx,1,7) =	'H4032X3'
or substr(dx,1,7) =	'H4032X4'
or substr(dx,1,7) =	'H4033X0'
or substr(dx,1,7) =	'H4033X1'
or substr(dx,1,7) =	'H4033X2'
or substr(dx,1,7) =	'H4033X3'
or substr(dx,1,7) =	'H4033X4'
or substr(dx,1,7) =	'H4040X0'
or substr(dx,1,7) =	'H4040X1'
or substr(dx,1,7) =	'H4040X2'
or substr(dx,1,7) =	'H4040X3'
or substr(dx,1,7) =	'H4040X4'
or substr(dx,1,7) =	'H4041X0'
or substr(dx,1,7) =	'H4041X1'
or substr(dx,1,7) =	'H4041X2'
or substr(dx,1,7) =	'H4041X3'
or substr(dx,1,7) =	'H4041X4'
or substr(dx,1,7) =	'H4042X0'
or substr(dx,1,7) =	'H4042X1'
or substr(dx,1,7) =	'H4042X2'
or substr(dx,1,7) =	'H4042X3'
or substr(dx,1,7) =	'H4042X4'
or substr(dx,1,7) =	'H4043X0'
or substr(dx,1,7) =	'H4043X1'
or substr(dx,1,7) =	'H4043X2'
or substr(dx,1,7) =	'H4043X3'
or substr(dx,1,7) =	'H4043X4'
or substr(dx,1,7) =	'H4050X0'
or substr(dx,1,7) =	'H4050X1'
or substr(dx,1,7) =	'H4050X2'
or substr(dx,1,7) =	'H4050X3'
or substr(dx,1,7) =	'H4050X4'
or substr(dx,1,7) =	'H4051X0'
or substr(dx,1,7) =	'H4051X1'
or substr(dx,1,7) =	'H4051X2'
or substr(dx,1,7) =	'H4051X3'
or substr(dx,1,7) =	'H4051X4'
or substr(dx,1,7) =	'H4052X0'
or substr(dx,1,7) =	'H4052X1'
or substr(dx,1,7) =	'H4052X2'
or substr(dx,1,7) =	'H4052X3'
or substr(dx,1,7) =	'H4052X4'
or substr(dx,1,7) =	'H4053X0'
or substr(dx,1,7) =	'H4053X1'
or substr(dx,1,7) =	'H4053X2'
or substr(dx,1,7) =	'H4053X3'
or substr(dx,1,7) =	'H4053X4'
or substr(dx,1,7) =	'H4060X0'
or substr(dx,1,7) =	'H4060X1'
or substr(dx,1,7) =	'H4060X2'
or substr(dx,1,7) =	'H4060X3'
or substr(dx,1,7) =	'H4060X4'
or substr(dx,1,7) =	'H4061X0'
or substr(dx,1,7) =	'H4061X1'
or substr(dx,1,7) =	'H4061X2'
or substr(dx,1,7) =	'H4061X3'
or substr(dx,1,7) =	'H4061X4'
or substr(dx,1,7) =	'H4062X0'
or substr(dx,1,7) =	'H4062X1'
or substr(dx,1,7) =	'H4062X2'
or substr(dx,1,7) =	'H4062X3'
or substr(dx,1,7) =	'H4062X4'
or substr(dx,1,7) =	'H4063X0'
or substr(dx,1,7) =	'H4063X1'
or substr(dx,1,7) =	'H4063X2'
or substr(dx,1,7) =	'H4063X3'
or substr(dx,1,7) =	'H4063X4'
or substr(dx,1,6) =	'H40811'
or substr(dx,1,6) =	'H40812'
or substr(dx,1,6) =	'H40813'
or substr(dx,1,6) =	'H40819'
or substr(dx,1,6) =	'H40821'
or substr(dx,1,6) =	'H40822'
or substr(dx,1,6) =	'H40823'
or substr(dx,1,6) =	'H40829'
or substr(dx,1,6) =	'H40831'
or substr(dx,1,6) =	'H40832'
or substr(dx,1,6) =	'H40833'
or substr(dx,1,6) =	'H40839'
or substr(dx,1,5) =	'H4089'
or substr(dx,1,4) =	'H409'
or substr(dx,1,3) =	'H42'
or substr(dx,1,6) =	'H44511'
or substr(dx,1,6) =	'H44512'
or substr(dx,1,6) =	'H44513'
or substr(dx,1,6) =	'H44519'
or substr(dx,1,6) =	'H47231'
or substr(dx,1,6) =	'H47232'
or substr(dx,1,6) =	'H47233'
or substr(dx,1,6) =	'H47239'
or substr(dx,1,4) =	'Q150')
		and ccw_14=0
                then ccw_14=1;
* Heart Failure;
	if (substr(dx,1,5) =	'39891'
or substr(dx,1,5) =	'40201'
or substr(dx,1,5) =	'40211'
or substr(dx,1,5) =	'40291'
or substr(dx,1,5) =	'40401'
or substr(dx,1,5) =	'40403'
or substr(dx,1,5) =	'40411'
or substr(dx,1,5) =	'40413'
or substr(dx,1,5) =	'40491'
or substr(dx,1,5) =	'40493'
or substr(dx,1,4) =	'4281'
or substr(dx,1,5) =	'42821'
or substr(dx,1,5) =	'42822'
or substr(dx,1,5) =	'42823'
or substr(dx,1,5) =	'42820'
or substr(dx,1,5) =	'42831'
or substr(dx,1,5) =	'42832'
or substr(dx,1,5) =	'42833'
or substr(dx,1,5) =	'42830'
or substr(dx,1,5) =	'42841'
or substr(dx,1,5) =	'42842'
or substr(dx,1,5) =	'42843'
or substr(dx,1,5) =	'42840'
or substr(dx,1,4) =	'4289'
or substr(dx,1,4) =	'4280'
or substr(dx,1,5) =	'I0981'
or substr(dx,1,4) =	'I110'
or substr(dx,1,4) =	'I130'
or substr(dx,1,4) =	'I132'
or substr(dx,1,4) =	'I501'
or substr(dx,1,5) =	'I5020'
or substr(dx,1,5) =	'I5021'
or substr(dx,1,5) =	'I5022'
or substr(dx,1,5) =	'I5023'
or substr(dx,1,5) =	'I5030'
or substr(dx,1,5) =	'I5031'
or substr(dx,1,5) =	'I5032'
or substr(dx,1,5) =	'I5033'
or substr(dx,1,5) =	'I5040'
or substr(dx,1,5) =	'I5041'
or substr(dx,1,5) =	'I5042'
or substr(dx,1,5) =	'I5043'
or substr(dx,1,6) =	'I50810'
or substr(dx,1,6) =	'I50811'
or substr(dx,1,6) =	'I50812'
or substr(dx,1,6) =	'I50813'
or substr(dx,1,6) =	'I50814'
or substr(dx,1,5) =	'I5082'
or substr(dx,1,5) =	'I5083'
or substr(dx,1,5) =	'I5084'
or substr(dx,1,5) =	'I5089'
or substr(dx,1,4) =	'I509')
		and ccw_15=0
                then ccw_15=1;
  * Hip/Pelvic Fracture ;
	if (substr(dx,1,5) =	'73314'
or substr(dx,1,5) =	'73315'
or substr(dx,1,5) =	'73396'
or substr(dx,1,5) =	'73397'
or substr(dx,1,5) =	'73398'
or substr(dx,1,4) =	'8081'
or substr(dx,1,4) =	'8082'
or substr(dx,1,4) =	'8083'
or substr(dx,1,5) =	'80841'
or substr(dx,1,5) =	'80842'
or substr(dx,1,5) =	'80843'
or substr(dx,1,5) =	'80844'
or substr(dx,1,5) =	'80849'
or substr(dx,1,5) =	'80851'
or substr(dx,1,5) =	'80852'
or substr(dx,1,5) =	'80853'
or substr(dx,1,5) =	'80854'
or substr(dx,1,5) =	'80859'
or substr(dx,1,4) =	'8088'
or substr(dx,1,4) =	'8089'
or substr(dx,1,4) =	'8080'
or substr(dx,1,5) =	'82001'
or substr(dx,1,5) =	'82002'
or substr(dx,1,5) =	'82003'
or substr(dx,1,5) =	'82009'
or substr(dx,1,5) =	'82011'
or substr(dx,1,5) =	'82012'
or substr(dx,1,5) =	'82013'
or substr(dx,1,5) =	'82019'
or substr(dx,1,5) =	'82010'
or substr(dx,1,5) =	'82021'
or substr(dx,1,5) =	'82022'
or substr(dx,1,5) =	'82020'
or substr(dx,1,5) =	'82031'
or substr(dx,1,5) =	'82032'
or substr(dx,1,5) =	'82030'
or substr(dx,1,4) =	'8208'
or substr(dx,1,4) =	'8209'
or substr(dx,1,5) =	'82000'
or substr(dx,1,7) =	'M80051A'
or substr(dx,1,7) =	'M80052A'
or substr(dx,1,7) =	'M80059A'
or substr(dx,1,7) =	'M80851A'
or substr(dx,1,7) =	'M80852A'
or substr(dx,1,7) =	'M80859A'
or substr(dx,1,7) =	'M84350A'
or substr(dx,1,7) =	'M84351A'
or substr(dx,1,7) =	'M84352A'
or substr(dx,1,7) =	'M84353A'
or substr(dx,1,7) =	'M84359A'
or substr(dx,1,7) =	'M84451A'
or substr(dx,1,7) =	'M84452A'
or substr(dx,1,7) =	'M84453A'
or substr(dx,1,7) =	'M84459A'
or substr(dx,1,7) =	'M84550A'
or substr(dx,1,7) =	'M84551A'
or substr(dx,1,7) =	'M84552A'
or substr(dx,1,7) =	'M84553A'
or substr(dx,1,7) =	'M84559A'
or substr(dx,1,7) =	'M84650A'
or substr(dx,1,7) =	'M84651A'
or substr(dx,1,7) =	'M84652A'
or substr(dx,1,7) =	'M84653A'
or substr(dx,1,7) =	'M84659A'
or substr(dx,1,7) =	'S32301A'
or substr(dx,1,7) =	'S32301B'
or substr(dx,1,7) =	'S32302A'
or substr(dx,1,7) =	'S32302B'
or substr(dx,1,7) =	'S32309A'
or substr(dx,1,7) =	'S32309B'
or substr(dx,1,7) =	'S32311A'
or substr(dx,1,7) =	'S32311B'
or substr(dx,1,7) =	'S32312A'
or substr(dx,1,7) =	'S32312B'
or substr(dx,1,7) =	'S32313A'
or substr(dx,1,7) =	'S32313B'
or substr(dx,1,7) =	'S32314A'
or substr(dx,1,7) =	'S32314B'
or substr(dx,1,7) =	'S32315A'
or substr(dx,1,7) =	'S32315B'
or substr(dx,1,7) =	'S32316A'
or substr(dx,1,7) =	'S32316B'
or substr(dx,1,7) =	'S32391A'
or substr(dx,1,7) =	'S32391B'
or substr(dx,1,7) =	'S32392A'
or substr(dx,1,7) =	'S32392B'
or substr(dx,1,7) =	'S32399A'
or substr(dx,1,7) =	'S32399B'
or substr(dx,1,7) =	'S32401A'
or substr(dx,1,7) =	'S32401B'
or substr(dx,1,7) =	'S32402A'
or substr(dx,1,7) =	'S32402B'
or substr(dx,1,7) =	'S32409A'
or substr(dx,1,7) =	'S32409B'
or substr(dx,1,7) =	'S32411A'
or substr(dx,1,7) =	'S32411B'
or substr(dx,1,7) =	'S32412A'
or substr(dx,1,7) =	'S32412B'
or substr(dx,1,7) =	'S32413A'
or substr(dx,1,7) =	'S32413B'
or substr(dx,1,7) =	'S32414A'
or substr(dx,1,7) =	'S32414B'
or substr(dx,1,7) =	'S32415A'
or substr(dx,1,7) =	'S32415B'
or substr(dx,1,7) =	'S32416A'
or substr(dx,1,7) =	'S32416B'
or substr(dx,1,7) =	'S32421A'
or substr(dx,1,7) =	'S32421B'
or substr(dx,1,7) =	'S32422A'
or substr(dx,1,7) =	'S32422B'
or substr(dx,1,7) =	'S32423A'
or substr(dx,1,7) =	'S32423B'
or substr(dx,1,7) =	'S32424A'
or substr(dx,1,7) =	'S32424B'
or substr(dx,1,7) =	'S32425A'
or substr(dx,1,7) =	'S32425B'
or substr(dx,1,7) =	'S32426A'
or substr(dx,1,7) =	'S32426B'
or substr(dx,1,7) =	'S32431A'
or substr(dx,1,7) =	'S32431B'
or substr(dx,1,7) =	'S32432A'
or substr(dx,1,7) =	'S32432B'
or substr(dx,1,7) =	'S32433A'
or substr(dx,1,7) =	'S32433B'
or substr(dx,1,7) =	'S32434A'
or substr(dx,1,7) =	'S32434B'
or substr(dx,1,7) =	'S32435A'
or substr(dx,1,7) =	'S32435B'
or substr(dx,1,7) =	'S32436A'
or substr(dx,1,7) =	'S32436B'
or substr(dx,1,7) =	'S32441A'
or substr(dx,1,7) =	'S32441B'
or substr(dx,1,7) =	'S32442A'
or substr(dx,1,7) =	'S32442B'
or substr(dx,1,7) =	'S32443A'
or substr(dx,1,7) =	'S32443B'
or substr(dx,1,7) =	'S32444A'
or substr(dx,1,7) =	'S32444B'
or substr(dx,1,7) =	'S32445A'
or substr(dx,1,7) =	'S32445B'
or substr(dx,1,7) =	'S32446A'
or substr(dx,1,7) =	'S32446B'
or substr(dx,1,7) =	'S32451A'
or substr(dx,1,7) =	'S32451B'
or substr(dx,1,7) =	'S32452A'
or substr(dx,1,7) =	'S32452B'
or substr(dx,1,7) =	'S32453A'
or substr(dx,1,7) =	'S32453B'
or substr(dx,1,7) =	'S32454A'
or substr(dx,1,7) =	'S32454B'
or substr(dx,1,7) =	'S32455A'
or substr(dx,1,7) =	'S32455B'
or substr(dx,1,7) =	'S32456A'
or substr(dx,1,7) =	'S32456B'
or substr(dx,1,7) =	'S32461A'
or substr(dx,1,7) =	'S32461B'
or substr(dx,1,7) =	'S32462A'
or substr(dx,1,7) =	'S32462B'
or substr(dx,1,7) =	'S32463A'
or substr(dx,1,7) =	'S32463B'
or substr(dx,1,7) =	'S32464A'
or substr(dx,1,7) =	'S32464B'
or substr(dx,1,7) =	'S32465A'
or substr(dx,1,7) =	'S32465B'
or substr(dx,1,7) =	'S32466A'
or substr(dx,1,7) =	'S32466B'
or substr(dx,1,7) =	'S32471A'
or substr(dx,1,7) =	'S32471B'
or substr(dx,1,7) =	'S32472A'
or substr(dx,1,7) =	'S32472B'
or substr(dx,1,7) =	'S32473A'
or substr(dx,1,7) =	'S32473B'
or substr(dx,1,7) =	'S32474A'
or substr(dx,1,7) =	'S32474B'
or substr(dx,1,7) =	'S32475A'
or substr(dx,1,7) =	'S32475B'
or substr(dx,1,7) =	'S32476A'
or substr(dx,1,7) =	'S32476B'
or substr(dx,1,7) =	'S32481A'
or substr(dx,1,7) =	'S32481B'
or substr(dx,1,7) =	'S32482A'
or substr(dx,1,7) =	'S32482B'
or substr(dx,1,7) =	'S32483A'
or substr(dx,1,7) =	'S32483B'
or substr(dx,1,7) =	'S32484A'
or substr(dx,1,7) =	'S32484B'
or substr(dx,1,7) =	'S32485A'
or substr(dx,1,7) =	'S32485B'
or substr(dx,1,7) =	'S32486A'
or substr(dx,1,7) =	'S32486B'
or substr(dx,1,7) =	'S32491A'
or substr(dx,1,7) =	'S32491B'
or substr(dx,1,7) =	'S32492A'
or substr(dx,1,7) =	'S32492B'
or substr(dx,1,7) =	'S32499A'
or substr(dx,1,7) =	'S32499B'
or substr(dx,1,7) =	'S32501A'
or substr(dx,1,7) =	'S32501B'
or substr(dx,1,7) =	'S32502A'
or substr(dx,1,7) =	'S32502B'
or substr(dx,1,7) =	'S32509A'
or substr(dx,1,7) =	'S32509B'
or substr(dx,1,7) =	'S32511A'
or substr(dx,1,7) =	'S32511B'
or substr(dx,1,7) =	'S32512A'
or substr(dx,1,7) =	'S32512B'
or substr(dx,1,7) =	'S32519A'
or substr(dx,1,7) =	'S32519B'
or substr(dx,1,7) =	'S32591A'
or substr(dx,1,7) =	'S32591B'
or substr(dx,1,7) =	'S32592A'
or substr(dx,1,7) =	'S32592B'
or substr(dx,1,7) =	'S32599A'
or substr(dx,1,7) =	'S32599B'
or substr(dx,1,7) =	'S32601A'
or substr(dx,1,7) =	'S32601B'
or substr(dx,1,7) =	'S32602A'
or substr(dx,1,7) =	'S32602B'
or substr(dx,1,7) =	'S32609A'
or substr(dx,1,7) =	'S32609B'
or substr(dx,1,7) =	'S32611A'
or substr(dx,1,7) =	'S32611B'
or substr(dx,1,7) =	'S32612A'
or substr(dx,1,7) =	'S32612B'
or substr(dx,1,7) =	'S32613A'
or substr(dx,1,7) =	'S32613B'
or substr(dx,1,7) =	'S32614A'
or substr(dx,1,7) =	'S32614B'
or substr(dx,1,7) =	'S32615A'
or substr(dx,1,7) =	'S32615B'
or substr(dx,1,7) =	'S32616A'
or substr(dx,1,7) =	'S32616B'
or substr(dx,1,7) =	'S32691A'
or substr(dx,1,7) =	'S32691B'
or substr(dx,1,7) =	'S32692A'
or substr(dx,1,7) =	'S32692B'
or substr(dx,1,7) =	'S32699A'
or substr(dx,1,7) =	'S32699B'
or substr(dx,1,7) =	'S32810A'
or substr(dx,1,7) =	'S32810B'
or substr(dx,1,7) =	'S32811A'
or substr(dx,1,7) =	'S32811B'
or substr(dx,1,7) =	'S3282XA'
or substr(dx,1,7) =	'S3282XB'
or substr(dx,1,7) =	'S3289XA'
or substr(dx,1,7) =	'S3289XB'
or substr(dx,1,7) =	'S329XXA'
or substr(dx,1,7) =	'S329XXB'
or substr(dx,1,7) =	'S72001A'
or substr(dx,1,7) =	'S72001B'
or substr(dx,1,7) =	'S72001C'
or substr(dx,1,7) =	'S72002A'
or substr(dx,1,7) =	'S72002B'
or substr(dx,1,7) =	'S72002C'
or substr(dx,1,7) =	'S72009A'
or substr(dx,1,7) =	'S72009B'
or substr(dx,1,7) =	'S72009C'
or substr(dx,1,7) =	'S72011A'
or substr(dx,1,7) =	'S72011B'
or substr(dx,1,7) =	'S72011C'
or substr(dx,1,7) =	'S72012A'
or substr(dx,1,7) =	'S72012B'
or substr(dx,1,7) =	'S72012C'
or substr(dx,1,7) =	'S72019A'
or substr(dx,1,7) =	'S72019B'
or substr(dx,1,7) =	'S72019C'
or substr(dx,1,7) =	'S72021A'
or substr(dx,1,7) =	'S72021B'
or substr(dx,1,7) =	'S72021C'
or substr(dx,1,7) =	'S72022A'
or substr(dx,1,7) =	'S72022B'
or substr(dx,1,7) =	'S72022C'
or substr(dx,1,7) =	'S72023A'
or substr(dx,1,7) =	'S72023B'
or substr(dx,1,7) =	'S72023C'
or substr(dx,1,7) =	'S72024A'
or substr(dx,1,7) =	'S72024B'
or substr(dx,1,7) =	'S72024C'
or substr(dx,1,7) =	'S72025A'
or substr(dx,1,7) =	'S72025B'
or substr(dx,1,7) =	'S72025C'
or substr(dx,1,7) =	'S72026A'
or substr(dx,1,7) =	'S72026B'
or substr(dx,1,7) =	'S72026C'
or substr(dx,1,7) =	'S72031A'
or substr(dx,1,7) =	'S72031B'
or substr(dx,1,7) =	'S72031C'
or substr(dx,1,7) =	'S72032A'
or substr(dx,1,7) =	'S72032B'
or substr(dx,1,7) =	'S72032C'
or substr(dx,1,7) =	'S72033A'
or substr(dx,1,7) =	'S72033B'
or substr(dx,1,7) =	'S72033C'
or substr(dx,1,7) =	'S72034A'
or substr(dx,1,7) =	'S72034B'
or substr(dx,1,7) =	'S72034C'
or substr(dx,1,7) =	'S72035A'
or substr(dx,1,7) =	'S72035B'
or substr(dx,1,7) =	'S72035C'
or substr(dx,1,7) =	'S72036A'
or substr(dx,1,7) =	'S72036B'
or substr(dx,1,7) =	'S72036C'
or substr(dx,1,7) =	'S72041A'
or substr(dx,1,7) =	'S72041B'
or substr(dx,1,7) =	'S72041C'
or substr(dx,1,7) =	'S72042A'
or substr(dx,1,7) =	'S72042B'
or substr(dx,1,7) =	'S72042C'
or substr(dx,1,7) =	'S72043A'
or substr(dx,1,7) =	'S72043B'
or substr(dx,1,7) =	'S72043C'
or substr(dx,1,7) =	'S72044A'
or substr(dx,1,7) =	'S72044B'
or substr(dx,1,7) =	'S72044C'
or substr(dx,1,7) =	'S72045A'
or substr(dx,1,7) =	'S72045B'
or substr(dx,1,7) =	'S72045C'
or substr(dx,1,7) =	'S72046A'
or substr(dx,1,7) =	'S72046B'
or substr(dx,1,7) =	'S72046C'
or substr(dx,1,7) =	'S72051A'
or substr(dx,1,7) =	'S72051B'
or substr(dx,1,7) =	'S72051C'
or substr(dx,1,7) =	'S72052A'
or substr(dx,1,7) =	'S72052B'
or substr(dx,1,7) =	'S72052C'
or substr(dx,1,7) =	'S72059A'
or substr(dx,1,7) =	'S72059B'
or substr(dx,1,7) =	'S72059C'
or substr(dx,1,7) =	'S72061A'
or substr(dx,1,7) =	'S72061B'
or substr(dx,1,7) =	'S72061C'
or substr(dx,1,7) =	'S72062A'
or substr(dx,1,7) =	'S72062B'
or substr(dx,1,7) =	'S72062C'
or substr(dx,1,7) =	'S72063A'
or substr(dx,1,7) =	'S72063B'
or substr(dx,1,7) =	'S72063C'
or substr(dx,1,7) =	'S72064A'
or substr(dx,1,7) =	'S72064B'
or substr(dx,1,7) =	'S72064C'
or substr(dx,1,7) =	'S72065A'
or substr(dx,1,7) =	'S72065B'
or substr(dx,1,7) =	'S72065C'
or substr(dx,1,7) =	'S72066A'
or substr(dx,1,7) =	'S72066B'
or substr(dx,1,7) =	'S72066C'
or substr(dx,1,7) =	'S72091A'
or substr(dx,1,7) =	'S72091B'
or substr(dx,1,7) =	'S72091C'
or substr(dx,1,7) =	'S72092A'
or substr(dx,1,7) =	'S72092B'
or substr(dx,1,7) =	'S72092C'
or substr(dx,1,7) =	'S72099A'
or substr(dx,1,7) =	'S72099B'
or substr(dx,1,7) =	'S72099C'
or substr(dx,1,7) =	'S72101A'
or substr(dx,1,7) =	'S72101B'
or substr(dx,1,7) =	'S72101C'
or substr(dx,1,7) =	'S72102A'
or substr(dx,1,7) =	'S72102B'
or substr(dx,1,7) =	'S72102C'
or substr(dx,1,7) =	'S72109A'
or substr(dx,1,7) =	'S72109B'
or substr(dx,1,7) =	'S72109C'
or substr(dx,1,7) =	'S72111A'
or substr(dx,1,7) =	'S72111B'
or substr(dx,1,7) =	'S72111C'
or substr(dx,1,7) =	'S72112A'
or substr(dx,1,7) =	'S72112B'
or substr(dx,1,7) =	'S72112C'
or substr(dx,1,7) =	'S72113A'
or substr(dx,1,7) =	'S72113B'
or substr(dx,1,7) =	'S72113C'
or substr(dx,1,7) =	'S72114A'
or substr(dx,1,7) =	'S72114B'
or substr(dx,1,7) =	'S72114C'
or substr(dx,1,7) =	'S72115A'
or substr(dx,1,7) =	'S72115B'
or substr(dx,1,7) =	'S72115C'
or substr(dx,1,7) =	'S72116A'
or substr(dx,1,7) =	'S72116B'
or substr(dx,1,7) =	'S72116C'
or substr(dx,1,7) =	'S72121A'
or substr(dx,1,7) =	'S72121B'
or substr(dx,1,7) =	'S72121C'
or substr(dx,1,7) =	'S72122A'
or substr(dx,1,7) =	'S72122B'
or substr(dx,1,7) =	'S72122C'
or substr(dx,1,7) =	'S72123A'
or substr(dx,1,7) =	'S72123B'
or substr(dx,1,7) =	'S72123C'
or substr(dx,1,7) =	'S72124A'
or substr(dx,1,7) =	'S72124B'
or substr(dx,1,7) =	'S72124C'
or substr(dx,1,7) =	'S72125A'
or substr(dx,1,7) =	'S72125B'
or substr(dx,1,7) =	'S72125C'
or substr(dx,1,7) =	'S72126A'
or substr(dx,1,7) =	'S72126B'
or substr(dx,1,7) =	'S72126C'
or substr(dx,1,7) =	'S72131A'
or substr(dx,1,7) =	'S72131B'
or substr(dx,1,7) =	'S72131C'
or substr(dx,1,7) =	'S72132A'
or substr(dx,1,7) =	'S72132B'
or substr(dx,1,7) =	'S72132C'
or substr(dx,1,7) =	'S72133A'
or substr(dx,1,7) =	'S72133B'
or substr(dx,1,7) =	'S72133C'
or substr(dx,1,7) =	'S72134A'
or substr(dx,1,7) =	'S72134B'
or substr(dx,1,7) =	'S72134C'
or substr(dx,1,7) =	'S72135A'
or substr(dx,1,7) =	'S72135B'
or substr(dx,1,7) =	'S72135C'
or substr(dx,1,7) =	'S72136A'
or substr(dx,1,7) =	'S72136B'
or substr(dx,1,7) =	'S72136C'
or substr(dx,1,7) =	'S72141A'
or substr(dx,1,7) =	'S72141B'
or substr(dx,1,7) =	'S72141C'
or substr(dx,1,7) =	'S72142A'
or substr(dx,1,7) =	'S72142B'
or substr(dx,1,7) =	'S72142C'
or substr(dx,1,7) =	'S72143A'
or substr(dx,1,7) =	'S72143B'
or substr(dx,1,7) =	'S72143C'
or substr(dx,1,7) =	'S72144A'
or substr(dx,1,7) =	'S72144B'
or substr(dx,1,7) =	'S72144C'
or substr(dx,1,7) =	'S72145A'
or substr(dx,1,7) =	'S72145B'
or substr(dx,1,7) =	'S72145C'
or substr(dx,1,7) =	'S72146A'
or substr(dx,1,7) =	'S72146B'
or substr(dx,1,7) =	'S72146C'
or substr(dx,1,7) =	'S7221XA'
or substr(dx,1,7) =	'S7221XB'
or substr(dx,1,7) =	'S7221XC'
or substr(dx,1,7) =	'S7222XA'
or substr(dx,1,7) =	'S7222XB'
or substr(dx,1,7) =	'S7222XC'
or substr(dx,1,7) =	'S7223XA'
or substr(dx,1,7) =	'S7223XB'
or substr(dx,1,7) =	'S7223XC'
or substr(dx,1,7) =	'S7224XA'
or substr(dx,1,7) =	'S7224XB'
or substr(dx,1,7) =	'S7224XC'
or substr(dx,1,7) =	'S7225XA'
or substr(dx,1,7) =	'S7225XB'
or substr(dx,1,7) =	'S7225XC'
or substr(dx,1,7) =	'S7226XA'
or substr(dx,1,7) =	'S7226XB'
or substr(dx,1,7) =	'S7226XC'
or substr(dx,1,7) =	'S79001A'
or substr(dx,1,7) =	'S79002A'
or substr(dx,1,7) =	'S79009A'
or substr(dx,1,7) =	'S79011A'
or substr(dx,1,7) =	'S79012A'
or substr(dx,1,7) =	'S79019A'
or substr(dx,1,7) =	'S79091A'
or substr(dx,1,7) =	'S79092A'
or substr(dx,1,7) =	'S79099A')
		and ccw_16=0
                then ccw_16=1;
  * Hyperlipidemia ;
	if (substr(dx,1,4) =	'2721'
or substr(dx,1,4) =	'2722'
or substr(dx,1,4) =	'2723'
or substr(dx,1,4) =	'2724'
or substr(dx,1,4) =	'2720'
or substr(dx,1,4) =	'E780'
or substr(dx,1,4) =	'E781'
or substr(dx,1,4) =	'E782'
or substr(dx,1,4) =	'E783'
or substr(dx,1,4) =	'E784'
or substr(dx,1,4) =	'E785' )
		and ccw_17=0
                then ccw_17=1;

  * Hypertension ;
	if (substr(dx,1,5) =	'36211'
or substr(dx,1,4) =	'4011'
or substr(dx,1,4) =	'4019'
or substr(dx,1,4) =	'4010'
or substr(dx,1,5) =	'40201'
or substr(dx,1,5) =	'40211'
or substr(dx,1,5) =	'40210'
or substr(dx,1,5) =	'40291'
or substr(dx,1,5) =	'40290'
or substr(dx,1,5) =	'40200'
or substr(dx,1,5) =	'40301'
or substr(dx,1,5) =	'40311'
or substr(dx,1,5) =	'40310'
or substr(dx,1,5) =	'40391'
or substr(dx,1,5) =	'40390'
or substr(dx,1,5) =	'40300'
or substr(dx,1,5) =	'40401'
or substr(dx,1,5) =	'40402'
or substr(dx,1,5) =	'40403'
or substr(dx,1,5) =	'40411'
or substr(dx,1,5) =	'40412'
or substr(dx,1,5) =	'40413'
or substr(dx,1,5) =	'40410'
or substr(dx,1,5) =	'40491'
or substr(dx,1,5) =	'40492'
or substr(dx,1,5) =	'40493'
or substr(dx,1,5) =	'40490'
or substr(dx,1,5) =	'40400'
or substr(dx,1,5) =	'40501'
or substr(dx,1,5) =	'40509'
or substr(dx,1,5) =	'40511'
or substr(dx,1,5) =	'40519'
or substr(dx,1,5) =	'40591'
or substr(dx,1,5) =	'40599'
or substr(dx,1,4) =	'4372'
or substr(dx,1,6) =	'H35031'
or substr(dx,1,6) =	'H35032'
or substr(dx,1,6) =	'H35033'
or substr(dx,1,6) =	'H35039'
or substr(dx,1,3) =	'I10'
or substr(dx,1,4) =	'I110'
or substr(dx,1,4) =	'I119'
or substr(dx,1,4) =	'I120'
or substr(dx,1,4) =	'I129'
or substr(dx,1,4) =	'I130'
or substr(dx,1,5) =	'I1310'
or substr(dx,1,5) =	'I1311'
or substr(dx,1,4) =	'I132'
or substr(dx,1,4) =	'I150'
or substr(dx,1,4) =	'I151'
or substr(dx,1,4) =	'I152'
or substr(dx,1,4) =	'I158'
or substr(dx,1,4) =	'I159'
or substr(dx,1,4) =	'I674'
or substr(dx,1,4) =	'N262' )
		and ccw_18=0
                then ccw_18=1;
  * Ischemic Heart Disease ;
	if (substr(dx,1,5) =	'41001'
or substr(dx,1,5) =	'41002'
or substr(dx,1,5) =	'41011'
or substr(dx,1,5) =	'41012'
or substr(dx,1,5) =	'41010'
or substr(dx,1,5) =	'41021'
or substr(dx,1,5) =	'41022'
or substr(dx,1,5) =	'41020'
or substr(dx,1,5) =	'41031'
or substr(dx,1,5) =	'41032'
or substr(dx,1,5) =	'41030'
or substr(dx,1,5) =	'41041'
or substr(dx,1,5) =	'41042'
or substr(dx,1,5) =	'41040'
or substr(dx,1,5) =	'41051'
or substr(dx,1,5) =	'41052'
or substr(dx,1,5) =	'41050'
or substr(dx,1,5) =	'41061'
or substr(dx,1,5) =	'41062'
or substr(dx,1,5) =	'41060'
or substr(dx,1,5) =	'41071'
or substr(dx,1,5) =	'41072'
or substr(dx,1,5) =	'41070'
or substr(dx,1,5) =	'41081'
or substr(dx,1,5) =	'41082'
or substr(dx,1,5) =	'41080'
or substr(dx,1,5) =	'41091'
or substr(dx,1,5) =	'41092'
or substr(dx,1,5) =	'41090'
or substr(dx,1,5) =	'41000'
or substr(dx,1,4) =	'4111'
or substr(dx,1,5) =	'41181'
or substr(dx,1,5) =	'41189'
or substr(dx,1,4) =	'4110'
or substr(dx,1,3) =	'412'
or substr(dx,1,4) =	'4131'
or substr(dx,1,4) =	'4139'
or substr(dx,1,4) =	'4130'
or substr(dx,1,5) =	'41401'
or substr(dx,1,5) =	'41402'
or substr(dx,1,5) =	'41403'
or substr(dx,1,5) =	'41404'
or substr(dx,1,5) =	'41405'
or substr(dx,1,5) =	'41406'
or substr(dx,1,5) =	'41407'
or substr(dx,1,5) =	'41412'
or substr(dx,1,4) =	'4142'
or substr(dx,1,4) =	'4143'
or substr(dx,1,4) =	'4144'
or substr(dx,1,4) =	'4148'
or substr(dx,1,4) =	'4149'
or substr(dx,1,3) =	'414'
or substr(dx,1,4) =	'I200'
or substr(dx,1,4) =	'I201'
or substr(dx,1,4) =	'I208'
or substr(dx,1,4) =	'I209'
or substr(dx,1,5) =	'I2101'
or substr(dx,1,5) =	'I2102'
or substr(dx,1,5) =	'I2109'
or substr(dx,1,5) =	'I2111'
or substr(dx,1,5) =	'I2119'
or substr(dx,1,5) =	'I2121'
or substr(dx,1,5) =	'I2129'
or substr(dx,1,4) =	'I213'
or substr(dx,1,4) =	'I214'
or substr(dx,1,5) =	'I21A1'
or substr(dx,1,5) =	'I21A9'
or substr(dx,1,4) =	'I220'
or substr(dx,1,4) =	'I221'
or substr(dx,1,4) =	'I222'
or substr(dx,1,4) =	'I228'
or substr(dx,1,4) =	'I229'
or substr(dx,1,4) =	'I230'
or substr(dx,1,4) =	'I231'
or substr(dx,1,4) =	'I232'
or substr(dx,1,4) =	'I233'
or substr(dx,1,4) =	'I234'
or substr(dx,1,4) =	'I235'
or substr(dx,1,4) =	'I236'
or substr(dx,1,4) =	'I237'
or substr(dx,1,4) =	'I238'
or substr(dx,1,4) =	'I240'
or substr(dx,1,4) =	'I241'
or substr(dx,1,4) =	'I248'
or substr(dx,1,4) =	'I249'
or substr(dx,1,5) =	'I2510'
or substr(dx,1,6) =	'I25110'
or substr(dx,1,6) =	'I25111'
or substr(dx,1,6) =	'I25118'
or substr(dx,1,6) =	'I25119'
or substr(dx,1,4) =	'I252'
or substr(dx,1,4) =	'I253'
or substr(dx,1,5) =	'I2541'
or substr(dx,1,5) =	'I2542'
or substr(dx,1,4) =	'I255'
or substr(dx,1,4) =	'I256'
or substr(dx,1,6) =	'I25700'
or substr(dx,1,6) =	'I25701'
or substr(dx,1,6) =	'I25708'
or substr(dx,1,6) =	'I25709'
or substr(dx,1,6) =	'I25710'
or substr(dx,1,6) =	'I25711'
or substr(dx,1,6) =	'I25718'
or substr(dx,1,6) =	'I25719'
or substr(dx,1,6) =	'I25720'
or substr(dx,1,6) =	'I25721'
or substr(dx,1,6) =	'I25728'
or substr(dx,1,6) =	'I25729'
or substr(dx,1,6) =	'I25730'
or substr(dx,1,6) =	'I25731'
or substr(dx,1,6) =	'I25738'
or substr(dx,1,6) =	'I25739'
or substr(dx,1,6) =	'I25750'
or substr(dx,1,6) =	'I25751'
or substr(dx,1,6) =	'I25758'
or substr(dx,1,6) =	'I25759'
or substr(dx,1,6) =	'I25760'
or substr(dx,1,6) =	'I25761'
or substr(dx,1,6) =	'I25768'
or substr(dx,1,6) =	'I25769'
or substr(dx,1,6) =	'I25790'
or substr(dx,1,6) =	'I25791'
or substr(dx,1,6) =	'I25798'
or substr(dx,1,6) =	'I25799'
or substr(dx,1,6) =	'I25810'
or substr(dx,1,6) =	'I25811'
or substr(dx,1,6) =	'I25812'
or substr(dx,1,5) =	'I2582'
or substr(dx,1,5) =	'I2583'
or substr(dx,1,5) =	'I2584'
or substr(dx,1,5) =	'I2589'
or substr(dx,1,4) =	'I259')
		and ccw_19=0
                then ccw_19=1;
  * Osteoporosis ;
	if (substr(dx,1,5) =	'73301'
or substr(dx,1,5) =	'73302'
or substr(dx,1,5) =	'73303'
or substr(dx,1,5) =	'73309'
or substr(dx,1,5) =	'73300'
or substr(dx,1,4) =	'M810'
or substr(dx,1,4) =	'M816'
or substr(dx,1,4) =	'M818')
		and ccw_20=0
                then ccw_20=1;
  * RA/OA ;
	if (substr(dx,1,4) =	'7141'
or substr(dx,1,4) =	'7142'
or substr(dx,1,5) =	'71431'
or substr(dx,1,5) =	'71432'
or substr(dx,1,5) =	'71433'
or substr(dx,1,5) =	'71430'
or substr(dx,1,4) =	'7140'
or substr(dx,1,5) =	'71504'
or substr(dx,1,5) =	'71509'
or substr(dx,1,5) =	'71511'
or substr(dx,1,5) =	'71512'
or substr(dx,1,5) =	'71513'
or substr(dx,1,5) =	'71514'
or substr(dx,1,5) =	'71515'
or substr(dx,1,5) =	'71516'
or substr(dx,1,5) =	'71517'
or substr(dx,1,5) =	'71518'
or substr(dx,1,5) =	'71510'
or substr(dx,1,5) =	'71521'
or substr(dx,1,5) =	'71522'
or substr(dx,1,5) =	'71523'
or substr(dx,1,5) =	'71524'
or substr(dx,1,5) =	'71525'
or substr(dx,1,5) =	'71526'
or substr(dx,1,5) =	'71527'
or substr(dx,1,5) =	'71528'
or substr(dx,1,5) =	'71520'
or substr(dx,1,5) =	'71531'
or substr(dx,1,5) =	'71532'
or substr(dx,1,5) =	'71533'
or substr(dx,1,5) =	'71534'
or substr(dx,1,5) =	'71535'
or substr(dx,1,5) =	'71536'
or substr(dx,1,5) =	'71537'
or substr(dx,1,5) =	'71538'
or substr(dx,1,5) =	'71530'
or substr(dx,1,5) =	'71589'
or substr(dx,1,5) =	'71580'
or substr(dx,1,5) =	'71591'
or substr(dx,1,5) =	'71592'
or substr(dx,1,5) =	'71593'
or substr(dx,1,5) =	'71594'
or substr(dx,1,5) =	'71595'
or substr(dx,1,5) =	'71596'
or substr(dx,1,5) =	'71597'
or substr(dx,1,5) =	'71598'
or substr(dx,1,5) =	'71590'
or substr(dx,1,5) =	'71500'
or substr(dx,1,4) =	'7200'
or substr(dx,1,4) =	'7211'
or substr(dx,1,4) =	'7212'
or substr(dx,1,4) =	'7213'
or substr(dx,1,5) =	'72191'
or substr(dx,1,5) =	'72190'
or substr(dx,1,4) =	'7210'
or substr(dx,1,5) =	'M0500'
or substr(dx,1,6) =	'M05011'
or substr(dx,1,6) =	'M05012'
or substr(dx,1,6) =	'M05019'
or substr(dx,1,6) =	'M05021'
or substr(dx,1,6) =	'M05022'
or substr(dx,1,6) =	'M05029'
or substr(dx,1,6) =	'M05031'
or substr(dx,1,6) =	'M05032'
or substr(dx,1,6) =	'M05039'
or substr(dx,1,6) =	'M05041'
or substr(dx,1,6) =	'M05042'
or substr(dx,1,6) =	'M05049'
or substr(dx,1,6) =	'M05051'
or substr(dx,1,6) =	'M05052'
or substr(dx,1,6) =	'M05059'
or substr(dx,1,6) =	'M05061'
or substr(dx,1,6) =	'M05062'
or substr(dx,1,6) =	'M05069'
or substr(dx,1,6) =	'M05071'
or substr(dx,1,6) =	'M05072'
or substr(dx,1,6) =	'M05079'
or substr(dx,1,5) =	'M0509'
or substr(dx,1,5) =	'M0520'
or substr(dx,1,6) =	'M05211'
or substr(dx,1,6) =	'M05212'
or substr(dx,1,6) =	'M05219'
or substr(dx,1,6) =	'M05221'
or substr(dx,1,6) =	'M05222'
or substr(dx,1,6) =	'M05229'
or substr(dx,1,6) =	'M05231'
or substr(dx,1,6) =	'M05232'
or substr(dx,1,6) =	'M05239'
or substr(dx,1,6) =	'M05241'
or substr(dx,1,6) =	'M05242'
or substr(dx,1,6) =	'M05249'
or substr(dx,1,6) =	'M05251'
or substr(dx,1,6) =	'M05252'
or substr(dx,1,6) =	'M05259'
or substr(dx,1,6) =	'M05261'
or substr(dx,1,6) =	'M05262'
or substr(dx,1,6) =	'M05269'
or substr(dx,1,6) =	'M05271'
or substr(dx,1,6) =	'M05272'
or substr(dx,1,6) =	'M05279'
or substr(dx,1,5) =	'M0529'
or substr(dx,1,5) =	'M0530'
or substr(dx,1,6) =	'M05311'
or substr(dx,1,6) =	'M05312'
or substr(dx,1,6) =	'M05319'
or substr(dx,1,6) =	'M05321'
or substr(dx,1,6) =	'M05322'
or substr(dx,1,6) =	'M05329'
or substr(dx,1,6) =	'M05331'
or substr(dx,1,6) =	'M05332'
or substr(dx,1,6) =	'M05339'
or substr(dx,1,6) =	'M05341'
or substr(dx,1,6) =	'M05342'
or substr(dx,1,6) =	'M05349'
or substr(dx,1,6) =	'M05351'
or substr(dx,1,6) =	'M05352'
or substr(dx,1,6) =	'M05359'
or substr(dx,1,6) =	'M05361'
or substr(dx,1,6) =	'M05362'
or substr(dx,1,6) =	'M05369'
or substr(dx,1,6) =	'M05371'
or substr(dx,1,6) =	'M05372'
or substr(dx,1,6) =	'M05379'
or substr(dx,1,5) =	'M0539'
or substr(dx,1,5) =	'M0540'
or substr(dx,1,6) =	'M05411'
or substr(dx,1,6) =	'M05412'
or substr(dx,1,6) =	'M05419'
or substr(dx,1,6) =	'M05421'
or substr(dx,1,6) =	'M05422'
or substr(dx,1,6) =	'M05429'
or substr(dx,1,6) =	'M05431'
or substr(dx,1,6) =	'M05432'
or substr(dx,1,6) =	'M05439'
or substr(dx,1,6) =	'M05441'
or substr(dx,1,6) =	'M05442'
or substr(dx,1,6) =	'M05449'
or substr(dx,1,6) =	'M05451'
or substr(dx,1,6) =	'M05452'
or substr(dx,1,6) =	'M05459'
or substr(dx,1,6) =	'M05461'
or substr(dx,1,6) =	'M05462'
or substr(dx,1,6) =	'M05469'
or substr(dx,1,6) =	'M05471'
or substr(dx,1,6) =	'M05472'
or substr(dx,1,6) =	'M05479'
or substr(dx,1,5) =	'M0549'
or substr(dx,1,5) =	'M0550'
or substr(dx,1,6) =	'M05511'
or substr(dx,1,6) =	'M05512'
or substr(dx,1,6) =	'M05519'
or substr(dx,1,6) =	'M05521'
or substr(dx,1,6) =	'M05522'
or substr(dx,1,6) =	'M05529'
or substr(dx,1,6) =	'M05531'
or substr(dx,1,6) =	'M05532'
or substr(dx,1,6) =	'M05539'
or substr(dx,1,6) =	'M05541'
or substr(dx,1,6) =	'M05542'
or substr(dx,1,6) =	'M05549'
or substr(dx,1,6) =	'M05551'
or substr(dx,1,6) =	'M05552'
or substr(dx,1,6) =	'M05559'
or substr(dx,1,6) =	'M05561'
or substr(dx,1,6) =	'M05562'
or substr(dx,1,6) =	'M05569'
or substr(dx,1,6) =	'M05571'
or substr(dx,1,6) =	'M05572'
or substr(dx,1,6) =	'M05579'
or substr(dx,1,5) =	'M0559'
or substr(dx,1,5) =	'M0560'
or substr(dx,1,6) =	'M05611'
or substr(dx,1,6) =	'M05612'
or substr(dx,1,6) =	'M05619'
or substr(dx,1,6) =	'M05621'
or substr(dx,1,6) =	'M05622'
or substr(dx,1,6) =	'M05629'
or substr(dx,1,6) =	'M05631'
or substr(dx,1,6) =	'M05632'
or substr(dx,1,6) =	'M05639'
or substr(dx,1,6) =	'M05641'
or substr(dx,1,6) =	'M05642'
or substr(dx,1,6) =	'M05649'
or substr(dx,1,6) =	'M05651'
or substr(dx,1,6) =	'M05652'
or substr(dx,1,6) =	'M05659'
or substr(dx,1,6) =	'M05661'
or substr(dx,1,6) =	'M05662'
or substr(dx,1,6) =	'M05669'
or substr(dx,1,6) =	'M05671'
or substr(dx,1,6) =	'M05672'
or substr(dx,1,6) =	'M05679'
or substr(dx,1,5) =	'M0569'
or substr(dx,1,5) =	'M0570'
or substr(dx,1,6) =	'M05711'
or substr(dx,1,6) =	'M05712'
or substr(dx,1,6) =	'M05719'
or substr(dx,1,6) =	'M05721'
or substr(dx,1,6) =	'M05722'
or substr(dx,1,6) =	'M05729'
or substr(dx,1,6) =	'M05731'
or substr(dx,1,6) =	'M05732'
or substr(dx,1,6) =	'M05739'
or substr(dx,1,6) =	'M05741'
or substr(dx,1,6) =	'M05742'
or substr(dx,1,6) =	'M05749'
or substr(dx,1,6) =	'M05751'
or substr(dx,1,6) =	'M05752'
or substr(dx,1,6) =	'M05759'
or substr(dx,1,6) =	'M05761'
or substr(dx,1,6) =	'M05762'
or substr(dx,1,6) =	'M05769'
or substr(dx,1,6) =	'M05771'
or substr(dx,1,6) =	'M05772'
or substr(dx,1,6) =	'M05779'
or substr(dx,1,5) =	'M0579'
or substr(dx,1,5) =	'M0580'
or substr(dx,1,6) =	'M05811'
or substr(dx,1,6) =	'M05812'
or substr(dx,1,6) =	'M05819'
or substr(dx,1,6) =	'M05821'
or substr(dx,1,6) =	'M05822'
or substr(dx,1,6) =	'M05829'
or substr(dx,1,6) =	'M05831'
or substr(dx,1,6) =	'M05832'
or substr(dx,1,6) =	'M05839'
or substr(dx,1,6) =	'M05841'
or substr(dx,1,6) =	'M05842'
or substr(dx,1,6) =	'M05849'
or substr(dx,1,6) =	'M05851'
or substr(dx,1,6) =	'M05852'
or substr(dx,1,6) =	'M05859'
or substr(dx,1,6) =	'M05861'
or substr(dx,1,6) =	'M05862'
or substr(dx,1,6) =	'M05869'
or substr(dx,1,6) =	'M05871'
or substr(dx,1,6) =	'M05872'
or substr(dx,1,6) =	'M05879'
or substr(dx,1,5) =	'M0589'
or substr(dx,1,4) =	'M059'
or substr(dx,1,5) =	'M0600'
or substr(dx,1,6) =	'M06011'
or substr(dx,1,6) =	'M06012'
or substr(dx,1,6) =	'M06019'
or substr(dx,1,6) =	'M06021'
or substr(dx,1,6) =	'M06022'
or substr(dx,1,6) =	'M06029'
or substr(dx,1,6) =	'M06031'
or substr(dx,1,6) =	'M06032'
or substr(dx,1,6) =	'M06039'
or substr(dx,1,6) =	'M06041'
or substr(dx,1,6) =	'M06042'
or substr(dx,1,6) =	'M06049'
or substr(dx,1,6) =	'M06051'
or substr(dx,1,6) =	'M06052'
or substr(dx,1,6) =	'M06059'
or substr(dx,1,6) =	'M06061'
or substr(dx,1,6) =	'M06062'
or substr(dx,1,6) =	'M06069'
or substr(dx,1,6) =	'M06071'
or substr(dx,1,6) =	'M06072'
or substr(dx,1,6) =	'M06079'
or substr(dx,1,5) =	'M0608'
or substr(dx,1,5) =	'M0609'
or substr(dx,1,4) =	'M061'
or substr(dx,1,5) =	'M0620'
or substr(dx,1,6) =	'M06211'
or substr(dx,1,6) =	'M06212'
or substr(dx,1,6) =	'M06219'
or substr(dx,1,6) =	'M06221'
or substr(dx,1,6) =	'M06222'
or substr(dx,1,6) =	'M06229'
or substr(dx,1,6) =	'M06231'
or substr(dx,1,6) =	'M06232'
or substr(dx,1,6) =	'M06239'
or substr(dx,1,6) =	'M06241'
or substr(dx,1,6) =	'M06242'
or substr(dx,1,6) =	'M06249'
or substr(dx,1,6) =	'M06251'
or substr(dx,1,6) =	'M06252'
or substr(dx,1,6) =	'M06259'
or substr(dx,1,6) =	'M06261'
or substr(dx,1,6) =	'M06262'
or substr(dx,1,6) =	'M06269'
or substr(dx,1,6) =	'M06271'
or substr(dx,1,6) =	'M06272'
or substr(dx,1,6) =	'M06279'
or substr(dx,1,5) =	'M0628'
or substr(dx,1,5) =	'M0629'
or substr(dx,1,5) =	'M0630'
or substr(dx,1,6) =	'M06311'
or substr(dx,1,6) =	'M06312'
or substr(dx,1,6) =	'M06319'
or substr(dx,1,6) =	'M06321'
or substr(dx,1,6) =	'M06322'
or substr(dx,1,6) =	'M06329'
or substr(dx,1,6) =	'M06331'
or substr(dx,1,6) =	'M06332'
or substr(dx,1,6) =	'M06339'
or substr(dx,1,6) =	'M06341'
or substr(dx,1,6) =	'M06342'
or substr(dx,1,6) =	'M06349'
or substr(dx,1,6) =	'M06351'
or substr(dx,1,6) =	'M06352'
or substr(dx,1,6) =	'M06359'
or substr(dx,1,6) =	'M06361'
or substr(dx,1,6) =	'M06362'
or substr(dx,1,6) =	'M06369'
or substr(dx,1,6) =	'M06371'
or substr(dx,1,6) =	'M06372'
or substr(dx,1,6) =	'M06379'
or substr(dx,1,5) =	'M0638'
or substr(dx,1,5) =	'M0639'
or substr(dx,1,5) =	'M0680'
or substr(dx,1,6) =	'M06811'
or substr(dx,1,6) =	'M06812'
or substr(dx,1,6) =	'M06819'
or substr(dx,1,6) =	'M06821'
or substr(dx,1,6) =	'M06822'
or substr(dx,1,6) =	'M06829'
or substr(dx,1,6) =	'M06831'
or substr(dx,1,6) =	'M06832'
or substr(dx,1,6) =	'M06839'
or substr(dx,1,6) =	'M06841'
or substr(dx,1,6) =	'M06842'
or substr(dx,1,6) =	'M06849'
or substr(dx,1,6) =	'M06851'
or substr(dx,1,6) =	'M06852'
or substr(dx,1,6) =	'M06859'
or substr(dx,1,6) =	'M06861'
or substr(dx,1,6) =	'M06862'
or substr(dx,1,6) =	'M06869'
or substr(dx,1,6) =	'M06871'
or substr(dx,1,6) =	'M06872'
or substr(dx,1,6) =	'M06879'
or substr(dx,1,5) =	'M0688'
or substr(dx,1,5) =	'M0689'
or substr(dx,1,4) =	'M069'
or substr(dx,1,5) =	'M0800'
or substr(dx,1,6) =	'M08011'
or substr(dx,1,6) =	'M08012'
or substr(dx,1,6) =	'M08019'
or substr(dx,1,6) =	'M08021'
or substr(dx,1,6) =	'M08022'
or substr(dx,1,6) =	'M08029'
or substr(dx,1,6) =	'M08031'
or substr(dx,1,6) =	'M08032'
or substr(dx,1,6) =	'M08039'
or substr(dx,1,6) =	'M08041'
or substr(dx,1,6) =	'M08042'
or substr(dx,1,6) =	'M08049'
or substr(dx,1,6) =	'M08051'
or substr(dx,1,6) =	'M08052'
or substr(dx,1,6) =	'M08059'
or substr(dx,1,6) =	'M08061'
or substr(dx,1,6) =	'M08062'
or substr(dx,1,6) =	'M08069'
or substr(dx,1,6) =	'M08071'
or substr(dx,1,6) =	'M08072'
or substr(dx,1,6) =	'M08079'
or substr(dx,1,5) =	'M0808'
or substr(dx,1,5) =	'M0809'
or substr(dx,1,4) =	'M081'
or substr(dx,1,5) =	'M0820'
or substr(dx,1,6) =	'M08211'
or substr(dx,1,6) =	'M08212'
or substr(dx,1,6) =	'M08219'
or substr(dx,1,6) =	'M08221'
or substr(dx,1,6) =	'M08222'
or substr(dx,1,6) =	'M08229'
or substr(dx,1,6) =	'M08231'
or substr(dx,1,6) =	'M08232'
or substr(dx,1,6) =	'M08239'
or substr(dx,1,6) =	'M08241'
or substr(dx,1,6) =	'M08242'
or substr(dx,1,6) =	'M08249'
or substr(dx,1,6) =	'M08251'
or substr(dx,1,6) =	'M08252'
or substr(dx,1,6) =	'M08259'
or substr(dx,1,6) =	'M08261'
or substr(dx,1,6) =	'M08262'
or substr(dx,1,6) =	'M08269'
or substr(dx,1,6) =	'M08271'
or substr(dx,1,6) =	'M08272'
or substr(dx,1,6) =	'M08279'
or substr(dx,1,5) =	'M0828'
or substr(dx,1,5) =	'M0829'
or substr(dx,1,4) =	'M083'
or substr(dx,1,5) =	'M0840'
or substr(dx,1,6) =	'M08411'
or substr(dx,1,6) =	'M08412'
or substr(dx,1,6) =	'M08419'
or substr(dx,1,6) =	'M08421'
or substr(dx,1,6) =	'M08422'
or substr(dx,1,6) =	'M08429'
or substr(dx,1,6) =	'M08431'
or substr(dx,1,6) =	'M08432'
or substr(dx,1,6) =	'M08439'
or substr(dx,1,6) =	'M08441'
or substr(dx,1,6) =	'M08442'
or substr(dx,1,6) =	'M08449'
or substr(dx,1,6) =	'M08451'
or substr(dx,1,6) =	'M08452'
or substr(dx,1,6) =	'M08459'
or substr(dx,1,6) =	'M08461'
or substr(dx,1,6) =	'M08462'
or substr(dx,1,6) =	'M08469'
or substr(dx,1,6) =	'M08471'
or substr(dx,1,6) =	'M08472'
or substr(dx,1,6) =	'M08479'
or substr(dx,1,5) =	'M0848'
or substr(dx,1,5) =	'M0880'
or substr(dx,1,6) =	'M08811'
or substr(dx,1,6) =	'M08812'
or substr(dx,1,6) =	'M08819'
or substr(dx,1,6) =	'M08821'
or substr(dx,1,6) =	'M08822'
or substr(dx,1,6) =	'M08829'
or substr(dx,1,6) =	'M08831'
or substr(dx,1,6) =	'M08832'
or substr(dx,1,6) =	'M08839'
or substr(dx,1,6) =	'M08841'
or substr(dx,1,6) =	'M08842'
or substr(dx,1,6) =	'M08849'
or substr(dx,1,6) =	'M08851'
or substr(dx,1,6) =	'M08852'
or substr(dx,1,6) =	'M08859'
or substr(dx,1,6) =	'M08861'
or substr(dx,1,6) =	'M08862'
or substr(dx,1,6) =	'M08869'
or substr(dx,1,6) =	'M08871'
or substr(dx,1,6) =	'M08872'
or substr(dx,1,6) =	'M08879'
or substr(dx,1,5) =	'M0888'
or substr(dx,1,5) =	'M0889'
or substr(dx,1,5) =	'M0890'
or substr(dx,1,6) =	'M08911'
or substr(dx,1,6) =	'M08912'
or substr(dx,1,6) =	'M08919'
or substr(dx,1,6) =	'M08921'
or substr(dx,1,6) =	'M08922'
or substr(dx,1,6) =	'M08929'
or substr(dx,1,6) =	'M08931'
or substr(dx,1,6) =	'M08932'
or substr(dx,1,6) =	'M08939'
or substr(dx,1,6) =	'M08941'
or substr(dx,1,6) =	'M08942'
or substr(dx,1,6) =	'M08949'
or substr(dx,1,6) =	'M08951'
or substr(dx,1,6) =	'M08952'
or substr(dx,1,6) =	'M08959'
or substr(dx,1,6) =	'M08961'
or substr(dx,1,6) =	'M08962'
or substr(dx,1,6) =	'M08969'
or substr(dx,1,6) =	'M08971'
or substr(dx,1,6) =	'M08972'
or substr(dx,1,6) =	'M08979'
or substr(dx,1,5) =	'M0898'
or substr(dx,1,5) =	'M0899'
or substr(dx,1,4) =	'M150'
or substr(dx,1,4) =	'M151'
or substr(dx,1,4) =	'M152'
or substr(dx,1,4) =	'M153'
or substr(dx,1,4) =	'M154'
or substr(dx,1,4) =	'M158'
or substr(dx,1,4) =	'M159'
or substr(dx,1,4) =	'M160'
or substr(dx,1,5) =	'M1610'
or substr(dx,1,5) =	'M1611'
or substr(dx,1,5) =	'M1612'
or substr(dx,1,4) =	'M162'
or substr(dx,1,5) =	'M1630'
or substr(dx,1,5) =	'M1631'
or substr(dx,1,5) =	'M1632'
or substr(dx,1,4) =	'M164'
or substr(dx,1,5) =	'M1650'
or substr(dx,1,5) =	'M1651'
or substr(dx,1,5) =	'M1652'
or substr(dx,1,4) =	'M166'
or substr(dx,1,4) =	'M167'
or substr(dx,1,4) =	'M169'
or substr(dx,1,4) =	'M170'
or substr(dx,1,5) =	'M1710'
or substr(dx,1,5) =	'M1711'
or substr(dx,1,5) =	'M1712'
or substr(dx,1,4) =	'M172'
or substr(dx,1,5) =	'M1730'
or substr(dx,1,5) =	'M1731'
or substr(dx,1,5) =	'M1732'
or substr(dx,1,4) =	'M174'
or substr(dx,1,4) =	'M175'
or substr(dx,1,4) =	'M179'
or substr(dx,1,4) =	'M180'
or substr(dx,1,5) =	'M1810'
or substr(dx,1,5) =	'M1811'
or substr(dx,1,5) =	'M1812'
or substr(dx,1,4) =	'M182'
or substr(dx,1,5) =	'M1830'
or substr(dx,1,5) =	'M1831'
or substr(dx,1,5) =	'M1832'
or substr(dx,1,4) =	'M184'
or substr(dx,1,5) =	'M1850'
or substr(dx,1,5) =	'M1851'
or substr(dx,1,5) =	'M1852'
or substr(dx,1,4) =	'M189'
or substr(dx,1,6) =	'M19011'
or substr(dx,1,6) =	'M19012'
or substr(dx,1,6) =	'M19019'
or substr(dx,1,6) =	'M19021'
or substr(dx,1,6) =	'M19022'
or substr(dx,1,6) =	'M19029'
or substr(dx,1,6) =	'M19031'
or substr(dx,1,6) =	'M19032'
or substr(dx,1,6) =	'M19039'
or substr(dx,1,6) =	'M19041'
or substr(dx,1,6) =	'M19042'
or substr(dx,1,6) =	'M19049'
or substr(dx,1,6) =	'M19071'
or substr(dx,1,6) =	'M19072'
or substr(dx,1,6) =	'M19079'
or substr(dx,1,6) =	'M19111'
or substr(dx,1,6) =	'M19112'
or substr(dx,1,6) =	'M19119'
or substr(dx,1,6) =	'M19121'
or substr(dx,1,6) =	'M19122'
or substr(dx,1,6) =	'M19129'
or substr(dx,1,6) =	'M19131'
or substr(dx,1,6) =	'M19132'
or substr(dx,1,6) =	'M19139'
or substr(dx,1,6) =	'M19141'
or substr(dx,1,6) =	'M19142'
or substr(dx,1,6) =	'M19149'
or substr(dx,1,6) =	'M19171'
or substr(dx,1,6) =	'M19172'
or substr(dx,1,6) =	'M19179'
or substr(dx,1,6) =	'M19211'
or substr(dx,1,6) =	'M19212'
or substr(dx,1,6) =	'M19219'
or substr(dx,1,6) =	'M19221'
or substr(dx,1,6) =	'M19222'
or substr(dx,1,6) =	'M19229'
or substr(dx,1,6) =	'M19231'
or substr(dx,1,6) =	'M19232'
or substr(dx,1,6) =	'M19239'
or substr(dx,1,6) =	'M19241'
or substr(dx,1,6) =	'M19242'
or substr(dx,1,6) =	'M19249'
or substr(dx,1,6) =	'M19271'
or substr(dx,1,6) =	'M19272'
or substr(dx,1,6) =	'M19279'
or substr(dx,1,5) =	'M1990'
or substr(dx,1,5) =	'M1991'
or substr(dx,1,5) =	'M1992'
or substr(dx,1,5) =	'M1993'
or substr(dx,1,4) =	'M450'
or substr(dx,1,4) =	'M451'
or substr(dx,1,4) =	'M452'
or substr(dx,1,4) =	'M453'
or substr(dx,1,4) =	'M454'
or substr(dx,1,4) =	'M455'
or substr(dx,1,4) =	'M456'
or substr(dx,1,4) =	'M457'
or substr(dx,1,4) =	'M458'
or substr(dx,1,4) =	'M459'
or substr(dx,1,6) =	'M47011'
or substr(dx,1,6) =	'M47012'
or substr(dx,1,6) =	'M47013'
or substr(dx,1,6) =	'M47014'
or substr(dx,1,6) =	'M47015'
or substr(dx,1,6) =	'M47016'
or substr(dx,1,6) =	'M47019'
or substr(dx,1,6) =	'M47021'
or substr(dx,1,6) =	'M47022'
or substr(dx,1,6) =	'M47029'
or substr(dx,1,5) =	'M4710'
or substr(dx,1,5) =	'M4711'
or substr(dx,1,5) =	'M4712'
or substr(dx,1,5) =	'M4713'
or substr(dx,1,5) =	'M4720'
or substr(dx,1,5) =	'M4721'
or substr(dx,1,5) =	'M4722'
or substr(dx,1,5) =	'M4723'
or substr(dx,1,5) =	'M4724'
or substr(dx,1,5) =	'M4725'
or substr(dx,1,5) =	'M4726'
or substr(dx,1,5) =	'M4727'
or substr(dx,1,5) =	'M4728'
or substr(dx,1,6) =	'M47811'
or substr(dx,1,6) =	'M47812'
or substr(dx,1,6) =	'M47813'
or substr(dx,1,6) =	'M47814'
or substr(dx,1,6) =	'M47815'
or substr(dx,1,6) =	'M47816'
or substr(dx,1,6) =	'M47817'
or substr(dx,1,6) =	'M47818'
or substr(dx,1,6) =	'M47819'
or substr(dx,1,6) =	'M47891'
or substr(dx,1,6) =	'M47892'
or substr(dx,1,6) =	'M47893'
or substr(dx,1,6) =	'M47894'
or substr(dx,1,6) =	'M47895'
or substr(dx,1,6) =	'M47896'
or substr(dx,1,6) =	'M47897'
or substr(dx,1,6) =	'M47898'
or substr(dx,1,6) =	'M47899'
or substr(dx,1,4) =	'M479'
or substr(dx,1,6) =	'M488X1'
or substr(dx,1,6) =	'M488X2'
or substr(dx,1,6) =	'M488X3'
or substr(dx,1,6) =	'M488X4'
or substr(dx,1,6) =	'M488X5'
or substr(dx,1,6) =	'M488X6'
or substr(dx,1,6) =	'M488X7'
or substr(dx,1,6) =	'M488X8'
or substr(dx,1,6) =	'M488X9')
		and ccw_21=0
                then ccw_21=1;
  * Stroke ;
	if (substr(dx,1,3) =	'430'
or substr(dx,1,3) =	'431'
or substr(dx,1,5) =	'43301'
or substr(dx,1,5) =	'43311'
or substr(dx,1,5) =	'43321'
or substr(dx,1,5) =	'43331'
or substr(dx,1,5) =	'43381'
or substr(dx,1,5) =	'43391'
or substr(dx,1,5) =	'43401'
or substr(dx,1,5) =	'43411'
or substr(dx,1,5) =	'43410'
or substr(dx,1,5) =	'43491'
or substr(dx,1,5) =	'43490'
or substr(dx,1,5) =	'43400'
or substr(dx,1,4) =	'4351'
or substr(dx,1,4) =	'4353'
or substr(dx,1,4) =	'4358'
or substr(dx,1,4) =	'4359'
or substr(dx,1,4) =	'4350'
or substr(dx,1,3) =	'436'
or substr(dx,1,5) =	'99702'
or substr(dx,1,4) =	'G450'
or substr(dx,1,4) =	'G451'
or substr(dx,1,4) =	'G452'
or substr(dx,1,4) =	'G458'
or substr(dx,1,4) =	'G459'
or substr(dx,1,4) =	'G460'
or substr(dx,1,4) =	'G461'
or substr(dx,1,4) =	'G462'
or substr(dx,1,4) =	'G463'
or substr(dx,1,4) =	'G464'
or substr(dx,1,4) =	'G465'
or substr(dx,1,4) =	'G466'
or substr(dx,1,4) =	'G467'
or substr(dx,1,4) =	'G468'
or substr(dx,1,5) =	'G9731'
or substr(dx,1,5) =	'G9732'
or substr(dx,1,5) =	'I6000'
or substr(dx,1,5) =	'I6001'
or substr(dx,1,5) =	'I6002'
or substr(dx,1,5) =	'I6010'
or substr(dx,1,5) =	'I6011'
or substr(dx,1,5) =	'I6012'
or substr(dx,1,5) =	'I6020'
or substr(dx,1,5) =	'I6021'
or substr(dx,1,5) =	'I6022'
or substr(dx,1,5) =	'I6030'
or substr(dx,1,5) =	'I6031'
or substr(dx,1,5) =	'I6032'
or substr(dx,1,4) =	'I604'
or substr(dx,1,5) =	'I6050'
or substr(dx,1,5) =	'I6051'
or substr(dx,1,5) =	'I6052'
or substr(dx,1,4) =	'I606'
or substr(dx,1,4) =	'I607'
or substr(dx,1,4) =	'I608'
or substr(dx,1,4) =	'I609'
or substr(dx,1,4) =	'I610'
or substr(dx,1,4) =	'I611'
or substr(dx,1,4) =	'I612'
or substr(dx,1,4) =	'I613'
or substr(dx,1,4) =	'I614'
or substr(dx,1,4) =	'I615'
or substr(dx,1,4) =	'I616'
or substr(dx,1,4) =	'I618'
or substr(dx,1,4) =	'I619'
or substr(dx,1,5) =	'I6300'
or substr(dx,1,6) =	'I63011'
or substr(dx,1,6) =	'I63012'
or substr(dx,1,6) =	'I63013'
or substr(dx,1,6) =	'I63019'
or substr(dx,1,5) =	'I6302'
or substr(dx,1,5) =	'I6302'
or substr(dx,1,6) =	'I63031'
or substr(dx,1,6) =	'I63032'
or substr(dx,1,6) =	'I63039'
or substr(dx,1,5) =	'I6309'
or substr(dx,1,5) =	'I6310'
or substr(dx,1,6) =	'I63111'
or substr(dx,1,6) =	'I63112'
or substr(dx,1,6) =	'I63119'
or substr(dx,1,5) =	'I6312'
or substr(dx,1,6) =	'I63131'
or substr(dx,1,6) =	'I63132'
or substr(dx,1,6) =	'I63139'
or substr(dx,1,5) =	'I6319'
or substr(dx,1,5) =	'I6320'
or substr(dx,1,6) =	'I63211'
or substr(dx,1,6) =	'I63212'
or substr(dx,1,6) =	'I63213'
or substr(dx,1,6) =	'I63219'
or substr(dx,1,5) =	'I6322'
or substr(dx,1,6) =	'I63231'
or substr(dx,1,6) =	'I63232'
or substr(dx,1,6) =	'I63233'
or substr(dx,1,6) =	'I63239'
or substr(dx,1,5) =	'I6329'
or substr(dx,1,5) =	'I6330'
or substr(dx,1,6) =	'I63311'
or substr(dx,1,6) =	'I63312'
or substr(dx,1,6) =	'I63313'
or substr(dx,1,6) =	'I63319'
or substr(dx,1,6) =	'I63321'
or substr(dx,1,6) =	'I63322'
or substr(dx,1,6) =	'I63323'
or substr(dx,1,6) =	'I63329'
or substr(dx,1,6) =	'I63331'
or substr(dx,1,6) =	'I63332'
or substr(dx,1,6) =	'I63333'
or substr(dx,1,6) =	'I63339'
or substr(dx,1,6) =	'I63341'
or substr(dx,1,6) =	'I63342'
or substr(dx,1,6) =	'I63343'
or substr(dx,1,6) =	'I63349'
or substr(dx,1,5) =	'I6339'
or substr(dx,1,5) =	'I6340'
or substr(dx,1,6) =	'I63411'
or substr(dx,1,6) =	'I63412'
or substr(dx,1,6) =	'I63413'
or substr(dx,1,6) =	'I63419'
or substr(dx,1,6) =	'I63421'
or substr(dx,1,6) =	'I63422'
or substr(dx,1,6) =	'I63423'
or substr(dx,1,6) =	'I63429'
or substr(dx,1,6) =	'I63431'
or substr(dx,1,6) =	'I63432'
or substr(dx,1,6) =	'I63433'
or substr(dx,1,6) =	'I63439'
or substr(dx,1,6) =	'I63441'
or substr(dx,1,6) =	'I63442'
or substr(dx,1,6) =	'I63443'
or substr(dx,1,6) =	'I63449'
or substr(dx,1,5) =	'I6349'
or substr(dx,1,5) =	'I6350'
or substr(dx,1,6) =	'I63511'
or substr(dx,1,6) =	'I63512'
or substr(dx,1,6) =	'I63513'
or substr(dx,1,6) =	'I63519'
or substr(dx,1,6) =	'I63521'
or substr(dx,1,6) =	'I63522'
or substr(dx,1,6) =	'I63523'
or substr(dx,1,6) =	'I63529'
or substr(dx,1,6) =	'I63531'
or substr(dx,1,6) =	'I63532'
or substr(dx,1,6) =	'I63533'
or substr(dx,1,6) =	'I63539'
or substr(dx,1,6) =	'I63541'
or substr(dx,1,6) =	'I63542'
or substr(dx,1,6) =	'I63543'
or substr(dx,1,6) =	'I63549'
or substr(dx,1,5) =	'I6359'
or substr(dx,1,4) =	'I636'
or substr(dx,1,4) =	'I638'
or substr(dx,1,4) =	'I639'
or substr(dx,1,5) =	'I6601'
or substr(dx,1,5) =	'I6602'
or substr(dx,1,5) =	'I6603'
or substr(dx,1,5) =	'I6609'
or substr(dx,1,5) =	'I6611'
or substr(dx,1,5) =	'I6612'
or substr(dx,1,5) =	'I6613'
or substr(dx,1,5) =	'I6619'
or substr(dx,1,5) =	'I6621'
or substr(dx,1,5) =	'I6622'
or substr(dx,1,5) =	'I6623'
or substr(dx,1,5) =	'I6629'
or substr(dx,1,4) =	'I663'
or substr(dx,1,4) =	'I668'
or substr(dx,1,4) =	'I669'
or substr(dx,1,6) =	'I67841'
or substr(dx,1,6) =	'I67848'
or substr(dx,1,5) =	'I6789'
or substr(dx,1,6) =	'I97810'
or substr(dx,1,6) =	'I97811'
or substr(dx,1,6) =	'I97820'
or substr(dx,1,6) =	'I97821')
		and ccw_22=0
                then ccw_22=1;
  * Colorectal Cancer ;
	if (substr(dx,1,4) =	'1531'
or substr(dx,1,4) =	'1532'
or substr(dx,1,4) =	'1533'
or substr(dx,1,4) =	'1534'
or substr(dx,1,4) =	'1535'
or substr(dx,1,4) =	'1536'
or substr(dx,1,4) =	'1537'
or substr(dx,1,4) =	'1538'
or substr(dx,1,4) =	'1539'
or substr(dx,1,4) = '1540'
or substr(dx,1,4) = '1541'
or substr(dx,1,4) =	'1530'
or substr(dx,1,4) =	'2303'
or substr(dx,1,4) =	'2304'
or substr(dx,1,5) =	'V1005'
or substr(dx,1,5) =	'V1006'
or substr(dx,1,4) =	'C180'
or substr(dx,1,4) =	'C181'
or substr(dx,1,4) =	'C182'
or substr(dx,1,4) =	'C183'
or substr(dx,1,4) =	'C184'
or substr(dx,1,4) =	'C185'
or substr(dx,1,4) =	'C186'
or substr(dx,1,4) =	'C187'
or substr(dx,1,4) =	'C188'
or substr(dx,1,4) =	'C189'
or substr(dx,1,3) =	'C19'
or substr(dx,1,3) =	'C20'
or substr(dx,1,4) =	'D010'
or substr(dx,1,4) =	'D011'
or substr(dx,1,4) =	'D012'
or substr(dx,1,6) =	'Z85038'
or substr(dx,1,6) =	'Z85040'
or substr(dx,1,6) =	'Z85048')
		and ccw_23=0
                then ccw_23=1;
  * Endometrial Cancer ;
	if (substr(dx,1,4) =	'1820'
or substr(dx,1,4) =	'2332'
or substr(dx,1,5) =	'V1042'
or substr(dx,1,4) =	'C541'
or substr(dx,1,4) =	'C542'
or substr(dx,1,4) =	'C543'
or substr(dx,1,4) =	'C548'
or substr(dx,1,4) =	'C549'
or substr(dx,1,4) =	'D070'
or substr(dx,1,5) =	'Z8542')
		and ccw_24=0
                then ccw_24=1;
  * Breast Cancer ;
if (substr(dx,1,4) = '1741'
or substr(dx,1,4) =	'1742'
or substr(dx,1,4) =	'1743'
or substr(dx,1,4) =	'1744'
or substr(dx,1,4) =	'1745'
or substr(dx,1,4) =	'1746'
or substr(dx,1,4) =	'1748'
or substr(dx,1,4) =	'1749'
or substr(dx,1,4) =	'1740'
or substr(dx,1,4) =	'1759'
or substr(dx,1,4) =	'1750'
or substr(dx,1,4) =	'2330'
or substr(dx,1,4) =	'V103'
or substr(dx,1,6) =	'C50011'
or substr(dx,1,6) =	'C50012'
or substr(dx,1,6) =	'C50019'
or substr(dx,1,6) =	'C50021'
or substr(dx,1,6) =	'C50022'
or substr(dx,1,6) =	'C50029'
or substr(dx,1,6) =	'C50111'
or substr(dx,1,6) =	'C50112'
or substr(dx,1,6) =	'C50119'
or substr(dx,1,6) =	'C50121'
or substr(dx,1,6) =	'C50122'
or substr(dx,1,6) =	'C50129'
or substr(dx,1,6) =	'C50211'
or substr(dx,1,6) =	'C50212'
or substr(dx,1,6) =	'C50219'
or substr(dx,1,6) =	'C50221'
or substr(dx,1,6) =	'C50222'
or substr(dx,1,6) =	'C50229'
or substr(dx,1,6) =	'C50311'
or substr(dx,1,6) =	'C50312'
or substr(dx,1,6) =	'C50319'
or substr(dx,1,6) =	'C50321'
or substr(dx,1,6) =	'C50322'
or substr(dx,1,6) =	'C50329'
or substr(dx,1,6) =	'C50411'
or substr(dx,1,6) =	'C50412'
or substr(dx,1,6) =	'C50419'
or substr(dx,1,6) =	'C50421'
or substr(dx,1,6) =	'C50422'
or substr(dx,1,6) =	'C50429'
or substr(dx,1,6) =	'C50511'
or substr(dx,1,6) =	'C50512'
or substr(dx,1,6) =	'C50519'
or substr(dx,1,6) =	'C50521'
or substr(dx,1,6) =	'C50522'
or substr(dx,1,6) =	'C50529'
or substr(dx,1,6) =	'C50611'
or substr(dx,1,6) =	'C50612'
or substr(dx,1,6) =	'C50619'
or substr(dx,1,6) =	'C50621'
or substr(dx,1,6) =	'C50622'
or substr(dx,1,6) =	'C50629'
or substr(dx,1,6) =	'C50811'
or substr(dx,1,6) =	'C50812'
or substr(dx,1,6) =	'C50819'
or substr(dx,1,6) =	'C50821'
or substr(dx,1,6) =	'C50822'
or substr(dx,1,6) =	'C50829'
or substr(dx,1,6) =	'C50911'
or substr(dx,1,6) =	'C50912'
or substr(dx,1,6) =	'C50919'
or substr(dx,1,6) =	'C50921'
or substr(dx,1,6) =	'C50922'
or substr(dx,1,6) =	'C50929'
or substr(dx,1,5) =	'D0500'
or substr(dx,1,5) =	'D0501'
or substr(dx,1,5) =	'D0502'
or substr(dx,1,5) =	'D0510'
or substr(dx,1,5) =	'D0511'
or substr(dx,1,5) =	'D0512'
or substr(dx,1,5) =	'D0580'
or substr(dx,1,5) =	'D0581'
or substr(dx,1,5) =	'D0582'
or substr(dx,1,5) =	'D0590'
or substr(dx,1,5) =	'D0591'
or substr(dx,1,5) =	'D0592'
or substr(dx,1,4) =	'Z853' )
		and ccw_25=0
                then ccw_25=1;
  * Lung Cancer ;
	if (substr(dx,1,4) =	'1622'
or substr(dx,1,4) =	'1623'
or substr(dx,1,4) =	'1624'
or substr(dx,1,4) =	'1625'
or substr(dx,1,4) =	'1628'
or substr(dx,1,4) =	'1629'
or substr(dx,1,4) =	'2312'
or substr(dx,1,5) =	'V1011'
or substr(dx,1,5) =	'C3400'
or substr(dx,1,5) =	'C3401'
or substr(dx,1,5) =	'C3402'
or substr(dx,1,5) =	'C3410'
or substr(dx,1,5) =	'C3411'
or substr(dx,1,5) =	'C3412'
or substr(dx,1,4) =	'C342'
or substr(dx,1,5) =	'C3430'
or substr(dx,1,5) =	'C3431'
or substr(dx,1,5) =	'C3432'
or substr(dx,1,5) =	'C3480'
or substr(dx,1,5) =	'C3481'
or substr(dx,1,5) =	'C3482'
or substr(dx,1,5) =	'C3490'
or substr(dx,1,5) =	'C3491'
or substr(dx,1,5) =	'C3492'
or substr(dx,1,5) =	'D0220'
or substr(dx,1,5) =	'D0221'
or substr(dx,1,5) =	'D0222'
or substr(dx,1,6) =	'Z85110'
or substr(dx,1,6) =	'Z85118')
		and ccw_26=0
                then ccw_26=1;
  * Prostate Cancer ;
	if (substr(dx,1,3) =	'185'
or substr(dx,1,4) =	'2334'
or substr(dx,1,5) =	'V1046'
or substr(dx,1,3) =	'C61'
or substr(dx,1,4) =	'D075'
or substr(dx,1,5) =	'Z8546')
		and ccw_27=0
                then ccw_27=1;
end;

run;

/*get count of each comorbidity for each id-core year combination*/
proc sql;
create table cnt_test1 as
select distinct bene_id,index_year,
sum(ccw_1) as cnt_1,
sum(ccw_2) as cnt_2,
sum(ccw_3) as cnt_3,
sum(ccw_4) as cnt_4,
sum(ccw_5) as cnt_5,
sum(ccw_6) as cnt_6,
sum(ccw_7) as cnt_7,
sum(ccw_8) as cnt_8,
sum(ccw_9) as cnt_9,
sum(ccw_10) as cnt_10,
sum(ccw_11) as cnt_11,
sum(ccw_12) as cnt_12,
sum(ccw_13) as cnt_13,
sum(ccw_14) as cnt_14,
sum(ccw_15) as cnt_15,
sum(ccw_16) as cnt_16,
sum(ccw_17) as cnt_17,
sum(ccw_18) as cnt_18,
sum(ccw_19) as cnt_19,
sum(ccw_20) as cnt_20,
sum(ccw_21) as cnt_21,
sum(ccw_22) as cnt_22,
sum(ccw_23) as cnt_23,
sum(ccw_24) as cnt_24,
sum(ccw_25) as cnt_25,
sum(ccw_26) as cnt_26,
sum(ccw_27) as cnt_27
from dx_ccw
group by bene_id,index_year;
quit;

/*convert counts of diagnoses for each comorbidity to indicator variables*/ 
data ccw_1(keep=bene_id index_year ccw_1-ccw_27 ccw_index);
set cnt_test1;
array list_cha cnt_1-cnt_27;
array list_cnt_bin ccw_1-ccw_27 ;

do over list_cha;
  list_cnt_bin=0;

  if list_cha>0 then do;
    list_cnt_bin=1;
   end;

end;
/*note this ccw_index count count is not weighted for morbidity*/
ccw_index=ccw_1+ccw_2+ccw_3+ccw_4+ccw_5+ccw_6+ccw_7+ccw_8+ccw_9+ccw_10
+ccw_11+ccw_12+ccw_13+ccw_14+ccw_15+ccw_16+ccw_17+ccw_18+ccw_19+ccw_20
+ccw_21+ccw_22+ccw_23+ccw_24+ccw_25+ccw_26+ccw_27;

label ccw_1 ='Acquired Hypothyroidism, CCW';
label ccw_2 ='AMI, CCW';
label ccw_3 ="Alzheimer's";
label ccw_4 ="Alzheimer's & Related/Dementia";
label ccw_5 ='Anemia';
label ccw_6 ='Asthma';
label ccw_7 ='Atrial Fibrillation';
label ccw_8 ='Benign Prostatic Hyperplasia';
label ccw_9 ='Cataract';
label ccw_10 ='CKD';
label ccw_11 ='COPD/Bronchiectasis';
label ccw_12 ='Depression';
label ccw_13 ='Diabetes';
label ccw_14 ='Glaucoma';
label ccw_15 ='Heart Failure';
label ccw_16 ='Hip/Pelvic Fracture';
label ccw_17 ='Hyperlipidemia';
label ccw_18 ='Hypertension';
label ccw_19 ='Ischemic Heart Disease';
label ccw_20 ='Osteoporosis';
label ccw_21 ='RA/OA';
label ccw_22 ='Stroke/Transient Ischemic Attack';
label ccw_23 ='Colorectal Cancer';
label ccw_24 ='Endometrial Cancer';
label ccw_25 ='Breast Cancer';
label ccw_26 ='Lung Cancer';
label ccw_27 ='Prostate Cancer';
label ccw_index ='Count of CCs (out of 27)';

run;

/*merge into list of obs with ffs mc 6m prior to ivw*/
proc sort data=ccw_1 out=test nodupkey;
by bene_id index_year;
run;



%rename(WORK,TEST,&range1._&range2);

data proj_int.ccw_&range1._&range2.(rename =(bene_id_&range1._&range2=bene_id
index_year_&range1._&range2=index_year));
set test;
keep bene_id_&range1._&range2 ccw: index_year:;
run;
proc sort data=proj_int.ccw_&range1._&range2.;
by bene_id index_year;
run;

%mend;

%ccw(range1=0, range2=6m);
%ccw(range1=0, range2=1yr);
%ccw(range1=0, range2=2yr);

proc freq data=proj_int.ccw_0_1yr;
table ccw:;
run;

proc freq data=proj_int.ccw_0_6m;
table ccw:;
run;



H="additional comorbidities"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************
*/

data dxa;
set proj_int.dx_0_6m(rename=(diag=dx_0));
dx=trim(left(dx_0));

neurodeg1=0;
cva1=0;
park1=0;
if substr(dx,1,4)='3330' 
or substr(dx,1,4)='3334' 
then neurodeg1=1;

if substr(dx,1,4)='3320'
then park1=1;

if substr(dx,1,3)='430'
or substr(dx,1,3)='431'
or substr(dx,1,5)='43411' 
or substr(dx,1,5)='43491'
or substr(dx,1,3)='436'
or substr(dx,1,5)='99702'
then cva1=1;
run;

proc sql;
create table addl as select distinct bene_id, index_year,
sum(neurodeg1) as neurodeg_count,
sum(cva1) as cva_count,
sum(park1) as park_count 
from dxa group by bene_id, index_year;
quit;

data proj_int.addl_comorb;
set addl;
neurodeg=neurodeg_count>=1;
*cva=cva_count>=1;
park=park_count>=1;
run;

H="SMIS from ICD-10"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************
*/



/*use ICD10 list to get SMIs that don't need more than dx*/

data icd10a;
set proj_int.dx_0_6m (rename=(diag=dx_0));

/*initialize variables*/
cancer_icd10=0;
esrd_icd10=0;
copd_icd10=0;
diabetes_icd10=0;
hiv_icd10=0;
liver_icd10=0;
als_icd10=0;
renal_icd10=0;
pvd_icd10=0;
dementia_icd10=0;
cad_icd10=0;
dementia_icd10=0;
chf_icd10=0;
cva_icd10=0;
hip_icd10=0;

diag=trim(left(dx_0));

if diag~='' then do;

/*cancer*/
if (substr(diag,1,3)='C33'
or substr(diag,1,4)='C154'
or substr(diag,1,4)='C155'
or substr(diag,1,4)='C158'
or substr(diag,1,4)='C159'
or substr(diag,1,4)='C160'
or substr(diag,1,4)='C161'
or substr(diag,1,4)='C162'
or substr(diag,1,4)='C163'
or substr(diag,1,4)='C164'
or substr(diag,1,4)='C165'
or substr(diag,1,4)='C166'
or substr(diag,1,4)='C168'
or substr(diag,1,4)='C169'
or substr(diag,1,4)='C220'
or substr(diag,1,4)='C221'
or substr(diag,1,4)='C222'
or substr(diag,1,4)='C223'
or substr(diag,1,4)='C224'
or substr(diag,1,4)='C227'
or substr(diag,1,4)='C228'
or substr(diag,1,4)='C229'
or substr(diag,1,4)='C250'
or substr(diag,1,4)='C251'
or substr(diag,1,4)='C252'
or substr(diag,1,4)='C253'
or substr(diag,1,4)='C254'
or substr(diag,1,4)='C257'
or substr(diag,1,4)='C258'
or substr(diag,1,4)='C259'
or substr(diag,1,4)='C384'
or substr(diag,1,4)='C450'
or substr(diag,1,4)='C480'
or substr(diag,1,4)='C481'
or substr(diag,1,4)='C482'
or substr(diag,1,4)='C488'
or substr(diag,1,4)='C561'
or substr(diag,1,4)='C562'
or substr(diag,1,4)='C569'
or substr(diag,1,4)='C573'
or substr(diag,1,4)='C574'
or substr(diag,1,4)='C710'
or substr(diag,1,4)='C712'
or substr(diag,1,4)='C713'
or substr(diag,1,4)='C714'
or substr(diag,1,4)='C717'
or substr(diag,1,4)='C718'
or substr(diag,1,4)='C719'
or substr(diag,1,4)='C770'
or substr(diag,1,4)='C771'
or substr(diag,1,4)='C772'
or substr(diag,1,4)='C773'
or substr(diag,1,4)='C774'
or substr(diag,1,4)='C775'
or substr(diag,1,4)='C778'
or substr(diag,1,4)='C779'
or substr(diag,1,4)='C781'
or substr(diag,1,4)='C782'
or substr(diag,1,4)='C784'
or substr(diag,1,4)='C785'
or substr(diag,1,4)='C786'
or substr(diag,1,4)='C787'
or substr(diag,1,4)='C792'
or substr(diag,1,4)='C800'
or substr(diag,1,4)='C751'
or substr(diag,1,5)='C5700'
or substr(diag,1,5)='C5701'
or substr(diag,1,5)='C5702'
or substr(diag,1,5)='C5710'
or substr(diag,1,5)='C7800'
or substr(diag,1,5)='C7830'
or substr(diag,1,5)='C7839'
or substr(diag,1,5)='C7880'
or substr(diag,1,5)='C7889'
or substr(diag,1,5)='C7900'
or substr(diag,1,5)='C7901'
or substr(diag,1,5)='C7902'
or substr(diag,1,5)='C7931'
or substr(diag,1,5)='C7932'
or substr(diag,1,5)='C7949'
or substr(diag,1,5)='C7951'
or substr(diag,1,5)='C7952'
or substr(diag,1,5)='C7960'
or substr(diag,1,5)='C7961'
or substr(diag,1,5)='C7962'
or substr(diag,1,5)='C7970'
or substr(diag,1,5)='C7981'
or substr(diag,1,5)='C7982'
or substr(diag,1,5)='C7989'
or substr(diag,1,5)='C9100'
or substr(diag,1,5)='C9101'
or substr(diag,1,5)='C9102'
or substr(diag,1,5)='C9110'
or substr(diag,1,5)='C9111'
or substr(diag,1,5)='C9112'
or substr(diag,1,5)='C9190'
or substr(diag,1,5)='C9191'
or substr(diag,1,5)='C9192'
or substr(diag,1,5)='C91Z0'
or substr(diag,1,5)='C91Z1'
or substr(diag,1,5)='C91Z2'
or substr(diag,1,5)='C9200'
or substr(diag,1,5)='C9201'
or substr(diag,1,5)='C9202'
or substr(diag,1,5)='C9210'
or substr(diag,1,5)='C9211'
or substr(diag,1,5)='C9212'
or substr(diag,1,5)='C9220'
or substr(diag,1,5)='C9221'
or substr(diag,1,5)='C9222'
or substr(diag,1,5)='C9230'
or substr(diag,1,5)='C9231'
or substr(diag,1,5)='C9232'
or substr(diag,1,5)='C9240'
or substr(diag,1,5)='C9241'
or substr(diag,1,5)='C9242'
or substr(diag,1,5)='C9250'
or substr(diag,1,5)='C9251'
or substr(diag,1,5)='C9252'
or substr(diag,1,5)='C9262'
or substr(diag,1,5)='C9290'
or substr(diag,1,5)='C9291'
or substr(diag,1,5)='C9292'
or substr(diag,1,5)='C92A2'
or substr(diag,1,5)='C92Z0'
or substr(diag,1,5)='C92Z1'
or substr(diag,1,5)='C92Z2'
or substr(diag,1,5)='C9300'
or substr(diag,1,5)='C9301'
or substr(diag,1,5)='C9302'
or substr(diag,1,5)='C9310'
or substr(diag,1,5)='C9311'
or substr(diag,1,5)='C9312'
or substr(diag,1,5)='C9332'
or substr(diag,1,5)='C9391'
or substr(diag,1,5)='C9392'
or substr(diag,1,5)='C93Z0'
or substr(diag,1,5)='C93Z1'
or substr(diag,1,5)='C93Z2'
or substr(diag,1,5)='C9400'
or substr(diag,1,5)='C9401'
or substr(diag,1,5)='C9402'
or substr(diag,1,5)='C9420'
or substr(diag,1,5)='C9421'
or substr(diag,1,5)='C9422'
or substr(diag,1,5)='C9430'
or substr(diag,1,5)='C9431'
or substr(diag,1,5)='C9432'
or substr(diag,1,5)='C9480'
or substr(diag,1,5)='C9481'
or substr(diag,1,5)='C9482'
or substr(diag,1,5)='C9500'
or substr(diag,1,5)='C9501'
or substr(diag,1,5)='C9502'
or substr(diag,1,5)='C9510'
or substr(diag,1,5)='C9511'
or substr(diag,1,5)='C9512'
or substr(diag,1,5)='C9590'
or substr(diag,1,5)='C9592'
or substr(diag,1,6)='C79011'
or substr(diag,1,6)='C79019'
or substr(diag,1,6)='C93910'
or substr(diag,1,4)='C153')
and cancer_icd10=0 then
cancer_icd10=1;

/*ESRD*/
if (substr(diag,1,4)='I120'
or substr(diag,1,5)='I1311'
or substr(diag,1,4)='N185'
or substr(diag,1,4)='N186'
or substr(diag,1,3)='N19'
or substr(diag,1,5)='Z4931'
or substr(diag,1,5)='Z4932'
or substr(diag,1,5)='Z9115'
or substr(diag,1,4)='Z992')
adn esrd_icd10=0 then 
esrd_icd10=1;

/*COPD*/
if (substr(diag,1,3)='J42'
or substr(diag,1,3)='J60'
or substr(diag,1,3)='J61'
or substr(diag,1,3)='J64'
or substr(diag,1,3)='J65'
or substr(diag,1,4)='J411'
or substr(diag,1,4)='J418'
or substr(diag,1,4)='J430'
or substr(diag,1,4)='J431'
or substr(diag,1,4)='J432'
or substr(diag,1,4)='J438'
or substr(diag,1,4)='J439'
or substr(diag,1,4)='J440'
or substr(diag,1,4)='J441'
or substr(diag,1,4)='J449'
or substr(diag,1,4)='J470'
or substr(diag,1,4)='J471'
or substr(diag,1,4)='J479'
or substr(diag,1,4)='J620'
or substr(diag,1,4)='J628'
or substr(diag,1,4)='J630'
or substr(diag,1,4)='J631'
or substr(diag,1,4)='J632'
or substr(diag,1,4)='J633'
or substr(diag,1,4)='J634'
or substr(diag,1,4)='J635'
or substr(diag,1,4)='J636'
or substr(diag,1,4)='J660'
or substr(diag,1,4)='J661'
or substr(diag,1,4)='J662'
or substr(diag,1,4)='J668'
or substr(diag,1,4)='J670'
or substr(diag,1,4)='J671'
or substr(diag,1,4)='J672'
or substr(diag,1,4)='J673'
or substr(diag,1,4)='J674'
or substr(diag,1,4)='J675'
or substr(diag,1,4)='J676'
or substr(diag,1,4)='J677'
or substr(diag,1,4)='J678'
or substr(diag,1,4)='J679'
or substr(diag,1,4)='J684'
or substr(diag,1,4)='J982'
or substr(diag,1,4)='J983'
or substr(diag,1,5)='J8410'
or substr(diag,1,5)='J8417'
or substr(diag,1,5)='J9600'
or substr(diag,1,5)='J9601'
or substr(diag,1,5)='J9602'
or substr(diag,1,5)='J9610'
or substr(diag,1,5)='J9611'
or substr(diag,1,5)='J9612'
or substr(diag,1,5)='J9620'
or substr(diag,1,5)='J9621'
or substr(diag,1,5)='J9622'
or substr(diag,1,5)='J9690'
or substr(diag,1,5)='J9691'
or substr(diag,1,5)='J9692'
or substr(diag,1,6)='J84112')
	and copd_icd10=0 then
	copd_icd10=1;

/*Diabetes*/
if (substr(diag,1,4)='E102'
or substr(diag,1,4)='E103'
or substr(diag,1,4)='E104'
or substr(diag,1,4)='E105'
or substr(diag,1,4)='E107'
or substr(diag,1,4)='E108'
or substr(diag,1,4)='E112'
or substr(diag,1,4)='E113'
or substr(diag,1,4)='E114'
or substr(diag,1,4)='E115'
or substr(diag,1,4)='E117'
or substr(diag,1,4)='E118'
or substr(diag,1,4)='E122'
or substr(diag,1,4)='E123'
or substr(diag,1,4)='E124'
or substr(diag,1,4)='E125'
or substr(diag,1,4)='E127'
or substr(diag,1,4)='E132'
or substr(diag,1,4)='E133'
or substr(diag,1,4)='E134'
or substr(diag,1,4)='E135'
or substr(diag,1,4)='E137'
or substr(diag,1,4)='E138'
or substr(diag,1,4)='E142'
or substr(diag,1,4)='E143'
or substr(diag,1,4)='E144'
or substr(diag,1,4)='E145'
or substr(diag,1,4)='E147'
or substr(diag,1,5)='E1037'
or substr(diag,1,5)='E1021'
or substr(diag,1,5)='E1022'
or substr(diag,1,5)='E1029'
or substr(diag,1,5)='E1036'
or substr(diag,1,5)='E1039'
or substr(diag,1,5)='E1040'
or substr(diag,1,5)='E1043'
or substr(diag,1,5)='E1044'
or substr(diag,1,5)='E1049'
or substr(diag,1,5)='E1051'
or substr(diag,1,5)='E1052'
or substr(diag,1,5)='E1059'
or substr(diag,1,5)='E1065'
or substr(diag,1,5)='E1121'
or substr(diag,1,5)='E1122'
or substr(diag,1,5)='E1129'
or substr(diag,1,5)='E1136'
or substr(diag,1,5)='E1139'
or substr(diag,1,5)='E1140'
or substr(diag,1,5)='E1141'
or substr(diag,1,5)='E1142'
or substr(diag,1,5)='E1143'
or substr(diag,1,5)='E1144'
or substr(diag,1,5)='E1149'
or substr(diag,1,5)='E1151'
or substr(diag,1,5)='E1152'
or substr(diag,1,5)='E1159'
or substr(diag,1,5)='E1165'
or substr(diag,1,5)='E1321'
or substr(diag,1,5)='E1322'
or substr(diag,1,5)='E1329'
or substr(diag,1,5)='E1336'
or substr(diag,1,5)='E1339'
or substr(diag,1,5)='E1340'
or substr(diag,1,5)='E1341'
or substr(diag,1,5)='E1342'
or substr(diag,1,5)='E1344'
or substr(diag,1,5)='E1349'
or substr(diag,1,5)='E1351'
or substr(diag,1,5)='E1352'
or substr(diag,1,5)='E1359'
or substr(diag,1,6)='E10311'
or substr(diag,1,6)='E10319'
or substr(diag,1,6)='E10321'
or substr(diag,1,6)='E10331'
or substr(diag,1,6)='E10341'
or substr(diag,1,6)='E10351'
or substr(diag,1,6)='E10610'
or substr(diag,1,6)='E11311'
or substr(diag,1,6)='E11319'
or substr(diag,1,6)='E11321'
or substr(diag,1,6)='E11331'
or substr(diag,1,6)='E11341'
or substr(diag,1,6)='E11351'
or substr(diag,1,6)='E11610'
or substr(diag,1,6)='E13321'
or substr(diag,1,6)='E13329'
or substr(diag,1,6)='E13331'
or substr(diag,1,6)='E13339'
or substr(diag,1,6)='E13341'
or substr(diag,1,6)='E13349'
or substr(diag,1,6)='E13351'
or substr(diag,1,6)='E13359'
or substr(diag,1,6)='E13610'
or substr(diag,1,7)='E103211'
or substr(diag,1,7)='E103212'
or substr(diag,1,7)='E103213'
or substr(diag,1,7)='E103219'
or substr(diag,1,7)='E103291'
or substr(diag,1,7)='E103292'
or substr(diag,1,7)='E103293'
or substr(diag,1,7)='E103299'
or substr(diag,1,7)='E103311'
or substr(diag,1,7)='E103312'
or substr(diag,1,7)='E103313'
or substr(diag,1,7)='E103319'
or substr(diag,1,7)='E103391'
or substr(diag,1,7)='E103392'
or substr(diag,1,7)='E103393'
or substr(diag,1,7)='E103399'
or substr(diag,1,7)='E103411'
or substr(diag,1,7)='E103412'
or substr(diag,1,7)='E103413'
or substr(diag,1,7)='E103419'
or substr(diag,1,7)='E103491'
or substr(diag,1,7)='E103492'
or substr(diag,1,7)='E103493'
or substr(diag,1,7)='E103499'
or substr(diag,1,7)='E103511'
or substr(diag,1,7)='E103512'
or substr(diag,1,7)='E103513'
or substr(diag,1,7)='E103519'
or substr(diag,1,7)='E103521'
or substr(diag,1,7)='E103522'
or substr(diag,1,7)='E103523'
or substr(diag,1,7)='E103529'
or substr(diag,1,7)='E103531'
or substr(diag,1,7)='E103532'
or substr(diag,1,7)='E103533'
or substr(diag,1,7)='E103539'
or substr(diag,1,7)='E103541'
or substr(diag,1,7)='E103542'
or substr(diag,1,7)='E103543'
or substr(diag,1,7)='E103549'
or substr(diag,1,7)='E103551'
or substr(diag,1,7)='E103552'
or substr(diag,1,7)='E103553'
or substr(diag,1,7)='E103559'
or substr(diag,1,7)='E103591'
or substr(diag,1,7)='E103592'
or substr(diag,1,7)='E103593'
or substr(diag,1,7)='E103599'
or substr(diag,1,7)='E1037X1'
or substr(diag,1,7)='E1037X2'
or substr(diag,1,7)='E1037X3'
or substr(diag,1,7)='E1037X9'
or substr(diag,1,7)='E113211'
or substr(diag,1,7)='E113212'
or substr(diag,1,7)='E113213'
or substr(diag,1,7)='E113219'
or substr(diag,1,7)='E113291'
or substr(diag,1,7)='E113292'
or substr(diag,1,7)='E113293'
or substr(diag,1,7)='E113299'
or substr(diag,1,7)='E113311'
or substr(diag,1,7)='E113312'
or substr(diag,1,7)='E113313'
or substr(diag,1,7)='E113319'
or substr(diag,1,7)='E113391'
or substr(diag,1,7)='E113392'
or substr(diag,1,7)='E113393'
or substr(diag,1,7)='E113399'
or substr(diag,1,7)='E113411'
or substr(diag,1,7)='E113412'
or substr(diag,1,7)='E113413'
or substr(diag,1,7)='E113419'
or substr(diag,1,7)='E113491'
or substr(diag,1,7)='E113492'
or substr(diag,1,7)='E113493'
or substr(diag,1,7)='E113499'
or substr(diag,1,7)='E113511'
or substr(diag,1,7)='E113512'
or substr(diag,1,7)='E113513'
or substr(diag,1,7)='E113519'
or substr(diag,1,7)='E113521'
or substr(diag,1,7)='E113522'
or substr(diag,1,7)='E113523'
or substr(diag,1,7)='E113529'
or substr(diag,1,7)='E113531'
or substr(diag,1,7)='E113532'
or substr(diag,1,7)='E113533'
or substr(diag,1,7)='E113539'
or substr(diag,1,7)='E113541'
or substr(diag,1,7)='E113542'
or substr(diag,1,7)='E113543'
or substr(diag,1,7)='E113549'
or substr(diag,1,7)='E113551'
or substr(diag,1,7)='E113552'
or substr(diag,1,7)='E113553'
or substr(diag,1,7)='E113559'
or substr(diag,1,7)='E113591'
or substr(diag,1,7)='E113592'
or substr(diag,1,7)='E113593'
or substr(diag,1,7)='E113599'
or substr(diag,1,7)='E1137X1'
or substr(diag,1,7)='E1137X2'
or substr(diag,1,7)='E1137X3'
or substr(diag,1,7)='E1137X9')
and diabetes_icd10=0 then
diabetes_icd10=1;

/*HIV*/

if (substr(diag,1,4)='B200'
or substr(diag,1,4)='B201'
or substr(diag,1,4)='B202'
or substr(diag,1,4)='B203'
or substr(diag,1,4)='B204'
or substr(diag,1,4)='B205'
or substr(diag,1,4)='B206'
or substr(diag,1,4)='B207'
or substr(diag,1,4)='B208'
or substr(diag,1,4)='B209'
or substr(diag,1,4)='B210'
or substr(diag,1,4)='B211'
or substr(diag,1,4)='B212'
or substr(diag,1,4)='B213'
or substr(diag,1,4)='B217'
or substr(diag,1,4)='B218'
or substr(diag,1,4)='B219'
or substr(diag,1,4)='B220'
or substr(diag,1,4)='B221'
or substr(diag,1,4)='B222'
or substr(diag,1,4)='B227')
and hiv_icd10=0 then
hiv_icd10=1;

/*Advanced liver disease*/
if (substr(diag,1,5)='I8500'
or substr(diag,1,5)='I8501'
or substr(diag,1,5)='I8510'
or substr(diag,1,5)='I8511'
or substr(diag,1,4)='K702'
or substr(diag,1,5)='K7030'
or substr(diag,1,5)='K7031'
or substr(diag,1,5)='K7040'
or substr(diag,1,5)='K7041'
or substr(diag,1,5)='K7210'
or substr(diag,1,5)='K7290'
or substr(diag,1,4)='K740'
or substr(diag,1,4)='K741'
or substr(diag,1,4)='K742'
or substr(diag,1,4)='K743'
or substr(diag,1,4)='K744'
or substr(diag,1,4)='K745'
or substr(diag,1,5)='K7460'
or substr(diag,1,5)='K7469'
or substr(diag,1,4)='K766'
or substr(diag,1,4)='K767')
and liver_icd10=0 then
liver_icd10=1;

/*ALS or other neurodegenerative disease*/
if (substr(diag,1,3)='G10'
or substr(diag,1,4)='G132'
or substr(diag,1,4)='G138'
or substr(diag,1,4)='G230'
or substr(diag,1,4)='G231'
or substr(diag,1,4)='G232'
or substr(diag,1,4)='G238'
or substr(diag,1,4)='G239'
or substr(diag,1,4)='G114'
or substr(diag,1,4)='G120'
or substr(diag,1,4)='G121'
or substr(diag,1,4)='G122'
or substr(diag,1,4)='G128'
or substr(diag,1,4)='G129'
or substr(diag,1,4)='G131'
or substr(diag,1,4)='G132'
or substr(diag,1,4)='G138'
or substr(diag,1,5)='G1221'
or substr(diag,1,5)='G1220'
or substr(diag,1,5)='G1221'
or substr(diag,1,5)='G1222'
or substr(diag,1,5)='G1223'
or substr(diag,1,5)='G1224'
or substr(diag,1,5)='G1225'
or substr(diag,1,5)='G1229')
and als_icd10=0 then
als_icd10=1;

/*renal, for diabetes*/
if (substr(diag,1,4)='I120'
or substr(diag,1,5)='I1311'
or substr(diag,1,4)='N184'
or substr(diag,1,4)='N185'
or substr(diag,1,4)='N186'
or substr(diag,1,3)='N19'
or substr(diag,1,5)='Z4931'
or substr(diag,1,5)='Z4932'
or substr(diag,1,5)='Z9115'
or substr(diag,1,4)='Z992')
and renal_icd10=0 then
renal_icd10=1;

/*PVD*/
if (substr(diag,1,5)='E0852'
or substr(diag,1,5)='E0952'
or substr(diag,1,5)='I7025'
or substr(diag,1,5)='I7025'
or substr(diag,1,5)='I7035'
or substr(diag,1,5)='I7045'
or substr(diag,1,5)='I7055'
or substr(diag,1,5)='I7065'
or substr(diag,1,5)='I7075'
or substr(diag,1,5)='I7092'
or substr(diag,1,5)='I7770'
or substr(diag,1,5)='I7771'
or substr(diag,1,5)='I7772'
or substr(diag,1,5)='I7773'
or substr(diag,1,5)='I7774'
or substr(diag,1,5)='I7775'
or substr(diag,1,5)='I7776'
or substr(diag,1,5)='I7777'
or substr(diag,1,5)='I7779'
or substr(diag,1,6)='I70221'
or substr(diag,1,6)='I70222'
or substr(diag,1,6)='I70223'
or substr(diag,1,6)='I70228'
or substr(diag,1,6)='I70229'
or substr(diag,1,6)='I70231'
or substr(diag,1,6)='I70232'
or substr(diag,1,6)='I70233'
or substr(diag,1,6)='I70234'
or substr(diag,1,6)='I70235'
or substr(diag,1,6)='I70238'
or substr(diag,1,6)='I70239'
or substr(diag,1,6)='I70241'
or substr(diag,1,6)='I70242'
or substr(diag,1,6)='I70243'
or substr(diag,1,6)='I70244'
or substr(diag,1,6)='I70245'
or substr(diag,1,6)='I70248'
or substr(diag,1,6)='I70249'
or substr(diag,1,6)='I70261'
or substr(diag,1,6)='I70262'
or substr(diag,1,6)='I70263'
or substr(diag,1,6)='I70268'
or substr(diag,1,6)='I70269'
or substr(diag,1,6)='I70301'
or substr(diag,1,6)='I70302'
or substr(diag,1,6)='I70303'
or substr(diag,1,6)='I70308'
or substr(diag,1,6)='I70309'
or substr(diag,1,6)='I70311'
or substr(diag,1,6)='I70312'
or substr(diag,1,6)='I70313'
or substr(diag,1,6)='I70318'
or substr(diag,1,6)='I70319'
or substr(diag,1,6)='I70321'
or substr(diag,1,6)='I70322'
or substr(diag,1,6)='I70323'
or substr(diag,1,6)='I70328'
or substr(diag,1,6)='I70329'
or substr(diag,1,6)='I70331'
or substr(diag,1,6)='I70332'
or substr(diag,1,6)='I70333'
or substr(diag,1,6)='I70334'
or substr(diag,1,6)='I70335'
or substr(diag,1,6)='I70338'
or substr(diag,1,6)='I70339'
or substr(diag,1,6)='I70341'
or substr(diag,1,6)='I70342'
or substr(diag,1,6)='I70343'
or substr(diag,1,6)='I70344'
or substr(diag,1,6)='I70345'
or substr(diag,1,6)='I70348'
or substr(diag,1,6)='I70349'
or substr(diag,1,6)='I70361'
or substr(diag,1,6)='I70362'
or substr(diag,1,6)='I70363'
or substr(diag,1,6)='I70368'
or substr(diag,1,6)='I70369'
or substr(diag,1,6)='I70391'
or substr(diag,1,6)='I70392'
or substr(diag,1,6)='I70393'
or substr(diag,1,6)='I70398'
or substr(diag,1,6)='I70399'
or substr(diag,1,6)='I70399'
or substr(diag,1,6)='I70401'
or substr(diag,1,6)='I70402'
or substr(diag,1,6)='I70403'
or substr(diag,1,6)='I70408'
or substr(diag,1,6)='I70409'
or substr(diag,1,6)='I70411'
or substr(diag,1,6)='I70412'
or substr(diag,1,6)='I70413'
or substr(diag,1,6)='I70418'
or substr(diag,1,6)='I70419'
or substr(diag,1,6)='I70421'
or substr(diag,1,6)='I70422'
or substr(diag,1,6)='I70423'
or substr(diag,1,6)='I70428'
or substr(diag,1,6)='I70429'
or substr(diag,1,6)='I70431'
or substr(diag,1,6)='I70432'
or substr(diag,1,6)='I70433'
or substr(diag,1,6)='I70434'
or substr(diag,1,6)='I70435'
or substr(diag,1,6)='I70438'
or substr(diag,1,6)='I70439'
or substr(diag,1,6)='I70441'
or substr(diag,1,6)='I70442'
or substr(diag,1,6)='I70443'
or substr(diag,1,6)='I70444'
or substr(diag,1,6)='I70445'
or substr(diag,1,6)='I70448'
or substr(diag,1,6)='I70449'
or substr(diag,1,6)='I70461'
or substr(diag,1,6)='I70462'
or substr(diag,1,6)='I70463'
or substr(diag,1,6)='I70468'
or substr(diag,1,6)='I70469'
or substr(diag,1,6)='I70491'
or substr(diag,1,6)='I70492'
or substr(diag,1,6)='I70493'
or substr(diag,1,6)='I70498'
or substr(diag,1,6)='I70499'
or substr(diag,1,6)='I70501'
or substr(diag,1,6)='I70502'
or substr(diag,1,6)='I70503'
or substr(diag,1,6)='I70508'
or substr(diag,1,6)='I70509'
or substr(diag,1,6)='I70511'
or substr(diag,1,6)='I70512'
or substr(diag,1,6)='I70513'
or substr(diag,1,6)='I70518'
or substr(diag,1,6)='I70519'
or substr(diag,1,6)='I70521'
or substr(diag,1,6)='I70522'
or substr(diag,1,6)='I70523'
or substr(diag,1,6)='I70528'
or substr(diag,1,6)='I70529'
or substr(diag,1,6)='I70531'
or substr(diag,1,6)='I70532'
or substr(diag,1,6)='I70533'
or substr(diag,1,6)='I70534'
or substr(diag,1,6)='I70535'
or substr(diag,1,6)='I70538'
or substr(diag,1,6)='I70539'
or substr(diag,1,6)='I70541'
or substr(diag,1,6)='I70542'
or substr(diag,1,6)='I70543'
or substr(diag,1,6)='I70544'
or substr(diag,1,6)='I70545'
or substr(diag,1,6)='I70548'
or substr(diag,1,6)='I70549'
or substr(diag,1,6)='I70561'
or substr(diag,1,6)='I70562'
or substr(diag,1,6)='I70563'
or substr(diag,1,6)='I70568'
or substr(diag,1,6)='I70569'
or substr(diag,1,6)='I70591'
or substr(diag,1,6)='I70592'
or substr(diag,1,6)='I70593'
or substr(diag,1,6)='I70598'
or substr(diag,1,6)='I70599'
or substr(diag,1,6)='I70599'
or substr(diag,1,6)='I70601'
or substr(diag,1,6)='I70602'
or substr(diag,1,6)='I70603'
or substr(diag,1,6)='I70608'
or substr(diag,1,6)='I70609'
or substr(diag,1,6)='I70611'
or substr(diag,1,6)='I70612'
or substr(diag,1,6)='I70613'
or substr(diag,1,6)='I70618'
or substr(diag,1,6)='I70619'
or substr(diag,1,6)='I70621'
or substr(diag,1,6)='I70622'
or substr(diag,1,6)='I70623'
or substr(diag,1,6)='I70628'
or substr(diag,1,6)='I70629'
or substr(diag,1,6)='I70631'
or substr(diag,1,6)='I70632'
or substr(diag,1,6)='I70633'
or substr(diag,1,6)='I70634'
or substr(diag,1,6)='I70635'
or substr(diag,1,6)='I70638'
or substr(diag,1,6)='I70639'
or substr(diag,1,6)='I70641'
or substr(diag,1,6)='I70642'
or substr(diag,1,6)='I70643'
or substr(diag,1,6)='I70644'
or substr(diag,1,6)='I70645'
or substr(diag,1,6)='I70648'
or substr(diag,1,6)='I70649'
or substr(diag,1,6)='I70661'
or substr(diag,1,6)='I70662'
or substr(diag,1,6)='I70663'
or substr(diag,1,6)='I70668'
or substr(diag,1,6)='I70669'
or substr(diag,1,6)='I70691'
or substr(diag,1,6)='I70692'
or substr(diag,1,6)='I70693'
or substr(diag,1,6)='I70698'
or substr(diag,1,6)='I70699'
or substr(diag,1,6)='I70701'
or substr(diag,1,6)='I70702'
or substr(diag,1,6)='I70703'
or substr(diag,1,6)='I70708'
or substr(diag,1,6)='I70709'
or substr(diag,1,6)='I70711'
or substr(diag,1,6)='I70712'
or substr(diag,1,6)='I70713'
or substr(diag,1,6)='I70718'
or substr(diag,1,6)='I70719'
or substr(diag,1,6)='I70721'
or substr(diag,1,6)='I70722'
or substr(diag,1,6)='I70723'
or substr(diag,1,6)='I70728'
or substr(diag,1,6)='I70729'
or substr(diag,1,6)='I70731'
or substr(diag,1,6)='I70732'
or substr(diag,1,6)='I70733'
or substr(diag,1,6)='I70734'
or substr(diag,1,6)='I70735'
or substr(diag,1,6)='I70738'
or substr(diag,1,6)='I70739'
or substr(diag,1,6)='I70741'
or substr(diag,1,6)='I70742'
or substr(diag,1,6)='I70743'
or substr(diag,1,6)='I70744'
or substr(diag,1,6)='I70745'
or substr(diag,1,6)='I70748'
or substr(diag,1,6)='I70749'
or substr(diag,1,6)='I70761'
or substr(diag,1,6)='I70762'
or substr(diag,1,6)='I70763'
or substr(diag,1,6)='I70768'
or substr(diag,1,6)='I70769'
or substr(diag,1,6)='I70791'
or substr(diag,1,6)='I70792'
or substr(diag,1,6)='I70793'
or substr(diag,1,6)='I70798'
or substr(diag,1,6)='I70799'
or substr(diag,1,6)='Z95820'
or substr(diag,1,6)='Z95828')
and pvd_icd10=0 then
pvd_icd10=1;

/*Ischemic Heart Disease*/
if (substr(diag,1,4)='I200'
or substr(diag,1,4)='I201'
or substr(diag,1,4)='I208'
or substr(diag,1,4)='I209'
or substr(diag,1,4)='I213'
or substr(diag,1,4)='I214'
or substr(diag,1,4)='I219'
or substr(diag,1,4)='I220'
or substr(diag,1,4)='I221'
or substr(diag,1,4)='I222'
or substr(diag,1,4)='I228'
or substr(diag,1,4)='I229'
or substr(diag,1,4)='I240'
or substr(diag,1,4)='I241'
or substr(diag,1,4)='I248'
or substr(diag,1,4)='I249'
or substr(diag,1,4)='I252'
or substr(diag,1,4)='I255'
or substr(diag,1,4)='I256'
or substr(diag,1,4)='I259'
or substr(diag,1,5)='I2101'
or substr(diag,1,5)='I2102'
or substr(diag,1,5)='I2109'
or substr(diag,1,5)='I2111'
or substr(diag,1,5)='I2119'
or substr(diag,1,5)='I2121'
or substr(diag,1,5)='I2129'
or substr(diag,1,5)='I21A1'
or substr(diag,1,5)='I21A9'
or substr(diag,1,5)='I2510'
or substr(diag,1,5)='I2542'
or substr(diag,1,5)='I2582'
or substr(diag,1,5)='I2583'
or substr(diag,1,5)='I2589'
or substr(diag,1,6)='I25110'
or substr(diag,1,6)='I25111'
or substr(diag,1,6)='I25118'
or substr(diag,1,6)='I25119'
or substr(diag,1,6)='I25700'
or substr(diag,1,6)='I25701'
or substr(diag,1,6)='I25708'
or substr(diag,1,6)='I25709'
or substr(diag,1,6)='I25710'
or substr(diag,1,6)='I25711'
or substr(diag,1,6)='I25718'
or substr(diag,1,6)='I25719'
or substr(diag,1,6)='I25720'
or substr(diag,1,6)='I25721'
or substr(diag,1,6)='I25728'
or substr(diag,1,6)='I25729'
or substr(diag,1,6)='I25730'
or substr(diag,1,6)='I25731'
or substr(diag,1,6)='I25738'
or substr(diag,1,6)='I25739'
or substr(diag,1,6)='I25750'
or substr(diag,1,6)='I25751'
or substr(diag,1,6)='I25758'
or substr(diag,1,6)='I25759'
or substr(diag,1,6)='I25760'
or substr(diag,1,6)='I25761'
or substr(diag,1,6)='I25768'
or substr(diag,1,6)='I25769'
or substr(diag,1,6)='I25790'
or substr(diag,1,6)='I25791'
or substr(diag,1,6)='I25798'
or substr(diag,1,6)='I25799'
or substr(diag,1,6)='I25810'
or substr(diag,1,6)='I25811'
or substr(diag,1,6)='I25812')
and cad_icd10=0 then
cad_icd10=1;

/*dementia*/
if (substr(diag,1,5)='F0150'
or substr(diag,1,5)='F0151'
or substr(diag,1,5)='F0280'
or substr(diag,1,5)='F0281'
or substr(diag,1,5)='F0390'
or substr(diag,1,5)='F0391'
or substr(diag,1,4)='F051'
or substr(diag,1,5)='F1027'
or substr(diag,1,5)='F1097'
or substr(diag,1,4)='G300'
or substr(diag,1,4)='G301'
or substr(diag,1,4)='G308'
or substr(diag,1,4)='G309'
or substr(diag,1,5)='G3101'
or substr(diag,1,5)='G3109'
or substr(diag,1,4)='G311'
or substr(diag,1,5)='G3183'
or substr(diag,1,4)='A811'
or substr(diag,1,4)='A812'
or substr(diag,1,4)='A818'
or substr(diag,1,5)='A8100'
or substr(diag,1,5)='A8101'
or substr(diag,1,5)='A8109'
or substr(diag,1,5)='A8181'
or substr(diag,1,5)='A8182'
or substr(diag,1,5)='A8183'
)  
		and dementia_icd10=0 
          then dementia_icd10=1;

/*hip fracture--as of 11/26/18, looking for any HF code in ICD10s if 70 or older*/
if (substr(diag,1,7)='S72043A'
or substr(diag,1,7)='S72042A'
or substr(diag,1,7)='S72046A'
or substr(diag,1,7)='S72044A'
or substr(diag,1,7)='S72041A'
or substr(diag,1,7)='S72045A'
or substr(diag,1,7)='S72019C'
or substr(diag,1,7)='S72001B'
or substr(diag,1,7)='S72009B'
or substr(diag,1,7)='S72001C'
or substr(diag,1,7)='S72002B'
or substr(diag,1,7)='S72009C'
or substr(diag,1,7)='S72002C'
or substr(diag,1,7)='S72019B'
or substr(diag,1,7)='S7223XB'
or substr(diag,1,7)='S72033C'
or substr(diag,1,7)='S72099A'
or substr(diag,1,7)='S72009A'
or substr(diag,1,7)='S72002A'
or substr(diag,1,7)='S72001A'
or substr(diag,1,7)='S72026B'
or substr(diag,1,7)='S72022C'
or substr(diag,1,7)='S72022B'
or substr(diag,1,7)='S72023B'
or substr(diag,1,7)='S72021C'
or substr(diag,1,7)='S72024C'
or substr(diag,1,7)='S72025B'
or substr(diag,1,7)='S72021B'
or substr(diag,1,7)='S72024B'
or substr(diag,1,7)='S72023C'
or substr(diag,1,7)='S72025C'
or substr(diag,1,7)='S72026C'
or substr(diag,1,7)='S7226XB'
or substr(diag,1,7)='S7226XC'
or substr(diag,1,7)='S72043B'
or substr(diag,1,7)='S72099B'
or substr(diag,1,7)='S72033B'
or substr(diag,1,7)='S72032C'
or substr(diag,1,7)='S72031C'
or substr(diag,1,7)='S72031B'
or substr(diag,1,7)='S72036C'
or substr(diag,1,7)='S72035C'
or substr(diag,1,7)='S72034C'
or substr(diag,1,7)='S72033C'
or substr(diag,1,7)='S72034B'
or substr(diag,1,7)='S72036B'
or substr(diag,1,7)='S72032B'
or substr(diag,1,7)='S72035B'
or substr(diag,1,7)='S7222XA'
or substr(diag,1,7)='S7223XA'
or substr(diag,1,7)='S7224XA'
or substr(diag,1,7)='S7226XA'
or substr(diag,1,7)='S7225XA'
or substr(diag,1,7)='S7221XA'
or substr(diag,1,7)='S72012A'
or substr(diag,1,7)='S72019A'
or substr(diag,1,7)='S72011A'
or substr(diag,1,7)='S7224XC'
or substr(diag,1,7)='S7223XC'
or substr(diag,1,7)='S7222XC'
or substr(diag,1,7)='S7224XB'
or substr(diag,1,7)='S7226XB'
or substr(diag,1,7)='S7226XC'
or substr(diag,1,7)='S7223XB'
or substr(diag,1,7)='S7225XC'
or substr(diag,1,7)='S7221XC'
or substr(diag,1,7)='S7222XB'
or substr(diag,1,7)='S7221XB'
or substr(diag,1,7)='S7225XB'
or substr(diag,1,7)='S72009C'
or substr(diag,1,7)='S72046A'
or substr(diag,1,7)='S7223XC'
or substr(diag,1,7)='S72099C'
or substr(diag,1,7)='S72032A'
or substr(diag,1,7)='S72031A'
or substr(diag,1,7)='S72034A'
or substr(diag,1,7)='S72035A'
or substr(diag,1,7)='S72033A'
or substr(diag,1,7)='S72036A'
or substr(diag,1,7)='S72143B'
or substr(diag,1,7)='S72026B'
or substr(diag,1,7)='S72099A'
or substr(diag,1,7)='S72091A'
or substr(diag,1,7)='S72065A'
or substr(diag,1,7)='S72051A'
or substr(diag,1,7)='S72059A'
or substr(diag,1,7)='S72052A'
or substr(diag,1,7)='S72066A'
or substr(diag,1,7)='S72061A'
or substr(diag,1,7)='S72092A'
or substr(diag,1,7)='S72062A'
or substr(diag,1,7)='S72063A'
or substr(diag,1,7)='S72064A'
or substr(diag,1,7)='S72146A'
or substr(diag,1,7)='S72142A'
or substr(diag,1,7)='S72145A'
or substr(diag,1,7)='S72143A'
or substr(diag,1,7)='S72144A'
or substr(diag,1,7)='S72141A'
or substr(diag,1,7)='S72023A'
or substr(diag,1,7)='S72023C'
or substr(diag,1,7)='S72143A'
or substr(diag,1,7)='S72021A'
or substr(diag,1,7)='S72025A'
or substr(diag,1,7)='S72022A'
or substr(diag,1,7)='S72024A'
or substr(diag,1,7)='S72023A'
or substr(diag,1,7)='S72026A'
or substr(diag,1,7)='S72036B'
or substr(diag,1,7)='S72146C'
or substr(diag,1,7)='S72146A'
or substr(diag,1,7)='S72146B'
or substr(diag,1,7)='S72066C'
or substr(diag,1,7)='S72065C'
or substr(diag,1,7)='S72059B'
or substr(diag,1,7)='S72066B'
or substr(diag,1,7)='S72064C'
or substr(diag,1,7)='S72063C'
or substr(diag,1,7)='S72051C'
or substr(diag,1,7)='S72099B'
or substr(diag,1,7)='S72063B'
or substr(diag,1,7)='S72065B'
or substr(diag,1,7)='S72091C'
or substr(diag,1,7)='S72062C'
or substr(diag,1,7)='S72061C'
or substr(diag,1,7)='S72092B'
or substr(diag,1,7)='S72062B'
or substr(diag,1,7)='S72052B'
or substr(diag,1,7)='S72064B'
or substr(diag,1,7)='S72091B'
or substr(diag,1,7)='S72092C'
or substr(diag,1,7)='S72059C'
or substr(diag,1,7)='S72052C'
or substr(diag,1,7)='S72061B'
or substr(diag,1,7)='S72051B'
or substr(diag,1,7)='S72099C'
or substr(diag,1,7)='S72009A'
or substr(diag,1,7)='S72046B'
or substr(diag,1,7)='S72026A'
or substr(diag,1,7)='S72046C'
or substr(diag,1,7)='S72126C'
or substr(diag,1,7)='S72122B'
or substr(diag,1,7)='S72134C'
or substr(diag,1,7)='S72113B'
or substr(diag,1,7)='S72131B'
or substr(diag,1,7)='S72123C'
or substr(diag,1,7)='S72102C'
or substr(diag,1,7)='S72132C'
or substr(diag,1,7)='S72133B'
or substr(diag,1,7)='S72122C'
or substr(diag,1,7)='S72121B'
or substr(diag,1,7)='S72135B'
or substr(diag,1,7)='S72115B'
or substr(diag,1,7)='S72125C'
or substr(diag,1,7)='S72109B'
or substr(diag,1,7)='S72111C'
or substr(diag,1,7)='S72102B'
or substr(diag,1,7)='S72132B'
or substr(diag,1,7)='S72113C'
or substr(diag,1,7)='S72112B'
or substr(diag,1,7)='S72116B'
or substr(diag,1,7)='S72116C'
or substr(diag,1,7)='S72136C'
or substr(diag,1,7)='S72133C'
or substr(diag,1,7)='S72114C'
or substr(diag,1,7)='S72126B'
or substr(diag,1,7)='S72109C'
or substr(diag,1,7)='S72121C'
or substr(diag,1,7)='S72124B'
or substr(diag,1,7)='S72111B'
or substr(diag,1,7)='S72114B'
or substr(diag,1,7)='S72136B'
or substr(diag,1,7)='S72112C'
or substr(diag,1,7)='S72101B'
or substr(diag,1,7)='S72131C'
or substr(diag,1,7)='S72124C'
or substr(diag,1,7)='S72135C'
or substr(diag,1,7)='S72115C'
or substr(diag,1,7)='S72123B'
or substr(diag,1,7)='S72125B'
or substr(diag,1,7)='S72101C'
or substr(diag,1,7)='S72134B'
or substr(diag,1,7)='S72109A'
or substr(diag,1,7)='S72043C'
or substr(diag,1,7)='S72144C'
or substr(diag,1,7)='S72146B'
or substr(diag,1,7)='S72142C'
or substr(diag,1,7)='S72146C'
or substr(diag,1,7)='S72141C'
or substr(diag,1,7)='S72145C'
or substr(diag,1,7)='S72141B'
or substr(diag,1,7)='S72142B'
or substr(diag,1,7)='S72143B'
or substr(diag,1,7)='S72144B'
or substr(diag,1,7)='S72145B'
or substr(diag,1,7)='S72143C'
or substr(diag,1,7)='S72043A'
or substr(diag,1,7)='S72033A'
or substr(diag,1,7)='S72043B'
or substr(diag,1,7)='S72041B'
or substr(diag,1,7)='S72045B'
or substr(diag,1,7)='S72043C'
or substr(diag,1,7)='S72042B'
or substr(diag,1,7)='S72044B'
or substr(diag,1,7)='S72044C'
or substr(diag,1,7)='S72045C'
or substr(diag,1,7)='S72042C'
or substr(diag,1,7)='S72046C'
or substr(diag,1,7)='S72041C'
or substr(diag,1,7)='S72046B'
or substr(diag,1,7)='S72124A'
or substr(diag,1,7)='S72134A'
or substr(diag,1,7)='S72116A'
or substr(diag,1,7)='S72109A'
or substr(diag,1,7)='S72133A'
or substr(diag,1,7)='S72122A'
or substr(diag,1,7)='S72114A'
or substr(diag,1,7)='S72126A'
or substr(diag,1,7)='S72101A'
or substr(diag,1,7)='S72132A'
or substr(diag,1,7)='S72123A'
or substr(diag,1,7)='S72121A'
or substr(diag,1,7)='S72112A'
or substr(diag,1,7)='S72113A'
or substr(diag,1,7)='S72102A'
or substr(diag,1,7)='S72131A'
or substr(diag,1,7)='S72125A'
or substr(diag,1,7)='S72136A'
or substr(diag,1,7)='S72135A'
or substr(diag,1,7)='S72111A'
or substr(diag,1,7)='S72115A'
or substr(diag,1,7)='S72009B'
or substr(diag,1,7)='S72143C'
or substr(diag,1,7)='S7226XA'
or substr(diag,1,7)='S72036A'
or substr(diag,1,7)='S72036C'
or substr(diag,1,7)='S72012B'
or substr(diag,1,7)='S72011C'
or substr(diag,1,7)='S72011B'
or substr(diag,1,7)='S72019C'
or substr(diag,1,7)='S72019B'
or substr(diag,1,7)='S72012C'
or substr(diag,1,7)='S72033B'
or substr(diag,1,7)='S72109B'
or substr(diag,1,7)='S7223XA'
or substr(diag,1,7)='S72026C'
or substr(diag,1,7)='S72109C'
or substr(diag,1,7)='S72019A'
or substr(diag,1,7)='S72023B'
or substr(diag,1,7)='S72091A'
or substr(diag,1,7)='S72064A'
or substr(diag,1,7)='S72063A'
or substr(diag,1,7)='S72116C'
or substr(diag,1,7)='S72052C'
or substr(diag,1,7)='S72124C'
or substr(diag,1,7)='S72111C'
or substr(diag,1,7)='S7224XA'
or substr(diag,1,7)='S72113C'
or substr(diag,1,7)='S72102A'
or substr(diag,1,7)='S72051B'
or substr(diag,1,7)='S72031A'
or substr(diag,1,7)='S72132B'
or substr(diag,1,7)='S72034A'
or substr(diag,1,7)='S72144B'
or substr(diag,1,7)='S72045C'
or substr(diag,1,7)='S72045A'
or substr(diag,1,7)='S72012C'
or substr(diag,1,7)='S72115C'
or substr(diag,1,7)='S72059A'
or substr(diag,1,7)='S72134B'
or substr(diag,1,7)='S72064C'
or substr(diag,1,7)='S72041B'
or substr(diag,1,7)='S72144C'
or substr(diag,1,7)='S72024C'
or substr(diag,1,7)='S72136A'
or substr(diag,1,7)='S72145C'
or substr(diag,1,7)='S72091B'
or substr(diag,1,7)='S72035C'
or substr(diag,1,7)='S72011B'
or substr(diag,1,7)='S72025C'
or substr(diag,1,7)='S72124B'
or substr(diag,1,7)='S72132A'
or substr(diag,1,7)='S72063B'
or substr(diag,1,7)='S72032A'
or substr(diag,1,7)='S72042C'
or substr(diag,1,7)='S72142A'
or substr(diag,1,7)='S7221XC'
or substr(diag,1,7)='S7224XB'
or substr(diag,1,7)='S72121C'
or substr(diag,1,7)='S72066C'
or substr(diag,1,7)='S72042B'
or substr(diag,1,7)='S7225XB'
or substr(diag,1,7)='S72134A'
or substr(diag,1,7)='S72022A'
or substr(diag,1,7)='S72092A'
or substr(diag,1,7)='S72102B'
or substr(diag,1,7)='S72123B'
or substr(diag,1,7)='S72115A'
or substr(diag,1,7)='S72024B'
or substr(diag,1,7)='S72125B'
or substr(diag,1,7)='S72133C'
or substr(diag,1,7)='S7224XC'
or substr(diag,1,7)='S72133A'
or substr(diag,1,7)='S72065A'
or substr(diag,1,7)='S72125A'
or substr(diag,1,7)='S72032B'
or substr(diag,1,7)='S72133B'
or substr(diag,1,7)='S72092B'
or substr(diag,1,7)='S72042A'
or substr(diag,1,7)='S72025A'
or substr(diag,1,7)='S72114B'
or substr(diag,1,7)='S72059C'
or substr(diag,1,7)='S72011A'
or substr(diag,1,7)='S72125C'
or substr(diag,1,7)='S72002B'
or substr(diag,1,7)='S72122A'
or substr(diag,1,7)='S72112A'
or substr(diag,1,7)='S72145A'
or substr(diag,1,7)='S72101B'
or substr(diag,1,7)='S72001C'
or substr(diag,1,7)='S72052A'
or substr(diag,1,7)='S72126A'
or substr(diag,1,7)='S72116A'
or substr(diag,1,7)='S72061C'
or substr(diag,1,7)='S72062B'
or substr(diag,1,7)='S72051C'
or substr(diag,1,7)='S72101A'
or substr(diag,1,7)='S72024A'
or substr(diag,1,7)='S72135B'
or substr(diag,1,7)='S72126B'
or substr(diag,1,7)='S72123A'
or substr(diag,1,7)='S72064B'
or substr(diag,1,7)='S72066B'
or substr(diag,1,7)='S72045B'
or substr(diag,1,7)='S72032C'
or substr(diag,1,7)='S72124A'
or substr(diag,1,7)='S72132C'
or substr(diag,1,7)='S72121A'
or substr(diag,1,7)='S72113B'
or substr(diag,1,7)='S72022B'
or substr(diag,1,7)='S72021B'
or substr(diag,1,7)='S72031B'
or substr(diag,1,7)='S72012B'
or substr(diag,1,7)='S72145B'
or substr(diag,1,7)='S72044A'
or substr(diag,1,7)='S72035B'
or substr(diag,1,7)='S72111B'
or substr(diag,1,7)='S72001B'
or substr(diag,1,7)='S72144A'
or substr(diag,1,7)='S72136B'
or substr(diag,1,7)='S72002A'
or substr(diag,1,7)='S72034B'
or substr(diag,1,7)='S72113A'
or substr(diag,1,7)='S72126C'
or substr(diag,1,7)='S72115B'
or substr(diag,1,7)='S72041A'
or substr(diag,1,7)='S72131C'
or substr(diag,1,7)='S7222XC'
or substr(diag,1,7)='S72034C'
or substr(diag,1,7)='S72021A'
or substr(diag,1,7)='S72123C'
or substr(diag,1,7)='S72141B'
or substr(diag,1,7)='S72134C'
or substr(diag,1,7)='S72142C'
or substr(diag,1,7)='S72059B'
or substr(diag,1,7)='S72112B'
or substr(diag,1,7)='S72131B'
or substr(diag,1,7)='S72122B'
or substr(diag,1,7)='S7222XA'
or substr(diag,1,7)='S72092C'
or substr(diag,1,7)='S72062A'
or substr(diag,1,7)='S72052B'
or substr(diag,1,7)='S72061B'
or substr(diag,1,7)='S72114A'
or substr(diag,1,7)='S72035A'
or substr(diag,1,7)='S7225XC'
or substr(diag,1,7)='S72066A'
or substr(diag,1,7)='S72031C'
or substr(diag,1,7)='S72041C'
or substr(diag,1,7)='S72116B'
or substr(diag,1,7)='S72135C'
or substr(diag,1,7)='S72062C'
or substr(diag,1,7)='S72002C'
or substr(diag,1,7)='S72025B'
or substr(diag,1,7)='S72111A'
or substr(diag,1,7)='S72121B'
or substr(diag,1,7)='S72136C'
or substr(diag,1,7)='S72044C'
or substr(diag,1,7)='S72122C'
or substr(diag,1,7)='S72141C'
or substr(diag,1,7)='S72102C'
or substr(diag,1,7)='S72063C'
or substr(diag,1,7)='S72022C'
or substr(diag,1,7)='S72021C'
or substr(diag,1,7)='S72135A'
or substr(diag,1,7)='S72012A'
or substr(diag,1,7)='S72101C'
or substr(diag,1,7)='S72112C'
or substr(diag,1,7)='S72142B'
or substr(diag,1,7)='S72114C'
or substr(diag,1,7)='S7221XA'
or substr(diag,1,7)='S7225XA'
or substr(diag,1,7)='S72051A'
or substr(diag,1,7)='S72131A'
or substr(diag,1,7)='S72011C'
or substr(diag,1,7)='S72091C'
or substr(diag,1,7)='S7221XB'
or substr(diag,1,7)='S7222XB'
or substr(diag,1,7)='S72001A'
or substr(diag,1,7)='S72061A'
or substr(diag,1,7)='S72044B')
		and hip_icd10=0 
		then hip_icd10=1;

/*CHF--just for comparison ICD9/10*/
if (substr(diag,1,5)='I0981' 
		or substr(diag,1,4)='I110'
		or substr(diag,1,4)='I130'
		or substr(diag,1,4)='I132'
		or substr(diag,1,4)='I501'
		or substr(diag,1,5)='I5020'
		or substr(diag,1,5)='I5021'
		or substr(diag,1,5)='I5022'
		or substr(diag,1,5)='I5023'
		or substr(diag,1,5)='I5030'
		or substr(diag,1,5)='I5031'
		or substr(diag,1,5)='I5032'
		or substr(diag,1,5)='I5033'
		or substr(diag,1,5)='I5040'
		or substr(diag,1,5)='I5041'
		or substr(diag,1,5)='I5042'
		or substr(diag,1,5)='I5043'
		or substr(diag,1,5)='I5043'
		or substr(diag,1,5)='I50810'
		or substr(diag,1,5)='I50811'
		or substr(diag,1,5)='I50812'
		or substr(diag,1,5)='I50813'
		or substr(diag,1,5)='I50814'
		or substr(diag,1,5)='I5082'
		or substr(diag,1,5)='I5083'
		or substr(diag,1,5)='I5084'
		or substr(diag,1,5)='I5089'
		or substr(diag,1,4)='I509')		
		and chf_icd10=0 
				then chf_icd10=1;

if (substr(diag,1,4)='I602'
or substr(diag,1,4)='I604'
or substr(diag,1,4)='I606'
or substr(diag,1,4)='I607'
or substr(diag,1,4)='I608'
or substr(diag,1,4)='I609'
or substr(diag,1,4)='I610'
or substr(diag,1,4)='I611'
or substr(diag,1,4)='I612'
or substr(diag,1,4)='I613'
or substr(diag,1,4)='I614'
or substr(diag,1,4)='I615'
or substr(diag,1,4)='I616'
or substr(diag,1,4)='I618'
or substr(diag,1,4)='I619'
or substr(diag,1,4)='I636'
or substr(diag,1,4)='I638'
or substr(diag,1,4)='I639'
or substr(diag,1,5)='G9731'
or substr(diag,1,5)='G9732'
or substr(diag,1,5)='I6000'
or substr(diag,1,5)='I6001'
or substr(diag,1,5)='I6002'
or substr(diag,1,5)='I6010'
or substr(diag,1,5)='I6011'
or substr(diag,1,5)='I6012'
or substr(diag,1,5)='I6020'
or substr(diag,1,5)='I6021'
or substr(diag,1,5)='I6022'
or substr(diag,1,5)='I6030'
or substr(diag,1,5)='I6031'
or substr(diag,1,5)='I6032'
or substr(diag,1,5)='I6050'
or substr(diag,1,5)='I6051'
or substr(diag,1,5)='I6052'
or substr(diag,1,5)='I6300'
or substr(diag,1,5)='I6302'
or substr(diag,1,5)='I6309'
or substr(diag,1,5)='I6310'
or substr(diag,1,5)='I6312'
or substr(diag,1,5)='I6319'
or substr(diag,1,5)='I6320'
or substr(diag,1,5)='I6322'
or substr(diag,1,5)='I6329'
or substr(diag,1,5)='I6330'
or substr(diag,1,5)='I6339'
or substr(diag,1,5)='I6340'
or substr(diag,1,5)='I6349'
or substr(diag,1,5)='I6350'
or substr(diag,1,5)='I6359'
or substr(diag,1,6)='I63011'
or substr(diag,1,6)='I63012'
or substr(diag,1,6)='I63013'
or substr(diag,1,6)='I63019'
or substr(diag,1,6)='I63031'
or substr(diag,1,6)='I63032'
or substr(diag,1,6)='I63033'
or substr(diag,1,6)='I63039'
or substr(diag,1,6)='I63111'
or substr(diag,1,6)='I63112'
or substr(diag,1,6)='I63113'
or substr(diag,1,6)='I63119'
or substr(diag,1,6)='I63131'
or substr(diag,1,6)='I63132'
or substr(diag,1,6)='I63133'
or substr(diag,1,6)='I63139'
or substr(diag,1,6)='I63211'
or substr(diag,1,6)='I63212'
or substr(diag,1,6)='I63213'
or substr(diag,1,6)='I63219'
or substr(diag,1,6)='I63231'
or substr(diag,1,6)='I63232'
or substr(diag,1,6)='I63233'
or substr(diag,1,6)='I63239'
or substr(diag,1,6)='I63311'
or substr(diag,1,6)='I63312'
or substr(diag,1,6)='I63313'
or substr(diag,1,6)='I63319'
or substr(diag,1,6)='I63321'
or substr(diag,1,6)='I63322'
or substr(diag,1,6)='I63323'
or substr(diag,1,6)='I63329'
or substr(diag,1,6)='I63331'
or substr(diag,1,6)='I63332'
or substr(diag,1,6)='I63333'
or substr(diag,1,6)='I63339'
or substr(diag,1,6)='I63341'
or substr(diag,1,6)='I63342'
or substr(diag,1,6)='I63343'
or substr(diag,1,6)='I63349'
or substr(diag,1,6)='I63411'
or substr(diag,1,6)='I63412'
or substr(diag,1,6)='I63413'
or substr(diag,1,6)='I63419'
or substr(diag,1,6)='I63421'
or substr(diag,1,6)='I63422'
or substr(diag,1,6)='I63423'
or substr(diag,1,6)='I63429'
or substr(diag,1,6)='I63431'
or substr(diag,1,6)='I63432'
or substr(diag,1,6)='I63433'
or substr(diag,1,6)='I63439'
or substr(diag,1,6)='I63441'
or substr(diag,1,6)='I63442'
or substr(diag,1,6)='I63443'
or substr(diag,1,6)='I63449'
or substr(diag,1,6)='I63511'
or substr(diag,1,6)='I63512'
or substr(diag,1,6)='I63513'
or substr(diag,1,6)='I63519'
or substr(diag,1,6)='I63521'
or substr(diag,1,6)='I63522'
or substr(diag,1,6)='I63523'
or substr(diag,1,6)='I63529'
or substr(diag,1,6)='I63531'
or substr(diag,1,6)='I63532'
or substr(diag,1,6)='I63533'
or substr(diag,1,6)='I63539'
or substr(diag,1,6)='I63541'
or substr(diag,1,6)='I63542'
or substr(diag,1,6)='I63543'
or substr(diag,1,6)='I63549'
or substr(diag,1,6)='I97810'
or substr(diag,1,6)='I97811'
or substr(diag,1,6)='I97820'
or substr(diag,1,6)='I97821')
and cva_icd10=0 then
cva_icd10=1;


end;
run;



proc sql;
create table proj_int.icd10_smi as select 
distinct bene_id, index_year,
max(cancer_icd10) as cancer_icd10,
max(esrd_icd10) as esrd_icd10,
max(copd_icd10) as copd_icd10,
max(diabetes_icd10) as diabetes_icd10,
max(hiv_icd10) as hiv_icd10,
max(als_icd10) as als_icd10,
max(pvd_icd10) as pvd_icd10,
max(liver_icd10) as liver_icd10,
max(renal_icd10) as renal_icd10,
max(cad_icd10) as cad_icd10,
max(chf_icd10) as chf_icd10,
max(cva_icd10) as cva_icd10,
max(dementia_icd10) as dementia_icd10,
max(hip_icd10) as hip_icd10
from icd10a
group by bene_id, index_year;
quit;







H="utilization pre-index"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************
*/


/*These additional variables are just added to the dataset with the
elixhauser and cc's 1 year preceeding the interview, can add them
later when required to get the 2 year look-back dataset*/

/****************************************************************************/
/*Get indicator of any hospital admission 6 and 12 months pre-core interview*/
/****************************************************************************/

%macro admissions(days=,suffix=);

/*pull list of ip claims from all medpar claims x days pre-interview*/
data ip_meet_&days.;
set proj_int.ip_meet_&days.;
run;
data ip_&days._2;
set ip_meet_&days.;
type_adm=clm_ip_admsn_type_cd;
if icarecnt=. then icarecnt=0; /*medpar intensive care day count*/
if CRNRYDAY=. then CRNRYDAY=0; /*medpar coronary day count*/
icu_days=icarecnt+CRNRYDAY;
em_urgent_admit=0; /*Urgent , emergent admissions from admission type*/
if type_adm in (1,2) then em_urgent_admit=1;
em_admit=0;
if type_adm=1 then em_admit=1;
urgent_admit=0;
if type_adm=2 then urgent_admit=1;
elect_admit=0;
if type_adm=3 then elect_admit=1;
ind_ed_charge=0; /*ED charges as another indicator of ED use*/
if erdaycnt>0 & erdaycnt~=. then ind_ed_charge=1;
if erdaycnt=0 | erdaycnt=. then ind_ed_charge=0;

/*truncate stays where the admit is more than x days before interview
or discharge is after the interview date so can get accurate LOS*/
if index_date-admit_date>&days. then do;
	admit_date=index_date-&days.;
	admit_trunc=1;
	end;
if index_date<disch_date then do;
	disch_date=index_date;
	disch_trunc=1;	
	end;
adj_los=disch_date-admit_date;
if disch_date-admit_date=0 then adj_los=1;
run;

proc sort data=ip_&days._2;
by bene_id index_year;
run;

proc sql;
create table ip_&days._3 as select distinct bene_id,index_year,
/*total ICU days*/
sum(icu_days) as icu_days_&suffix. label="total icu days &suffix. pre ivw ivw",
/*count of IP admissions, all types*/
count(*) as n_ip_admit_&suffix. label="total n of hospital admit &suffix. pre ivw ivw",
/*total Hospital LOS*/
sum(adj_los) as n_hospd_&suffix. label="total hospital days &suffix. pre ivw ivw",
/*ICU stays*/
count(case when icu_days>0 then 1 else . end) as n_icu_stays_&suffix. 
	label="ICU stays &suffix pre ivw",
/*count urgent or emergency admissions*/
count(case when em_urgent_admit=1 then em_urgent_admit else . end) as n_em_urgent_admit_&suffix. 
	label="total n of urgent/emergent hospital admit &suffix. pre ivw ivw",
/*count of emergency admissions, from admission type code*/
count(case when em_admit=1 then em_admit else . end) as n_em_admit_&suffix. 
	label="total n of emergent hospital admit &suffix. pre ivw ivw",
/*count of urgent admissions, from admission type code*/
count(case when urgent_admit=1 then urgent_admit else . end) as n_urgent_admit_&suffix. 
	label="total n of urgent hospital admit &suffix. pre ivw ivw",
/*count of elective admissions, from admission type code*/
count(case when elect_admit=1 then elect_admit else . end) as n_elect_admit_&suffix. 
	label="total n of elective hospital admit &suffix. pre ivw ivw",
/*count of admissions with any ED charges*/
count(case when ind_ed_charge=1 then ind_ed_charge else . end) as n_ED_ip_&suffix. 
	label="total n of ED visits with subsequent admit &suffix. pre ivw ivw"

 from ip_&days._2 group by bene_id,index_year;
quit;

data ip_&days._4;
set ip_&days._3;
if icu_days_&suffix.>n_hospd_&suffix. then icu_days_&suffix.=n_hospd_&suffix.;
run;

%mend;

%admissions(days=183,suffix=6m);
%admissions(days=365,suffix=12m);

data elective_1;
set ip_365_2;
if elect_admit=1;
run;



proc sort data=ip_183_3 nodupkey;
by bene_id index_year;
run;


proc sql;
create table ip_6m as select a.*,b.icu_days_6m,b.n_icu_stays_6m,
b.n_ip_admit_6m,b.n_hospd_6m,b.n_em_urgent_admit_6m,b.n_em_admit_6m,
b.n_urgent_admit_6m,b.n_elect_admit_6m,b.n_ED_ip_6m
from proj_int.index a
left join
ip_183_3 b 
on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_year=b.index_year;
quit;

proc sort data=ip_365_3 nodupkey;
by bene_id index_year;
run;

proc sql;
create table ip1 as select a.*,b.icu_days_12m,b.n_icu_stays_12m,
b.n_ip_admit_12m,b.n_hospd_12m,b.n_em_urgent_admit_12m,b.n_em_admit_12m,
b.n_urgent_admit_12m,b.n_elect_admit_12m,b.n_ED_ip_12m
from ip_6m a
left join
ip_365_3 b 
on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_year=b.index_year;
quit;

/*Dataset just contains obs with ffs mc 1yr and age 65+
So if missing, set var to 0*/
 data ip ;
 set ip1 ;
 array list icu_days_6m n_ip_admit_6m n_hospd_6m n_em_urgent_admit_6m 
	n_em_admit_6m n_urgent_admit_6m n_elect_admit_6m n_ED_ip_6m
	icu_days_12m n_ip_admit_12m n_hospd_12m n_em_urgent_admit_12m
	n_em_admit_12m n_urgent_admit_12m n_elect_admit_12m n_ED_ip_12m;
 do over list;
 if list=. then list=0;
 end;

 if n_ip_admit_6m=0 then ind_hosp_adm_6m=0;
 if n_ip_admit_6m>0 & n_ip_admit_6m~=. then ind_hosp_adm_6m=1;
 label ind_hosp_adm_6m="Indicator for any hospital admission 6m pre ivw";

 if n_em_urgent_admit_6m=0 then ind_em_ur_adm_6m=0;
 if n_em_urgent_admit_6m>0 & n_em_urgent_admit_6m~=. then ind_em_ur_adm_6m=1;
 label ind_em_ur_adm_6m="Ind any urgent or emergent hospital admission 6m pre ivw";

 if n_em_admit_6m=0 then ind_em_adm_6m=0;
 if n_em_admit_6m>0 & n_em_admit_6m~=. then ind_em_adm_6m=1;
 label ind_em_adm_6m="Ind any emergency hospital admission 6m pre ivw";

 if n_urgent_admit_6m=0 then ind_ur_adm_6m=0;
 if n_urgent_admit_6m>0 & n_urgent_admit_6m~=. then ind_ur_adm_6m=1;
 label ind_ur_adm_6m="Ind any urgent hospital admission 6m pre ivw";

 if n_elect_admit_6m =0 then ind_elect_adm_6m=0;
 if n_elect_admit_6m >0 & n_elect_admit_6m ~=. then ind_elect_adm_6m=1;
 label ind_elect_adm_6m="Ind any elective hospital admission 6m pre ivw";

 if (n_ip_admit_6m - n_elect_admit_6m)=0 then ind_nonelect_adm_6m=0;
 if (n_ip_admit_6m - n_elect_admit_6m)>0 & n_elect_admit_6m~=. then ind_nonelect_adm_6m=1;
 label ind_nonelect_adm_6m="Ind any non-elective hospital admission 6m pre ivw";

 n_nonelect_adm_6m=(n_ip_admit_6m - n_elect_admit_6m);
 label n_nonelect_adm_6m="total n non-elective ip admit 6m pre ivw";

 if n_ED_ip_6m=0 then ind_ED_adm_6m=0;
 if n_ED_ip_6m>0 & n_ED_ip_6m~=. then ind_ED_adm_6m=1;
 label ind_ED_adm_6m="Ind ED use with hospital admission 6m pre ivw, from charges";

 if n_ip_admit_12m=0 then ind_hosp_adm_12m=0;
 if n_ip_admit_12m>0 & n_ip_admit_12m~=. then ind_hosp_adm_12m=1;
 label ind_hosp_adm_12m="Indicator for any hospital admission 12m pre ivw";

 if n_em_urgent_admit_12m=0 then ind_em_ur_adm_12m=0;
 if n_em_urgent_admit_12m>0 & n_em_urgent_admit_12m~=. then ind_em_ur_adm_12m=1;
 label ind_em_ur_adm_12m="Ind any urgent or emergent hospital admission 12m pre ivw";

 if n_em_admit_12m=0 then ind_em_adm_12m=0;
 if n_em_admit_12m>0 & n_em_admit_12m~=. then ind_em_adm_12m=1;
 label ind_em_adm_12m="Ind any emergency hospital admission 12m pre ivw";

 if n_urgent_admit_12m=0 then ind_ur_adm_12m=0;
 if n_urgent_admit_12m>0 & n_urgent_admit_12m~=. then ind_ur_adm_12m=1;
 label ind_ur_adm_12m="Ind any urgent hospital admission 12m pre ivw";

 if n_elect_admit_12m =0 then ind_elect_adm_12m=0;
 if n_elect_admit_12m >0 & n_elect_admit_12m ~=. then ind_elect_adm_12m=1;
 label ind_elect_adm_12m="Ind any elective hospital admission 12m pre ivw";

 if (n_ip_admit_12m - n_elect_admit_12m)=0 then ind_nonelect_adm_12m=0;
 if (n_ip_admit_12m - n_elect_admit_12m)>0 & n_elect_admit_12m~=. then ind_nonelect_adm_12m=1;
 label ind_nonelect_adm_12m="Ind any non-elective hospital admission 12m pre ivw";

 n_nonelect_adm_12m=(n_ip_admit_12m - n_elect_admit_12m);
 label n_nonelect_adm_12m="total n non-elective ip admit 12m pre ivw";

 if n_ED_ip_12m=0 then ind_ED_adm_12m=0;
 if n_ED_ip_12m>0 & n_ED_ip_12m~=. then ind_ED_adm_12m=1;
 label ind_ED_adm_12m="Ind ED use with hospital admission 12m pre ivw, from charges";

run;

 proc freq;
 table icu_days_6m n_ip_admit_6m n_hospd_6m ind_hosp_adm_6m n_em_urgent_admit_6m ind_em_ur_adm_6m 
	ind_em_adm_6m ind_ur_adm_6m ind_nonelect_adm_6m n_nonelect_adm_6m n_ED_ip_6m ind_ED_adm_6m 
	ind_em_adm_6m*ind_ED_adm_6m /missprint;
 run;

proc freq;
table icu_days_12m n_ip_admit_12m n_hospd_12m ind_hosp_adm_12m n_em_urgent_admit_12m ind_em_ur_adm_12m
	ind_em_adm_12m ind_ur_adm_12m ind_nonelect_adm_12m n_nonelect_adm_12m n_ED_ip_12m ind_ED_adm_12m 
	ind_em_adm_12m*ind_ED_adm_12m /missprint;
run;

/****************************************************************************/
/****************************************************************************/
/*Get SNF days, indicator for 12 months preceding the interview*/
/****************************************************************************/
/****************************************************************************/

/*pull list of snf claims from all medpar claims 12 months pre-interview*/
data snf_meet_365;
set proj_int.snf_meet_365;
run;

proc sort data=snf_meet_365;
by bene_id admit_date;
run;

data snf_meet_365_1a;
set snf_meet_365;
format admit_date date9. disch_date date9.;
run;

/*3 claim windows are present:
1. SNF stays fully within the 1 year before interview
2. Stays that begin before 1 year pre-core but end within 1 year pre-core
3. Stays that begin within 1 year of core but end after core ivw
4. Stays that begin before 1 year and end after interview, LOS=365!
Get claims that meet 1 *1797*/
proc sql;
create table snf_meet1_pre_365 as select *
from snf_meet_365_1a
where (index_date - admit_date)<365 & (index_date - disch_date)>=0; 
quit;


/*meet time window 2 *152*/
proc sql;
create table snf_meet2_pre_365 as select *
from snf_meet_365_1a
where (index_date - admit_date)>=365 & (index_date - disch_date)>=0; 
quit;

/*For these claims that start > 1 year before core, truncate start date so 
only count LOS days w/i 1 year
create indicator variable that claim start date is truncated*/
data snf_meet2_pre_365_1;
set snf_meet2_pre_365;
admit_date = index_date-365;
snf_admit_date_mod = 1;
label snf_admit_date_mod = "Admit date mod; at 12 mo from ivw date";
run;

proc freq;
table snf_admit_date_mod ;
run;

/*meet time window 3 *135 */
proc sql;
create table snf_meet3_pre_365 as select *
from snf_meet_365_1a
where (index_date - admit_date)<365 & (index_date-disch_date)<0; 
quit;

/*For these claims that end after core, truncate end date so 
only count LOS days 1 year before the core
create indicator variable that claim end date is truncated*/
data snf_meet3_pre_365_1;
set snf_meet3_pre_365;
disch_date = index_date;
snf_disch_date_mod = 1;
label snf_disch_date_mod = "Disch date mod; at ivw date";
run;

proc freq;
table snf_disch_date_mod ;
run;

/*meet 4 , overlap both start and end dates n=7*/
proc sql;
create table snf_meet4_pre_365 as select *
from snf_meet_365_1a
where (index_date - admit_date)>=365 & (index_date - disch_date)<0; 
quit;

/*truncate both start and end dates so just count 1 year pre interview*/
data snf_meet4_pre_365_1;
set snf_meet4_pre_365;
disch_date = index_date;
snf_disch_date_mod = 1;
label snf_disch_date_mod = "Disch date mod; at ivw date";
admit_date = index_date-365;
snf_admit_date_mod = 1;
label snf_admit_date_mod = "Admit date mod; at 12 mo from ivw date";
run;

proc freq;
table snf_disch_date_mod snf_admit_date_mod;
run;


data snf_meet_pre_365;
set snf_meet1_pre_365 snf_meet2_pre_365_1 snf_meet3_pre_365_1 snf_meet4_pre_365_1;
run;

proc freq;
table snf_admit_date_mod snf_disch_date_mod ;
run;

/*save final files to project int_data directory*/
data proj_int.snf_meet_pre_365 ;
set  snf_meet_pre_365;
run;

/*************************************************************/
/*calculate total number of days spent in SNF by BID*/
/*************************************************************/

data pre_snf_days_1;
set proj_int.snf_meet_pre_365;
calc_snf_LOS=disch_date-admit_date;
if calc_snf_LOS=0 then calc_snf_LOS=1;
run;

proc sort data=pre_snf_days_1;
by bene_id index_date admit_date;
run;

proc sql;
create table snf_days_pre as select distinct bene_id,index_year,
sum(calc_snf_LOS)
	as n_snf_days_12m
	from pre_snf_days_1 group by bene_id,index_year;
quit;


/*merge into full ffs 1yr, age 65+ dataset*/
proc sort data=snf_days_pre nodupkey;
by bene_id index_year;
run;



 data snf ;
 set snf_days_pre ;
 array list n_snf_days_12m;
 do over list;
 if list=. then list=0;
 end; 

if n_snf_days_12m=0 then ind_snf_use_12m=0;
 if n_snf_days_12m>0 & n_snf_days_12m~=. then ind_snf_use_12m=1;
 label ind_snf_use_12m="Indicator for any SNF stay 12m pre ivw";
 label n_snf_days_12m="SNF Days 12m pre ivw";

run;


proc freq data=snf; tables n_snf_days_12m / missprint; run;
/****************************************************************************/
/****************************************************************************/
/*Get indicator of ESRD codes from the denominator file the year of the interview*/
/****************************************************************************/
/****************************************************************************/
proc sort data=medi.mbsf_06_16 out=dn_2000_20122  nodupkey;
by bene_id year;
run;

/*pull ESRD status variable from dn file
for the core interview years*/
proc sql;
create table esrd1 as select
a.*,b.Bene_ESRD_IND from 
proj_int.index a left join
dn_2000_20122 b
on trim(left(a.bene_id))=trim(left(b.bene_id))
and a.index_year=b.year;
quit;

proc freq;
table bene_esrd_ind /missprint;
run;

data esrd;
set esrd1 ;
if bene_esrd_ind='Y' then esrd_ind_n=1;
if bene_esrd_ind='0' then esrd_ind_n=0;
label esrd_ind_n="ESRD indicator from claims denominator file";
drop bene_esrd_ind;
run;

proc freq;
table esrd_ind_n /missprint;
run;

/****************************************************************************/
/*Get indicator of Home 02 use 12 months pre interview from DME claims*/
/****************************************************************************/
data oxygen1(keep=bene_id index_year oxygen);
set proj_int.dm_meet_183;
oxygen=0;
if h_o2>0 then oxygen=1;
if oxygen=1;
run;

proc sort data=oxygen1 out=oxygen nodupkey;
by bene_id index_year;
run;
proc contents data=medi.op_09_16; run;
data ed_op_1;
set proj_int.op_meet_183(keep=bene_id admit_date disch_date index_date index_year erdaycnt obs_stay);
if erdaycnt>0 then ed_op=1;
if erdaycnt=0 then ed_op=0;
if obs_stay=. then obs_stay=0;
if obs_stay>1 then obs_stay=1;
run;

proc freq;
table ed_op;
run;

proc sql;
create table ed_op_2 as select distinct bene_id,index_year,
count(case when ed_op=1 then ed_op else . end)
	as n_ed_op_visits_12m,
sum(obs_stay) as n_obs_stay_12m,
max(obs_stay) as obs_stay_12m
	from ed_op_1 group by bene_id,index_year;
quit;




proc sort data=ed_op_2 nodupkey;
by bene_id index_year;
run;


data ed ;
set ed_op_2;
if n_ed_op_visits_12m=. then n_ed_op_visits_12m=0;
label n_ed_op_visits_12m="Count ED OP visits, 1yr pre ivw";

if n_ed_op_visits_12m=0 then ind_ed_op_12m=0;
if n_ed_op_visits_12m>0 & n_ed_op_visits_12m~=. then ind_ed_op_12m=1;
label ind_ed_op_12m="Indicator any ED OP visits, 1 yr pre ivw";

if n_obs_stay_12m=. then n_obs_stay_12m=0;
label n_obs_stay_12m="Number obs stays, 1 yr pre ivw";

if n_obs_stay_12m=. then obs_stay_12m=0;
label obs_stay_12m="Indicator any obs stay, 1 yr pre ivw";
run;

proc freq; tables n_ed_op_visits_12m n_obs_stay_12m /missprint; run;

data hh(keep=bene_id index_year ind_hh_12m);
set proj_int.hh_meet_365;
ind_hh_12m=1;
run;

proc sort data=ip out=ip nodupkey; by bene_id index_year; run;
proc sort data=snf out=snf nodupkey; by bene_id index_year; run;
proc sort data=esrd out=esrd nodupkey; by bene_id index_year; run;
proc sort data=oxygen out=oxygen nodupkey; by bene_id index_year; run;
proc sort data=ed out=ed nodupkey; by bene_id index_year; run;
proc sort data=hh out=hh nodupkey; by bene_id index_year; run;


/*housecalls

housecall codes (from Bruce Kinosian from CMS on 8/16/17) are 99341-99350
and dom care codes are 99324-99328 and 99334-99337

POS codes are 12 13 14

*/

%macro pb_pre (days=,suf=);

proc sql;
create table pb_meet_&days.d_bef as select * from
proj_int.index a
left join medi.pb_09_16 b
on a.bene_id=b.bene_id and admit_date<=index_date<=admit_date+&days;
quit;


data hc;
set pb_meet_&days.d_bef;
array this hcpcscd1-hcpcscd13;
code=0;
do over this;
if in(this,"99324","99325","99326","99327","99328","99334","99335","99336","99337", 
	"99341","99342","99343","99344","99345","99346","99347","99348","99349","99350") and code=0 
	then code=1;
end;
array that pos1-pos13;
place=0;
do over that;
if in(that,"12","13","14") and place=0 then place=1;
end;
housecall=place=1 and code=1;
run;

proc sql; 
create table hc_&suf as select distinct bene_id, index_date,
sum(housecall) as n_housecalls_&suf
from hc
group by bene_id, index_date;
quit;

%mend;

/*housecalls

housecall codes (from Bruce Kinosian from CMS on 8/16/17) are 99341-99350
and dom care codes are 99324-99328 and 99334-99337

POS codes are 12 13 14

*/

%macro pb_post (days=,suf=);

proc sql;
create table pb_meet_&days.d_bef as select * from
proj_int.index a
left join medi.pb_09_16 b
on a.bene_id=b.bene_id and admit_date>=index_date>=admit_date-&days;
quit;


data hc;
set pb_meet_&days.d_bef;
array this hcpcscd1-hcpcscd13;
code=0;
do over this;
if in(this,"99324","99325","99326","99327","99328","99334","99335","99336","99337", 
	"99341","99342","99343","99344","99345","99346","99347","99348","99349","99350") and code=0 
	then code=1;
end;
array that pos1-pos13;
place=0;
do over that;
if in(that,"12","13","14") and place=0 then place=1;
end;
housecall=place=1 and code=1;
run;

proc sql; 
create table hc_&suf as select distinct bene_id, index_date,
sum(housecall) as n_housecalls_&suf
from hc group by bene_id, index_date;
quit;

%mend;

%pb_pre(days=365,suf=n12m);
%pb_pre(days=90,suf=n3m);
%pb_post(days=365,suf=p12m);
%pb_post(days=90,suf=p3m);

proc sql;
create table pb as select * from
proj_int.index a
left join 
hc_n3m b
on a.bene_id=b.bene_id and a.index_date=b.index_date
left join
hc_n12m c
on a.bene_id=c.bene_id and a.index_date=c.index_date
left join 
hc_p3m d
on a.bene_id=d.bene_id and a.index_date=d.index_date
left join
hc_p12m e
on a.bene_id=e.bene_id and a.index_date=e.index_date;
quit;

proc sql;
create table proj_int.utilization_pre as select * 
from proj_int.index a 
left join
ip b
on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_year=b.index_year
left join 
snf c
on trim(left(a.bene_id))=trim(left(c.bene_id)) and a.index_year=c.index_year
left join 
esrd d
on trim(left(a.bene_id))=trim(left(d.bene_id)) and a.index_year=d.index_year
left join
oxygen e
on trim(left(a.bene_id))=trim(left(e.bene_id)) and a.index_year=e.index_year
left join 
ed f
on trim(left(a.bene_id))=trim(left(f.bene_id)) and a.index_year=f.index_year
left join
hh g
on trim(left(a.bene_id))=trim(left(g.bene_id)) and a.index_year=g.index_year
left join 
pb h
on trim(left(a.bene_id))=trim(left(h.bene_id)) and a.index_year=h.index_year;
quit;

proc contents data=proj_int.utilization_pre; 
run;



H="classify serious illness from 6m"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************
*/

/*recoded as a macro and use either the primary diagnosis or admitting diagnoses AD_DGNS */

/*start with IP claim list, 1 year before interview*/

%macro singledx(dxvar=,name=);
data dx_1_&name.;
set proj_int.ip_meet_183;

&name._dx=trim(left(&dxvar.));

if &name._dx~="" then do;

chf_&name._dx=0;
copd_&name._dx=0;
hip_&name._dx=0;
cva_&name._dx=0;

/*CHF*/
if (substr(&name._dx,1,5)='39891' or
		substr(&name._dx,1,5)='40211' or
		substr(&name._dx,1,5)='40291' or
		substr(&name._dx,1,5)='40411' or
		substr(&name._dx,1,5)='40413' or
		substr(&name._dx,1,5)='40491' or
		substr(&name._dx,1,5)='40493' or
		substr(&name._dx,1,3)='428') 
		and chf_&name._dx=0 
		then chf_&name._dx=1;*add one binary variables here.;
		/*ICD10*/
if (substr(&name._dx,1,5)='I0981' 
		or substr(&name._dx,1,4)='I110'
		or substr(&name._dx,1,4)='I130'
		or substr(&name._dx,1,4)='I132'
		or substr(&name._dx,1,4)='I501'
		or substr(&name._dx,1,5)='I5020'
		or substr(&name._dx,1,5)='I5021'
		or substr(&name._dx,1,5)='I5022'
		or substr(&name._dx,1,5)='I5023'
		or substr(&name._dx,1,5)='I5030'
		or substr(&name._dx,1,5)='I5031'
		or substr(&name._dx,1,5)='I5032'
		or substr(&name._dx,1,5)='I5033'
		or substr(&name._dx,1,5)='I5040'
		or substr(&name._dx,1,5)='I5041'
		or substr(&name._dx,1,5)='I5042'
		or substr(&name._dx,1,5)='I5043'
		or substr(&name._dx,1,5)='I5043'
		or substr(&name._dx,1,5)='I50810'
		or substr(&name._dx,1,5)='I50811'
		or substr(&name._dx,1,5)='I50812'
		or substr(&name._dx,1,5)='I50813'
		or substr(&name._dx,1,5)='I50814'
		or substr(&name._dx,1,5)='I5082'
		or substr(&name._dx,1,5)='I5083'
		or substr(&name._dx,1,5)='I5084'
		or substr(&name._dx,1,5)='I5089'
		or substr(&name._dx,1,4)='I509')		
		and chf_&name._dx=0 
				then chf_&name._dx=1;


/*COPD*/
	if (substr(&name._dx,1,3)='490' or
		substr(&name._dx,1,3)='491' or
		substr(&name._dx,1,3)='492' or
		substr(&name._dx,1,4)='4930' or
		substr(&name._dx,1,4)='4931' or
		substr(&name._dx,1,4)='4932' or
		substr(&name._dx,1,4)='4938' or
		substr(&name._dx,1,5)='49390' or
		substr(&name._dx,1,5)='49391' or
		substr(&name._dx,1,3)='494' or
		substr(&name._dx,1,3)='495' or
		substr(&name._dx,1,3)='496' or
		substr(&name._dx,1,3)='497' or
		substr(&name._dx,1,3)='498' or
		substr(&name._dx,1,3)='499' or
		substr(&name._dx,1,3)='500' or
		substr(&name._dx,1,3)='501' or
		substr(&name._dx,1,3)='502' or
		substr(&name._dx,1,3)='503' or
		substr(&name._dx,1,3)='504' or
		substr(&name._dx,1,3)='505' or
		substr(&name._dx,1,4)='5064') 
			and copd_&name._dx=0 
		then copd_&name._dx=1;	
		if (substr(&name._dx,1,3)='J42'
		or substr(&name._dx,1,3)='J60'
		or substr(&name._dx,1,3)='J61'
		or substr(&name._dx,1,3)='J64'
		or substr(&name._dx,1,3)='J65'
		or substr(&name._dx,1,4)='J411'
		or substr(&name._dx,1,4)='J418'
		or substr(&name._dx,1,4)='J430'
		or substr(&name._dx,1,4)='J431'
		or substr(&name._dx,1,4)='J432'
		or substr(&name._dx,1,4)='J438'
		or substr(&name._dx,1,4)='J439'
		or substr(&name._dx,1,4)='J440'
		or substr(&name._dx,1,4)='J441'
		or substr(&name._dx,1,4)='J449'
		or substr(&name._dx,1,4)='J470'
		or substr(&name._dx,1,4)='J471'
		or substr(&name._dx,1,4)='J479'
		or substr(&name._dx,1,4)='J620'
		or substr(&name._dx,1,4)='J628'
		or substr(&name._dx,1,4)='J630'
		or substr(&name._dx,1,4)='J631'
		or substr(&name._dx,1,4)='J632'
		or substr(&name._dx,1,4)='J633'
		or substr(&name._dx,1,4)='J634'
		or substr(&name._dx,1,4)='J635'
		or substr(&name._dx,1,4)='J636'
		or substr(&name._dx,1,4)='J660'
		or substr(&name._dx,1,4)='J661'
		or substr(&name._dx,1,4)='J662'
		or substr(&name._dx,1,4)='J668'
		or substr(&name._dx,1,4)='J670'
		or substr(&name._dx,1,4)='J671'
		or substr(&name._dx,1,4)='J672'
		or substr(&name._dx,1,4)='J673'
		or substr(&name._dx,1,4)='J674'
		or substr(&name._dx,1,4)='J675'
		or substr(&name._dx,1,4)='J676'
		or substr(&name._dx,1,4)='J677'
		or substr(&name._dx,1,4)='J678'
		or substr(&name._dx,1,4)='J679'
		or substr(&name._dx,1,4)='J684'
		or substr(&name._dx,1,4)='J982'
		or substr(&name._dx,1,4)='J983'
		or substr(&name._dx,1,5)='J8410'
		or substr(&name._dx,1,5)='J8417'
		or substr(&name._dx,1,5)='J9600'
		or substr(&name._dx,1,5)='J9601'
		or substr(&name._dx,1,5)='J9602'
		or substr(&name._dx,1,5)='J9610'
		or substr(&name._dx,1,5)='J9611'
		or substr(&name._dx,1,5)='J9612'
		or substr(&name._dx,1,5)='J9620'
		or substr(&name._dx,1,5)='J9621'
		or substr(&name._dx,1,5)='J9622'
		or substr(&name._dx,1,5)='J9690'
		or substr(&name._dx,1,5)='J9691'
		or substr(&name._dx,1,5)='J9692'
		or substr(&name._dx,1,6)='J84112')
				and copd_&name._dx=0 
		then copd_&name._dx=1;


		*hip fracture;
if (substr(&name._dx,1,3)='820' ) 
		and hip_&name._dx=0 
		then hip_&name._dx=1;*add one binary variables here.;
if (substr(&name._dx,1,7)='S72043A'
or substr(&name._dx,1,7)='S72042A'
or substr(&name._dx,1,7)='S72046A'
or substr(&name._dx,1,7)='S72044A'
or substr(&name._dx,1,7)='S72041A'
or substr(&name._dx,1,7)='S72045A'
or substr(&name._dx,1,7)='S72019C'
or substr(&name._dx,1,7)='S72001B'
or substr(&name._dx,1,7)='S72009B'
or substr(&name._dx,1,7)='S72001C'
or substr(&name._dx,1,7)='S72002B'
or substr(&name._dx,1,7)='S72009C'
or substr(&name._dx,1,7)='S72002C'
or substr(&name._dx,1,7)='S72019B'
or substr(&name._dx,1,7)='S7223XB'
or substr(&name._dx,1,7)='S72033C'
or substr(&name._dx,1,7)='S72099A'
or substr(&name._dx,1,7)='S72009A'
or substr(&name._dx,1,7)='S72002A'
or substr(&name._dx,1,7)='S72001A'
or substr(&name._dx,1,7)='S72026B'
or substr(&name._dx,1,7)='S72022C'
or substr(&name._dx,1,7)='S72022B'
or substr(&name._dx,1,7)='S72023B'
or substr(&name._dx,1,7)='S72021C'
or substr(&name._dx,1,7)='S72024C'
or substr(&name._dx,1,7)='S72025B'
or substr(&name._dx,1,7)='S72021B'
or substr(&name._dx,1,7)='S72024B'
or substr(&name._dx,1,7)='S72023C'
or substr(&name._dx,1,7)='S72025C'
or substr(&name._dx,1,7)='S72026C'
or substr(&name._dx,1,7)='S7226XB'
or substr(&name._dx,1,7)='S7226XC'
or substr(&name._dx,1,7)='S72043B'
or substr(&name._dx,1,7)='S72099B'
or substr(&name._dx,1,7)='S72033B'
or substr(&name._dx,1,7)='S72032C'
or substr(&name._dx,1,7)='S72031C'
or substr(&name._dx,1,7)='S72031B'
or substr(&name._dx,1,7)='S72036C'
or substr(&name._dx,1,7)='S72035C'
or substr(&name._dx,1,7)='S72034C'
or substr(&name._dx,1,7)='S72033C'
or substr(&name._dx,1,7)='S72034B'
or substr(&name._dx,1,7)='S72036B'
or substr(&name._dx,1,7)='S72032B'
or substr(&name._dx,1,7)='S72035B'
or substr(&name._dx,1,7)='S7222XA'
or substr(&name._dx,1,7)='S7223XA'
or substr(&name._dx,1,7)='S7224XA'
or substr(&name._dx,1,7)='S7226XA'
or substr(&name._dx,1,7)='S7225XA'
or substr(&name._dx,1,7)='S7221XA'
or substr(&name._dx,1,7)='S72012A'
or substr(&name._dx,1,7)='S72019A'
or substr(&name._dx,1,7)='S72011A'
or substr(&name._dx,1,7)='S7224XC'
or substr(&name._dx,1,7)='S7223XC'
or substr(&name._dx,1,7)='S7222XC'
or substr(&name._dx,1,7)='S7224XB'
or substr(&name._dx,1,7)='S7226XB'
or substr(&name._dx,1,7)='S7226XC'
or substr(&name._dx,1,7)='S7223XB'
or substr(&name._dx,1,7)='S7225XC'
or substr(&name._dx,1,7)='S7221XC'
or substr(&name._dx,1,7)='S7222XB'
or substr(&name._dx,1,7)='S7221XB'
or substr(&name._dx,1,7)='S7225XB'
or substr(&name._dx,1,7)='S72009C'
or substr(&name._dx,1,7)='S72046A'
or substr(&name._dx,1,7)='S7223XC'
or substr(&name._dx,1,7)='S72099C'
or substr(&name._dx,1,7)='S72032A'
or substr(&name._dx,1,7)='S72031A'
or substr(&name._dx,1,7)='S72034A'
or substr(&name._dx,1,7)='S72035A'
or substr(&name._dx,1,7)='S72033A'
or substr(&name._dx,1,7)='S72036A'
or substr(&name._dx,1,7)='S72143B'
or substr(&name._dx,1,7)='S72026B'
or substr(&name._dx,1,7)='S72099A'
or substr(&name._dx,1,7)='S72091A'
or substr(&name._dx,1,7)='S72065A'
or substr(&name._dx,1,7)='S72051A'
or substr(&name._dx,1,7)='S72059A'
or substr(&name._dx,1,7)='S72052A'
or substr(&name._dx,1,7)='S72066A'
or substr(&name._dx,1,7)='S72061A'
or substr(&name._dx,1,7)='S72092A'
or substr(&name._dx,1,7)='S72062A'
or substr(&name._dx,1,7)='S72063A'
or substr(&name._dx,1,7)='S72064A'
or substr(&name._dx,1,7)='S72146A'
or substr(&name._dx,1,7)='S72142A'
or substr(&name._dx,1,7)='S72145A'
or substr(&name._dx,1,7)='S72143A'
or substr(&name._dx,1,7)='S72144A'
or substr(&name._dx,1,7)='S72141A'
or substr(&name._dx,1,7)='S72023A'
or substr(&name._dx,1,7)='S72023C'
or substr(&name._dx,1,7)='S72143A'
or substr(&name._dx,1,7)='S72021A'
or substr(&name._dx,1,7)='S72025A'
or substr(&name._dx,1,7)='S72022A'
or substr(&name._dx,1,7)='S72024A'
or substr(&name._dx,1,7)='S72023A'
or substr(&name._dx,1,7)='S72026A'
or substr(&name._dx,1,7)='S72036B'
or substr(&name._dx,1,7)='S72146C'
or substr(&name._dx,1,7)='S72146A'
or substr(&name._dx,1,7)='S72146B'
or substr(&name._dx,1,7)='S72066C'
or substr(&name._dx,1,7)='S72065C'
or substr(&name._dx,1,7)='S72059B'
or substr(&name._dx,1,7)='S72066B'
or substr(&name._dx,1,7)='S72064C'
or substr(&name._dx,1,7)='S72063C'
or substr(&name._dx,1,7)='S72051C'
or substr(&name._dx,1,7)='S72099B'
or substr(&name._dx,1,7)='S72063B'
or substr(&name._dx,1,7)='S72065B'
or substr(&name._dx,1,7)='S72091C'
or substr(&name._dx,1,7)='S72062C'
or substr(&name._dx,1,7)='S72061C'
or substr(&name._dx,1,7)='S72092B'
or substr(&name._dx,1,7)='S72062B'
or substr(&name._dx,1,7)='S72052B'
or substr(&name._dx,1,7)='S72064B'
or substr(&name._dx,1,7)='S72091B'
or substr(&name._dx,1,7)='S72092C'
or substr(&name._dx,1,7)='S72059C'
or substr(&name._dx,1,7)='S72052C'
or substr(&name._dx,1,7)='S72061B'
or substr(&name._dx,1,7)='S72051B'
or substr(&name._dx,1,7)='S72099C'
or substr(&name._dx,1,7)='S72009A'
or substr(&name._dx,1,7)='S72046B'
or substr(&name._dx,1,7)='S72026A'
or substr(&name._dx,1,7)='S72046C'
or substr(&name._dx,1,7)='S72126C'
or substr(&name._dx,1,7)='S72122B'
or substr(&name._dx,1,7)='S72134C'
or substr(&name._dx,1,7)='S72113B'
or substr(&name._dx,1,7)='S72131B'
or substr(&name._dx,1,7)='S72123C'
or substr(&name._dx,1,7)='S72102C'
or substr(&name._dx,1,7)='S72132C'
or substr(&name._dx,1,7)='S72133B'
or substr(&name._dx,1,7)='S72122C'
or substr(&name._dx,1,7)='S72121B'
or substr(&name._dx,1,7)='S72135B'
or substr(&name._dx,1,7)='S72115B'
or substr(&name._dx,1,7)='S72125C'
or substr(&name._dx,1,7)='S72109B'
or substr(&name._dx,1,7)='S72111C'
or substr(&name._dx,1,7)='S72102B'
or substr(&name._dx,1,7)='S72132B'
or substr(&name._dx,1,7)='S72113C'
or substr(&name._dx,1,7)='S72112B'
or substr(&name._dx,1,7)='S72116B'
or substr(&name._dx,1,7)='S72116C'
or substr(&name._dx,1,7)='S72136C'
or substr(&name._dx,1,7)='S72133C'
or substr(&name._dx,1,7)='S72114C'
or substr(&name._dx,1,7)='S72126B'
or substr(&name._dx,1,7)='S72109C'
or substr(&name._dx,1,7)='S72121C'
or substr(&name._dx,1,7)='S72124B'
or substr(&name._dx,1,7)='S72111B'
or substr(&name._dx,1,7)='S72114B'
or substr(&name._dx,1,7)='S72136B'
or substr(&name._dx,1,7)='S72112C'
or substr(&name._dx,1,7)='S72101B'
or substr(&name._dx,1,7)='S72131C'
or substr(&name._dx,1,7)='S72124C'
or substr(&name._dx,1,7)='S72135C'
or substr(&name._dx,1,7)='S72115C'
or substr(&name._dx,1,7)='S72123B'
or substr(&name._dx,1,7)='S72125B'
or substr(&name._dx,1,7)='S72101C'
or substr(&name._dx,1,7)='S72134B'
or substr(&name._dx,1,7)='S72109A'
or substr(&name._dx,1,7)='S72043C'
or substr(&name._dx,1,7)='S72144C'
or substr(&name._dx,1,7)='S72146B'
or substr(&name._dx,1,7)='S72142C'
or substr(&name._dx,1,7)='S72146C'
or substr(&name._dx,1,7)='S72141C'
or substr(&name._dx,1,7)='S72145C'
or substr(&name._dx,1,7)='S72141B'
or substr(&name._dx,1,7)='S72142B'
or substr(&name._dx,1,7)='S72143B'
or substr(&name._dx,1,7)='S72144B'
or substr(&name._dx,1,7)='S72145B'
or substr(&name._dx,1,7)='S72143C'
or substr(&name._dx,1,7)='S72043A'
or substr(&name._dx,1,7)='S72033A'
or substr(&name._dx,1,7)='S72043B'
or substr(&name._dx,1,7)='S72041B'
or substr(&name._dx,1,7)='S72045B'
or substr(&name._dx,1,7)='S72043C'
or substr(&name._dx,1,7)='S72042B'
or substr(&name._dx,1,7)='S72044B'
or substr(&name._dx,1,7)='S72044C'
or substr(&name._dx,1,7)='S72045C'
or substr(&name._dx,1,7)='S72042C'
or substr(&name._dx,1,7)='S72046C'
or substr(&name._dx,1,7)='S72041C'
or substr(&name._dx,1,7)='S72046B'
or substr(&name._dx,1,7)='S72124A'
or substr(&name._dx,1,7)='S72134A'
or substr(&name._dx,1,7)='S72116A'
or substr(&name._dx,1,7)='S72109A'
or substr(&name._dx,1,7)='S72133A'
or substr(&name._dx,1,7)='S72122A'
or substr(&name._dx,1,7)='S72114A'
or substr(&name._dx,1,7)='S72126A'
or substr(&name._dx,1,7)='S72101A'
or substr(&name._dx,1,7)='S72132A'
or substr(&name._dx,1,7)='S72123A'
or substr(&name._dx,1,7)='S72121A'
or substr(&name._dx,1,7)='S72112A'
or substr(&name._dx,1,7)='S72113A'
or substr(&name._dx,1,7)='S72102A'
or substr(&name._dx,1,7)='S72131A'
or substr(&name._dx,1,7)='S72125A'
or substr(&name._dx,1,7)='S72136A'
or substr(&name._dx,1,7)='S72135A'
or substr(&name._dx,1,7)='S72111A'
or substr(&name._dx,1,7)='S72115A'
or substr(&name._dx,1,7)='S72009B'
or substr(&name._dx,1,7)='S72143C'
or substr(&name._dx,1,7)='S7226XA'
or substr(&name._dx,1,7)='S72036A'
or substr(&name._dx,1,7)='S72036C'
or substr(&name._dx,1,7)='S72012B'
or substr(&name._dx,1,7)='S72011C'
or substr(&name._dx,1,7)='S72011B'
or substr(&name._dx,1,7)='S72019C'
or substr(&name._dx,1,7)='S72019B'
or substr(&name._dx,1,7)='S72012C'
or substr(&name._dx,1,7)='S72033B'
or substr(&name._dx,1,7)='S72109B'
or substr(&name._dx,1,7)='S7223XA'
or substr(&name._dx,1,7)='S72026C'
or substr(&name._dx,1,7)='S72109C'
or substr(&name._dx,1,7)='S72019A'
or substr(&name._dx,1,7)='S72023B'
or substr(&name._dx,1,7)='S72091A'
or substr(&name._dx,1,7)='S72064A'
or substr(&name._dx,1,7)='S72063A'
or substr(&name._dx,1,7)='S72116C'
or substr(&name._dx,1,7)='S72052C'
or substr(&name._dx,1,7)='S72124C'
or substr(&name._dx,1,7)='S72111C'
or substr(&name._dx,1,7)='S7224XA'
or substr(&name._dx,1,7)='S72113C'
or substr(&name._dx,1,7)='S72102A'
or substr(&name._dx,1,7)='S72051B'
or substr(&name._dx,1,7)='S72031A'
or substr(&name._dx,1,7)='S72132B'
or substr(&name._dx,1,7)='S72034A'
or substr(&name._dx,1,7)='S72144B'
or substr(&name._dx,1,7)='S72045C'
or substr(&name._dx,1,7)='S72045A'
or substr(&name._dx,1,7)='S72012C'
or substr(&name._dx,1,7)='S72115C'
or substr(&name._dx,1,7)='S72059A'
or substr(&name._dx,1,7)='S72134B'
or substr(&name._dx,1,7)='S72064C'
or substr(&name._dx,1,7)='S72041B'
or substr(&name._dx,1,7)='S72144C'
or substr(&name._dx,1,7)='S72024C'
or substr(&name._dx,1,7)='S72136A'
or substr(&name._dx,1,7)='S72145C'
or substr(&name._dx,1,7)='S72091B'
or substr(&name._dx,1,7)='S72035C'
or substr(&name._dx,1,7)='S72011B'
or substr(&name._dx,1,7)='S72025C'
or substr(&name._dx,1,7)='S72124B'
or substr(&name._dx,1,7)='S72132A'
or substr(&name._dx,1,7)='S72063B'
or substr(&name._dx,1,7)='S72032A'
or substr(&name._dx,1,7)='S72042C'
or substr(&name._dx,1,7)='S72142A'
or substr(&name._dx,1,7)='S7221XC'
or substr(&name._dx,1,7)='S7224XB'
or substr(&name._dx,1,7)='S72121C'
or substr(&name._dx,1,7)='S72066C'
or substr(&name._dx,1,7)='S72042B'
or substr(&name._dx,1,7)='S7225XB'
or substr(&name._dx,1,7)='S72134A'
or substr(&name._dx,1,7)='S72022A'
or substr(&name._dx,1,7)='S72092A'
or substr(&name._dx,1,7)='S72102B'
or substr(&name._dx,1,7)='S72123B'
or substr(&name._dx,1,7)='S72115A'
or substr(&name._dx,1,7)='S72024B'
or substr(&name._dx,1,7)='S72125B'
or substr(&name._dx,1,7)='S72133C'
or substr(&name._dx,1,7)='S7224XC'
or substr(&name._dx,1,7)='S72133A'
or substr(&name._dx,1,7)='S72065A'
or substr(&name._dx,1,7)='S72125A'
or substr(&name._dx,1,7)='S72032B'
or substr(&name._dx,1,7)='S72133B'
or substr(&name._dx,1,7)='S72092B'
or substr(&name._dx,1,7)='S72042A'
or substr(&name._dx,1,7)='S72025A'
or substr(&name._dx,1,7)='S72114B'
or substr(&name._dx,1,7)='S72059C'
or substr(&name._dx,1,7)='S72011A'
or substr(&name._dx,1,7)='S72125C'
or substr(&name._dx,1,7)='S72002B'
or substr(&name._dx,1,7)='S72122A'
or substr(&name._dx,1,7)='S72112A'
or substr(&name._dx,1,7)='S72145A'
or substr(&name._dx,1,7)='S72101B'
or substr(&name._dx,1,7)='S72001C'
or substr(&name._dx,1,7)='S72052A'
or substr(&name._dx,1,7)='S72126A'
or substr(&name._dx,1,7)='S72116A'
or substr(&name._dx,1,7)='S72061C'
or substr(&name._dx,1,7)='S72062B'
or substr(&name._dx,1,7)='S72051C'
or substr(&name._dx,1,7)='S72101A'
or substr(&name._dx,1,7)='S72024A'
or substr(&name._dx,1,7)='S72135B'
or substr(&name._dx,1,7)='S72126B'
or substr(&name._dx,1,7)='S72123A'
or substr(&name._dx,1,7)='S72064B'
or substr(&name._dx,1,7)='S72066B'
or substr(&name._dx,1,7)='S72045B'
or substr(&name._dx,1,7)='S72032C'
or substr(&name._dx,1,7)='S72124A'
or substr(&name._dx,1,7)='S72132C'
or substr(&name._dx,1,7)='S72121A'
or substr(&name._dx,1,7)='S72113B'
or substr(&name._dx,1,7)='S72022B'
or substr(&name._dx,1,7)='S72021B'
or substr(&name._dx,1,7)='S72031B'
or substr(&name._dx,1,7)='S72012B'
or substr(&name._dx,1,7)='S72145B'
or substr(&name._dx,1,7)='S72044A'
or substr(&name._dx,1,7)='S72035B'
or substr(&name._dx,1,7)='S72111B'
or substr(&name._dx,1,7)='S72001B'
or substr(&name._dx,1,7)='S72144A'
or substr(&name._dx,1,7)='S72136B'
or substr(&name._dx,1,7)='S72002A'
or substr(&name._dx,1,7)='S72034B'
or substr(&name._dx,1,7)='S72113A'
or substr(&name._dx,1,7)='S72126C'
or substr(&name._dx,1,7)='S72115B'
or substr(&name._dx,1,7)='S72041A'
or substr(&name._dx,1,7)='S72131C'
or substr(&name._dx,1,7)='S7222XC'
or substr(&name._dx,1,7)='S72034C'
or substr(&name._dx,1,7)='S72021A'
or substr(&name._dx,1,7)='S72123C'
or substr(&name._dx,1,7)='S72141B'
or substr(&name._dx,1,7)='S72134C'
or substr(&name._dx,1,7)='S72142C'
or substr(&name._dx,1,7)='S72059B'
or substr(&name._dx,1,7)='S72112B'
or substr(&name._dx,1,7)='S72131B'
or substr(&name._dx,1,7)='S72122B'
or substr(&name._dx,1,7)='S7222XA'
or substr(&name._dx,1,7)='S72092C'
or substr(&name._dx,1,7)='S72062A'
or substr(&name._dx,1,7)='S72052B'
or substr(&name._dx,1,7)='S72061B'
or substr(&name._dx,1,7)='S72114A'
or substr(&name._dx,1,7)='S72035A'
or substr(&name._dx,1,7)='S7225XC'
or substr(&name._dx,1,7)='S72066A'
or substr(&name._dx,1,7)='S72031C'
or substr(&name._dx,1,7)='S72041C'
or substr(&name._dx,1,7)='S72116B'
or substr(&name._dx,1,7)='S72135C'
or substr(&name._dx,1,7)='S72062C'
or substr(&name._dx,1,7)='S72002C'
or substr(&name._dx,1,7)='S72025B'
or substr(&name._dx,1,7)='S72111A'
or substr(&name._dx,1,7)='S72121B'
or substr(&name._dx,1,7)='S72136C'
or substr(&name._dx,1,7)='S72044C'
or substr(&name._dx,1,7)='S72122C'
or substr(&name._dx,1,7)='S72141C'
or substr(&name._dx,1,7)='S72102C'
or substr(&name._dx,1,7)='S72063C'
or substr(&name._dx,1,7)='S72022C'
or substr(&name._dx,1,7)='S72021C'
or substr(&name._dx,1,7)='S72135A'
or substr(&name._dx,1,7)='S72012A'
or substr(&name._dx,1,7)='S72101C'
or substr(&name._dx,1,7)='S72112C'
or substr(&name._dx,1,7)='S72142B'
or substr(&name._dx,1,7)='S72114C'
or substr(&name._dx,1,7)='S7221XA'
or substr(&name._dx,1,7)='S7225XA'
or substr(&name._dx,1,7)='S72051A'
or substr(&name._dx,1,7)='S72131A'
or substr(&name._dx,1,7)='S72011C'
or substr(&name._dx,1,7)='S72091C'
or substr(&name._dx,1,7)='S7221XB'
or substr(&name._dx,1,7)='S7222XB'
or substr(&name._dx,1,7)='S72001A'
or substr(&name._dx,1,7)='S72061A'
or substr(&name._dx,1,7)='S72044B')
		and hip_&name._dx=0 
		then hip_&name._dx=1;*add one binary variables here.;


/*stroke--added into list at behest of AAHPM, only at primary according to Amy's ICD-10 code list*/
/*ICD-9*/
if substr(&name._dx,1,3)='430'
or substr(&name._dx,1,3)='431'
or substr(&name._dx,1,5)='43411' 
or substr(&name._dx,1,5)='43491'
or substr(&name._dx,1,3)='436'
or substr(&name._dx,1,5)='99702'
and cva_&name._dx=0 then cva_&name._dx=1;

/*ICD-10*/
if (substr(&name._dx,1,4)='I602'
or substr(&name._dx,1,4)='I604'
or substr(&name._dx,1,4)='I606'
or substr(&name._dx,1,4)='I607'
or substr(&name._dx,1,4)='I608'
or substr(&name._dx,1,4)='I609'
or substr(&name._dx,1,4)='I610'
or substr(&name._dx,1,4)='I611'
or substr(&name._dx,1,4)='I612'
or substr(&name._dx,1,4)='I613'
or substr(&name._dx,1,4)='I614'
or substr(&name._dx,1,4)='I615'
or substr(&name._dx,1,4)='I616'
or substr(&name._dx,1,4)='I618'
or substr(&name._dx,1,4)='I619'
or substr(&name._dx,1,4)='I636'
or substr(&name._dx,1,4)='I638'
or substr(&name._dx,1,4)='I639'
or substr(&name._dx,1,5)='G9731'
or substr(&name._dx,1,5)='G9732'
or substr(&name._dx,1,5)='I6000'
or substr(&name._dx,1,5)='I6001'
or substr(&name._dx,1,5)='I6002'
or substr(&name._dx,1,5)='I6010'
or substr(&name._dx,1,5)='I6011'
or substr(&name._dx,1,5)='I6012'
or substr(&name._dx,1,5)='I6020'
or substr(&name._dx,1,5)='I6021'
or substr(&name._dx,1,5)='I6022'
or substr(&name._dx,1,5)='I6030'
or substr(&name._dx,1,5)='I6031'
or substr(&name._dx,1,5)='I6032'
or substr(&name._dx,1,5)='I6050'
or substr(&name._dx,1,5)='I6051'
or substr(&name._dx,1,5)='I6052'
or substr(&name._dx,1,5)='I6300'
or substr(&name._dx,1,5)='I6302'
or substr(&name._dx,1,5)='I6309'
or substr(&name._dx,1,5)='I6310'
or substr(&name._dx,1,5)='I6312'
or substr(&name._dx,1,5)='I6319'
or substr(&name._dx,1,5)='I6320'
or substr(&name._dx,1,5)='I6322'
or substr(&name._dx,1,5)='I6329'
or substr(&name._dx,1,5)='I6330'
or substr(&name._dx,1,5)='I6339'
or substr(&name._dx,1,5)='I6340'
or substr(&name._dx,1,5)='I6349'
or substr(&name._dx,1,5)='I6350'
or substr(&name._dx,1,5)='I6359'
or substr(&name._dx,1,6)='I63011'
or substr(&name._dx,1,6)='I63012'
or substr(&name._dx,1,6)='I63013'
or substr(&name._dx,1,6)='I63019'
or substr(&name._dx,1,6)='I63031'
or substr(&name._dx,1,6)='I63032'
or substr(&name._dx,1,6)='I63033'
or substr(&name._dx,1,6)='I63039'
or substr(&name._dx,1,6)='I63111'
or substr(&name._dx,1,6)='I63112'
or substr(&name._dx,1,6)='I63113'
or substr(&name._dx,1,6)='I63119'
or substr(&name._dx,1,6)='I63131'
or substr(&name._dx,1,6)='I63132'
or substr(&name._dx,1,6)='I63133'
or substr(&name._dx,1,6)='I63139'
or substr(&name._dx,1,6)='I63211'
or substr(&name._dx,1,6)='I63212'
or substr(&name._dx,1,6)='I63213'
or substr(&name._dx,1,6)='I63219'
or substr(&name._dx,1,6)='I63231'
or substr(&name._dx,1,6)='I63232'
or substr(&name._dx,1,6)='I63233'
or substr(&name._dx,1,6)='I63239'
or substr(&name._dx,1,6)='I63311'
or substr(&name._dx,1,6)='I63312'
or substr(&name._dx,1,6)='I63313'
or substr(&name._dx,1,6)='I63319'
or substr(&name._dx,1,6)='I63321'
or substr(&name._dx,1,6)='I63322'
or substr(&name._dx,1,6)='I63323'
or substr(&name._dx,1,6)='I63329'
or substr(&name._dx,1,6)='I63331'
or substr(&name._dx,1,6)='I63332'
or substr(&name._dx,1,6)='I63333'
or substr(&name._dx,1,6)='I63339'
or substr(&name._dx,1,6)='I63341'
or substr(&name._dx,1,6)='I63342'
or substr(&name._dx,1,6)='I63343'
or substr(&name._dx,1,6)='I63349'
or substr(&name._dx,1,6)='I63411'
or substr(&name._dx,1,6)='I63412'
or substr(&name._dx,1,6)='I63413'
or substr(&name._dx,1,6)='I63419'
or substr(&name._dx,1,6)='I63421'
or substr(&name._dx,1,6)='I63422'
or substr(&name._dx,1,6)='I63423'
or substr(&name._dx,1,6)='I63429'
or substr(&name._dx,1,6)='I63431'
or substr(&name._dx,1,6)='I63432'
or substr(&name._dx,1,6)='I63433'
or substr(&name._dx,1,6)='I63439'
or substr(&name._dx,1,6)='I63441'
or substr(&name._dx,1,6)='I63442'
or substr(&name._dx,1,6)='I63443'
or substr(&name._dx,1,6)='I63449'
or substr(&name._dx,1,6)='I63511'
or substr(&name._dx,1,6)='I63512'
or substr(&name._dx,1,6)='I63513'
or substr(&name._dx,1,6)='I63519'
or substr(&name._dx,1,6)='I63521'
or substr(&name._dx,1,6)='I63522'
or substr(&name._dx,1,6)='I63523'
or substr(&name._dx,1,6)='I63529'
or substr(&name._dx,1,6)='I63531'
or substr(&name._dx,1,6)='I63532'
or substr(&name._dx,1,6)='I63533'
or substr(&name._dx,1,6)='I63539'
or substr(&name._dx,1,6)='I63541'
or substr(&name._dx,1,6)='I63542'
or substr(&name._dx,1,6)='I63543'
or substr(&name._dx,1,6)='I63549'
or substr(&name._dx,1,6)='I97810'
or substr(&name._dx,1,6)='I97811'
or substr(&name._dx,1,6)='I97820'
or substr(&name._dx,1,6)='I97821')
and cva_&name._dx=0 then
cva_&name._dx=1;

end;
run;


proc sql;
create table &name._dx_2 as
select distinct bene_id,index_year,
sum(chf_&name._dx) as chf_&name.,
sum(copd_&name._dx) as copd_&name.,
sum(hip_&name._dx) as hip_&name.,
sum(cva_&name._dx) as cva_&name.
from dx_1_&name.
group by bene_id,index_year;
quit;

/*convert counts of diagnoses for each comorbidity to indicator variables*/ 
data &name._dx_3(keep=bene_id index_year chf_&name._dx copd_&name._dx hip_&name._dx cva_&name._dx);
set &name._dx_2 ;
array list_com chf_&name. copd_&name. hip_&name. cva_&name.;
array list_com_bin chf_&name._dx copd_&name._dx hip_&name._dx cva_&name._dx;

do over list_com;
  list_com_bin=0;

  if list_com>0 then do;
    list_com_bin=1;
   end;

end;

run;

proc freq;
table chf_&name._dx copd_&name._dx hip_&name._dx cva_&name._dx;
run;
%mend;

/*use primary diagnosis code*/
%singledx(dxvar=icd_dgns_cd1,name=pri);
/*use admitting diagnosis code*/
%singledx(dxvar=ADmtg_DGNS_cd,name=adm);

/*merge together*/

proc sql;
create table dx_both as select *
from proj_int.index a 
left join 
pri_dx_3 b 
on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_year=b.index_year
left join
adm_dx_3 c
on trim(left(a.bene_id))=trim(left(c.bene_id)) and a.index_year=c.index_year;
quit;

data dx_both2;
set dx_both;

array list chf_pri_dx copd_pri_dx hip_pri_dx cva_pri_dx chf_adm_dx copd_adm_dx hip_adm_dx cva_adm_dx;
do over list;
	if list = .  then list=0;
end;
label chf_pri_dx="CHF as primary dx from IP claim, 6m pre ivw";
label copd_pri_dx="COPD as primary dx from IP claim, 6m pre ivw";
label hip_pri_dx="Hip fracture as primary dx from IP claim, 6m pre ivw";
label cva_pri_dx="Stroke as primary dx from IP claim, 6m pre ivw";

label chf_adm_dx="CHF as admitting dx from IP claim, 6m pre ivw";
label copd_adm_dx="COPD as admitting dx from IP claim, 6m pre ivw";
label hip_adm_dx="Hip fracture as admitting dx from IP claim, 6m pre ivw";
label cva_adm_dx="Stroke as admitting dx from IP claim, 6m pre ivw";

run;


/*Hip fracture criteria, method  by Covinsky
One of the (2) criteria met:
(1) Subject was admitted to a hospital with admitting diagnosis of “820.xx”.
(2) There is a physician record of “HF procedure” (defined by CPT code of 27230-27248) that is supported by either: 
a. Another physician record within 2 days OR 2
b. Relevant surgery during hospitalization. (Relevant surgery is defined by ICD9 codes 785.5, 790.5, 791.5, 792.5). 
(1) variable hip_adm_dx defined in macro above
(2) HF procedure: carrier claims 	(HCPCS_YR specifies the year of CPT coding used)
					hcpcscd01-hcpcscd13 The level 1 HCPCS code is the CPT code
Then a)from carrier claims or 
     b) from IP claims
	

For item (2) checked inpatient claims variables hcpcscd01-45 but none had any of the CPT codes in the list
Next step, try running with carrier files...
*/

/********************************************************************/
/*Physican record of HF procedure, check IP claims
There are no observations with the HF procedure codes in the IP claims, this method isn't
used in creating the final variable*/
data ip_meet_183;
set proj_int.ip_meet_183;
run;

proc contents data=ip_meet_183;
run;

data testhf;
set ip_meet_183;
if HCPcSCD1~='';
run;

data hfproc_ip;
set ip_meet_183;
hf_proc_ind=0;
array list hcpcscd1-hcpcscd45;
do over list;
if list~='' then do;
	if (list='27230' or
		list='27231' or
		list='27232' or
		list='27233' or
		list='27234' or
		list='27235' or
		list='27236' or
		list='27237' or
		list='27238' or
		list='27239' or
		list='27240' or
		list='27241' or
		list='27242' or
		list='27243' or
		list='27244' or
		list='27245' or
		list='27246' or
		list='27247' or
		list='27248')
		/*and hf_proc_ind=0*/
		then hf_proc_ind=1;
	end;
end;


run;

proc freq; table hf_proc_ind;
run;

/********************************************************************/
/*Physican record of HF procedure, check carrier claims*/
/********************************************************************/

data hfproc_carr;
set proj_int.pb_meet_183;
hf_proc_ind=0;
array list hcpcscd1-hcpcscd13;
do over list;
if list~='' then do;
	if (list='27230' or
		list='27231' or
		list='27232' or
		list='27233' or
		list='27234' or
		list='27235' or
		list='27236' or
		list='27237' or
		list='27238' or
		list='27239' or
		list='27240' or
		list='27241' or
		list='27242' or
		list='27243' or
		list='27244' or
		list='27245' or
		list='27246' or
		list='27247' or
		list='27248')
		/*and hf_proc_ind=0*/
		then hf_proc_ind=1;
	end;
end;

run;

proc freq; table hf_proc_ind;
run;
/********************************************************************/
/*is there also a physican record within 2 days?*/
proc sort data=hfproc_carr; by bene_id admit_date disch_date hf_proc_ind;
run;

data hfproc_carr_2;
set hfproc_carr;
if eof1=0 then
	set hfproc_carr (firstobs=2 keep=admit_date disch_date rename=(admit_date=lead1admit disch_date=lead1disch)) end=eof1;
else do; lead1admit=.;  lead1disch=.; end;
run;

data hfproc_carr_3;
set hfproc_carr_2;
days_next_visit=lead1admit-disch_date;
days_next_disch=lead1disch-disch_date;
if hf_proc_ind=1 and days_next_visit<=2 and days_next_visit~=. & days_next_disch>0 then hf_w_visit_2d=1;
else hf_w_visit_2d=0;
run;

data hfproc_carr_4;
set hfproc_carr_3;
if hf_proc_ind=1;
run;

proc freq data=hfproc_carr_3;
table hf_proc_ind hf_w_visit_2d index_year; run;

/*if have hf CPT code from carrier, but no subsequent carrier claim,
do they have a surgery code from the inpatient claims?*/
data hfproc_carr_5;
set hfproc_carr_4;
if hf_proc_ind=1 and hf_w_visit_2d=0;
run;




/*for b) identify relevant surgeries from IP claims CPT codes and surgery dates*/

/*This section of code for just checking For Surgeries*/
data ip_meet_183;
set proj_int.ip_meet_183;
run;

proc contents data=ip_meet_183;
run;

data proc_long(keep=bene_id CLM_IP_ADMSN_TYPE_CD procedure procedure_date date_imp_yes ADMTG_DGNS_CD icd_dgns_cd1-ICD_DGNS_CD25
	 admit_date disch_date index_year);
set ip_meet_183;
array list ICD_PRCDR_CD1-ICD_PRCDR_CD25;
array date PRCDR_DT1-PRCDR_DT25;
do over list;
if list~="" then do;
	procedure=list;
	if date=0000000 then do;
		procedure_date=admit_date;
		date_imp_yes=1;
		end;
	if date~=0000000 then do;
	procedure_date=datejul(date);
	end;
	output;
end;
end;

format procedure_date date10.;
format admit_date date10.;
format disch_date date10.;

run;

proc freq; table date_imp_yes; run;
/* Identify surgeries that meet the criteria
Indicator variable surgery_meet = 1 if yes, include in sample 
79 surgeries meet the criteria*/
data surgery_meet;
set proc_long;
if length(compress(procedure))>3 then do;

if compress(procedure)+0 in (7855, 7905, 7915, 7925) then surgery_meet=1;

end;
/*only keep observations in work.surgery_meet that meet criteria*/
if surgery_meet then output;

run;
/*End surgery section 1*/

/*who has surgery that meets criteria AND hf CPT code from carrier?*/
proc sql;
create table cpt_and_surg as select a.*,b.admit_date as carr_hf_admit, b.disch_date as carr_hf_disch,
b.hf_proc_ind, b.hf_w_visit_2d from 
surgery_meet a inner join
hfproc_carr_5 b
on trim(left(a.bene_id))=trim(left(b.bene_id));
quit;

data cpt_and_surg_1;
set cpt_and_surg;
format carr_hf_admit carr_hf_disch date9.;
hf_w_surgery=1;
run;

/*now merge in lists to get a list of bid's that meet criteria 1 or 2*/
data cpt_and_surg_2;
set cpt_and_surg_1;
keep bene_id hf_proc_ind hf_w_surgery index_year;
run;

proc sort data=cpt_and_surg_2 nodupkey; by bene_id index_year ; run;

data hfproc_carr_6;
set hfproc_carr_4;
keep bene_id hf_proc_ind hf_w_visit_2d index_year;
if hf_proc_ind=1 and hf_w_visit_2d=1;
run;

proc sort data=hfproc_carr_6 nodupkey; by bene_id  index_year ; run;

*merge the datasets;
data hf_meet;
merge hfproc_carr_6 cpt_and_surg_2 ;
by bene_id index_year;
run;

proc sort data=hf_meet out=hf_meet2 nodupkey; by bene_id  index_year; run;

proc sql;
create table hf_meet3 as select* from
proj_int.index a 
left join 
hf_meet2 b 
on a.bene_id=b.bene_id and a.index_year=b.index_year;
quit;

data hf_meet4;
set hf_meet3;

array list hf_proc_ind hf_w_visit_2d hf_w_surgery ;
do over list;
	if list = .  then list=0;
end;
label hf_w_visit_2d ="HF CPT + Dr visit within 2 days, 6m pre ivw";
label hf_w_surgery ="HF CPT + Surgery, 6m pre ivw";

run;

proc freq; table hf_w_visit_2d hf_w_surgery; run;

/*Another idea is to check IP claims
if CPT code (in fields proj_int-HCPCSCD45 in list then if PRCDRCD1-PRCDRCD25 in list = hip frature = yes*/

/*merge new variables*/

proc sql;
create table proj_int.criteria as select * from
dx_both2 a
left join hf_meet4 b
on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_year=b.index_year;
quit;


H="get spending"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************
*/

/*Add total Medicare payments from claims 1 index_date after interview
and 6m after interview*/

/*Claims files from 2000-2012, claims pulled in previous section
to get just claims that are within 1 index_date of the interview dates
for those interviews were r>65 and ffs medicare 1 yr prior to ivw*/

/**********************************************************/
/**********************************************************/
/*totals from mp file*/
/*Note: variable SSLSSNF from mp claims is N=Skilled nursing facility*/
/*Two totals are calculated - one for skilled nursing facility claims
and one for all other claims in the mp file (inpatient claims)*/
/**********************************************************/
/**********************************************************/

%macro mp(month_n=,days_start=,days_after_core=,source=,equ=,name=);

/*Case 1 - no adjustment needed - claims where entire claim is within the x months after the interview*/
proc sql;
create table &source._meet_post_1 as select *
from proj_int.&source._meet_&days_after_core.p
where &days_start<=disch_date-index_date<=&days_after_core and
&days_start<=admit_date-index_date<=&days_after_core;
quit;

data zz_&source._meet_post_1;
set &source._meet_post_1;
ivw_to_admit=admit_date-index_date;
ivw_to_disch=disch_date-index_date;
run;
proc means; var ivw_to_admit ivw_to_disch; run;

/*Case 2 - adjustment needed because part of stay is in the window but part is after the window has ended
Claims with admission date within start of x months but discharge date is after the x month window*/
proc sql;
create table &source._meet2_post as select *
from proj_int.&source._meet_&days_after_core.p
where disch_date-index_date>&days_after_core and 0<=admit_date-index_date<=&days_after_core;
quit;

data zz_&source._meet2_post;
set &source._meet2_post;
ivw_to_admit=admit_date-index_date;
ivw_to_disch=disch_date-index_date;
run;
proc means; var ivw_to_admit ivw_to_disch; run;


/*identify fraction of claims that span x month period that should be 
attributed to the x month period
by just using the fraction of time that was included in the span*/
data &source._meet3_post;
set &source._meet2_post;
pct_xm=((index_date+&days_after_core)-admit_date)/(disch_date-admit_date);
array list clm_pmt_amt clm_pass_thru_per_diem_amt;
do over list;
if list=. then list=0;
/*scale the partial claims by the time within the x month period*/
list=list*pct_xm;
end;

run;

/*Case 3 - adjustment needed because part of stay is in the window but part is before the window started
Claims with discharge date within start of x months but admit date is before the interview date*/
proc sql;
create table &source._meet4_post as select *
from proj_int.&source._meet_&days_after_core.p
where disch_date-index_date<=&days_after_core and admit_date-index_date<&days_start;
quit;

data zz_&source._meet4_post;
set &source._meet4_post;
ivw_to_admit=admit_date-index_date;
ivw_to_disch=disch_date-index_date;
run;
proc means; var ivw_to_admit ivw_to_disch; run;


data &source._meet5_post;
set &source._meet4_post;
pct_xm=(disch_date-index_date)/(disch_date-admit_date);
array list clm_pmt_amt clm_pass_thru_per_diem_amt;
do over list;
if list=. then list=0;
/*scale the partial claims by the time within the x month period*/
list=list*pct_xm;
end;

run;
/*note-12/5/18, switched to CPI-U for inflation adjustment for all projects
adjust for inflation, Uses CPI for Medical Services from 
BLS website, accessed 5/4/2015*/

/*create table merging both the claims fully in the 2 index_date period 
and those partially in that time
adjust for inflation here also*/
data &source._cost_post;
set &source._meet_post_1 &source._meet3_post &source._meet5_post;
array list clm_pmt_amt clm_pass_thru_per_diem_amt;
do over list;
if list=. then list=0;
end;



if year(admit_date)=2016 then rate=1;
if year(admit_date)=2015 then rate=1.01262;
if year(admit_date)=2014 then rate=1.01382;
if year(admit_date)=2013 then rate=1.03026;
if year(admit_date)=2012 then rate=1.04535;
if year(admit_date)=2011 then rate=1.06699;
if year(admit_date)=2010 then rate=1.10067;
if year(admit_date)=2009 then rate=1.11872;
if year(admit_date)=2008 then rate=1.11474;
if year(admit_date)=2007 then rate=1.15754;
if year(admit_date)=2006 then rate=1.19051;

&source._paid_by_mc=rate*(clm_pmt_amt+clm_pass_thru_per_diem_amt);
run;
*calculates total of mc charges for the claim type by hrs bid;
proc sql;
create table &source._pay_post as select distinct bene_id,index_date,
sum(&source._paid_by_mc) as &source._paid_by_mc 
from &source._cost_post group by bene_id,index_date;
quit;

*merges the totals above with the full interview list;
proc sql;
create table &source._&name._post as select
a.*,coalesce(b.&source._paid_by_mc,0) as &source._paid_by_mc_&name.
from proj_int.index a
left join
 &source._pay_post b
 on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_date=b.index_date;
 quit;

 proc sort data=&source._&name._post ;
 by bene_id index_date;
 run;
%mend;

/*Runs macro to get total for the SNF claims*/
%mp(days_start=0,days_after_core=365,source=snf,equ=,name=12m );
%mp(days_start=0,days_after_core=183,source=snf,equ=,name=6m );
/*Runs macro to get total for the inpatient (not SNF) claims*/
%mp(days_start=0,days_after_core=365,source=ip,equ=~,name=12m );
%mp(days_start=0,days_after_core=183,source=ip,equ=~,name=6m );

/**********************************************************/
/**********************************************************/
/*totals from other claim types*/
/**********************************************************/
/**********************************************************/
/*macro to calculate totals for the claims that are not in medpar files*/
%macro all_other(source=,month_n=,days_start=,days_after_core=);

/*Adjust for inflation*/
data &source._meet2_post;
set proj_int.&source._meet_&days_after_core.p;
/*adjust to 2014 dollars*/

if year(admit_date)=2016 then rate=1;
if year(admit_date)=2015 then rate=1.01262;
if year(admit_date)=2014 then rate=1.01382;
if year(admit_date)=2013 then rate=1.03026;
if year(admit_date)=2012 then rate=1.04535;
if year(admit_date)=2011 then rate=1.06699;
if year(admit_date)=2010 then rate=1.10067;
if year(admit_date)=2009 then rate=1.11872;
if year(admit_date)=2008 then rate=1.11474;
if year(admit_date)=2007 then rate=1.15754;
if year(admit_date)=2006 then rate=1.19051;

&source._paid_by_mc=rate*(clm_pmt_amt);
run;

/*Calculate total mc payments by ID*/
proc sql;
create table &source._pay_post as select distinct bene_id,index_date,
sum(&source._paid_by_mc) as &source._paid_by_mc
from &source._meet2_post group by bene_id,index_date;
quit;

/*merge in mc totals with interview list*/
proc sql;
create table &source.&month_n._post as select
a.*,coalesce(b.&source._paid_by_mc,0) as &source._paid_by_mc&month_n 
from proj_int.index a
left join
 &source._pay_post b
 on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_date=b.index_date;
 quit;

 proc sort data=&source&month_n._post ;
 by bene_id index_date;
 run;
 %mend all_other;

/******************************************************************/
/* Run the macro over the mc claims files for 2 index_dates prior to death*/
/******************************************************************/
 %all_other(source=op,month_n=_12m,days_start=0,days_after_core=365);
  %all_other(source=pb,month_n=_12m,days_start=0,days_after_core=365);
   %all_other(source=hh,month_n=_12m,days_start=0,days_after_core=365);
    %all_other(source=hs,month_n=_12m,days_start=0,days_after_core=365);
     %all_other(source=dm,month_n=_12m,days_start=0,days_after_core=365);

 %all_other(source=op,month_n=_6m,days_start=0,days_after_core=183);
  %all_other(source=pb,month_n=_6m,days_start=0,days_after_core=183);
   %all_other(source=hh,month_n=_6m,days_start=0,days_after_core=183);
    %all_other(source=hs,month_n=_6m,days_start=0,days_after_core=183);
     %all_other(source=dm,month_n=_6m,days_start=0,days_after_core=183);

/******************************************************************/
/* Merge into single file, by id and interview */
/******************************************************************/
*first merge 12m and 6m spending into single dataset;
data proj_int.mc_costs_all;
merge ip_12m_post snf_12m_post hh_12m_post hs_12m_post pb_12m_post op_12m_post dm_12m_post
 ip_6m_post snf_6m_post hh_6m_post hs_6m_post pb_6m_post op_6m_post dm_6m_post;
by bene_id index_date;
run;

proc means data=proj_int.mc_costs_all; run;

H="other outcomes from claims"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************
*/

/*These additional variables are just added to the dataset with the
elixhauser and cc's 1 year preceeding the interview, can add them
later when required to get the 2 year look-back dataset*/

/****************************************************************************/
/*Get indicator of any hospital admission 6 and 12 months pre-core interview*/
/****************************************************************************/

%macro admissions(days=,suffix=);

/*pull list of ip claims from all medpar claims x days pre-interview*/
data ip_meet_&days.;
set proj_int.ip_meet_&days.p;
run;
data ip_&days._2;
set ip_meet_&days.;
type_adm=clm_ip_admsn_type_cd;
if icarecnt=. then icarecnt=0; /*medpar intensive care day count*/
if CRNRYDAY=. then CRNRYDAY=0; /*medpar coronary day count*/
icu_days=icarecnt+CRNRYDAY;
em_urgent_admit=0; /*Urgent , emergent admissions from admission type*/
if type_adm in (1,2) then em_urgent_admit=1;
em_admit=0;
if type_adm=1 then em_admit=1;
urgent_admit=0;
if type_adm=2 then urgent_admit=1;
elect_admit=0;
if type_adm=3 then elect_admit=1;
ind_ed_charge=0; /*ED charges as another indicator of ED use*/
if erdaycnt>0 & erdaycnt~=. then ind_ed_charge=1;
if erdaycnt=0 | erdaycnt=. then ind_ed_charge=0;

/*truncate stays where the admit is more than x days before interview
or discharge is after the interview date so can get accurate LOS*/
if disch_date-index_date>&days. then do;
	disch_date=index_date+&days.;
	admit_trunc=1;
	end;
if admit_date<index_date then do;
	admit_date=index_date;
	admit_trunc=1;	
	end;
adj_los=disch_date-admit_date;
if disch_date-admit_date=0 then adj_los=1;
run;

proc sort data=ip_&days._2;
by bene_id index_year;
run;

proc sql;
create table ip_&days._3 as select distinct bene_id,index_year,
/*total ICU days*/
sum(icu_days) as icu_days_&suffix. label="total icu days &suffix. post ivw",
/*count of IP admissions, all types*/
count(*) as n_ip_admit_&suffix. label="total n of hospital admit &suffix. post ivw",
/*total Hospital LOS*/
sum(adj_los) as n_hospd_&suffix. label="total hospital days &suffix. post ivw",
/*count urgent or emergency admissions*/
count(case when em_urgent_admit=1 then em_urgent_admit else . end) as n_em_urgent_admit_&suffix. 
	label="total n of urgent/emergent hospital admit &suffix. post ivw",
/*count of emergency admissions, from admission type code*/
count(case when em_admit=1 then em_admit else . end) as n_em_admit_&suffix. 
	label="total n of emergent hospital admit &suffix. post ivw",
/*count of urgent admissions, from admission type code*/
count(case when urgent_admit=1 then urgent_admit else . end) as n_urgent_admit_&suffix. 
	label="total n of urgent hospital admit &suffix. post ivw",
/*count of elective admissions, from admission type code*/
count(case when elect_admit=1 then elect_admit else . end) as n_elect_admit_&suffix. 
	label="total n of elective hospital admit &suffix. post ivw",
/*count of admissions with any ED charges*/
count(case when ind_ed_charge=1 then ind_ed_charge else . end) as n_ED_ip_&suffix. 
	label="total n of ED visits with subsequent admit &suffix. post ivw"

 from ip_&days._2 group by bene_id,index_year;
quit;

data ip_&days._4;
set ip_&days._3;
if icu_days_&suffix.>n_hospd_&suffix. then icu_days_&suffix.=n_hospd_&suffix.;
run;

%mend;

%admissions(days=183,suffix=p6m);
%admissions(days=365,suffix=p12m);

data elective_1;
set ip_365_2;
if elect_admit=1;
run;



proc sort data=ip_183_3 nodupkey;
by bene_id index_year;
run;


proc sql;
create table ip_p6m as select a.*,b.icu_days_p6m,
b.n_ip_admit_p6m,b.n_hospd_p6m,b.n_em_urgent_admit_p6m,b.n_em_admit_p6m,
b.n_urgent_admit_p6m,b.n_elect_admit_p6m,b.n_ED_ip_p6m
from proj_int.index a
left join
ip_183_3 b 
on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_year=b.index_year;
quit;

proc sort data=ip_365_3 nodupkey;
by bene_id index_year;
run;

proc sql;
create table ip1 as select a.*,b.icu_days_p12m,
b.n_ip_admit_p12m,b.n_hospd_p12m,b.n_em_urgent_admit_p12m,b.n_em_admit_p12m,
b.n_urgent_admit_p12m,b.n_elect_admit_p12m,b.n_ED_ip_p12m
from ip_p6m a
left join
ip_365_3 b 
on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_year=b.index_year;
quit;

/*Dataset just contains obs with ffs mc 1yr and age 65+
So if missing, set var to 0*/
 data ip ;
 set ip1 ;
 array list icu_days_p6m n_ip_admit_p6m n_hospd_p6m n_em_urgent_admit_p6m 
	n_em_admit_p6m n_urgent_admit_p6m n_elect_admit_p6m n_ED_ip_p6m
	icu_days_p12m n_ip_admit_p12m n_hospd_p12m n_em_urgent_admit_p12m
	n_em_admit_p12m n_urgent_admit_p12m n_elect_admit_p12m n_ED_ip_p12m;
 do over list;
 if list=. then list=0;
 end;

 if n_ip_admit_p6m=0 then ind_hosp_adm_p6m=0;
 if n_ip_admit_p6m>0 & n_ip_admit_p6m~=. then ind_hosp_adm_p6m=1;
 label ind_hosp_adm_p6m="Indicator for any hospital admission 6m post ivw";

 if n_em_urgent_admit_p6m=0 then ind_em_ur_adm_p6m=0;
 if n_em_urgent_admit_p6m>0 & n_em_urgent_admit_p6m~=. then ind_em_ur_adm_p6m=1;
 label ind_em_ur_adm_p6m="Ind any urgent or emergent hospital admission 6m post ivw";

 if n_em_admit_p6m=0 then ind_em_adm_p6m=0;
 if n_em_admit_p6m>0 & n_em_admit_p6m~=. then ind_em_adm_p6m=1;
 label ind_em_adm_p6m="Ind any emergency hospital admission 6m post ivw";

 if n_urgent_admit_p6m=0 then ind_ur_adm_p6m=0;
 if n_urgent_admit_p6m>0 & n_urgent_admit_p6m~=. then ind_ur_adm_p6m=1;
 label ind_ur_adm_p6m="Ind any urgent hospital admission 6m post ivw";

 if n_elect_admit_p6m =0 then ind_elect_adm_p6m=0;
 if n_elect_admit_p6m >0 & n_elect_admit_p6m ~=. then ind_elect_adm_p6m=1;
 label ind_elect_adm_p6m="Ind any elective hospital admission 6m post ivw";

 if (n_ip_admit_p6m - n_elect_admit_p6m)=0 then ind_nonelect_adm_p6m=0;
 if (n_ip_admit_p6m - n_elect_admit_p6m)>0 & n_elect_admit_p6m~=. then ind_nonelect_adm_p6m=1;
 label ind_nonelect_adm_p6m="Ind any non-elective hospital admission 6m post ivw";

 n_nonelect_adm_p6m=(n_ip_admit_p6m - n_elect_admit_p6m);
 label n_nonelect_adm_p6m="total n non-elective ip admit 6m post ivw";

 if n_ED_ip_p6m=0 then ind_ED_adm_p6m=0;
 if n_ED_ip_p6m>0 & n_ED_ip_p6m~=. then ind_ED_adm_p6m=1;
 label ind_ED_adm_p6m="Ind ED use with hospital admission 6m post ivw, from charges";

 if n_ip_admit_p12m=0 then ind_hosp_adm_p12m=0;
 if n_ip_admit_p12m>0 & n_ip_admit_p12m~=. then ind_hosp_adm_p12m=1;
 label ind_hosp_adm_p12m="Indicator for any hospital admission 12m post ivw";

 if n_em_urgent_admit_p12m=0 then ind_em_ur_adm_p12m=0;
 if n_em_urgent_admit_p12m>0 & n_em_urgent_admit_p12m~=. then ind_em_ur_adm_p12m=1;
 label ind_em_ur_adm_p12m="Ind any urgent or emergent hospital admission 12m post ivw";

 if n_em_admit_p12m=0 then ind_em_adm_p12m=0;
 if n_em_admit_p12m>0 & n_em_admit_p12m~=. then ind_em_adm_p12m=1;
 label ind_em_adm_p12m="Ind any emergency hospital admission 12m post ivw";

 if n_urgent_admit_p12m=0 then ind_ur_adm_p12m=0;
 if n_urgent_admit_p12m>0 & n_urgent_admit_p12m~=. then ind_ur_adm_p12m=1;
 label ind_ur_adm_p12m="Ind any urgent hospital admission 12m post ivw";

 if n_elect_admit_p12m =0 then ind_elect_adm_p12m=0;
 if n_elect_admit_p12m >0 & n_elect_admit_p12m ~=. then ind_elect_adm_p12m=1;
 label ind_elect_adm_p12m="Ind any elective hospital admission 12m post ivw";

 if (n_ip_admit_p12m - n_elect_admit_p12m)=0 then ind_nonelect_adm_p12m=0;
 if (n_ip_admit_p12m - n_elect_admit_p12m)>0 & n_elect_admit_p12m~=. then ind_nonelect_adm_p12m=1;
 label ind_nonelect_adm_p12m="Ind any non-elective hospital admission 12m post ivw";

 n_nonelect_adm_p12m=(n_ip_admit_p12m - n_elect_admit_p12m);
 label n_nonelect_adm_p12m="total n non-elective ip admit 12m post ivw";

 if n_ED_ip_p12m=0 then ind_ED_adm_p12m=0;
 if n_ED_ip_p12m>0 & n_ED_ip_p12m~=. then ind_ED_adm_p12m=1;
 label ind_ED_adm_p12m="Ind ED use with hospital admission 12m post ivw, from charges";

run;

 proc freq;
 table icu_days_p6m n_ip_admit_p6m n_hospd_p6m ind_hosp_adm_p6m n_em_urgent_admit_p6m ind_em_ur_adm_p6m 
	ind_em_adm_p6m ind_ur_adm_p6m ind_nonelect_adm_p6m n_nonelect_adm_p6m n_ED_ip_p6m ind_ED_adm_p6m 
	ind_em_adm_p6m*ind_ED_adm_p6m /missprint;
 run;

proc freq;
table icu_days_p12m n_ip_admit_p12m n_hospd_p12m ind_hosp_adm_p12m n_em_urgent_admit_p12m ind_em_ur_adm_p12m
	ind_em_adm_p12m ind_ur_adm_p12m ind_nonelect_adm_p12m n_nonelect_adm_p12m n_ED_ip_p12m ind_ED_adm_p12m 
	ind_em_adm_p12m*ind_ED_adm_p12m /missprint;
run;

/****************************************************************************/
/****************************************************************************/
/*Get SNF days, indicator for 12 months after the interview*/
/****************************************************************************/
/****************************************************************************/

/*pull list of snf claims from all medpar claims 12 months post-interview*/
data snf_meet_365;
set proj_int.snf_meet_365p;
run;

proc sort data=snf_meet_365;
by bene_id admit_date;
run;

data snf_meet_365_1a;
set snf_meet_365;
format admit_date date9. disch_date date9.;
run;

/*3 claim windows are present:
1. SNF stays fully within the 1 year before interview
2. Stays that begin before 1 year pre-core but end within 1 year pre-core
3. Stays that begin within 1 year of core but end after core ivw
4. Stays that begin before 1 year and end after interview, LOS=365!
Get claims that meet 1 *1797*/
proc sql;
create table snf_meet1_aft_365 as select *
from snf_meet_365_1a
where (index_date - admit_date)<365 & (index_date - disch_date)>=0; 
quit;


/*meet time window 2 *152*/
proc sql;
create table snf_meet2_aft_365 as select *
from snf_meet_365_1a
where (index_date - admit_date)>=365 & (index_date - disch_date)>=0; 
quit;

/*For these claims that start > 1 year before core, truncate start date so 
only count LOS days w/i 1 year
create indicator variable that claim start date is truncated*/
data snf_meet2_aft_365_1;
set snf_meet2_aft_365;
admit_date = index_date-365;
snf_admit_date_mod = 1;
label snf_admit_date_mod = "Admit date mod; at 12 mo from ivw date";
run;

proc freq;
table snf_admit_date_mod ;
run;

/*meet time window 3 *135 */
proc sql;
create table snf_meet3_aft_365 as select *
from snf_meet_365_1a
where (index_date - admit_date)<365 & (index_date-disch_date)<0; 
quit;

/*For these claims that end after core, truncate end date so 
only count LOS days 1 year before the core
create indicator variable that claim end date is truncated*/
data snf_meet3_aft_365_1;
set snf_meet3_aft_365;
disch_date = index_date;
snf_disch_date_mod = 1;
label snf_disch_date_mod = "Disch date mod; at ivw date";
run;

proc freq;
table snf_disch_date_mod ;
run;

/*meet 4 , overlap both start and end dates n=7*/
proc sql;
create table snf_meet4_aft_365 as select *
from snf_meet_365_1a
where (index_date - admit_date)>=365 & (index_date - disch_date)<0; 
quit;

/*truncate both start and end dates so just count 1 year pre interview*/
data snf_meet4_aft_365_1;
set snf_meet4_aft_365;
disch_date = index_date;
snf_disch_date_mod = 1;
label snf_disch_date_mod = "Disch date mod; at ivw date";
admit_date = index_date-365;
snf_admit_date_mod = 1;
label snf_admit_date_mod = "Admit date mod; at 12 mo from ivw date";
run;

proc freq;
table snf_disch_date_mod snf_admit_date_mod;
run;


data snf_meet_aft_365;
set snf_meet1_aft_365 snf_meet2_aft_365_1 snf_meet3_aft_365_1 snf_meet4_aft_365_1;
run;

proc freq;
table snf_admit_date_mod snf_disch_date_mod ;
run;

/*save final files to project int_data directory*/
data proj_int.snf_meet_aft_365 ;
set  snf_meet_aft_365;
run;

/*************************************************************/
/*calculate total number of days spent in SNF by BID*/
/*************************************************************/

data aft_snf_days_1;
set proj_int.snf_meet_aft_365;
calc_snf_LOS=disch_date-admit_date;
if calc_snf_LOS=0 then calc_snf_LOS=1;
run;

proc sort data=aft_snf_days_1;
by bene_id index_date admit_date;
run;

proc sql;
create table snf_days_pre as select distinct bene_id,index_year,
sum(calc_snf_LOS)
	as n_snf_days_p12m
	from aft_snf_days_1 group by bene_id,index_year;
quit;


/*merge into full ffs 1yr, age 65+ dataset*/
proc sort data=snf_days_pre nodupkey;
by bene_id index_year;
run;



 data snf ;
 set snf_days_pre ;
 array list n_snf_days_p12m;
 do over list;
 if list=. then list=0;
 end; 

if n_snf_days_p12m=0 then ind_snf_use_p12m=0;
 if n_snf_days_p12m>0 & n_snf_days_p12m~=. then ind_snf_use_p12m=1;
 label ind_snf_use_p12m="Indicator for any SNF stay 12m post ivw";
 label n_snf_days_p12m="SNF Days 12m post ivw";

run;

/****************************************************************************/
/****************************************************************************/
/*Get indicator of ESRD codes from the denominator file the year of the interview*/
/****************************************************************************/
/****************************************************************************/
proc sort data=medi.mbsf_06_16 out=dn_2000_20122  nodupkey;
by bene_id year;
run;

/*pull ESRD status variable from dn file
for the core interview years*/
proc sql;
create table esrd1 as select
a.*,b.Bene_ESRD_IND from 
proj_int.index a left join
dn_2000_20122 b
on trim(left(a.bene_id))=trim(left(b.bene_id))
and a.index_year=b.year;
quit;

proc freq;
table bene_esrd_ind /missprint;
run;

data esrd;
set esrd1 ;
if bene_esrd_ind='Y' then esrd_ind_n=1;
if bene_esrd_ind='0' then esrd_ind_n=0;
label esrd_ind_n="ESRD indicator from claims denominator file";
drop bene_esrd_ind;
run;

proc freq;
table esrd_ind_n /missprint;
run;

/****************************************************************************/
/*Get indicator of Home 02 use 12 months pre interview from DME claims*/
/****************************************************************************/
data oxygen1(keep=bene_id index_year oxygen);
set proj_int.dm_meet_365p;
oxygen=0;
if h_o2>0 then oxygen=1;
run;

proc sort data=oxygen1 out=oxygen nodupkey;
by bene_id index_year;
run;
proc contents data=medi.op_06_16; run;
data ed_op_1;
set proj_int.op_meet_365p(keep=bene_id admit_date disch_date index_date index_year erdaycnt);
if erdaycnt>0 then ed_op=1;
if erdaycnt=0 then ed_op=0;
run;

proc freq;
table ed_op;
run;

proc sql;
create table ed_op_2 as select distinct bene_id,index_year,
count(case when ed_op=1 then ed_op else . end)
	as n_ed_op_visits_p12m
	from ed_op_1 group by bene_id,index_year;
quit;

proc freq;
table n_ed_op_visits_p12m;
run;


proc sort data=ed_op_2 nodupkey;
by bene_id index_year;
run;


data ed ;
set ed_op_2;
if n_ed_op_visits_p12m=. and comorb_1_0_1yr~=. then n_ed_op_visits_p12m=0;
label n_ed_op_visits_p12m="Count ED OP visits, 1yr post ivw";

if n_ed_op_visits_p12m=0 then ind_ed_op_p12m=0;
if n_ed_op_visits_p12m>0 & n_ed_op_visits_p12m~=. then ind_ed_op_p12m=1;
label ind_ed_op_p12m="Indicator any ED OP visits, 1 yr post ivw";
run;

proc freq;
table n_ed_op_visits_p12m*ind_ed_op_p12m;
run;

data ed_op_1;
set proj_int.op_meet_183p(keep=bene_id admit_date disch_date index_date index_year erdaycnt);
if erdaycnt>0 then ed_op=1;
if erdaycnt=0 then ed_op=0;
run;

proc freq;
table ed_op;
run;

proc sql;
create table ed_op_2 as select distinct bene_id,index_year,
count(case when ed_op=1 then ed_op else . end)
	as n_ed_op_visits_p6m
	from ed_op_1 group by bene_id,index_year;
quit;

proc freq;
table n_ed_op_visits_p6m;
run;


proc sort data=ed_op_2 nodupkey;
by bene_id index_year;
run;


data ed_6m ;
set ed_op_2;
if n_ed_op_visits_p6m=. and comorb_1_0_1yr~=. then n_ed_op_visits_p6m=0;
label n_ed_op_visits_p6m="Count ED OP visits, 1yr post ivw";

if n_ed_op_visits_p6m=0 then ind_ed_op_p6m=0;
if n_ed_op_visits_p6m>0 & n_ed_op_visits_p6m~=. then ind_ed_op_p6m=1;
label ind_ed_op_p6m="Indicator any ED OP visits, 1 yr post ivw";
run;



proc sort data=ip out=ip nodupkey; by bene_id index_year; run;
proc sort data=snf out=snf nodupkey; by bene_id index_year; run;
proc sort data=esrd out=esrd nodupkey; by bene_id index_year; run;
proc sort data=oxygen out=oxygen nodupkey; by bene_id index_year; run;
proc sort data=ed out=ed nodupkey; by bene_id index_year; run;
proc sort data=ed_6m out=ed_6m nodupkey; by bene_id index_year; run;


proc sql;
create table proj_int.utilization_post as select * 
from proj_int.index a 
left join
ip b
on trim(left(a.bene_id))=trim(left(b.bene_id)) and a.index_year=b.index_year
left join 
snf c
on trim(left(a.bene_id))=trim(left(c.bene_id)) and a.index_year=c.index_year
left join 
esrd d
on trim(left(a.bene_id))=trim(left(d.bene_id)) and a.index_year=d.index_year
left join
oxygen e
on trim(left(a.bene_id))=trim(left(e.bene_id)) and a.index_year=e.index_year
left join 
ed f
on trim(left(a.bene_id))=trim(left(f.bene_id)) and a.index_year=f.index_year
left join 
ed_6m g
on trim(left(a.bene_id))=trim(left(g.bene_id)) and a.index_year=g.index_year;
quit;

proc contents data=proj_int.utilization_post; 
run;

H="combine with interviews into one dataset"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************
*/
data proj_int.index;
set proj_int.index;
if index_date = . then delete;
run;


data proj_int.index;
set proj_int.index;
if bene_id =" " then delete;
run;


proc sql; 
create table tomerge as select * from
proj_int.index a left join
proj_int.ffs_before b 
on a.bene_id=b.bene_id and a.index_year=b.index_year
left join 
proj_int.ffs_after c
on a.bene_id=c.bene_id and a.index_year=c.index_year
left join 
proj_int.elix_0_6m_2 d
on a.bene_id=d.bene_id and a.index_year=d.index_year
left join 
proj_int.charls_0_6m e
on a.bene_id=e.bene_id and a.index_year=e.index_year
left join
proj_int.dmouth_0_6m f
on a.bene_id=f.bene_id and a.index_year=f.index_year
left join
proj_int.chronic_21_6m3_0 g
on a.bene_id=g.bene_id and a.index_year=g.index_year
left join 
proj_int.utilization_pre h
on a.bene_id=h.bene_id and a.index_year=h.index_year
left join
proj_int.mc_costs_all i
on a.bene_id=i.bene_id and a.index_year=i.index_year
left join 
proj_int.utilization_post j
on a.bene_id=j.bene_id and a.index_year=j.index_year
left join
proj_int.criteria k
on a.bene_id=k.bene_id and a.index_year=k.index_year
left join
proj_int.chronic_21_1yr3_0 l
on a.bene_id=l.bene_id and a.index_year=l.index_year
left join
proj_int.addl_comorb m
on a.bene_id=m.bene_id and a.index_year=m.index_year
left join
proj_int.icd10_smi n
on a.bene_id=n.bene_id and a.index_year=n.index_year
left join
proj_int.ccw o
on a.bene_id=o.bene_id and a.index_year=o.index_year;
quit;

proc sql;
create table proj_int.serious_ill_int_dataset as select * from
proj_int.nhats a 
left join
tomerge b 
on a.spid=b.spid and a.ivw_year=b.index_year;
quit;

proc export data=proj_int.serious_ill_int_dataset outfile="E:\nhats\data\projects\serious_ill\icd910\int_data\serious_ill_int_dataset.dta" 
replace;
run;

H="var clean and check criteria"
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:




**************************************************
*/



/*This section defines the serious medical illness indicators
as well as the additional criteria for serious illness
1. Serious medical illness
2. ADL impairment
3. Self report nursing home residence
4. Urgent or emergent hospitalization 

2 sets of criteria are used:
Criteria A: Either serious medical illness or ADL impairment
Criteria B: Critera A + either nursing home resident or hospitalization*/

option nofmterr;

data proj_int.serious_ill_int_dataset1;
set proj_int.serious_ill_int_dataset;


/*any elixhauser cancer dx*/
if comorb_17_0_6m=1 | comorb_18_0_6m=1 | comorb_19_0_6m=1 then el_cancer_6m=1;
if comorb_17_0_6m=0 & comorb_18_0_6m=0 & comorb_19_0_6m=0 then el_cancer_6m=0;

/*3 or more Elixhauser comorbidities*/
if comorb_all_0_6m>2 then el_ge3_comorb_6m=1;
if 0=<comorb_all_0_6m<=2 then el_ge3_comorb_6m=0;

/*4 or more comorbidities - needs to be reevaluated once other defs are defined!*/
if comorb_all_0_6m>3 then el_ge4_comorb_6m=1;
if 0=<comorb_all_0_6m<=3 then el_ge4_comorb_6m=0;

cc_all_count_6m = cc_1_ami_6m + cc_2_alzh_6m + cc_3_alzhdmta_6m + 
cc_4_atrialfb_6m + cc_5_cataract_6m + cc_6_chrnkidn_6m + 
cc_7_copd_6m + cc_8_chf_6m + cc_9_diabetes_6m + cc_10_glaucoma_6m + 
cc_11_hipfrac_6m + cc_12_ischmcht_6m + cc_13_depressn_6m + 
cc_14_osteoprs_6m + cc_15_ra_oa_6m + cc_16_strketia_6m + 
cc_17_cncrbrst_6m + cc_18_cncrclrc_6m + cc_19_cncrprst_6m + 
cc_20_cncrlung_6m + cc_21_cncrendm_6m;

if cc_all_count_6m >3 then cc_ge4_comorb_6m=1;
if 0=<cc_all_count_6m <=3 then cc_ge4_comorb_6m=0;

/*cc's excluding cataract and glaucoma*/
cc_all_count_6m_2 = cc_1_ami_6m + cc_2_alzh_6m + cc_3_alzhdmta_6m + 
cc_4_atrialfb_6m + /*cc_5_cataract_6m +*/ cc_6_chrnkidn_6m + 
cc_7_copd_6m + cc_8_chf_6m + cc_9_diabetes_6m + /*cc_10_glaucoma_6m +*/ 
cc_11_hipfrac_6m + cc_12_ischmcht_6m + cc_13_depressn_6m + 
cc_14_osteoprs_6m + cc_15_ra_oa_6m + cc_16_strketia_6m + 
cc_17_cncrbrst_6m + cc_18_cncrclrc_6m + cc_19_cncrprst_6m + 
cc_20_cncrlung_6m + cc_21_cncrendm_6m;
label cc_all_count_6m_2="Count of cc's, excludes cataract and glaucoma";

if cc_all_count_6m_2>3 then cc2_ge4_comorb_6m=1;
if 0=<cc_all_count_6m_2<=3 then cc2_ge4_comorb_6m=0;

label el_ge3_comorb_6m="3+ Elixhauser comorbidities";
label el_ge4_comorb_6m="4+ Elixhauser comorbidities";
label cc_ge4_comorb_6m="4+ DW Chronic Conditions";
label cc2_ge4_comorb_6m="4+ DW Chronic Conditions, excl cataract and glaucoma";

/***************************************************/
/*create indicators for any indication of the serious medical illnesses across
variables (cc's elix hrs survey) */
/*dementia requires more than 1 dementia diagnosis 1 year before ivw*/
if dem_dx_6m>=2 and dem_dx_6m~=. then smi_dem_ind=1;
if dem_dx_6m=0 or dem_dx_6m=1 then smi_dem_ind=0;
label smi_dem_ind="Indicator of Dementia 6m, Elixhauser 2+dx req.";

/*old def commented out
if el_cancer_6m=1 | CC_cncr_chronic_6m=1 | cancer_hrs=1 then cancer_any_ind=1;
if el_cancer_6m=0 & CC_cncr_chronic_6m=0 & cancer_hrs=0 then cancer_any_ind=0; */
/*cancer flagged as serious medical illness if metastatic cancer 
or blood cancers new def to be provided from Amy*/
if comorb_18_0_6m=1 | cancer_icd10=1 then smi_cancer_ind=1;
if comorb_18_0_6m=0 & smi_cancer_ind~=1 then smi_cancer_ind=0;
label smi_cancer_ind="Indicator of Metastatic Cancer 6m";

/*ESRD from either dx code per elixhauser or denominator file flag*/
if comorb_13_0_6m=1 | esrd_icd10=1 | esrd_ind_n=1 then smi_esrd_ind=1;
if comorb_13_0_6m=0 & esrd_ind_n=0  & smi_esrd_ind~=1 then smi_esrd_ind=0;
label smi_esrd_ind="Indicator of ESRD 6m, Elix and claims DN file";

/*chf, use dx list for Elixhauser, but as primary DX from a hospitalization only*/
if chf_pri_dx=1  then smi_chf_ind=1;
if chf_pri_dx=0  then smi_chf_ind=0;
if chf_icd10=1 and oxygen=1 then smi_chf_ind=1;
label smi_chf_ind="Indicator of CHF 6m, Primary dx from IP claim or O2 and ICD-10 claim";

/*COPD indicator meets following criteria:
1. COPD from Elix (any dx field) and Oxygen use from DME claims or
2. COPD as a primary diagnosis from a hospitalization*/
if ((comorb_9_0_6m=1 | copd_icd10=1) & oxygen=1) | copd_pri_dx=1 then smi_copd_ind=1;
if (comorb_9_0_6m=0 | oxygen=0) & copd_pri_dx=0 & smi_copd_ind~=1 then smi_copd_ind=0;
label smi_copd_ind="Indicator of COPD 6m, copd any dx and home o2 use or copd as prim dx";

/*diabetes, Elix 11 (diabetes with complications) if criteria for 
renal disease (comorb 34), ischemic heart disease (cc 12) or 
peripheral vascular disease (comorb 5) are present*/
if comorb_11_0_6m=1 & (comorb_5_0_6m=1 | comorb_34_0_6m=1 | CC_12_ISCHMCHT_6m =1) then
	smi_diab_compl_ind=1;
if comorb_11_0_6m=0 | (comorb_5_0_6m=0 & comorb_34_0_6m=0 & CC_12_ISCHMCHT_6m =0) 
	and smi_diab_compl_ind~=1 then
	smi_diab_compl_ind=0;
if diabetes_icd10=1 & (renal_icd10=1 | cad_icd10=1 | pvd_icd10=1) and smi_diab_compl_ind~=1 then 
	smi_diab_compl_ind=1;
label smi_diab_compl_ind="Elix compl diabetes + peripheral vas, renal or ischem, 6m";

if comorb_14_0_6m=1 | liver_icd10=1 then smi_liver_ind=1;
if comorb_14_0_6m=0 and smi_liver_ind~=1 then smi_liver_ind=0;
label smi_liver_ind="Indicator of Advanced liver disease/cirrhosis 6m, elix";

/*Update 6/9/14 - HIV not included in final list of serious medical illnesses for
the criteria definition
4/2/15 - Added HIV back into list*/
if comorb_16_0_6m=1 | hiv_icd10=1 then smi_hiv_ind=1;
if comorb_16_0_6m=0 & smi_hiv_ind~=1 then smi_hiv_ind=0;
label smi_hiv_ind="Indicator of HIV with and AIDS defining illness 6m, elix";

/*Update 2/1/19- Including codes Huntington's & other neurodegenerative disease in for ICD-9*/
if comorb_33_0_6m=1 | neurodeg=1 | als_icd10=1 then smi_neurodeg_ind=1;
if  smi_neurodeg_ind~=1 then smi_neurodeg_ind=0;
label smi_neurodeg_ind="Indicator of neurodegenerative disease, 6m";

/*hip fracture, either admitting diagnosis or CPT from carrier claim AND
surgery or follow up carrier claim within 2 days*/
if hip_adm_dx=1 | hf_w_visit_2d=1 | hf_w_surgery=1 then smi_hip_ind=1;
if hip_adm_dx=0 & hf_w_visit_2d=0 & hf_w_surgery=0 then smi_hip_ind=0;
if hip_icd10=1 & age>=70 then smi_hip_ind=1;
label smi_hip_ind="Indicator of Hip fracture 6m, any ICD10, or adm dx or from physician claims";

if cva_adm_dx=1 | cva_pri_dx=1 then smi_cva_ind=1;
if smi_cva_ind~=1 then smi_cva_ind=0;
label smi_cva_ind="Indicator of stroke primary or admitting diagnosis, 6m"
/*******************************************************************/
/*******************************************************************/

/*doesn't use the cc definition excluding cataract,glaucoma cc2_ge4_comorb_6m */
if el_ge4_comorb_6m=1 | cc_ge4_comorb_6m=1 /*| comor_c_hrs=1*/ then multi_any_ind=1;
if el_ge4_comorb_6m=0 & cc_ge4_comorb_6m=0 /*& comor_c_hrs=0*/ then multi_any_ind=0;
label multi_any_ind="Any indicator of Multimorbidity 4+ chronic conditions 6m";

/*total number of serious medical illnesses per these definitions*/
smi_count=smi_dem_ind + smi_cancer_ind + smi_esrd_ind + smi_chf_ind + smi_copd_ind + 
 smi_diab_compl_ind + smi_liver_ind + smi_hiv_ind + smi_neurodeg_ind + smi_hip_ind + smi_cva_ind;

/*indicator for 3+serious medical illnesses*/
if smi_count>=3 then smi_ge3_ind=1;
if smi_count<3 then smi_ge3_ind=0;
label smi_ge3_ind="3 or more serious medical illnesses";

/*indicator for any serious medical illness
Update 6/9/14 - HIV not included in list of serious medical illnesses*/
if smi_dem_ind =1 | smi_cancer_ind =1 | smi_esrd_ind =1 | smi_chf_ind =1 | 
 smi_copd_ind =1 | smi_diab_compl_ind =1 | smi_liver_ind =1 | smi_hiv_ind =1 | 
 smi_neurodeg_ind =1 | smi_hip_ind=1 | smi_cva_ind=1
 then ser_med_illness=1;
if smi_dem_ind =0 & smi_cancer_ind =0 & smi_esrd_ind =0 & smi_chf_ind =0 & 
 smi_copd_ind =0 & smi_diab_compl_ind =0 & smi_liver_ind =0 & smi_hiv_ind =0 & 
 smi_neurodeg_ind =0 & smi_hip_ind=0 & ser_med_illness~=1
 then ser_med_illness=0;
label ser_med_illness="Any indicator of serious medical illness 6m";

/*Indicator for any SNF stays 12m prior to interview or current nh res
Update 6/2/14 - nursing home use will be included only if current nh residence reported,
not if any SNF claims found*/
if /*ind_snf_use_6m=1 |*/ nhres=1 then smi_nh_ind=1;
if /*ind_snf_use_6m=0 &*/ nhres=0 then smi_nh_ind=0;
label smi_nh_ind="Nursing home resident self report in ivw";

/*indicator for adl helper*/
*if adl_helper_count>0 & adl_helper_count~=. then smi_helper_ind=1;
*if adl_helper_count=0 then smi_helper_ind=0;
*label smi_helper_ind="Indicator of having any helpers with ADL, core";

/*backfill adl status if adl helper variable is complete*/
adl_ind = adl_independent;
*if adl_independent=. and smi_helper_ind=1 then adl_ind_core_n=0;
*if adl_independent=. and smi_helper_ind=0 then adl_ind_core_n=1;
label adl_ind = "ADL independent at interview";

if adl_ind=1 then adl_impair = 0;
if adl_ind=0 then adl_impair = 1;
label adl_impair = "ADL impairment at core interview";

/*indicator for any ED visit, either OP or IP*/
ind_ed_op_6m=0;
if ind_ed_op_6m=1 | ind_ED_adm_6m=1 then ind_ed_op_or_ip_6m=1;
if ind_ed_op_6m=0 & ind_ED_adm_6m=0 then ind_ed_op_or_ip_6m=0;
label ind_ed_op_or_ip_6m="Indicator any ED use 6m pre ivw";

/*criteria (A) serious medical illness and/or ADL impairment*/
if (ser_med_illness=1 | adl_impair=1) then criteria_a=1;
if criteria_a~=1 then criteria_a=0;
label criteria_a="Crit A SMI and/or ADL impair";

/*indicator for serious medical illness and ADL impairment*/
if (ser_med_illness=1 & adl_impair=1) then smi_and_adl=1;
if (ser_med_illness=0 | adl_impair=0) then smi_and_adl=0;
label smi_and_adl="SMI and ADL impairment";

/*criteria (B) serious medical illness and/or ADL impairment AND nh res or urgent/emergent hosp*/
if (ser_med_illness=1 | adl_impair=1) & (ind_em_ur_adm_6m=1 | smi_nh_ind=1) then criteria_b=1;
if (ser_med_illness=0 & adl_impair=0) | (ind_em_ur_adm_6m=0 & smi_nh_ind=0) then criteria_b=0;
label criteria_b="Crit B SMI or ADL impair and hospital admit or nh use";

/*criteria (C) serious medical illness and adl impairment AND nh res or urgent/emergent hosp*/
if (ser_med_illness=1 & adl_impair=1) & (ind_em_ur_adm_6m=1 | smi_nh_ind=1) then criteria_c=1;
if (ser_med_illness=0 | adl_impair=0) | (ind_em_ur_adm_6m=0 & smi_nh_ind=0) then criteria_c=0;
label criteria_c="Crit C SMI and ADL impair and hospital admit or nh use";

/*serious medical illness criteria variable defined, so name matches format of other criteria indicators*/
criteria_smi=ser_med_illness;
label criteria_smi="Comparison criteria - SMI";

run;

/*export full dataset to Stata*/


proc export data=proj_int.serious_ill_int_dataset1
outfile="E:\nhats\data\projects\serious_ill\icd910\int_data\serious_ill_int_dataset1.dta" replace;
run;

H="dataset cleaning and sample derivation"
/*

Created by: EBL
Date Created: 2/7/19

Updated by: EBL
Date Updated: 2/22/19


**************************************************
*/

local date = subinstr("$S_DATE"," ","_",.) 
local name @INSERTNAME_`date'
di "`name'"



clear all 
set more off
capture log close

local intpath "${intpath}"
local datapath "${datapath}"
local logpath "${logpath}"



****************************************************



cd `datapath'
log using `logpath'\sample_derivation.txt, text replace


use `intpath'\serious_ill_int_dataset1.dta, clear
//2/20/19-EBL-merge with final clean dataset because the notes are dropped in SAS
merge 1:1 spid wave using  "E:\nhats\data\NHATS cleaned\sp_round_1_7.dta", ///
keep(match) nogen

*****************************************
//variable cleaning and construction
*****************************************
foreach x of varlist adl*help {
replace `x'=. if sp_ivw_==0
replace adl_independent=0 if `x'==1
replace adl_impair=1 if `x'==1
}
//set comorb/serill to zero if missing (because no entry in the pb file)
foreach x of varlist comorb* cc* smi* {
	replace `x'=0 if `x'==. & cont_ffs_n_mos>=12
}


replace el_ge3=comorb_all>3 if !missing(comorb_all)
replace adl_impair=1 if nhres==1

/*update 7/24/17--include neurodeg and cva*/
/*update 2/1/19--neurodeg replace ALS to be more comparable with ICD-10
*rename neurodeg smi_neurodeg_ind 

replace smi_count=smi_dem_ind + smi_cancer_ind + smi_esrd_ind + smi_chf_ind + ///
smi_copd_ind + smi_diab_compl_ind + smi_liver_ind + smi_hiv_ind + smi_als_ind + smi_hip_ind ///
+ smi_neurodeg + smi_cva*/
replace ser_med_illness=smi_count>0 if missing(ser_med_illness) & !missing(smi_count)
replace criteria_a=smi_count>0 if !missing(smi_count) & missing(criteria_a)
replace criteria_a=1 if adl_impair==1
replace criteria_b=criteria_a==1 & (ind_em_ur_adm_6m==1 | smi_nh_ind==1) if missing(criteria_b)
replace criteria_c=ser_med_illness==1 & adl_impair==1 & (ind_em_ur_adm_6m==1 | ///
smi_nh_ind==1) if missing(criteria_c)


gen criteria_all=1
gen criteria_none=criteria_a==0

foreach time in 6 12 {
	gen tot_paid_by_mc_`time'm=0 
	//3/7/19-added op/pb combo for final jpsm submission
	egen pbop_paid_by_mc_`time'm=rowtotal(pb_paid_by_mc_`time'm op_paid_by_mc_`time'm)
	notes pbop_paid_by_mc_`time'm : clm_pmt_amt from pb & op files.
	notes pbop_paid_by_mc_`time'm : combination of pb + op exp for `time' yr
	notes tot_paid_by_mc_`time'm : E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison, ///
	get spending and dataset cleaning headers
	label var pbop_paid_by_mc_`time'm "PB & OP expenditures `time' months post ivw"
	foreach x in ip snf hh hs pb op dm {
		replace tot_paid_by_mc_`time'm=tot_paid_by_mc_`time'm+`x'_paid_by_mc_`time'm
}
	notes tot_paid_by_mc_`time'm : clm_pmt_amt from all claims. clm_pass_thru_per_diem_amt ///
	 from IP claims. 
	notes tot_paid_by_mc_`time'm : Total Medicare expenditures excluding Part D
	notes tot_paid_by_mc_`time'm : E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison, ///
	get spending and dataset cleaning headers
	
	

	gen mult_ip_adm_p`time'm=n_ip_admit_p`time'm>1 if !missing(n_ip_admit_p`time'm)
	notes mult_ip_adm_p`time'm : admit_date from IP file
	notes mult_ip_adm_p`time'm : Multiple hospital admissions within `time' months post interview
	notes mult_ip_adm_p`time'm : E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison, ///
	other outcomes from claims and dataset cleaning headers
	foreach x of varlist *_op_* *icu_* {
		replace `x'=0 if missing(`x')
}

	gen n_ed_vis_p`time'm=n_ed_op_visits_p`time'm+n_ed_ip_p`time'm
	notes n_ed_vis_p`time'm : admit_date and rev_center from OP and IP files
	notes n_ed_vis_p`time'm : Number of ED visits, whether leading to admission or not
	notes n_ed_vis_p`time'm : E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison, ///
	other outcomes and dataset cleaning headers
	gen ind_ed_vis_p`time'm=n_ed_vis_p`time'm>0 if !missing(n_ed_vis_p`time'm)
	gen mult_ed_vis_p`time'm=n_ed_vis_p`time'm>1 if !missing(n_ed_vis_p`time'm)
	gen ind_icu_p`time'm=icu_days_p`time'm>0 if !missing(icu_days_p`time'm)
	notes ind_icu_p`time'm : admit_date and rev_center from IP file
	notes ind_icu_p`time'm : Any ICU visit within `time' months post interview
	notes ind_icu_p`time'm : E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison, ///
	other outcomes and dataset cleaning headers	
	gen ind_hs_p`time'm=hs_paid_by_mc_`time'm!=0 if !missing(hs_paid_by_mc_`time'm)
	notes ind_hs_p`time'm : admit_date disch_date from HS file
	notes ind_hs_p`time'm : Any hospice use within `time' months post interview
	notes ind_hs_p`time'm : E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison, ///
	other outcomes and dataset cleaning headers	
}

drop /*smi_neuro*/ smi_nh smi_ge3
drop smi_count
egen smi_count=rowtotal(smi_*ind)
replace smi_count=0 if missing(smi_count)
notes smi_count : various claims and survey-variables
notes smi_count : Count of SMIs (SMCs in current parlance)
notes smi_count : E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison
notes smi_count : "_"
notes smi_count : Kelley, et al. (Identifying Serious Illness, 2015, HSR), ///
Kelley, Bollens-Lund. (Serious Illness: the Denominator Problem, 2018, JPM)

replace criteria_a=1 if smi_count>=1
rename smi_esrd* smi_renal*


svyset varunit [pw=anfinwgt], strata(varstrat)

gen died_6=died_12==1 & mofd(death_date)<=mofd(ivw_date)+6
notes died_6 : r`i'spstatdtmt, r`i'spstatdtyr, previously configured death date ///
from various death date variables from NHATS and CMS data
notes died_6 : Death within 6 months of interview
notes died_6 : E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison, ///
dataset cleaning header

gen m2d=(death_date -ivw_date)/30.4
replace m2d=0 if m2d<0
gen m2dec=12-ivw_month+1
replace m2dec=6 if wave==4
replace m2d=m2dec if m2dec<m2d

notes m2d : previously configured death dates and interview dates
notes m2d : Months of follow up (death or calendar)
notes m2d :  E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison, ///
dataset cleaning header

notes m2dec : previously configured interview dates
notes m2dec : Months of follow up (calendar only)
notes m2dec :  E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison, ///
dataset cleaning header

foreach x in m2d m2dec {
	replace `x'=6 if `x'>6
	gen ind_trunc_`x'=`x'<6
}
replace ind_trunc_m2d=1 if died_6==1

notes ind_trunc_m2d : previously configured death dates and interview dates
notes ind_trunc_m2d : Less than 6 months of follow up (death or calendar)
notes ind_trunc_m2d :  E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison, ///
dataset cleaning header

notes ind_trunc_m2dec : previously configured interview dates
notes ind_trunc_m2dec : Less than 6 months of follow up (calendar only)
notes ind_trunc_m2dec :  E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison, ///
dataset cleaning header


label var m2d "Mean months follow-up, truncated for calendar or death"
label var m2dec "Mean months of follow-up, truncated for calendar only"
label var ind_trunc_m2d "% Indicator <6m follow-up, truncated for calendar or death"
label var ind_trunc_m2dec "% Indicator <6m follow-up, truncated for calendar only"

sort spid wave
by spid (wave): carryforward aveincome, replace

local income
forvalues i=1/4 {
	gen income`i'=income_quart==`i'
	local lab : label income_quart `i'
	label var income`i' "Income Quartile: `lab'"
	local income `income' income`i'
	notes income`i' : aveincome
	notes income`i' : Income quartile indicator.  Note that income only asked at ///
	odd-numbered waves, so carried-forward from wave 3 for our 2014 cohort and 5 ///
	for the 2016 cohort
	notes income`i' : E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison, ///
	dataset cleaning header
}



drop comorb_all_0_6m

egen comorb_all_0_6m=rowtotal(comorb_1_0_6m-comorb_31_0_6m)
label var comorb_all "Count of Elix comorbidities (includes dementia)"

gen comorb_ge3_0_6m=comorb_all>=3 if !missing(comorb_all)
label var comorb_ge3 "3+ Elixhauser comorbidities"

notes comorb_all_0_6m : icd_dgns_cd* from all Medicare files
notes comorb_all_0_6m : Elixhauser comorbidity count (codes modified from ///
original Elixhauser for SMI projects)
notes comorb_all_0_6m : E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison
notes comorb_all_0_6m : "_"
notes comorb_all_0_6m : Elixhauser, et al. 1998. Comorbidity Measures for Use with Administrative Data. ///
Medical Care 36(1):8-27

notes comorb_ge3_0_6m : icd_dgns_cd* from all Medicare files
notes comorb_ge3_0_6m : Elixhauser comorbidity count is >=3
notes comorb_ge3_0_6m :  E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison
notes comorb_ge3_0_6m : "_"
notes comorb_ge3_0_6m : Elixhauser, et al. 1998. Comorbidity Measures for Use with Administrative Data. ///
Medical Care 36(1):8-27

label var ip_paid_by_mc_6m "IP expenditures 6m post"
label var op_paid_by_mc_6m "OP expenditures 6m post"
label var pb_paid_by_mc_6m "PB expenditures 6m post"
label var hh_paid_by_mc_6m "HH expenditures 6m post"
label var hs_paid_by_mc_6m "HS expenditures 6m post"
label var snf_paid_by_mc_6m "SNF expenditures 6m post"
label var dm_paid_by_mc_6m "DM expenditures 6m post"
label var tot_paid_by_mc_6m "Total MC expenditures 6m post"
label var ind_icu_p6m "Any ICU 6m post"
label var ind_hs_p6m "Any hospice 6m post"
label var mult_ip_adm_p6m ">1 hospital admission 6m post"
label var smi_neurodeg_ind "Neurodegenerative disorder, 6m"
label var smi_renal_ind "Advanced kidney disease"
label var educ_hs_ind "High school"

label var died_6 "Died w/in 6m"


gen ind_smi_any=smi_count>=1
label var ind_smi_any "Any SMI"


notes ind_smi_any : various claims and survey-variables
notes ind_smi_any : At least one SMI (SMC in current parlance)
notes ind_smi_any : E:\nhats_code\serious_ill\ICD9_10_serious_ill_comparison
notes ind_smi_any : "_"
notes ind_smi_any : Kelley, et al. (Identifying Serious Illness, 2015, HSR), ///
Kelley, Bollens-Lund. (Serious Illness: the Denominator Problem, 2018, JPM)


*****************************************
//sample derivation
*****************************************
gen wave46=inlist(wave,4,6)
gen ffs_6m=cont_ffs_n_mos>=6 if !missing(cont_ffs_n_mos)
gen ab_6m=part_ab_n_mos>=6
gen hmo_6m=non_hmo_d_n_mos>=6
gen nolml=!lml
label var ab_6m "6m AB Medicare before ivw"
label var hmo_6m "6m w/o HMO before ivw"
label var wave46 "Wave 4 or 6 Interview"
label var ffs_6m "6m continuous FFS before ivw"
label var sp_ivw_yes "Completed SP interview"
label var nolml "Not LML interview"
*local samplevars wave1 sp_ivw_yes ab_6m hmo_6m ffs_6m 
local samplevars sp_ivw_yes nolml wave46 ab_6m hmo_6m ffs_6m 
save serious_ill_nhats_1_6_full_6m.dta, replace

preserve
local rn : word count `samplevars'
local r=1
local c=1
mat samp=J(`rn',2,.)

foreach x in `samplevars' {
	keep if `x'==1
	sum `x'
	mat samp[`r',`c']=r(N)
	local r=`r'+1
}

mat rownames samp=`samplevars'

frmttable, statmat(samp) ctitles("" "N") title("Sample Derivation") sdec(0) ///
varlabels



///new thing--keep only vars going to use (for codebook's sake)
keep spid bene_id age anfinwgt varstrat varunit m2dec m2d ind_trunc_m2dec ind_trunc_m2d female white black ///
hisp other_race married educ_hs_ind `income' proxy medicaid medigap srh_fp ///
adl_eat_help adl_bath_help adl_toil_help adl_dres_help adl_ins_help adl_bed_help ///
adl_independent nhres comorb_*_0_6m smi*ind ind_hosp_adm_*6m mult_ip_adm_p6m ind_ed_op_p6m  ///
ind_icu_p6m ind_hs_p6m died_6 ip_paid_by_mc_6m snf_paid_by_mc_6m hh_paid_by_mc_6m ///
 hs_paid_by_mc_6m pb_paid_by_mc_6m op_paid_by_mc_6m pbop_paid_by_mc_6m ///
 dm_paid_by_mc_6m tot_paid_by_mc_6m n_hospd_p6m wave cont_ffs* criteria_a ///
 criteria_b criteria_c smi_count ind_smi_any
 
 
save serious_ill_nhats_sample, replace
restore



H="Codebook"
capture log close
clear all
set more off
version 15


//filepath globals should be set in the first NoteTab header, or you can change these below
local logpath $logpath
local datapath $datapath
local outpath $outpath

//date
local date = subinstr("$S_DATE"," ","_",.)


cd "`logpath'"

// load dataset here

//date
local date = subinstr("$S_DATE"," ","_",.)


cd "`logpath'"

log using "`logpath'\data_dictionary`date'.txt", text replace //slightly easier than saving as SCML and then PDF

// load dataset here


//set filename 
local filename serious_ill_nhats_sample



// specify excel data dictionary file/filepath here
local wkbk `logpath'\icd_9_10_data_dictionary`date'.xlsx  // put excel data dictionary file/filepath here


assert "`filename'"!=""
use "`datapath'/`filename'", clear


if "`wkbk'" == "" {
display as text "Warning: Excel file specification not found"
} 
else {
display "Excel File: `wkbk'"
}

// generates variables that will contain the information
local dispvars varname varlabel vallabelname vallabel note_1 note_2 note_3 note_4 note_5 type format ///
mean sd min p25 p50 p75 max distinct_values n_observations n_missing 




foreach x of local dispvars {
	gen `x'=""
}

//gets word count so don't include them in the final output
local excl_count : word count `dispvars'
order `dispvars'

label variable varname			"Variable Name"
label variable varlabel			"Variable Label"
label variable vallabelname		"Value Label Name"
label variable vallabel			"Value Labels"

/*these can be anything, but I think this may address what we need: raw vars, plain language, and code location
  all must be included in prior code, shouldn't be done within this template*/
label variable note_1			"Raw variables used in creation" 
label variable note_2 			"Plain English of what the variable is"
label variable note_3			"Location of code where variable was created" 
label variable note_4 			"Dates of creation, alteration"
label variable note_5			"Reference"
label variable type				"Type (String, Numeric or Date)"
label variable format			"Stata Display Format"
label variable mean 			"Mean Value for numeric variables"			
label variable sd 				"Std. Dev. for numeric variables"			
label variable min				"Minimum Value for numeric variables"
label variable p25				"25th percentile for numeric variables"
label variable p50				"Median Value for numeric variables"
label variable p75				"75th percentile for numeric variables"
label variable max				"Maximum Value for numeric variables"
label variable n_observations 	"Total number of observations"
label variable distinct_values	"Number of distinct values"
label variable n_missing		"Number missing"

local i = 1



foreach v of var * {



	
if "`: var label `v''" == "" {

label variable `v' "No label"              // overwrites varlabel local if label is too long or not desired for output

}


replace varname			= "`v'" in `i'
replace varlabel		= "`: var label `v''" in `i'
replace vallabelname	= "`: val label `v''" in `i'
replace format			= "`: format `v''" in `i'
replace note_1			= "`: char `v'[note1]'" in `i'
replace note_2			= "`: char `v'[note2]'" in `i'
replace note_3			= "`: char `v'[note3]'" in `i'
replace note_4			= "`: char `v'[note4]'" in `i'
replace note_5			= "`: char `v'[note5]'" in `i'
local vallabeltest = "`: val label `v''" in `i'
if "`vallabeltest'" != "" {

local val_label ""

levelsof `v', local(levels)
foreach l of local levels {
local lab :label (`v') `l'
local val_label "`val_label' `l',  `lab'|"

}

replace vallabel = "`val_label'" in `i'

}




ds `v' , has(type string)

if "`r(varlist)'" == "`v'" {

replace type = "String" in `i'

} 

ds `v' , has(type numeric)

if "`r(varlist)'" == "`v'" {

replace type = "Numeric" in `i'

}

ds `v' , has(varl *date* *Date*)

if "`r(varlist)'" == "`v'" {

replace type = "Date" in `i'

}


if inlist("`: format `v''" , "%dM_d,_CY", "%tCMonth_dd,_CCYY_HH:MM", "%tm", "%td", "%tmmcY") {

replace type = "Date" in `i'

} 


sum `v' , d
foreach x in mean sd min p25 p50 p75 max {
	local `x' : di %-12.5gc `r(`x')'
	replace `x' = "``x''" in `i'
}

gen n=1
sum n if missing(`v')
replace n_missing="`r(N)'" in `i'
sum n
replace n_observations="`r(N)'" in `i'
drop n

// section creates fills in idicator var based off of start of var label 
// 		- project specific and would need to add indicator variable generate statement and
//		add var to keep statement 
// local varlabel : var label `v'
// display "`varlabel'"

// if (strpos("`: var label `v''", "RCAP") == 1) {
//             replace redcap = "yes" in `i'
//         }
// 	else {
// 	replace redcap = "no" in `i'
// 	}

*levelsof `v' , clean	
*local countlevel : word count `r(levels)'

egen tag`v'=tag(`v')
count if tag`v'
replace distinct_values = "`r(N)'" in `i'
	
	


local ++ i
}


// remove min/ max of numeric identifiers here
replace min = "" if varname == "study_id"  
replace max = "" if varname == "study_id"

// removes min/max of date variables, were numeric, considering taking the time 
// to replace them with the display format, currently time is not available

replace min = "" if type == "Date"
replace max = "" if type == "Date"

// for string vars, distinct values not as important (also would need to be calculated differently)

replace distinct_values = "" if type != "Numeric"


drop if varname == ""



keep `dispvars'
keep if _n>`excl_count'
if "`wkbk'" == "" {
display as text "Excel file specification Required"
exit
} 
else {
display "Excel File: `wkbk'"
}
assert "`wkbk'" != ""  // redundant check


//1/4/19--ebl--put in quotes, since My Documents filepath (where I dumped it) has spaces
export excel using "`wkbk'" , firstrow(varlabels) replace 


log close
exit




H="**********************************"


H="Comparison tables, ICD-9 and ICD-10"
/*

Created by: EBL
Date Created: 2/7/19

Updated by: EBL
Date Updated: 3/7/19


**************************************************
*/

local date = subinstr("$S_DATE"," ","_",.) 
local name @INSERTNAME_`date'
di "`name'"



clear all 
set more off
capture log close

local intpath "${intpath}"
local datapath "${datapath}"
local logpath "${logpath}"



****************************************************


cd `datapath'
*log using `logpath'\table1_xwave.txt, text replace

local date=subinstr("$S_DATE"," ","_",.)

use serious_ill_nhats_sample, clear
svyset varunit [pw=anfinwgt], strata(varstrat)

local income
forvalues i=1/4 {
	local income `income' income`i'
}

local cvars1 age m2dec m2d
local cvars2 
local ivars1 ind_trunc_m2dec ind_trunc_m2d female white black hisp other_race married educ_hs_ind
local ivars2 `income' proxy  ///
medicaid medigap srh_fp adl_eat_help adl_bath_help adl_toil_help adl_dres_help ///
adl_ins_help adl_bed_help adl_independent nhres 

local comorbs 
forvalues i=1/31 {
	local comorbs `comorbs' comorb_`i'_0_6m
}

local comorbs `comorbs' comorb_ge3_0_6m

local smi 
foreach x of varlist smi*ind {
	local smi `smi' `x'
}


local ioutcomes ind_hosp_adm_p6m mult_ip_adm_p6m ind_ed_op_p6m  ///
ind_icu_p6m ind_hs_p6m died_6

local coutcomes ip_paid_by_mc_6m snf_paid_by_mc_6m hh_paid_by_mc_6m ///
 hs_paid_by_mc_6m pb_paid_by_mc_6m op_paid_by_mc_6m pbop_paid_by_mc_6m ///
 dm_paid_by_mc_6m tot_paid_by_mc_6m n_hospd_p6m
 

gen n=1
label var n "Population Estimate"



local vars  `cvars1' `cvars2' `ivars1' `ivars2'

local rnvars : word count `vars'
local rndx : word count `comorbs' `smi'
local rnout : word count `ioutcomes' `coutcomes'

mat tab=J(`rnvars'+3,3,.)
mat stars=J(`rnvars'+3,3,0)
local r=1
local c=1

foreach w in 4 6 {
	forvalues time=1/2 {
		foreach x of local cvars`time' {	
			sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1 [aw=anfinwgt]
			mat tab[`r',`c']=r(mean)
			if "`w'"=="6" {
				svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1): mean `x', over(wave)
				test [`x']4=[`x']6
				mat tab[`r',3]=r(p)
				mat stars[`r',3]=(r(p)<.05)+(r(p)<.01)
}
			local r=`r'+1
}
		foreach x of local ivars`time' {
			sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1 [aw=anfinwgt]
			mat tab[`r',`c']=r(mean)*100
			if "`w'"=="6" {
				svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1): tab `x' wave
				mat tab[`r',3]=e(p_Pear)
				mat stars[`r',3]=(e(p_Pear)<.01)+(e(p_Pear)<.05)
}
			local r=`r'+1
}
}
		sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1  [aw=anfinwgt]
		mat tab[`r',`c']=r(N)
		mat tab[`r'+1,`c']=r(sum_w)
		local nume=r(sum_w)
		sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) [aw=anfinwgt]
		mat tab[`r'+2,`c']=`nume'/r(sum_w)*100
		local r=1
		local c=`c'+1
}

mat rownames tab=`vars' N n
frmttable using `logpath'\comparison_icd9_icd10_tables`date'.rtf, statmat(tab) title("Identifying Serious Illness in ICD-9 and ICD-10" \ ///
"Sample characteristics, NHATS 2014 & 2016") ctitles("" "2014" "2016" "P-value") ///
annotate(stars) asymbol(*,**) replace varlabels ///
note("6+ months of FFS Medicare prior to interview and 1+ SMI")



local smi ind_smi_any `smi'

foreach y in smi comorbs {
local rn : word count ``y''
mat tab=J(`rn'+2,3,.)
mat stars=J(`rn'+2,3,0)
local r=1
local c=1

foreach w in 4 6 {
	foreach x in ``y'' {
			sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1 [aw=anfinwgt]
		mat tab[`r',`c']=r(mean)*100
		if "`w'"=="6" {
			svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1): tab `x' wave
			mat tab[`r',3]=e(p_Pear)
			mat stars[`r',3]=(e(p_Pear)<.01)+(e(p_Pear)<.05)
}
		local r=`r'+1
}
		sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1  [aw=anfinwgt]
		mat tab[`r',`c']=r(N)
		mat tab[`r'+1,`c']=r(sum_w)
		local r=1
		local c=`c'+1
}

mat rownames tab=``y'' N n
if "`y'"=="smi" local title "Serious Medical Illnesses"
else local title "Elixhauser Comorbidities"

frmttable using `logpath'\comparison_icd9_icd10_tables`date'.rtf, statmat(tab) title("Identifying Serious Illness in ICD-9 and ICD-10" \ ///
"`title'") ctitles("" "2014" "2016" "P-value") ///
annotate(stars) asymbol(*,**) addtable varlabels ///
note("6+ months of FFS Medicare prior to interview and 1+ SMI" \ ///
"Elixhauser codes modified for renal and liver diseases, and dementia is added" \ ///
"Additional neurodegenerative diseases included with ALS in ICD-10 only")



}

//2/5/19--also looking at stroke, despite tiny sample size
local smi ind_smi_any smi_dem_ind smi_cancer_ind smi_renal_ind smi_copd_ind ///
smi_diab_compl_ind smi_cva_ind

foreach smivar of local smi {


	local rncout : word count `coutcomes'
	mat tab=J(`rnout'+`rncout'+2,3,.)
	mat stars=J(`rnout'+`rncout'+2,3,0)
	local r=1
	local c=1

	foreach w in 4 6 {
			foreach x of local coutcomes {	
				sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & `smivar'==1 [aw=anfinwgt],d
				mat tab[`r',`c']=r(mean)
				mat tab[`r'+1,`c']=r(p50)
				if "`w'"=="6" {
					svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & `smivar'==1): mean `x', over(wave)
					test [`x']4=[`x']6
					mat tab[`r',3]=r(p)
					mat stars[`r',3]=(r(p)<.05)+(r(p)<.01)
}
				local r=`r'+2
}
			foreach x of local ioutcomes {
				sum `x' if wave==`w'  & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & `smivar'==1  [aw=anfinwgt],d
				mat tab[`r',`c']=r(mean)*100
				if "`w'"=="6" {
					svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & `smivar'==1): tab `x' wave
					mat tab[`r',3]=e(p_Pear)
					mat stars[`r',3]=(e(p_Pear)<.01)+(e(p_Pear)<.05)
}
				local r=`r'+1
}
			sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & `smivar'==1 [aw=anfinwgt]
			mat tab[`r',`c']=r(N)
			mat tab[`r'+1,`c']=r(sum_w)
			local r=1
			local c=`c'+1
}


	local rnames
	foreach x in `coutcomes' {
	local rnames `rnames' `x' Median
}
	mat rownames tab=`rnames' `ioutcomes' N n
	frmttable using `logpath'\comparison_icd9_icd10_tables`date'.rtf, ///
	statmat(tab) title("Identifying Serious Illness in ICD-9 and ICD-10" \ ///
	"Six-month outcomes, `smivar'=1") ctitles("" "2014" "2016" "P-value") ///
	annotate(stars) asymbol(*,**) addtable varlabels ///
	note("6+ months of FFS Medicare prior to interview and 1+ SMI" \ ///
	"Less than 6 full months of follow-up for 42% of sample in 2016" \ ///
	"Expenditures have been inflation adjusted to 2016 dollars")

}


H="Comparison tables, shareable"
/*

Created by: EBL
Date Created: 2/11/19

Updated by: EBL
Date Updated: 3/7/19


**************************************************
*/

local date = subinstr("$S_DATE"," ","_",.) 
local name @INSERTNAME_`date'
di "`name'"



clear all 
set more off
capture log close

local intpath "${intpath}"
local datapath "${datapath}"
local logpath "${logpath}"



****************************************************


cd `datapath'
*log using `logpath'\table1_xwave.txt, text replace

local date=subinstr("$S_DATE"," ","_",.)

use serious_ill_nhats_sample, clear
svyset varunit [pw=anfinwgt], strata(varstrat)

local income
forvalues i=1/4 {
	local income `income' income`i'
}

local cvars1 age m2dec m2d
local cvars2 
local ivars1 ind_trunc_m2dec ind_trunc_m2d female white black hisp other_race married educ_hs_ind
local ivars2 `income' proxy  ///
medicaid medigap srh_fp adl_eat_help adl_bath_help adl_toil_help adl_dres_help ///
adl_ins_help adl_bed_help adl_independent nhres 

local comorbs 
forvalues i=1/31 {
	local comorbs `comorbs' comorb_`i'_0_6m
}

local comorbs `comorbs' comorb_ge3_0_6m

local smi 
foreach x of varlist smi*ind {
	local smi `smi' `x'
}


local ioutcomes ind_hosp_adm_p6m mult_ip_adm_p6m ind_ed_op_p6m  ///
ind_icu_p6m ind_hs_p6m died_6

local coutcomes ip_paid_by_mc_6m snf_paid_by_mc_6m hh_paid_by_mc_6m ///
 hs_paid_by_mc_6m pb_paid_by_mc_6m op_paid_by_mc_6m pbop_paid_by_mc_6m ///
 dm_paid_by_mc_6m tot_paid_by_mc_6m n_hospd_p6m
 

gen n=1
label var n "Population Estimate"



local vars  `cvars1' `cvars2' `ivars1' `ivars2'

local rnvars : word count `vars'
local rndx : word count `comorbs' `smi'
local rnout : word count `ioutcomes' `coutcomes'

mat tab=J(`rnvars'+3,3,.)
mat stars=J(`rnvars'+3,3,0)
local r=1
local c=1

foreach w in 4 6 {
	forvalues time=1/2 {
		foreach x of local cvars`time' {	
			sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1 [aw=anfinwgt]
			mat tab[`r',`c']=r(mean)
			if "`w'"=="6" {
				svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1): mean `x', over(wave)
				test [`x']4=[`x']6
				mat tab[`r',3]=r(p)
				mat stars[`r',3]=(r(p)<.05)+(r(p)<.01)
}
			local r=`r'+1
}
		foreach x of local ivars`time' {
			sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1 [aw=anfinwgt]
			if (r(mean)*r(N)>=11 | r(mean)*r(N)==0) & ((1-r(mean))*r(N)>=11 | (1-r(mean))*r(N)==0) ///
			mat tab[`r',`c']=r(mean)*100
			if "`w'"=="6" {
				svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1): tab `x' wave
				mat tab[`r',3]=e(p_Pear)
				mat stars[`r',3]=(e(p_Pear)<.01)+(e(p_Pear)<.05)
}
			local r=`r'+1
}
}
		sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1  [aw=anfinwgt]
		mat tab[`r',`c']=r(N)
		mat tab[`r'+1,`c']=r(sum_w)
		local nume=r(sum_w)
		sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) [aw=anfinwgt]
		mat tab[`r'+2,`c']=`nume'/r(sum_w)*100
		local r=1
		local c=`c'+1
}

mat rownames tab=`vars' N n
frmttable using `logpath'\comparison_icd9_icd10_tables`date'_shareable.rtf, statmat(tab) title("Identifying Serious Illness in ICD-9 and ICD-10" \ ///
"Sample characteristics, NHATS 2014 & 2016") ctitles("" "2014" "2016" "P-value") ///
annotate(stars) asymbol(*,**) replace varlabels ///
note("6+ months of FFS Medicare prior to interview and 1+ SMI")



local smi ind_smi_any `smi'

foreach y in smi comorbs {
local rn : word count ``y''
mat tab=J(`rn'+2,3,.)
mat stars=J(`rn'+2,3,0)
local r=1
local c=1

foreach w in 4 6 {
	foreach x in ``y'' {
			sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1 [aw=anfinwgt]
			if (r(mean)*r(N)>=11 | r(mean)*r(N)==0) & ((1-r(mean))*r(N)>=11 | (1-r(mean))*r(N)==0) ///
		mat tab[`r',`c']=r(mean)*100
		if "`w'"=="6" {
			svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1): tab `x' wave
			mat tab[`r',3]=e(p_Pear)
			mat stars[`r',3]=(e(p_Pear)<.01)+(e(p_Pear)<.05)
}
		local r=`r'+1
}
		sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & smi_count>=1  [aw=anfinwgt]
		mat tab[`r',`c']=r(N)
		mat tab[`r'+1,`c']=r(sum_w)
		local r=1
		local c=`c'+1
}

mat rownames tab=``y'' N n
if "`y'"=="smi" local title "Serious Medical Illnesses"
else local title "Elixhauser Comorbidities"

frmttable using `logpath'\comparison_icd9_icd10_tables`date'_shareable.rtf, statmat(tab) title("Identifying Serious Illness in ICD-9 and ICD-10" \ ///
"`title'") ctitles("" "2014" "2016" "P-value") ///
annotate(stars) asymbol(*,**) addtable varlabels ///
note("6+ months of FFS Medicare prior to interview and 1+ SMI" \ ///
"Elixhauser codes modified for renal and liver diseases, and dementia is added" \ ///
"Additional neurodegenerative diseases included with ALS in ICD-10 only")



}

//2/5/19--also looking at stroke, despite tiny sample size
local smi ind_smi_any smi_dem_ind smi_cancer_ind smi_renal_ind smi_copd_ind ///
smi_diab_compl_ind smi_cva_ind

foreach smivar of local smi {


	local rncout : word count `coutcomes'
	mat tab=J(`rnout'+`rncout'+2,3,.)
	mat stars=J(`rnout'+`rncout'+2,3,0)
	local r=1
	local c=1

	foreach w in 4 6 {
			foreach x of local coutcomes {	
				sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & `smivar'==1 [aw=anfinwgt],d
				mat tab[`r',`c']=r(mean)
				mat tab[`r'+1,`c']=r(p50)
				if "`w'"=="6" {
					svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & `smivar'==1): mean `x', over(wave)
					test [`x']4=[`x']6
					mat tab[`r',3]=r(p)
					mat stars[`r',3]=(r(p)<.05)+(r(p)<.01)
}
				local r=`r'+2
}
			foreach x of local ioutcomes {
				sum `x' if wave==`w'  & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & `smivar'==1  [aw=anfinwgt],d
				if (r(mean)*r(N)>=11 | r(mean)*r(N)==0) & ((1-r(mean))*r(N)>=11 | (1-r(mean))*r(N)==0) ///
				mat tab[`r',`c']=r(mean)*100
				if "`w'"=="6" {
					svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & `smivar'==1): tab `x' wave
					mat tab[`r',3]=e(p_Pear)
					mat stars[`r',3]=(e(p_Pear)<.01)+(e(p_Pear)<.05)
}
				local r=`r'+1
}
			sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & `smivar'==1 [aw=anfinwgt]
			mat tab[`r',`c']=r(N)
			mat tab[`r'+1,`c']=r(sum_w)
			local r=1
			local c=`c'+1
}


	local rnames
	foreach x in `coutcomes' {
	local rnames `rnames' `x' Median
}
	mat rownames tab=`rnames' `ioutcomes' N n
	frmttable using `logpath'\comparison_icd9_icd10_tables`date'_shareable.rtf, ///
	statmat(tab) title("Identifying Serious Illness in ICD-9 and ICD-10" \ ///
	"Six-month outcomes, `smivar'=1") ctitles("" "2014" "2016" "P-value") ///
	annotate(stars) asymbol(*,**) addtable varlabels ///
	note("6+ months of FFS Medicare prior to interview and 1+ SMI" \ ///
	"Less than 6 full months of follow-up for 42% of sample in 2016" \ ///
	"Expenditures have been inflation adjusted to 2016 dollars")

}


H="Comparison tables, restricted to hospital admission"
/*

Created by: EBL
Date Created: 2/7/19

Updated by: EBL
Date Updated: 3/7/19


**************************************************
*/

local date = subinstr("$S_DATE"," ","_",.) 
local name @INSERTNAME_`date'
di "`name'"



clear all 
set more off
capture log close

local intpath "${intpath}"
local datapath "${datapath}"
local logpath "${logpath}"



****************************************************


cd `datapath'
*log using `logpath'\table1_xwave.txt, text replace

local date=subinstr("$S_DATE"," ","_",.)

use serious_ill_nhats_sample, clear
svyset varunit [pw=anfinwgt], strata(varstrat)

local income
forvalues i=1/4 {
	local income `income' income`i'
}

local cvars1 age m2dec m2d
local cvars2 
local ivars1 ind_trunc_m2dec ind_trunc_m2d female white black hisp other_race married educ_hs_ind
local ivars2 `income' proxy  ///
medicaid medigap srh_fp adl_eat_help adl_bath_help adl_toil_help adl_dres_help ///
adl_ins_help adl_bed_help adl_independent nhres ind_hosp_adm_6m

local comorbs 
forvalues i=1/31 {
	local comorbs `comorbs' comorb_`i'_0_6m
}

local comorbs `comorbs' comorb_ge3_0_6m

local smi 
foreach x of varlist smi*ind {
	local smi `smi' `x'
}


local ioutcomes ind_hosp_adm_p6m mult_ip_adm_p6m ind_ed_op_p6m  ///
ind_icu_p6m ind_hs_p6m died_6

local coutcomes ip_paid_by_mc_6m snf_paid_by_mc_6m hh_paid_by_mc_6m ///
 hs_paid_by_mc_6m pb_paid_by_mc_6m op_paid_by_mc_6m pbop_paid_by_mc_6m ///
 dm_paid_by_mc_6m tot_paid_by_mc_6m n_hospd_p6m
 

gen n=1
label var n "Population Estimate"



local vars  `cvars1' `cvars2' `ivars1' `ivars2'

local rnvars : word count `vars'
local rndx : word count `comorbs' `smi'
local rnout : word count `ioutcomes' `coutcomes'

mat tab=J(`rnvars'+3,3,.)
mat stars=J(`rnvars'+3,3,0)
local r=1
local c=1

foreach w in 4 6 {
	forvalues time=1/2 {
		foreach x of local cvars`time' {	
			sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_p6m==1 & smi_count>=1 [aw=anfinwgt]
			mat tab[`r',`c']=r(mean)
			if "`w'"=="6" {
				svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_p6m==1 & smi_count>=1): mean `x', over(wave)
				test [`x']4=[`x']6
				mat tab[`r',3]=r(p)
				mat stars[`r',3]=(r(p)<.05)+(r(p)<.01)
}
			local r=`r'+1
}
		foreach x of local ivars`time' {
			sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_p6m==1 & smi_count>=1 [aw=anfinwgt]
			mat tab[`r',`c']=r(mean)*100
			if "`w'"=="6" {
				svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_p6m==1 & smi_count>=1): tab `x' wave
				mat tab[`r',3]=e(p_Pear)
				mat stars[`r',3]=(e(p_Pear)<.01)+(e(p_Pear)<.05)
}
			local r=`r'+1
}
}
		sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_p6m==1 & smi_count>=1  [aw=anfinwgt]
		mat tab[`r',`c']=r(N)
		mat tab[`r'+1,`c']=r(sum_w)
		local nume=r(sum_w)
		sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) [aw=anfinwgt]
		mat tab[`r'+2,`c']=`nume'/r(sum_w)*100
		local r=1
		local c=`c'+1
}

mat rownames tab=`vars' N n
frmttable using `logpath'\comparison_icd9_icd10_tables`date'_w_adm.rtf, statmat(tab) ///
title("Identifying Serious Illness in ICD-9 and ICD-10" \ ///
"Sample characteristics, NHATS 2014 & 2016") ctitles("" "2014" "2016" "P-value") ///
annotate(stars) asymbol(*,**) replace varlabels ///
note("6+ months of FFS Medicare prior to interview and 1+ SMI and hospital admission")



local smi ind_smi_any `smi'

foreach y in smi comorbs {
local rn : word count ``y''
mat tab=J(`rn'+2,3,.)
mat stars=J(`rn'+2,3,0)
local r=1
local c=1

foreach w in 4 6 {
	foreach x in ``y'' {
			sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_p6m==1 & smi_count>=1 [aw=anfinwgt]
		mat tab[`r',`c']=r(mean)*100
		if "`w'"=="6" {
			svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_p6m==1 & smi_count>=1): tab `x' wave
			mat tab[`r',3]=e(p_Pear)
			mat stars[`r',3]=(e(p_Pear)<.01)+(e(p_Pear)<.05)
}
		local r=`r'+1
}
		sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_p6m==1 & smi_count>=1  [aw=anfinwgt]
		mat tab[`r',`c']=r(N)
		mat tab[`r'+1,`c']=r(sum_w)
		local r=1
		local c=`c'+1
}

mat rownames tab=``y'' N n
if "`y'"=="smi" local title "Serious Medical Illnesses"
else local title "Elixhauser Comorbidities"

frmttable using `logpath'\comparison_icd9_icd10_tables`date'_w_adm.rtf, statmat(tab) title("Identifying Serious Illness in ICD-9 and ICD-10" \ ///
"`title'") ctitles("" "2014" "2016" "P-value") ///
annotate(stars) asymbol(*,**) addtable varlabels ///
note("6+ months of FFS Medicare prior to interview and 1+ SMI and hospital admission" \ ///
"Elixhauser codes modified for renal and liver diseases, and dementia is added" \ ///
"Additional neurodegenerative diseases included with ALS in ICD-10 only")



}

//2/5/19--also looking at stroke, despite tiny sample size
local smi ind_smi_any smi_dem_ind smi_cancer_ind smi_renal_ind smi_copd_ind ///
smi_diab_compl_ind smi_cva_ind

foreach smivar of local smi {


	local rncout : word count `coutcomes'
	mat tab=J(`rnout'+`rncout'+2,3,.)
	mat stars=J(`rnout'+`rncout'+2,3,0)
	local r=1
	local c=1

	foreach w in 4 6 {
			foreach x of local coutcomes {	
				sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_p6m==1 & `smivar'==1 [aw=anfinwgt],d
				mat tab[`r',`c']=r(mean)
				mat tab[`r'+1,`c']=r(p50)
				if "`w'"=="6" {
					svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_p6m==1 & `smivar'==1): mean `x', over(wave)
					test [`x']4=[`x']6
					mat tab[`r',3]=r(p)
					mat stars[`r',3]=(r(p)<.05)+(r(p)<.01)
}
				local r=`r'+2
}
			foreach x of local ioutcomes {
				sum `x' if wave==`w'  & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_p6m==1 & `smivar'==1  [aw=anfinwgt],d
				mat tab[`r',`c']=r(mean)*100
				if "`w'"=="6" {
					svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_p6m==1 & `smivar'==1): tab `x' wave
					mat tab[`r',3]=e(p_Pear)
					mat stars[`r',3]=(e(p_Pear)<.01)+(e(p_Pear)<.05)
}
				local r=`r'+1
}
			sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_p6m==1 & `smivar'==1 [aw=anfinwgt]
			mat tab[`r',`c']=r(N)
			mat tab[`r'+1,`c']=r(sum_w)
			local r=1
			local c=`c'+1
}


	local rnames
	foreach x in `coutcomes' {
	local rnames `rnames' `x' Median
}
	mat rownames tab=`rnames' `ioutcomes' N n
	frmttable using `logpath'\comparison_icd9_icd10_tables`date'_w_adm.rtf, ///
	statmat(tab) title("Identifying Serious Illness in ICD-9 and ICD-10" \ ///
	"Six-month outcomes, `smivar'=1") ctitles("" "2014" "2016" "P-value") ///
	annotate(stars) asymbol(*,**) addtable varlabels ///
	note("6+ months of FFS Medicare prior to interview and 1+ SMI and hospital admission" \ ///
	"Less than 6 full months of follow-up for 42% of sample in 2016" \ ///
	"Expenditures have been inflation adjusted to 2016 dollars")

}
/*

Created by: EBL
Date Created: 2/7/19

Updated by:
Date Updated:


**************************************************
*/

local date = subinstr("$S_DATE"," ","_",.) 
local name @INSERTNAME_`date'
di "`name'"



clear all 
set more off
capture log close

local intpath "${intpath}"
local datapath "${datapath}"
local logpath "${logpath}"



****************************************************


cd `datapath'
*log using `logpath'\table1_xwave.txt, text replace

local date=subinstr("$S_DATE"," ","_",.)

//use serious_ill_nhats_sample, clear
use serious_ill_nhats_1_6_full_6m if !lml & sp_ivw==1, clear
keep if inlist(wave,4,6)
svyset varunit [pw=anfinwgt], strata(varstrat)

local income
forvalues i=1/4 {
	local income `income' income`i'
}

local cvars1 age m2dec m2d
local cvars2 
local ivars1 ind_trunc_m2dec ind_trunc_m2d female white black hisp other_race married educ_hs_ind
local ivars2 `income' proxy  ///
medicaid medigap srh_fp adl_eat_help adl_bath_help adl_toil_help adl_dres_help ///
adl_ins_help adl_bed_help adl_independent nhres ind_hosp_adm_6m

local comorbs 
forvalues i=1/31 {
	local comorbs `comorbs' comorb_`i'_0_6m
}

local comorbs `comorbs' comorb_ge3_0_6m

local smi 
foreach x of varlist smi*ind {
	local smi `smi' `x'
}


local ioutcomes ind_hosp_adm_p6m mult_ip_adm_p6m ind_ed_op_p6m  ///
ind_icu_p6m ind_hs_p6m died_6

local coutcomes ip_paid_by_mc_6m snf_paid_by_mc_6m hh_paid_by_mc_6m ///
 hs_paid_by_mc_6m pb_paid_by_mc_6m op_paid_by_mc_6m ///
 dm_paid_by_mc_6m tot_paid_by_mc_6m n_hospd_p6m
 

gen n=1
gen n2=1
label var n "Population Estimate"
label var n2 "Percentage of total pop. w/ 6m FFS MC"


local vars  `cvars1' `cvars2' `ivars1' `ivars2'

local rnvars : word count `vars'
local rndx : word count `comorbs' `smi'
local rnout : word count `ioutcomes' `coutcomes'

mat tab=J(`rnvars'+3,3,.)
mat stars=J(`rnvars'+3,3,0)
local r=1
local c=1

foreach w in 4 6 {
	forvalues time=1/2 {
		foreach x of local cvars`time' {	
			sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_6m==1 & smi_count>=1 [aw=anfinwgt]
			mat tab[`r',`c']=r(mean)
			if "`w'"=="6" {
				svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_6m==1 & smi_count>=1): mean `x', over(wave)
				test [`x']4=[`x']6
				mat tab[`r',3]=r(p)
				mat stars[`r',3]=(r(p)<.05)+(r(p)<.01)
}
			local r=`r'+1
}
		foreach x of local ivars`time' {
			sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_6m==1 & smi_count>=1 [aw=anfinwgt]
			mat tab[`r',`c']=r(mean)*100
			if "`w'"=="6" {
				svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_6m==1 & smi_count>=1): tab `x' wave
				mat tab[`r',3]=e(p_Pear)
				mat stars[`r',3]=(e(p_Pear)<.01)+(e(p_Pear)<.05)
}
			local r=`r'+1
}
}
		sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & ///
		criteria_a==1 & ind_hosp_adm_6m==1 & smi_count>=1  [aw=anfinwgt]
		mat tab[`r',`c']=r(N)
		mat tab[`r'+1,`c']=r(sum_w)
		local nume=r(sum_w)
		sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) [aw=anfinwgt]
		mat tab[`r'+2,`c']=`nume'/r(sum_w)*100
		di `nume'/r(sum_w)*100
		local r=1
		local c=`c'+1
}

mat rownames tab=`vars' N n n2
frmttable using `logpath'\comparison_icd9_icd10_tables`date'_w_adm.rtf, statmat(tab) ///
title("Identifying Serious Illness in ICD-9 and ICD-10" \ ///
"Sample characteristics, NHATS 2014 & 2016") ctitles("" "2014" "2016" "P-value") ///
annotate(stars) asymbol(*,**) replace varlabels ///
note("6+ months of FFS Medicare prior to interview and 1+ SMI and hospital admission")



local smi ind_smi_any `smi'

foreach y in smi comorbs {
local rn : word count ``y''
mat tab=J(`rn'+2,3,.)
mat stars=J(`rn'+2,3,0)
local r=1
local c=1

foreach w in 4 6 {
	foreach x in ``y'' {
			sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_6m==1 & smi_count>=1 [aw=anfinwgt]
		mat tab[`r',`c']=r(mean)*100
		if "`w'"=="6" {
			svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_6m==1 & smi_count>=1): tab `x' wave
			mat tab[`r',3]=e(p_Pear)
			mat stars[`r',3]=(e(p_Pear)<.01)+(e(p_Pear)<.05)
}
		local r=`r'+1
}
		sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_6m==1 & smi_count>=1  [aw=anfinwgt]
		mat tab[`r',`c']=r(N)
		mat tab[`r'+1,`c']=r(sum_w)
		local r=1
		local c=`c'+1
}

mat rownames tab=``y'' N n
if "`y'"=="smi" local title "Serious Medical Illnesses"
else local title "Elixhauser Comorbidities"

frmttable using `logpath'\comparison_icd9_icd10_tables`date'_w_adm.rtf, statmat(tab) title("Identifying Serious Illness in ICD-9 and ICD-10" \ ///
"`title'") ctitles("" "2014" "2016" "P-value") ///
annotate(stars) asymbol(*,**) addtable varlabels ///
note("6+ months of FFS Medicare prior to interview and 1+ SMI and hospital admission" \ ///
"Elixhauser codes modified for renal and liver diseases, and dementia is added" \ ///
"Additional neurodegenerative diseases included with ALS in ICD-10 only")



}

//2/5/19--also looking at stroke, despite tiny sample size
local smi ind_smi_any smi_dem_ind smi_cancer_ind smi_renal_ind smi_copd_ind ///
smi_diab_compl_ind smi_cva_ind

foreach smivar of local smi {


	local rncout : word count `coutcomes'
	mat tab=J(`rnout'+`rncout'+2,3,.)
	mat stars=J(`rnout'+`rncout'+2,3,0)
	local r=1
	local c=1

	foreach w in 4 6 {
			foreach x of local coutcomes {	
				sum `x' if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_6m==1 & `smivar'==1 [aw=anfinwgt],d
				mat tab[`r',`c']=r(mean)
				mat tab[`r'+1,`c']=r(p50)
				if "`w'"=="6" {
					svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_6m==1 & `smivar'==1): mean `x', over(wave)
					test [`x']4=[`x']6
					mat tab[`r',3]=r(p)
					mat stars[`r',3]=(r(p)<.05)+(r(p)<.01)
}
				local r=`r'+2
}
			foreach x of local ioutcomes {
				sum `x' if wave==`w'  & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_6m==1 & `smivar'==1  [aw=anfinwgt],d
				mat tab[`r',`c']=r(mean)*100
				if "`w'"=="6" {
					svy, subpop(if cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_6m==1 & `smivar'==1): tab `x' wave
					mat tab[`r',3]=e(p_Pear)
					mat stars[`r',3]=(e(p_Pear)<.01)+(e(p_Pear)<.05)
}
				local r=`r'+1
}
			sum n if wave==`w' & cont_ffs_n_mos>=6 & !missing(cont_ffs_n_mos) & criteria_a==1 & ind_hosp_adm_6m==1 & `smivar'==1 [aw=anfinwgt]
			mat tab[`r',`c']=r(N)
			mat tab[`r'+1,`c']=r(sum_w)
			local r=1
			local c=`c'+1
}


	local rnames
	foreach x in `coutcomes' {
	local rnames `rnames' `x' Median
}
	mat rownames tab=`rnames' `ioutcomes' N n
	frmttable using `logpath'\comparison_icd9_icd10_tables`date'_w_adm.rtf, ///
	statmat(tab) title("Identifying Serious Illness in ICD-9 and ICD-10" \ ///
	"Six-month outcomes, `smivar'=1") ctitles("" "2014" "2016" "P-value") ///
	annotate(stars) asymbol(*,**) addtable varlabels ///
	note("6+ months of FFS Medicare prior to interview and 1+ SMI and hospital admission" \ ///
	"Less than 6 full months of follow-up for 42% of sample in 2016" \ ///
	"Expenditures have been inflation adjusted to 2016 dollars")

}


H="changelog"
4/23/19-EBL-Added ICD-10 CCWs (building in the code)

3/7/19-EBL-added PB/OP combination for final output

2/22/19-EBL-notes added for NHATS survey variables and project vars created in Stata

2/14/19-EBL-added codebook code (not yet notes)

2/13/19-EBL-added home oxygen to CHF definition for ICD-10 in "var clean and check criteria" header

2/11/19-EBL-added shareable Comparison tables header

2/8/19-EBL-Added "Comparison tables, restricted to hospital admission"

2/7/19-EBL-started project doc and added code to draw sample from raw data (previously, work done in "Serious Illness Definition" code)